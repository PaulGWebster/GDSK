            "new_value": "lang=fr",
            "expected": {
                "href": "https://example.net/?lang=fr#nav",
                "search": "?lang=fr"
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "lang=fr",
            "expected": {
                "href": "https://example.net/?lang=fr#nav",
                "search": "?lang=fr"
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "?lang=fr",
            "expected": {
                "href": "https://example.net/?lang=fr#nav",
                "search": "?lang=fr"
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "??lang=fr",
            "expected": {
                "href": "https://example.net/??lang=fr#nav",
                "search": "??lang=fr"
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "?",
            "expected": {
                "href": "https://example.net/?#nav",
                "search": ""
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "",
            "expected": {
                "href": "https://example.net/#nav",
                "search": ""
            }
        },
        {
            "href": "https://example.net?lang=en-US",
            "new_value": "",
            "expected": {
                "href": "https://example.net/",
                "search": ""
            }
        },
        {
            "href": "https://example.net",
            "new_value": "",
            "expected": {
                "href": "https://example.net/",
                "search": ""
            }
        },
        {
            "comment": "UTF-8 percent encoding with the query encode set. Tabs and newlines are removed.",
            "href": "a:/",
            "new_value": "\u0000\u0001\t\n\r\u001f !\"#$%&'()*+,-./09:;<=>?@AZ[\\]^_`az{|}~\u007f\u0080\u0081Éé",
            "expected": {
                "href": "a:/?%00%01%1F%20!%22%23$%&'()*+,-./09:;%3C=%3E?@AZ[\\]^_`az{|}~%7F%C2%80%C2%81%C3%89%C3%A9",
                "search": "?%00%01%1F%20!%22%23$%&'()*+,-./09:;%3C=%3E?@AZ[\\]^_`az{|}~%7F%C2%80%C2%81%C3%89%C3%A9"
            }
        },
        {
            "comment": "Bytes already percent-encoded are left as-is",
            "href": "http://example.net",
            "new_value": "%c3%89té",
            "expected": {
                "href": "http://example.net/?%c3%89t%C3%A9",
                "search": "?%c3%89t%C3%A9"
            }
        },
        {
            "comment": "Drop trailing spaces from trailing opaque paths",
            "href": "data:space ?query",
            "new_value": "",
            "expected": {
                "href": "data:space",
                "pathname": "space",
                "search": ""
            }
        },
        {
            "href": "sc:space ?query",
            "new_value": "",
            "expected": {
                "href": "sc:space",
                "pathname": "space",
                "search": ""
            }
        },
        {
            "comment": "Do not drop trailing spaces from non-trailing opaque paths",
            "href": "data:space  ?query#fragment",
            "new_value": "",
            "expected": {
                "href": "data:space  #fragment",
                "search": ""
            }
        },
        {
            "href": "sc:space  ?query#fragment",
            "new_value": "",
            "expected": {
                "href": "sc:space  #fragment",
                "search": ""
            }
        },
        {
            "comment": "Trailing space should be encoded",
            "href": "http://example.net",
            "new_value": " ",
            "expected": {
                "href": "http://example.net/?%20",
                "search": "?%20"
            }
        },
        {
            "comment": "Trailing C0 control should be encoded",
            "href": "http://example.net",
            "new_value": "\u0000",
            "expected": {
                "href": "http://example.net/?%00",
                "search": "?%00"
            }
        }
    ],
    "hash": [
        {
            "href": "https://example.net",
            "new_value": "main",
            "expected": {
                "href": "https://example.net/#main",
                "hash": "#main"
            }
        },
        {
            "href": "https://example.net#nav",
            "new_value": "main",
            "expected": {
                "href": "https://example.net/#main",
                "hash": "#main"
            }
        },
        {
            "href": "https://example.net?lang=en-US",
            "new_value": "##nav",
            "expected": {
                "href": "https://example.net/?lang=en-US##nav",
                "hash": "##nav"
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "#main",
            "expected": {
                "href": "https://example.net/?lang=en-US#main",
                "hash": "#main"
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "#",
            "expected": {
                "href": "https://example.net/?lang=en-US#",
                "hash": ""
            }
        },
        {
            "href": "https://example.net?lang=en-US#nav",
            "new_value": "",
            "expected": {
                "href": "https://example.net/?lang=en-US",
                "hash": ""
            }
        },
        {
            "href": "http://example.net",
            "new_value": "#foo bar",
            "expected": {
                "href": "http://example.net/#foo%20bar",
                "hash": "#foo%20bar"
            }
        },
        {
            "href": "http://example.net",
            "new_value": "#foo\"bar",
            "expected": {
                "href": "http://example.net/#foo%22bar",
                "hash": "#foo%22bar"
            }
        },
        {
            "href": "http://example.net",
            "new_value": "#foo<bar",
            "expected": {
                "href": "http://example.net/#foo%3Cbar",
                "hash": "#foo%3Cbar"
            }
        },
        {
            "href": "http://example.net",
            "new_value": "#foo>bar",
            "expected": {
                "href": "http://example.net/#foo%3Ebar",
                "hash": "#foo%3Ebar"
            }
        },
        {
            "href": "http://example.net",
            "new_value": "#foo`bar",
            "expected": {
                "href": "http://example.net/#foo%60bar",
                "hash": "#foo%60bar"
            }
        },
        {
            "comment": "Simple percent-encoding; tabs and newlines are removed",
            "href": "a:/",
            "new_value": "\u0000\u0001\t\n\r\u001f !\"#$%&'()*+,-./09:;<=>?@AZ[\\]^_`az{|}~\u007f\u0080\u0081Éé",
            "expected": {
                "href": "a:/#%00%01%1F%20!%22#$%&'()*+,-./09:;%3C=%3E?@AZ[\\]^_%60az{|}~%7F%C2%80%C2%81%C3%89%C3%A9",
                "hash": "#%00%01%1F%20!%22#$%&'()*+,-./09:;%3C=%3E?@AZ[\\]^_%60az{|}~%7F%C2%80%C2%81%C3%89%C3%A9"
            }
        },
        {
            "comment": "Percent-encode NULLs in fragment",
            "href": "http://example.net",
            "new_value": "a\u0000b",
            "expected": {
                "href": "http://example.net/#a%00b",
                "hash": "#a%00b"
            }
        },
        {
            "comment": "Percent-encode NULLs in fragment",
            "href": "non-spec:/",
            "new_value": "a\u0000b",
            "expected": {
                "href": "non-spec:/#a%00b",
                "hash": "#a%00b"
            }
        },
        {
            "comment": "Bytes already percent-encoded are left as-is",
            "href": "http://example.net",
            "new_value": "%c3%89té",
            "expected": {
                "href": "http://example.net/#%c3%89t%C3%A9",
                "hash": "#%c3%89t%C3%A9"
            }
        },
        {
            "href": "javascript:alert(1)",
            "new_value": "castle",
            "expected": {
                "href": "javascript:alert(1)#castle",
                "hash": "#castle"
            }
        },
        {
            "comment": "Drop trailing spaces from trailing opaque paths",
            "href": "data:space                                                                                                                                  #fragment",
            "new_value": "",
            "expected": {
                "href": "data:space",
                "pathname": "space",
                "hash": ""
            }
        },
        {
            "href": "sc:space    #fragment",
            "new_value": "",
            "expected": {
                "href": "sc:space",
                "pathname": "space",
                "hash": ""
            }
        },
        {
            "comment": "Do not drop trailing spaces from non-trailing opaque paths",
            "href": "data:space  ?query#fragment",
            "new_value": "",
            "expected": {
                "href": "data:space  ?query",
                "hash": ""
            }
        },
        {
            "href": "sc:space  ?query#fragment",
            "new_value": "",
            "expected": {
                "href": "sc:space  ?query",
                "hash": ""
            }
        },
        {
            "comment": "Trailing space should be encoded",
            "href": "http://example.net",
            "new_value": " ",
            "expected": {
                "href": "http://example.net/#%20",
                "hash": "#%20"
            }
        },
        {
            "comment": "Trailing C0 control should be encoded",
            "href": "http://example.net",
            "new_value": "\u0000",
            "expected": {
                "href": "http://example.net/#%00",
                "hash": "#%00"
            }
        }
    ],
    "href": [
        {
            "href": "file:///var/log/system.log",
            "new_value": "http://0300.168.0xF0",
            "expected": {
                "href": "http://192.168.0.240/",
                "protocol": "http:"
            }
        }
    ]
}
                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/url/resources/toascii.json                                            0000664 0000000 0000000 00000021240 14746647661 0023360 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        [
  "This contains assorted IDNA tests that IdnaTestV2 might not cover.",
  "Feel free to deduplicate with a clear commit message.",
  {
    "comment": "Label with hyphens in 3rd and 4th position",
    "input": "aa--",
    "output": "aa--"
  },
  {
    "input": "a†--",
    "output": "xn--a---kp0a"
  },
  {
    "input": "ab--c",
    "output": "ab--c"
  },
  {
    "comment": "Label with leading hyphen",
    "input": "-x",
    "output": "-x"
  },
  {
    "input": "-†",
    "output": "xn----xhn"
  },
  {
    "input": "-x.xn--zca",
    "output": "-x.xn--zca"
  },
  {
    "input": "-x.ß",
    "output": "-x.xn--zca"
  },
  {
    "comment": "Label with trailing hyphen",
    "input": "x-.xn--zca",
    "output": "x-.xn--zca"
  },
  {
    "input": "x-.ß",
    "output": "x-.xn--zca"
  },
  {
    "comment": "Empty labels",
    "input": "x..xn--zca",
    "output": "x..xn--zca"
  },
  {
    "input": "x..ß",
    "output": "x..xn--zca"
  },
  {
    "comment": "Invalid Punycode",
    "input": "xn--a",
    "output": null
  },
  {
    "input": "xn--a.xn--zca",
    "output": null
  },
  {
    "input": "xn--a.ß",
    "output": null
  },
  {
    "input": "xn--ls8h=",
    "output": null
  },
  {
    "comment": "Invalid Punycode (contains non-ASCII character)",
    "input": "xn--tešla",
    "output": null
  },
  {
    "comment": "Valid Punycode",
    "input": "xn--zca.xn--zca",
    "output": "xn--zca.xn--zca"
  },
  {
    "comment": "Mixed",
    "input": "xn--zca.ß",
    "output": "xn--zca.xn--zca"
  },
  {
    "input": "ab--c.xn--zca",
    "output": "ab--c.xn--zca"
  },
  {
    "input": "ab--c.ß",
    "output": "ab--c.xn--zca"
  },
  {
    "comment": "CheckJoiners is true",
    "input": "\u200D.example",
    "output": null
  },
  {
    "input": "xn--1ug.example",
    "output": null
  },
  {
    "comment": "CheckBidi is true",
    "input": "يa",
    "output": null
  },
  {
    "input": "xn--a-yoc",
    "output": null
  },
  {
    "comment": "processing_option is Nontransitional_Processing",
    "input": "ශ්‍රී",
    "output": "xn--10cl1a0b660p"
  },
  {
    "input": "نامه‌ای",
    "output": "xn--mgba3gch31f060k"
  },
  {
    "comment": "U+FFFD",
    "input": "\uFFFD.com",
    "output": null
  },
  {
    "comment": "U+FFFD character encoded in Punycode",
    "input": "xn--zn7c.com",
    "output": null
  },
  {
    "comment": "Label longer than 63 code points",
    "input": "x01234567890123456789012345678901234567890123456789012345678901x",
    "output": "x01234567890123456789012345678901234567890123456789012345678901x"
  },
  {
    "input": "x01234567890123456789012345678901234567890123456789012345678901†",
    "output": "xn--x01234567890123456789012345678901234567890123456789012345678901-6963b"
  },
  {
    "input": "x01234567890123456789012345678901234567890123456789012345678901x.xn--zca",
    "output": "x01234567890123456789012345678901234567890123456789012345678901x.xn--zca"
  },
  {
    "input": "x01234567890123456789012345678901234567890123456789012345678901x.ß",
    "output": "x01234567890123456789012345678901234567890123456789012345678901x.xn--zca"
  },
  {
    "comment": "Domain excluding TLD longer than 253 code points",
    "input": "01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.0123456789012345678901234567890123456789012345678.x",
    "output": "01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.0123456789012345678901234567890123456789012345678.x"
  },
  {
    "input": "01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.0123456789012345678901234567890123456789012345678.xn--zca",
    "output": "01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.0123456789012345678901234567890123456789012345678.xn--zca"
  },
  {
    "input": "01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.0123456789012345678901234567890123456789012345678.ß",
    "output": "01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.01234567890123456789012345678901234567890123456789.0123456789012345678901234567890123456789012345678.xn--zca"
  },
  {
    "comment": "IDNA ignored code points",
    "input": "a\u00ADb",
    "output": "ab"
  },
  {
    "comment": "Interesting UseSTD3ASCIIRules=false cases",
    "input": "≠",
    "output": "xn--1ch"
  },
  {
    "input": "≮",
    "output": "xn--gdh"
  },
  {
    "input": "≯",
    "output": "xn--hdh"
  },
  {
    "comment": "NFC normalization (forbidden < and > characters are normalized to valid ones)",
    "input": "=\u0338",
    "output": "xn--1ch"
  },
  {
    "input": "<\u0338",
    "output": "xn--gdh"
  },
  {
    "input": ">\u0338",
    "output": "xn--hdh"
  },
  {
    "comment": "Same with inserted IDNA ignored code point",
    "input": "=\u00AD\u0338",
    "output": "xn--1ch"
  },
  {
    "input": "<\u00AD\u0338",
    "output": "xn--gdh"
  },
  {
    "input": ">\u00AD\u0338",
    "output": "xn--hdh"
  },
  "Tests below are from WebKit (fast/url/idna2003.html & fast/url/idna2008.html; contributed by Chris Weber back in 2011).",
  {
    "input": "fa\u00DF.de",
    "output": "xn--fa-hia.de"
  },
  {
    "input": "\u03B2\u03CC\u03BB\u03BF\u03C2.com",
    "output": "xn--nxasmm1c.com"
  },
  {
    "input": "\u0DC1\u0DCA\u200D\u0DBB\u0DD3.com",
    "output": "xn--10cl1a0b660p.com"
  },
  {
    "input": "\u0646\u0627\u0645\u0647\u200C\u0627\u06CC.com",
    "output": "xn--mgba3gch31f060k.com"
  },
  {
    "input": "www.loo\u0138out.net",
    "output": "www.xn--looout-5bb.net"
  },
  {
    "input": "\u15EF\u15EF\u15EF.lookout.net",
    "output": "xn--1qeaa.lookout.net"
  },
  {
    "input": "www.lookout.\u0441\u043E\u043C",
    "output": "www.lookout.xn--l1adi"
  },
  {
    "input": "www\u2025lookout.net",
    "output": null
  },
  {
    "input": "www.lookout\u2027net",
    "output": "www.xn--lookoutnet-406e"
  },
  {
    "input": "www.lookout.net\u2A7480",
    "output": null
  },
  {
    "input": "www\u00A0.lookout.net",
    "output": null
  },
  {
    "input": "\u1680lookout.net",
    "output": null
  },
  {
    "input": "\u001flookout.net",
    "output": null
  },
  {
    "input": "look\u06DDout.net",
    "output": null
  },
  {
    "input": "look\u180Eout.net",
    "output": null
  },
  {
    "input": "look\u2060out.net",
    "output": "lookout.net"
  },
  {
    "input": "look\uFEFFout.net",
    "output": "lookout.net"
  },
  {
    "input": "look\uD83F\uDFFEout.net",
    "output": null
  },
  {
    "input": "look\uFFFAout.net",
    "output": null
  },
  {
    "input": "look\u2FF0out.net",
    "output": null
  },
  {
    "input": "look\u0341out.net",
    "output": "xn--looout-kp7b.net"
  },
  {
    "input": "look\u202Eout.net",
    "output": null
  },
  {
    "input": "look\u206Bout.net",
    "output": null
  },
  {
    "input": "look\uDB40\uDC01out.net",
    "output": null
  },
  {
    "input": "look\uDB40\uDC20out.net",
    "output": null
  },
  {
    "input": "look\u05BEout.net",
    "output": null
  },
  {
    "input": "B\u00FCcher.de",
    "output": "xn--bcher-kva.de"
  },
  {
    "input": "\u2665.net",
    "output": "xn--g6h.net"
  },
  {
    "input": "\u0378.net",
    "output": null
  },
  {
    "input": "\u04C0.com",
    "output": null
  },
  {
    "comment": "This is U+2F868 (which is mapped to U+36FC starting with Unicode 16.0)",
    "input": "\uD87E\uDC68.com",
    "output": "xn--snl.com"
  },
  {
    "input": "\u2183.com",
    "output": null
  },
  {
    "input": "look\u034Fout.net",
    "output": "lookout.net"
  },
  {
    "input": "gOoGle.com",
    "output": "google.com"
  },
  {
    "input": "\u09dc.com",
    "output": "xn--15b8c.com"
  },
  {
    "input": "\u1E9E.com",
    "output": "xn--zca.com"
  },
  {
    "input": "\u1E9E.foo.com",
    "output": "xn--zca.foo.com"
  },
  {
    "input": "-foo.bar.com",
    "output": "-foo.bar.com"
  },
  {
    "input": "foo-.bar.com",
    "output": "foo-.bar.com"
  },
  {
    "input": "ab--cd.com",
    "output": "ab--cd.com"
  },
  {
    "input": "xn--0.com",
    "output": null
  },
  {
    "input": "foo\u0300.bar.com",
    "output": "xn--fo-3ja.bar.com"
  }
]
                                                                                                                                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/url/resources/urltestdata-javascript-only.json                        0000664 0000000 0000000 00000001606 14746647661 0027410 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        [
    "See ../README.md for a description of the format.",
    {
        "input": "http://example.com/\uD800\uD801\uDFFE\uDFFF\uFDD0\uFDCF\uFDEF\uFDF0\uFFFE\uFFFF?\uD800\uD801\uDFFE\uDFFF\uFDD0\uFDCF\uFDEF\uFDF0\uFFFE\uFFFF",
        "base": null,
        "href": "http://example.com/%EF%BF%BD%F0%90%9F%BE%EF%BF%BD%EF%B7%90%EF%B7%8F%EF%B7%AF%EF%B7%B0%EF%BF%BE%EF%BF%BF?%EF%BF%BD%F0%90%9F%BE%EF%BF%BD%EF%B7%90%EF%B7%8F%EF%B7%AF%EF%B7%B0%EF%BF%BE%EF%BF%BF",
        "origin": "http://example.com",
        "protocol": "http:",
        "username": "",
        "password": "",
        "host": "example.com",
        "hostname": "example.com",
        "port": "",
        "pathname": "/%EF%BF%BD%F0%90%9F%BE%EF%BF%BD%EF%B7%90%EF%B7%8F%EF%B7%AF%EF%B7%B0%EF%BF%BE%EF%BF%BF",
        "search": "?%EF%BF%BD%F0%90%9F%BE%EF%BF%BD%EF%B7%90%EF%B7%8F%EF%B7%AF%EF%B7%B0%EF%BF%BE%EF%BF%BF",
        "hash": ""
    }
]
                                                                                                                          node-23.7.0/test/fixtures/wpt/url/resources/urltestdata.json                                        0000664 0000000 0000000 00000644440 14746647661 0024276 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        [
  "See ../README.md for a description of the format.",
  {
    "input": "http://example\t.\norg",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://user:pass@foo:21/bar;par?b#c",
    "base": "http://example.org/foo/bar",
    "href": "http://user:pass@foo:21/bar;par?b#c",
    "origin": "http://foo:21",
    "protocol": "http:",
    "username": "user",
    "password": "pass",
    "host": "foo:21",
    "hostname": "foo",
    "port": "21",
    "pathname": "/bar;par",
    "search": "?b",
    "hash": "#c"
  },
  {
    "input": "https://test:@test",
    "base": null,
    "href": "https://test@test/",
    "origin": "https://test",
    "protocol": "https:",
    "username": "test",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https://:@test",
    "base": null,
    "href": "https://test/",
    "origin": "https://test",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://test:@test/x",
    "base": null,
    "href": "non-special://test@test/x",
    "origin": "null",
    "protocol": "non-special:",
    "username": "test",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/x",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://:@test/x",
    "base": null,
    "href": "non-special://test/x",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/x",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:foo.com",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/foo.com",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/foo.com",
    "search": "",
    "hash": ""
  },
  {
    "input": "\t   :foo.com   \n",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:foo.com",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:foo.com",
    "search": "",
    "hash": ""
  },
  {
    "input": " foo.com  ",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/foo.com",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/foo.com",
    "search": "",
    "hash": ""
  },
  {
    "input": "a:\t foo.com",
    "base": "http://example.org/foo/bar",
    "href": "a: foo.com",
    "origin": "null",
    "protocol": "a:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": " foo.com",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://f:21/ b ? d # e ",
    "base": "http://example.org/foo/bar",
    "href": "http://f:21/%20b%20?%20d%20#%20e",
    "origin": "http://f:21",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "f:21",
    "hostname": "f",
    "port": "21",
    "pathname": "/%20b%20",
    "search": "?%20d%20",
    "hash": "#%20e"
  },
  {
    "input": "lolscheme:x x#x x",
    "base": null,
    "href": "lolscheme:x x#x%20x",
    "protocol": "lolscheme:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "x x",
    "search": "",
    "hash": "#x%20x"
  },
  {
    "input": "http://f:/c",
    "base": "http://example.org/foo/bar",
    "href": "http://f/c",
    "origin": "http://f",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "f",
    "hostname": "f",
    "port": "",
    "pathname": "/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://f:0/c",
    "base": "http://example.org/foo/bar",
    "href": "http://f:0/c",
    "origin": "http://f:0",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "f:0",
    "hostname": "f",
    "port": "0",
    "pathname": "/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://f:00000000000000/c",
    "base": "http://example.org/foo/bar",
    "href": "http://f:0/c",
    "origin": "http://f:0",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "f:0",
    "hostname": "f",
    "port": "0",
    "pathname": "/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://f:00000000000000000000080/c",
    "base": "http://example.org/foo/bar",
    "href": "http://f/c",
    "origin": "http://f",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "f",
    "hostname": "f",
    "port": "",
    "pathname": "/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://f:b/c",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://f: /c",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://f:\n/c",
    "base": "http://example.org/foo/bar",
    "href": "http://f/c",
    "origin": "http://f",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "f",
    "hostname": "f",
    "port": "",
    "pathname": "/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://f:fifty-two/c",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://f:999999/c",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "non-special://f:999999/c",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://f: 21 / b ? d # e ",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "  \t",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": ":foo.com/",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:foo.com/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:foo.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": ":foo.com\\",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:foo.com/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:foo.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": ":",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:",
    "search": "",
    "hash": ""
  },
  {
    "input": ":a",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:a",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:a",
    "search": "",
    "hash": ""
  },
  {
    "input": ":/",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:/",
    "search": "",
    "hash": ""
  },
  {
    "input": ":\\",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:/",
    "search": "",
    "hash": ""
  },
  {
    "input": ":#",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:#",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:",
    "search": "",
    "hash": ""
  },
  {
    "input": "#",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar#",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "#/",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar#/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": "#/"
  },
  {
    "input": "#\\",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar#\\",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": "#\\"
  },
  {
    "input": "#;?",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar#;?",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": "#;?"
  },
  {
    "input": "?",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar?",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "/",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": ":23",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:23",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:23",
    "search": "",
    "hash": ""
  },
  {
    "input": "/:23",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/:23",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/:23",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\x",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/x",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/x",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\\\x\\hello",
    "base": "http://example.org/foo/bar",
    "href": "http://x/hello",
    "origin": "http://x",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "x",
    "hostname": "x",
    "port": "",
    "pathname": "/hello",
    "search": "",
    "hash": ""
  },
  {
    "input": "::",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/::",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/::",
    "search": "",
    "hash": ""
  },
  {
    "input": "::23",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/::23",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/::23",
    "search": "",
    "hash": ""
  },
  {
    "input": "foo://",
    "base": "http://example.org/foo/bar",
    "href": "foo://",
    "origin": "null",
    "protocol": "foo:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://a:b@c:29/d",
    "base": "http://example.org/foo/bar",
    "href": "http://a:b@c:29/d",
    "origin": "http://c:29",
    "protocol": "http:",
    "username": "a",
    "password": "b",
    "host": "c:29",
    "hostname": "c",
    "port": "29",
    "pathname": "/d",
    "search": "",
    "hash": ""
  },
  {
    "input": "http::@c:29",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/:@c:29",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/:@c:29",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://&a:foo(b]c@d:2/",
    "base": "http://example.org/foo/bar",
    "href": "http://&a:foo(b%5Dc@d:2/",
    "origin": "http://d:2",
    "protocol": "http:",
    "username": "&a",
    "password": "foo(b%5Dc",
    "host": "d:2",
    "hostname": "d",
    "port": "2",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://::@c@d:2",
    "base": "http://example.org/foo/bar",
    "href": "http://:%3A%40c@d:2/",
    "origin": "http://d:2",
    "protocol": "http:",
    "username": "",
    "password": "%3A%40c",
    "host": "d:2",
    "hostname": "d",
    "port": "2",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://foo.com:b@d/",
    "base": "http://example.org/foo/bar",
    "href": "http://foo.com:b@d/",
    "origin": "http://d",
    "protocol": "http:",
    "username": "foo.com",
    "password": "b",
    "host": "d",
    "hostname": "d",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://foo.com/\\@",
    "base": "http://example.org/foo/bar",
    "href": "http://foo.com//@",
    "origin": "http://foo.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.com",
    "hostname": "foo.com",
    "port": "",
    "pathname": "//@",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:\\\\foo.com\\",
    "base": "http://example.org/foo/bar",
    "href": "http://foo.com/",
    "origin": "http://foo.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.com",
    "hostname": "foo.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:\\\\a\\b:c\\d@foo.com\\",
    "base": "http://example.org/foo/bar",
    "href": "http://a/b:c/d@foo.com/",
    "origin": "http://a",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "a",
    "hostname": "a",
    "port": "",
    "pathname": "/b:c/d@foo.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://a:b@c\\",
    "base": null,
    "href": "http://a:b@c/",
    "origin": "http://c",
    "protocol": "http:",
    "username": "a",
    "password": "b",
    "host": "c",
    "hostname": "c",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws://a@b\\c",
    "base": null,
    "href": "ws://a@b/c",
    "origin": "ws://b",
    "protocol": "ws:",
    "username": "a",
    "password": "",
    "host": "b",
    "hostname": "b",
    "port": "",
    "pathname": "/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "foo:/",
    "base": "http://example.org/foo/bar",
    "href": "foo:/",
    "origin": "null",
    "protocol": "foo:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "foo:/bar.com/",
    "base": "http://example.org/foo/bar",
    "href": "foo:/bar.com/",
    "origin": "null",
    "protocol": "foo:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/bar.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "foo://///////",
    "base": "http://example.org/foo/bar",
    "href": "foo://///////",
    "origin": "null",
    "protocol": "foo:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "///////",
    "search": "",
    "hash": ""
  },
  {
    "input": "foo://///////bar.com/",
    "base": "http://example.org/foo/bar",
    "href": "foo://///////bar.com/",
    "origin": "null",
    "protocol": "foo:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "///////bar.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "foo:////://///",
    "base": "http://example.org/foo/bar",
    "href": "foo:////://///",
    "origin": "null",
    "protocol": "foo:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//://///",
    "search": "",
    "hash": ""
  },
  {
    "input": "c:/foo",
    "base": "http://example.org/foo/bar",
    "href": "c:/foo",
    "origin": "null",
    "protocol": "c:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "//foo/bar",
    "base": "http://example.org/foo/bar",
    "href": "http://foo/bar",
    "origin": "http://foo",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://foo/path;a??e#f#g",
    "base": "http://example.org/foo/bar",
    "href": "http://foo/path;a??e#f#g",
    "origin": "http://foo",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/path;a",
    "search": "??e",
    "hash": "#f#g"
  },
  {
    "input": "http://foo/abcd?efgh?ijkl",
    "base": "http://example.org/foo/bar",
    "href": "http://foo/abcd?efgh?ijkl",
    "origin": "http://foo",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/abcd",
    "search": "?efgh?ijkl",
    "hash": ""
  },
  {
    "input": "http://foo/abcd#foo?bar",
    "base": "http://example.org/foo/bar",
    "href": "http://foo/abcd#foo?bar",
    "origin": "http://foo",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/abcd",
    "search": "",
    "hash": "#foo?bar"
  },
  {
    "input": "[61:24:74]:98",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/[61:24:74]:98",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/[61:24:74]:98",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:[61:27]/:foo",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/[61:27]/:foo",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/[61:27]/:foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://[1::2]:3:4",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://2001::1",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://2001::1]",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://2001::1]:80",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://[2001::1]",
    "base": "http://example.org/foo/bar",
    "href": "http://[2001::1]/",
    "origin": "http://[2001::1]",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[2001::1]",
    "hostname": "[2001::1]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://[::127.0.0.1]",
    "base": "http://example.org/foo/bar",
    "href": "http://[::7f00:1]/",
    "origin": "http://[::7f00:1]",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[::7f00:1]",
    "hostname": "[::7f00:1]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://[::127.0.0.1.]",
    "base": "http://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "http://[0:0:0:0:0:0:13.1.68.3]",
    "base": "http://example.org/foo/bar",
    "href": "http://[::d01:4403]/",
    "origin": "http://[::d01:4403]",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[::d01:4403]",
    "hostname": "[::d01:4403]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://[2001::1]:80",
    "base": "http://example.org/foo/bar",
    "href": "http://[2001::1]/",
    "origin": "http://[2001::1]",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[2001::1]",
    "hostname": "[2001::1]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/example.com/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftp:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "ftp://example.com/",
    "origin": "ftp://example.com",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "https://example.com/",
    "origin": "https://example.com",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "madeupscheme:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "madeupscheme:/example.com/",
    "origin": "null",
    "protocol": "madeupscheme:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "file:///example.com/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://example:1/",
    "base": null,
    "failure": true
  },
  {
    "input": "file://example:test/",
    "base": null,
    "failure": true
  },
  {
    "input": "file://example%/",
    "base": null,
    "failure": true
  },
  {
    "input": "file://[example]/",
    "base": null,
    "failure": true
  },
  {
    "input": "ftps:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "ftps:/example.com/",
    "origin": "null",
    "protocol": "ftps:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "gopher:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "gopher:/example.com/",
    "origin": "null",
    "protocol": "gopher:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "ws://example.com/",
    "origin": "ws://example.com",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "wss://example.com/",
    "origin": "wss://example.com",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "data:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "data:/example.com/",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "javascript:/example.com/",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto:/example.com/",
    "base": "http://example.org/foo/bar",
    "href": "mailto:/example.com/",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/example.com/",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftp:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "ftp://example.com/",
    "origin": "ftp://example.com",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "https://example.com/",
    "origin": "https://example.com",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "madeupscheme:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "madeupscheme:example.com/",
    "origin": "null",
    "protocol": "madeupscheme:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftps:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "ftps:example.com/",
    "origin": "null",
    "protocol": "ftps:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "gopher:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "gopher:example.com/",
    "origin": "null",
    "protocol": "gopher:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "ws://example.com/",
    "origin": "ws://example.com",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "wss://example.com/",
    "origin": "wss://example.com",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "data:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "data:example.com/",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "javascript:example.com/",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto:example.com/",
    "base": "http://example.org/foo/bar",
    "href": "mailto:example.com/",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "/a/b/c",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/a/b/c",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/a/b/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "/a/ /c",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/a/%20/c",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/a/%20/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "/a%2fc",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/a%2fc",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/a%2fc",
    "search": "",
    "hash": ""
  },
  {
    "input": "/a/%2f/c",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/a/%2f/c",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/a/%2f/c",
    "search": "",
    "hash": ""
  },
  {
    "input": "#β",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar#%CE%B2",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": "#%CE%B2"
  },
  {
    "input": "data:text/html,test#test",
    "base": "http://example.org/foo/bar",
    "href": "data:text/html,test#test",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "text/html,test",
    "search": "",
    "hash": "#test"
  },
  {
    "input": "tel:1234567890",
    "base": "http://example.org/foo/bar",
    "href": "tel:1234567890",
    "origin": "null",
    "protocol": "tel:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "1234567890",
    "search": "",
    "hash": ""
  },
  "# Based on https://felixfbecker.github.io/whatwg-url-custom-host-repro/",
  {
    "input": "ssh://example.com/foo/bar.git",
    "base": "http://example.org/",
    "href": "ssh://example.com/foo/bar.git",
    "origin": "null",
    "protocol": "ssh:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/bar.git",
    "search": "",
    "hash": ""
  },
  "# Based on http://trac.webkit.org/browser/trunk/LayoutTests/fast/url/file.html",
  {
    "input": "file:c:\\foo\\bar.html",
    "base": "file:///tmp/mock/path",
    "href": "file:///c:/foo/bar.html",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/c:/foo/bar.html",
    "search": "",
    "hash": ""
  },
  {
    "input": "  File:c|////foo\\bar.html",
    "base": "file:///tmp/mock/path",
    "href": "file:///c:////foo/bar.html",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/c:////foo/bar.html",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|/foo/bar",
    "base": "file:///tmp/mock/path",
    "href": "file:///C:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "/C|\\foo\\bar",
    "base": "file:///tmp/mock/path",
    "href": "file:///C:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "//C|/foo/bar",
    "base": "file:///tmp/mock/path",
    "href": "file:///C:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "//server/file",
    "base": "file:///tmp/mock/path",
    "href": "file://server/file",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "server",
    "hostname": "server",
    "port": "",
    "pathname": "/file",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\\\server\\file",
    "base": "file:///tmp/mock/path",
    "href": "file://server/file",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "server",
    "hostname": "server",
    "port": "",
    "pathname": "/file",
    "search": "",
    "hash": ""
  },
  {
    "input": "/\\server/file",
    "base": "file:///tmp/mock/path",
    "href": "file://server/file",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "server",
    "hostname": "server",
    "port": "",
    "pathname": "/file",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///foo/bar.txt",
    "base": "file:///tmp/mock/path",
    "href": "file:///foo/bar.txt",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/foo/bar.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///home/me",
    "base": "file:///tmp/mock/path",
    "href": "file:///home/me",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/home/me",
    "search": "",
    "hash": ""
  },
  {
    "input": "//",
    "base": "file:///tmp/mock/path",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///",
    "base": "file:///tmp/mock/path",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///test",
    "base": "file:///tmp/mock/path",
    "href": "file:///test",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://test",
    "base": "file:///tmp/mock/path",
    "href": "file://test/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://localhost",
    "base": "file:///tmp/mock/path",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://localhost/",
    "base": "file:///tmp/mock/path",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://localhost/test",
    "base": "file:///tmp/mock/path",
    "href": "file:///test",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "test",
    "base": "file:///tmp/mock/path",
    "href": "file:///tmp/mock/test",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/tmp/mock/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:test",
    "base": "file:///tmp/mock/path",
    "href": "file:///tmp/mock/test",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/tmp/mock/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///w|m",
    "base": null,
    "href": "file:///w|m",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/w|m",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///w||m",
    "base": null,
    "href": "file:///w||m",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/w||m",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///w|/m",
    "base": null,
    "href": "file:///w:/m",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/w:/m",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:C|/m/",
    "base": null,
    "href": "file:///C:/m/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/m/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:C||/m/",
    "base": null,
    "href": "file:///C||/m/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C||/m/",
    "search": "",
    "hash": ""
  },
  "# Based on http://trac.webkit.org/browser/trunk/LayoutTests/fast/url/script-tests/path.js",
  {
    "input": "http://example.com/././foo",
    "base": null,
    "href": "http://example.com/foo",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/./.foo",
    "base": null,
    "href": "http://example.com/.foo",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/.foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/.",
    "base": null,
    "href": "http://example.com/foo/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/./",
    "base": null,
    "href": "http://example.com/foo/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/bar/..",
    "base": null,
    "href": "http://example.com/foo/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/bar/../",
    "base": null,
    "href": "http://example.com/foo/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/..bar",
    "base": null,
    "href": "http://example.com/foo/..bar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/..bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/bar/../ton",
    "base": null,
    "href": "http://example.com/foo/ton",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/ton",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/bar/../ton/../../a",
    "base": null,
    "href": "http://example.com/a",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/../../..",
    "base": null,
    "href": "http://example.com/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/../../../ton",
    "base": null,
    "href": "http://example.com/ton",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/ton",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/%2e",
    "base": null,
    "href": "http://example.com/foo/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/%2e%2",
    "base": null,
    "href": "http://example.com/foo/%2e%2",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/%2e%2",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/%2e./%2e%2e/.%2e/%2e.bar",
    "base": null,
    "href": "http://example.com/%2e.bar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%2e.bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com////../..",
    "base": null,
    "href": "http://example.com//",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/bar//../..",
    "base": null,
    "href": "http://example.com/foo/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo/bar//..",
    "base": null,
    "href": "http://example.com/foo/bar/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo/bar/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo",
    "base": null,
    "href": "http://example.com/foo",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/%20foo",
    "base": null,
    "href": "http://example.com/%20foo",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%20foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo%",
    "base": null,
    "href": "http://example.com/foo%",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo%2",
    "base": null,
    "href": "http://example.com/foo%2",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%2",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo%2zbar",
    "base": null,
    "href": "http://example.com/foo%2zbar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%2zbar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo%2Â©zbar",
    "base": null,
    "href": "http://example.com/foo%2%C3%82%C2%A9zbar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%2%C3%82%C2%A9zbar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo%41%7a",
    "base": null,
    "href": "http://example.com/foo%41%7a",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%41%7a",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo\t\u0091%91",
    "base": null,
    "href": "http://example.com/foo%C2%91%91",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%C2%91%91",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo%00%51",
    "base": null,
    "href": "http://example.com/foo%00%51",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foo%00%51",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/(%28:%3A%29)",
    "base": null,
    "href": "http://example.com/(%28:%3A%29)",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/(%28:%3A%29)",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/%3A%3a%3C%3c",
    "base": null,
    "href": "http://example.com/%3A%3a%3C%3c",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%3A%3a%3C%3c",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/foo\tbar",
    "base": null,
    "href": "http://example.com/foobar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/foobar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com\\\\foo\\\\bar",
    "base": null,
    "href": "http://example.com//foo//bar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "//foo//bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/%7Ffp3%3Eju%3Dduvgw%3Dd",
    "base": null,
    "href": "http://example.com/%7Ffp3%3Eju%3Dduvgw%3Dd",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%7Ffp3%3Eju%3Dduvgw%3Dd",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/@asdf%40",
    "base": null,
    "href": "http://example.com/@asdf%40",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/@asdf%40",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/你好你好",
    "base": null,
    "href": "http://example.com/%E4%BD%A0%E5%A5%BD%E4%BD%A0%E5%A5%BD",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%E4%BD%A0%E5%A5%BD%E4%BD%A0%E5%A5%BD",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/‥/foo",
    "base": null,
    "href": "http://example.com/%E2%80%A5/foo",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%E2%80%A5/foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/﻿/foo",
    "base": null,
    "href": "http://example.com/%EF%BB%BF/foo",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%EF%BB%BF/foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.com/‮/foo/‭/bar",
    "base": null,
    "href": "http://example.com/%E2%80%AE/foo/%E2%80%AD/bar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/%E2%80%AE/foo/%E2%80%AD/bar",
    "search": "",
    "hash": ""
  },
  "# Based on http://trac.webkit.org/browser/trunk/LayoutTests/fast/url/script-tests/relative.js",
  {
    "input": "http://www.google.com/foo?bar=baz#",
    "base": null,
    "href": "http://www.google.com/foo?bar=baz#",
    "origin": "http://www.google.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.google.com",
    "hostname": "www.google.com",
    "port": "",
    "pathname": "/foo",
    "search": "?bar=baz",
    "hash": ""
  },
  {
    "input": "http://www.google.com/foo?bar=baz# »",
    "base": null,
    "href": "http://www.google.com/foo?bar=baz#%20%C2%BB",
    "origin": "http://www.google.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.google.com",
    "hostname": "www.google.com",
    "port": "",
    "pathname": "/foo",
    "search": "?bar=baz",
    "hash": "#%20%C2%BB"
  },
  {
    "input": "data:test# »",
    "base": null,
    "href": "data:test#%20%C2%BB",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "test",
    "search": "",
    "hash": "#%20%C2%BB"
  },
  {
    "input": "http://www.google.com",
    "base": null,
    "href": "http://www.google.com/",
    "origin": "http://www.google.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.google.com",
    "hostname": "www.google.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://192.0x00A80001",
    "base": null,
    "href": "http://192.168.0.1/",
    "origin": "http://192.168.0.1",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.0.1",
    "hostname": "192.168.0.1",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://www/foo%2Ehtml",
    "base": null,
    "href": "http://www/foo%2Ehtml",
    "origin": "http://www",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www",
    "hostname": "www",
    "port": "",
    "pathname": "/foo%2Ehtml",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://www/foo/%2E/html",
    "base": null,
    "href": "http://www/foo/html",
    "origin": "http://www",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www",
    "hostname": "www",
    "port": "",
    "pathname": "/foo/html",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://user:pass@/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://%25DOMAIN:foobar@foodomain.com/",
    "base": null,
    "href": "http://%25DOMAIN:foobar@foodomain.com/",
    "origin": "http://foodomain.com",
    "protocol": "http:",
    "username": "%25DOMAIN",
    "password": "foobar",
    "host": "foodomain.com",
    "hostname": "foodomain.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:\\\\www.google.com\\foo",
    "base": null,
    "href": "http://www.google.com/foo",
    "origin": "http://www.google.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.google.com",
    "hostname": "www.google.com",
    "port": "",
    "pathname": "/foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://foo:80/",
    "base": null,
    "href": "http://foo/",
    "origin": "http://foo",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://foo:81/",
    "base": null,
    "href": "http://foo:81/",
    "origin": "http://foo:81",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo:81",
    "hostname": "foo",
    "port": "81",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "httpa://foo:80/",
    "base": null,
    "href": "httpa://foo:80/",
    "origin": "null",
    "protocol": "httpa:",
    "username": "",
    "password": "",
    "host": "foo:80",
    "hostname": "foo",
    "port": "80",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://foo:-80/",
    "base": null,
    "failure": true
  },
  {
    "input": "https://foo:443/",
    "base": null,
    "href": "https://foo/",
    "origin": "https://foo",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https://foo:80/",
    "base": null,
    "href": "https://foo:80/",
    "origin": "https://foo:80",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "foo:80",
    "hostname": "foo",
    "port": "80",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftp://foo:21/",
    "base": null,
    "href": "ftp://foo/",
    "origin": "ftp://foo",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftp://foo:80/",
    "base": null,
    "href": "ftp://foo:80/",
    "origin": "ftp://foo:80",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "foo:80",
    "hostname": "foo",
    "port": "80",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "gopher://foo:70/",
    "base": null,
    "href": "gopher://foo:70/",
    "origin": "null",
    "protocol": "gopher:",
    "username": "",
    "password": "",
    "host": "foo:70",
    "hostname": "foo",
    "port": "70",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "gopher://foo:443/",
    "base": null,
    "href": "gopher://foo:443/",
    "origin": "null",
    "protocol": "gopher:",
    "username": "",
    "password": "",
    "host": "foo:443",
    "hostname": "foo",
    "port": "443",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws://foo:80/",
    "base": null,
    "href": "ws://foo/",
    "origin": "ws://foo",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws://foo:81/",
    "base": null,
    "href": "ws://foo:81/",
    "origin": "ws://foo:81",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "foo:81",
    "hostname": "foo",
    "port": "81",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws://foo:443/",
    "base": null,
    "href": "ws://foo:443/",
    "origin": "ws://foo:443",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "foo:443",
    "hostname": "foo",
    "port": "443",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws://foo:815/",
    "base": null,
    "href": "ws://foo:815/",
    "origin": "ws://foo:815",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "foo:815",
    "hostname": "foo",
    "port": "815",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss://foo:80/",
    "base": null,
    "href": "wss://foo:80/",
    "origin": "wss://foo:80",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "foo:80",
    "hostname": "foo",
    "port": "80",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss://foo:81/",
    "base": null,
    "href": "wss://foo:81/",
    "origin": "wss://foo:81",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "foo:81",
    "hostname": "foo",
    "port": "81",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss://foo:443/",
    "base": null,
    "href": "wss://foo/",
    "origin": "wss://foo",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "foo",
    "hostname": "foo",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss://foo:815/",
    "base": null,
    "href": "wss://foo:815/",
    "origin": "wss://foo:815",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "foo:815",
    "hostname": "foo",
    "port": "815",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/example.com/",
    "base": null,
    "href": "http://example.com/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftp:/example.com/",
    "base": null,
    "href": "ftp://example.com/",
    "origin": "ftp://example.com",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https:/example.com/",
    "base": null,
    "href": "https://example.com/",
    "origin": "https://example.com",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "madeupscheme:/example.com/",
    "base": null,
    "href": "madeupscheme:/example.com/",
    "origin": "null",
    "protocol": "madeupscheme:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:/example.com/",
    "base": null,
    "href": "file:///example.com/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftps:/example.com/",
    "base": null,
    "href": "ftps:/example.com/",
    "origin": "null",
    "protocol": "ftps:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "gopher:/example.com/",
    "base": null,
    "href": "gopher:/example.com/",
    "origin": "null",
    "protocol": "gopher:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws:/example.com/",
    "base": null,
    "href": "ws://example.com/",
    "origin": "ws://example.com",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss:/example.com/",
    "base": null,
    "href": "wss://example.com/",
    "origin": "wss://example.com",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "data:/example.com/",
    "base": null,
    "href": "data:/example.com/",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript:/example.com/",
    "base": null,
    "href": "javascript:/example.com/",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto:/example.com/",
    "base": null,
    "href": "mailto:/example.com/",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:example.com/",
    "base": null,
    "href": "http://example.com/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftp:example.com/",
    "base": null,
    "href": "ftp://example.com/",
    "origin": "ftp://example.com",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https:example.com/",
    "base": null,
    "href": "https://example.com/",
    "origin": "https://example.com",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "madeupscheme:example.com/",
    "base": null,
    "href": "madeupscheme:example.com/",
    "origin": "null",
    "protocol": "madeupscheme:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ftps:example.com/",
    "base": null,
    "href": "ftps:example.com/",
    "origin": "null",
    "protocol": "ftps:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "gopher:example.com/",
    "base": null,
    "href": "gopher:example.com/",
    "origin": "null",
    "protocol": "gopher:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ws:example.com/",
    "base": null,
    "href": "ws://example.com/",
    "origin": "ws://example.com",
    "protocol": "ws:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "wss:example.com/",
    "base": null,
    "href": "wss://example.com/",
    "origin": "wss://example.com",
    "protocol": "wss:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "data:example.com/",
    "base": null,
    "href": "data:example.com/",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript:example.com/",
    "base": null,
    "href": "javascript:example.com/",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto:example.com/",
    "base": null,
    "href": "mailto:example.com/",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "example.com/",
    "search": "",
    "hash": ""
  },
  "# Based on http://trac.webkit.org/browser/trunk/LayoutTests/fast/url/segments-userinfo-vs-host.html",
  {
    "input": "http:@www.example.com",
    "base": null,
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/@www.example.com",
    "base": null,
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://@www.example.com",
    "base": null,
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:a:b@www.example.com",
    "base": null,
    "href": "http://a:b@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "a",
    "password": "b",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/a:b@www.example.com",
    "base": null,
    "href": "http://a:b@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "a",
    "password": "b",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://a:b@www.example.com",
    "base": null,
    "href": "http://a:b@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "a",
    "password": "b",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://@pple.com",
    "base": null,
    "href": "http://pple.com/",
    "origin": "http://pple.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "pple.com",
    "hostname": "pple.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http::b@www.example.com",
    "base": null,
    "href": "http://:b@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "b",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/:b@www.example.com",
    "base": null,
    "href": "http://:b@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "b",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://:b@www.example.com",
    "base": null,
    "href": "http://:b@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "b",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/:@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http://user@/www.example.com",
    "base": null,
    "failure": true
  },
  {
    "input": "http:@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http:/@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http://@/www.example.com",
    "base": null,
    "failure": true
  },
  {
    "input": "https:@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http:a:b@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http:/a:b@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http://a:b@/www.example.com",
    "base": null,
    "failure": true
  },
  {
    "input": "http::@/www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http:a:@www.example.com",
    "base": null,
    "href": "http://a@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "a",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:/a:@www.example.com",
    "base": null,
    "href": "http://a@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "a",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://a:@www.example.com",
    "base": null,
    "href": "http://a@www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "a",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://www.@pple.com",
    "base": null,
    "href": "http://www.@pple.com/",
    "origin": "http://pple.com",
    "protocol": "http:",
    "username": "www.",
    "password": "",
    "host": "pple.com",
    "hostname": "pple.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http:@:www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http:/@:www.example.com",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "http://@:www.example.com",
    "base": null,
    "failure": true
  },
  {
    "input": "http://:@www.example.com",
    "base": null,
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# Others",
  {
    "input": "/",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "/test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": ".",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "..",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "./test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "../test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "../aaa/test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/aaa/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/aaa/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "../../test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "中/test.txt",
    "base": "http://www.example.com/test",
    "href": "http://www.example.com/%E4%B8%AD/test.txt",
    "origin": "http://www.example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "port": "",
    "pathname": "/%E4%B8%AD/test.txt",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://www.example2.com",
    "base": "http://www.example.com/test",
    "href": "http://www.example2.com/",
    "origin": "http://www.example2.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example2.com",
    "hostname": "www.example2.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "//www.example2.com",
    "base": "http://www.example.com/test",
    "href": "http://www.example2.com/",
    "origin": "http://www.example2.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.example2.com",
    "hostname": "www.example2.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:...",
    "base": "http://www.example.com/test",
    "href": "file:///...",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/...",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:..",
    "base": "http://www.example.com/test",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:a",
    "base": "http://www.example.com/test",
    "href": "file:///a",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:.",
    "base": null,
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:.",
    "base": "http://www.example.com/test",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# Based on http://trac.webkit.org/browser/trunk/LayoutTests/fast/url/host.html",
  "Basic canonicalization, uppercase should be converted to lowercase",
  {
    "input": "http://ExAmPlE.CoM",
    "base": "http://other.com/",
    "href": "http://example.com/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example example.com",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://Goo%20 goo%7C|.com",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[:]",
    "base": "http://other.com/",
    "failure": true
  },
  "U+3000 is mapped to U+0020 (space) which is disallowed",
  {
    "input": "http://GOO\u00a0\u3000goo.com",
    "base": "http://other.com/",
    "failure": true
  },
  "Other types of space (no-break, zero-width, zero-width-no-break) are name-prepped away to nothing. U+200B, U+2060, and U+FEFF, are ignored",
  {
    "input": "http://GOO\u200b\u2060\ufeffgoo.com",
    "base": "http://other.com/",
    "href": "http://googoo.com/",
    "origin": "http://googoo.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "googoo.com",
    "hostname": "googoo.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Leading and trailing C0 control or space",
  {
    "input": "\u0000\u001b\u0004\u0012 http://example.com/\u001f \u000d ",
    "base": null,
    "href": "http://example.com/",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Ideographic full stop (full-width period for Chinese, etc.) should be treated as a dot. U+3002 is mapped to U+002E (dot)",
  {
    "input": "http://www.foo。bar.com",
    "base": "http://other.com/",
    "href": "http://www.foo.bar.com/",
    "origin": "http://www.foo.bar.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "www.foo.bar.com",
    "hostname": "www.foo.bar.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Invalid unicode characters should fail... U+FDD0 is disallowed; %ef%b7%90 is U+FDD0",
  {
    "input": "http://\ufdd0zyx.com",
    "base": "http://other.com/",
    "failure": true
  },
  "This is the same as previous but escaped",
  {
    "input": "http://%ef%b7%90zyx.com",
    "base": "http://other.com/",
    "failure": true
  },
  "U+FFFD",
  {
    "input": "https://\ufffd",
    "base": null,
    "failure": true
  },
  {
    "input": "https://%EF%BF%BD",
    "base": null,
    "failure": true
  },
  {
    "input": "https://x/\ufffd?\ufffd#\ufffd",
    "base": null,
    "href": "https://x/%EF%BF%BD?%EF%BF%BD#%EF%BF%BD",
    "origin": "https://x",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "x",
    "hostname": "x",
    "port": "",
    "pathname": "/%EF%BF%BD",
    "search": "?%EF%BF%BD",
    "hash": "#%EF%BF%BD"
  },
  "Domain is ASCII, but a label is invalid IDNA",
  {
    "input": "http://a.b.c.xn--pokxncvks",
    "base": null,
    "failure": true
  },
  {
    "input": "http://10.0.0.xn--pokxncvks",
    "base": null,
    "failure": true
  },
  "IDNA labels should be matched case-insensitively",
  {
    "input": "http://a.b.c.XN--pokxncvks",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a.b.c.Xn--pokxncvks",
    "base": null,
    "failure": true
  },
  {
    "input": "http://10.0.0.XN--pokxncvks",
    "base": null,
    "failure": true
  },
  {
    "input": "http://10.0.0.xN--pokxncvks",
    "base": null,
    "failure": true
  },
  "Test name prepping, fullwidth input should be converted to ASCII and NOT IDN-ized. This is 'Go' in fullwidth UTF-8/UTF-16.",
  {
    "input": "http://Ｇｏ.com",
    "base": "http://other.com/",
    "href": "http://go.com/",
    "origin": "http://go.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "go.com",
    "hostname": "go.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "URL spec forbids the following. https://www.w3.org/Bugs/Public/show_bug.cgi?id=24257",
  {
    "input": "http://％４１.com",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://%ef%bc%85%ef%bc%94%ef%bc%91.com",
    "base": "http://other.com/",
    "failure": true
  },
  "...%00 in fullwidth should fail (also as escaped UTF-8 input)",
  {
    "input": "http://％００.com",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://%ef%bc%85%ef%bc%90%ef%bc%90.com",
    "base": "http://other.com/",
    "failure": true
  },
  "Basic IDN support, UTF-8 and UTF-16 input should be converted to IDN",
  {
    "input": "http://你好你好",
    "base": "http://other.com/",
    "href": "http://xn--6qqa088eba/",
    "origin": "http://xn--6qqa088eba",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "xn--6qqa088eba",
    "hostname": "xn--6qqa088eba",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https://faß.ExAmPlE/",
    "base": null,
    "href": "https://xn--fa-hia.example/",
    "origin": "https://xn--fa-hia.example",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "xn--fa-hia.example",
    "hostname": "xn--fa-hia.example",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "sc://faß.ExAmPlE/",
    "base": null,
    "href": "sc://fa%C3%9F.ExAmPlE/",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "fa%C3%9F.ExAmPlE",
    "hostname": "fa%C3%9F.ExAmPlE",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Invalid escaped characters should fail and the percents should be escaped. https://www.w3.org/Bugs/Public/show_bug.cgi?id=24191",
  {
    "input": "http://%zz%66%a.com",
    "base": "http://other.com/",
    "failure": true
  },
  "If we get an invalid character that has been escaped.",
  {
    "input": "http://%25",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://hello%00",
    "base": "http://other.com/",
    "failure": true
  },
  "Escaped numbers should be treated like IP addresses if they are.",
  {
    "input": "http://%30%78%63%30%2e%30%32%35%30.01",
    "base": "http://other.com/",
    "href": "http://192.168.0.1/",
    "origin": "http://192.168.0.1",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.0.1",
    "hostname": "192.168.0.1",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://%30%78%63%30%2e%30%32%35%30.01%2e",
    "base": "http://other.com/",
    "href": "http://192.168.0.1/",
    "origin": "http://192.168.0.1",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.0.1",
    "hostname": "192.168.0.1",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://192.168.0.257",
    "base": "http://other.com/",
    "failure": true
  },
  "Invalid escaping in hosts causes failure",
  {
    "input": "http://%3g%78%63%30%2e%30%32%35%30%2E.01",
    "base": "http://other.com/",
    "failure": true
  },
  "A space in a host causes failure",
  {
    "input": "http://192.168.0.1 hello",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "https://x x:12",
    "base": null,
    "failure": true
  },
  "Fullwidth and escaped UTF-8 fullwidth should still be treated as IP",
  {
    "input": "http://０Ｘｃ０．０２５０．０１",
    "base": "http://other.com/",
    "href": "http://192.168.0.1/",
    "origin": "http://192.168.0.1",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.0.1",
    "hostname": "192.168.0.1",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Domains with empty labels",
  {
    "input": "http://./",
    "base": null,
    "href": "http://./",
    "origin": "http://.",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": ".",
    "hostname": ".",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://../",
    "base": null,
    "href": "http://../",
    "origin": "http://..",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "..",
    "hostname": "..",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Non-special domains with empty labels",
  {
    "input": "h://.",
    "base": null,
    "href": "h://.",
    "origin": "null",
    "protocol": "h:",
    "username": "",
    "password": "",
    "host": ".",
    "hostname": ".",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  "Broken IPv6",
  {
    "input": "http://[www.google.com]/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://[google.com]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::1.2.3.4x]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::1.2.3.]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::1.2.]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::.1.2]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::1.]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::.1]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://[::%31]",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://%5B::1]",
    "base": "http://other.com/",
    "failure": true
  },
  "Misc Unicode",
  {
    "input": "http://foo:💩@example.com/bar",
    "base": "http://other.com/",
    "href": "http://foo:%F0%9F%92%A9@example.com/bar",
    "origin": "http://example.com",
    "protocol": "http:",
    "username": "foo",
    "password": "%F0%9F%92%A9",
    "host": "example.com",
    "hostname": "example.com",
    "port": "",
    "pathname": "/bar",
    "search": "",
    "hash": ""
  },
  "# resolving a fragment against any scheme succeeds",
  {
    "input": "#",
    "base": "test:test",
    "href": "test:test#",
    "origin": "null",
    "protocol": "test:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "test",
    "search": "",
    "hash": ""
  },
  {
    "input": "#x",
    "base": "mailto:x@x.com",
    "href": "mailto:x@x.com#x",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "x@x.com",
    "search": "",
    "hash": "#x"
  },
  {
    "input": "#x",
    "base": "data:,",
    "href": "data:,#x",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": ",",
    "search": "",
    "hash": "#x"
  },
  {
    "input": "#x",
    "base": "about:blank",
    "href": "about:blank#x",
    "origin": "null",
    "protocol": "about:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "blank",
    "search": "",
    "hash": "#x"
  },
  {
    "input": "#x:y",
    "base": "about:blank",
    "href": "about:blank#x:y",
    "origin": "null",
    "protocol": "about:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "blank",
    "search": "",
    "hash": "#x:y"
  },
  {
    "input": "#",
    "base": "test:test?test",
    "href": "test:test?test#",
    "origin": "null",
    "protocol": "test:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "test",
    "search": "?test",
    "hash": ""
  },
  "# multiple @ in authority state",
  {
    "input": "https://@test@test@example:800/",
    "base": "http://doesnotmatter/",
    "href": "https://%40test%40test@example:800/",
    "origin": "https://example:800",
    "protocol": "https:",
    "username": "%40test%40test",
    "password": "",
    "host": "example:800",
    "hostname": "example",
    "port": "800",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https://@@@example",
    "base": "http://doesnotmatter/",
    "href": "https://%40%40@example/",
    "origin": "https://example",
    "protocol": "https:",
    "username": "%40%40",
    "password": "",
    "host": "example",
    "hostname": "example",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "non-az-09 characters",
  {
    "input": "http://`{}:`{}@h/`{}?`{}",
    "base": "http://doesnotmatter/",
    "href": "http://%60%7B%7D:%60%7B%7D@h/%60%7B%7D?`{}",
    "origin": "http://h",
    "protocol": "http:",
    "username": "%60%7B%7D",
    "password": "%60%7B%7D",
    "host": "h",
    "hostname": "h",
    "port": "",
    "pathname": "/%60%7B%7D",
    "search": "?`{}",
    "hash": ""
  },
  "byte is ' and url is special",
  {
    "input": "http://host/?'",
    "base": null,
    "href": "http://host/?%27",
    "origin": "http://host",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/",
    "search": "?%27",
    "hash": ""
  },
  {
    "input": "notspecial://host/?'",
    "base": null,
    "href": "notspecial://host/?'",
    "origin": "null",
    "protocol": "notspecial:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/",
    "search": "?'",
    "hash": ""
  },
  "# Credentials in base",
  {
    "input": "/some/path",
    "base": "http://user@example.org/smth",
    "href": "http://user@example.org/some/path",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "user",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/some/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "",
    "base": "http://user:pass@example.org:21/smth",
    "href": "http://user:pass@example.org:21/smth",
    "origin": "http://example.org:21",
    "protocol": "http:",
    "username": "user",
    "password": "pass",
    "host": "example.org:21",
    "hostname": "example.org",
    "port": "21",
    "pathname": "/smth",
    "search": "",
    "hash": ""
  },
  {
    "input": "/some/path",
    "base": "http://user:pass@example.org:21/smth",
    "href": "http://user:pass@example.org:21/some/path",
    "origin": "http://example.org:21",
    "protocol": "http:",
    "username": "user",
    "password": "pass",
    "host": "example.org:21",
    "hostname": "example.org",
    "port": "21",
    "pathname": "/some/path",
    "search": "",
    "hash": ""
  },
  "# a set of tests designed by zcorpan for relative URLs with unknown schemes",
  {
    "input": "i",
    "base": "sc:sd",
    "failure": true
  },
  {
    "input": "i",
    "base": "sc:sd/sd",
    "failure": true
  },
  {
    "input": "i",
    "base": "sc:/pa/pa",
    "href": "sc:/pa/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pa/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "i",
    "base": "sc://ho/pa",
    "href": "sc://ho/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "ho",
    "hostname": "ho",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "i",
    "base": "sc:///pa/pa",
    "href": "sc:///pa/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pa/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "../i",
    "base": "sc:sd",
    "failure": true
  },
  {
    "input": "../i",
    "base": "sc:sd/sd",
    "failure": true
  },
  {
    "input": "../i",
    "base": "sc:/pa/pa",
    "href": "sc:/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "../i",
    "base": "sc://ho/pa",
    "href": "sc://ho/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "ho",
    "hostname": "ho",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "../i",
    "base": "sc:///pa/pa",
    "href": "sc:///i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "/i",
    "base": "sc:sd",
    "failure": true
  },
  {
    "input": "/i",
    "base": "sc:sd/sd",
    "failure": true
  },
  {
    "input": "/i",
    "base": "sc:/pa/pa",
    "href": "sc:/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "/i",
    "base": "sc://ho/pa",
    "href": "sc://ho/i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "ho",
    "hostname": "ho",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "/i",
    "base": "sc:///pa/pa",
    "href": "sc:///i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/i",
    "search": "",
    "hash": ""
  },
  {
    "input": "?i",
    "base": "sc:sd",
    "failure": true
  },
  {
    "input": "?i",
    "base": "sc:sd/sd",
    "failure": true
  },
  {
    "input": "?i",
    "base": "sc:/pa/pa",
    "href": "sc:/pa/pa?i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pa/pa",
    "search": "?i",
    "hash": ""
  },
  {
    "input": "?i",
    "base": "sc://ho/pa",
    "href": "sc://ho/pa?i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "ho",
    "hostname": "ho",
    "port": "",
    "pathname": "/pa",
    "search": "?i",
    "hash": ""
  },
  {
    "input": "?i",
    "base": "sc:///pa/pa",
    "href": "sc:///pa/pa?i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pa/pa",
    "search": "?i",
    "hash": ""
  },
  {
    "input": "#i",
    "base": "sc:sd",
    "href": "sc:sd#i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "sd",
    "search": "",
    "hash": "#i"
  },
  {
    "input": "#i",
    "base": "sc:sd/sd",
    "href": "sc:sd/sd#i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "sd/sd",
    "search": "",
    "hash": "#i"
  },
  {
    "input": "#i",
    "base": "sc:/pa/pa",
    "href": "sc:/pa/pa#i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pa/pa",
    "search": "",
    "hash": "#i"
  },
  {
    "input": "#i",
    "base": "sc://ho/pa",
    "href": "sc://ho/pa#i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "ho",
    "hostname": "ho",
    "port": "",
    "pathname": "/pa",
    "search": "",
    "hash": "#i"
  },
  {
    "input": "#i",
    "base": "sc:///pa/pa",
    "href": "sc:///pa/pa#i",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pa/pa",
    "search": "",
    "hash": "#i"
  },
  "# make sure that relative URL logic works on known typically non-relative schemes too",
  {
    "input": "about:/../",
    "base": null,
    "href": "about:/",
    "origin": "null",
    "protocol": "about:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "data:/../",
    "base": null,
    "href": "data:/",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript:/../",
    "base": null,
    "href": "javascript:/",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto:/../",
    "base": null,
    "href": "mailto:/",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# unknown schemes and their hosts",
  {
    "input": "sc://ñ.test/",
    "base": null,
    "href": "sc://%C3%B1.test/",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1.test",
    "hostname": "%C3%B1.test",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "sc://%/",
    "base": null,
    "href": "sc://%/",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%",
    "hostname": "%",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "sc://@/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://te@s:t@/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://:/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://:12/",
    "base": null,
    "failure": true
  },
  {
    "input": "x",
    "base": "sc://ñ",
    "href": "sc://%C3%B1/x",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1",
    "hostname": "%C3%B1",
    "port": "",
    "pathname": "/x",
    "search": "",
    "hash": ""
  },
  "# unknown schemes and backslashes",
  {
    "input": "sc:\\../",
    "base": null,
    "href": "sc:\\../",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "\\../",
    "search": "",
    "hash": ""
  },
  "# unknown scheme with path looking like a password",
  {
    "input": "sc::a@example.net",
    "base": null,
    "href": "sc::a@example.net",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": ":a@example.net",
    "search": "",
    "hash": ""
  },
  "# unknown scheme with bogus percent-encoding",
  {
    "input": "wow:%NBD",
    "base": null,
    "href": "wow:%NBD",
    "origin": "null",
    "protocol": "wow:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "%NBD",
    "search": "",
    "hash": ""
  },
  {
    "input": "wow:%1G",
    "base": null,
    "href": "wow:%1G",
    "origin": "null",
    "protocol": "wow:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "%1G",
    "search": "",
    "hash": ""
  },
  "# unknown scheme with non-URL characters",
  {
    "input": "wow:\uFFFF",
    "base": null,
    "href": "wow:%EF%BF%BF",
    "origin": "null",
    "protocol": "wow:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "%EF%BF%BF",
    "search": "",
    "hash": ""
  },
  "Forbidden host code points",
  {
    "input": "sc://a\u0000b/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a b/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a<b",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a>b",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a[b/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a\\b/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a]b/",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a^b",
    "base": null,
    "failure": true
  },
  {
    "input": "sc://a|b/",
    "base": null,
    "failure": true
  },
  "Forbidden host codepoints: tabs and newlines are removed during preprocessing",
  {
    "input": "foo://ho\u0009st/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href":"foo://host/",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": ""
  },
  {
    "input": "foo://ho\u000Ast/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href":"foo://host/",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": ""
  },
  {
    "input": "foo://ho\u000Dst/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href":"foo://host/",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": ""
  },
  "Forbidden domain code-points",
  {
    "input": "http://a\u0000b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0001b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0002b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0003b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0004b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0005b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0006b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0007b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0008b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u000Bb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u000Cb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u000Eb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u000Fb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0010b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0011b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0012b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0013b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0014b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0015b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0016b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0017b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0018b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u0019b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u001Ab/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u001Bb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u001Cb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u001Db/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u001Eb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u001Fb/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a%b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a<b",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a>b",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a[b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a]b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a^b",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a|b/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://a\u007Fb/",
    "base": null,
    "failure": true
  },
  "Forbidden domain codepoints: tabs and newlines are removed during preprocessing",
  {
    "input": "http://ho\u0009st/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href":"http://host/",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "http:",
    "search": "",
    "username": ""
  },
  {
    "input": "http://ho\u000Ast/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href":"http://host/",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "http:",
    "search": "",
    "username": ""
  },
  {
    "input": "http://ho\u000Dst/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href":"http://host/",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "http:",
    "search": "",
    "username": ""
  },
  "Encoded forbidden domain codepoints in special URLs",
  {
    "input": "http://ho%00st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%01st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%02st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%03st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%04st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%05st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%06st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%07st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%08st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%09st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%0Ast/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%0Bst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%0Cst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%0Dst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%0Est/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%0Fst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%10st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%11st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%12st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%13st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%14st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%15st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%16st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%17st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%18st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%19st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%1Ast/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%1Bst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%1Cst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%1Dst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%1Est/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%1Fst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%20st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%23st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%25st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%2Fst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%3Ast/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%3Cst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%3Est/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%3Fst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%40st/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%5Bst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%5Cst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%5Dst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%7Cst/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://ho%7Fst/",
    "base": null,
    "failure": true
  },
  "Allowed host/domain code points",
  {
    "input": "http://!\"$&'()*+,-.;=_`{}~/",
    "base": null,
    "href": "http://!\"$&'()*+,-.;=_`{}~/",
    "origin": "http://!\"$&'()*+,-.;=_`{}~",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "!\"$&'()*+,-.;=_`{}~",
    "hostname": "!\"$&'()*+,-.;=_`{}~",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "sc://\u0001\u0002\u0003\u0004\u0005\u0006\u0007\u0008\u000B\u000C\u000E\u000F\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017\u0018\u0019\u001A\u001B\u001C\u001D\u001E\u001F\u007F!\"$%&'()*+,-.;=_`{}~/",
    "base": null,
    "href": "sc://%01%02%03%04%05%06%07%08%0B%0C%0E%0F%10%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F!\"$%&'()*+,-.;=_`{}~/",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%01%02%03%04%05%06%07%08%0B%0C%0E%0F%10%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F!\"$%&'()*+,-.;=_`{}~",
    "hostname": "%01%02%03%04%05%06%07%08%0B%0C%0E%0F%10%11%12%13%14%15%16%17%18%19%1A%1B%1C%1D%1E%1F%7F!\"$%&'()*+,-.;=_`{}~",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# Hosts and percent-encoding",
  {
    "input": "ftp://example.com%80/",
    "base": null,
    "failure": true
  },
  {
    "input": "ftp://example.com%A0/",
    "base": null,
    "failure": true
  },
  {
    "input": "https://example.com%80/",
    "base": null,
    "failure": true
  },
  {
    "input": "https://example.com%A0/",
    "base": null,
    "failure": true
  },
  {
    "input": "ftp://%e2%98%83",
    "base": null,
    "href": "ftp://xn--n3h/",
    "origin": "ftp://xn--n3h",
    "protocol": "ftp:",
    "username": "",
    "password": "",
    "host": "xn--n3h",
    "hostname": "xn--n3h",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "https://%e2%98%83",
    "base": null,
    "href": "https://xn--n3h/",
    "origin": "https://xn--n3h",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "xn--n3h",
    "hostname": "xn--n3h",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# tests from jsdom/whatwg-url designed for code coverage",
  {
    "input": "http://127.0.0.1:10100/relative_import.html",
    "base": null,
    "href": "http://127.0.0.1:10100/relative_import.html",
    "origin": "http://127.0.0.1:10100",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "127.0.0.1:10100",
    "hostname": "127.0.0.1",
    "port": "10100",
    "pathname": "/relative_import.html",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://facebook.com/?foo=%7B%22abc%22",
    "base": null,
    "href": "http://facebook.com/?foo=%7B%22abc%22",
    "origin": "http://facebook.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "facebook.com",
    "hostname": "facebook.com",
    "port": "",
    "pathname": "/",
    "search": "?foo=%7B%22abc%22",
    "hash": ""
  },
  {
    "input": "https://localhost:3000/jqueryui@1.2.3",
    "base": null,
    "href": "https://localhost:3000/jqueryui@1.2.3",
    "origin": "https://localhost:3000",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "localhost:3000",
    "hostname": "localhost",
    "port": "3000",
    "pathname": "/jqueryui@1.2.3",
    "search": "",
    "hash": ""
  },
  "# tab/LF/CR",
  {
    "input": "h\tt\nt\rp://h\to\ns\rt:9\t0\n0\r0/p\ta\nt\rh?q\tu\ne\rry#f\tr\na\rg",
    "base": null,
    "href": "http://host:9000/path?query#frag",
    "origin": "http://host:9000",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "host:9000",
    "hostname": "host",
    "port": "9000",
    "pathname": "/path",
    "search": "?query",
    "hash": "#frag"
  },
  "# Stringification of URL.searchParams",
  {
    "input": "?a=b&c=d",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar?a=b&c=d",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "?a=b&c=d",
    "searchParams": "a=b&c=d",
    "hash": ""
  },
  {
    "input": "??a=b&c=d",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar??a=b&c=d",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "??a=b&c=d",
    "searchParams": "%3Fa=b&c=d",
    "hash": ""
  },
  "# Scheme only",
  {
    "input": "http:",
    "base": "http://example.org/foo/bar",
    "href": "http://example.org/foo/bar",
    "origin": "http://example.org",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "searchParams": "",
    "hash": ""
  },
  {
    "input": "http:",
    "base": "https://example.org/foo/bar",
    "failure": true
  },
  {
    "input": "sc:",
    "base": "https://example.org/foo/bar",
    "href": "sc:",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "",
    "search": "",
    "searchParams": "",
    "hash": ""
  },
  "# Percent encoding of fragments",
  {
    "input": "http://foo.bar/baz?qux#foo\bbar",
    "base": null,
    "href": "http://foo.bar/baz?qux#foo%08bar",
    "origin": "http://foo.bar",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.bar",
    "hostname": "foo.bar",
    "port": "",
    "pathname": "/baz",
    "search": "?qux",
    "searchParams": "qux=",
    "hash": "#foo%08bar"
  },
  {
    "input": "http://foo.bar/baz?qux#foo\"bar",
    "base": null,
    "href": "http://foo.bar/baz?qux#foo%22bar",
    "origin": "http://foo.bar",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.bar",
    "hostname": "foo.bar",
    "port": "",
    "pathname": "/baz",
    "search": "?qux",
    "searchParams": "qux=",
    "hash": "#foo%22bar"
  },
  {
    "input": "http://foo.bar/baz?qux#foo<bar",
    "base": null,
    "href": "http://foo.bar/baz?qux#foo%3Cbar",
    "origin": "http://foo.bar",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.bar",
    "hostname": "foo.bar",
    "port": "",
    "pathname": "/baz",
    "search": "?qux",
    "searchParams": "qux=",
    "hash": "#foo%3Cbar"
  },
  {
    "input": "http://foo.bar/baz?qux#foo>bar",
    "base": null,
    "href": "http://foo.bar/baz?qux#foo%3Ebar",
    "origin": "http://foo.bar",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.bar",
    "hostname": "foo.bar",
    "port": "",
    "pathname": "/baz",
    "search": "?qux",
    "searchParams": "qux=",
    "hash": "#foo%3Ebar"
  },
  {
    "input": "http://foo.bar/baz?qux#foo`bar",
    "base": null,
    "href": "http://foo.bar/baz?qux#foo%60bar",
    "origin": "http://foo.bar",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "foo.bar",
    "hostname": "foo.bar",
    "port": "",
    "pathname": "/baz",
    "search": "?qux",
    "searchParams": "qux=",
    "hash": "#foo%60bar"
  },
  "# IPv4 parsing (via https://github.com/nodejs/node/pull/10317)",
  {
    "input": "http://1.2.3.4/",
    "base": "http://other.com/",
    "href": "http://1.2.3.4/",
    "origin": "http://1.2.3.4",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "1.2.3.4",
    "hostname": "1.2.3.4",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://1.2.3.4./",
    "base": "http://other.com/",
    "href": "http://1.2.3.4/",
    "origin": "http://1.2.3.4",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "1.2.3.4",
    "hostname": "1.2.3.4",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://192.168.257",
    "base": "http://other.com/",
    "href": "http://192.168.1.1/",
    "origin": "http://192.168.1.1",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.1.1",
    "hostname": "192.168.1.1",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://192.168.257.",
    "base": "http://other.com/",
    "href": "http://192.168.1.1/",
    "origin": "http://192.168.1.1",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.1.1",
    "hostname": "192.168.1.1",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://192.168.257.com",
    "base": "http://other.com/",
    "href": "http://192.168.257.com/",
    "origin": "http://192.168.257.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "192.168.257.com",
    "hostname": "192.168.257.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://256",
    "base": "http://other.com/",
    "href": "http://0.0.1.0/",
    "origin": "http://0.0.1.0",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "0.0.1.0",
    "hostname": "0.0.1.0",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://256.com",
    "base": "http://other.com/",
    "href": "http://256.com/",
    "origin": "http://256.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "256.com",
    "hostname": "256.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://999999999",
    "base": "http://other.com/",
    "href": "http://59.154.201.255/",
    "origin": "http://59.154.201.255",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "59.154.201.255",
    "hostname": "59.154.201.255",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://999999999.",
    "base": "http://other.com/",
    "href": "http://59.154.201.255/",
    "origin": "http://59.154.201.255",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "59.154.201.255",
    "hostname": "59.154.201.255",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://999999999.com",
    "base": "http://other.com/",
    "href": "http://999999999.com/",
    "origin": "http://999999999.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "999999999.com",
    "hostname": "999999999.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://10000000000",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://10000000000.com",
    "base": "http://other.com/",
    "href": "http://10000000000.com/",
    "origin": "http://10000000000.com",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "10000000000.com",
    "hostname": "10000000000.com",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://4294967295",
    "base": "http://other.com/",
    "href": "http://255.255.255.255/",
    "origin": "http://255.255.255.255",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "255.255.255.255",
    "hostname": "255.255.255.255",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://4294967296",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://0xffffffff",
    "base": "http://other.com/",
    "href": "http://255.255.255.255/",
    "origin": "http://255.255.255.255",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "255.255.255.255",
    "hostname": "255.255.255.255",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://0xffffffff1",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://256.256.256.256",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "https://0x.0x.0",
    "base": null,
    "href": "https://0.0.0.0/",
    "origin": "https://0.0.0.0",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "0.0.0.0",
    "hostname": "0.0.0.0",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "More IPv4 parsing (via https://github.com/jsdom/whatwg-url/issues/92)",
  {
    "input": "https://0x100000000/test",
    "base": null,
    "failure": true
  },
  {
    "input": "https://256.0.0.1/test",
    "base": null,
    "failure": true
  },
  "# file URLs containing percent-encoded Windows drive letters (shouldn't work)",
  {
    "input": "file:///C%3A/",
    "base": null,
    "href": "file:///C%3A/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C%3A/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///C%7C/",
    "base": null,
    "href": "file:///C%7C/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C%7C/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://%43%3A",
    "base": null,
    "failure": true
  },
  {
    "input": "file://%43%7C",
    "base": null,
    "failure": true
  },
  {
    "input": "file://%43|",
    "base": null,
    "failure": true
  },
  {
    "input": "file://C%7C",
    "base": null,
    "failure": true
  },
  {
    "input": "file://%43%7C/",
    "base": null,
    "failure": true
  },
  {
    "input": "https://%43%7C/",
    "base": null,
    "failure": true
  },
  {
    "input": "asdf://%43|/",
    "base": null,
    "failure": true
  },
  {
    "input": "asdf://%43%7C/",
    "base": null,
    "href": "asdf://%43%7C/",
    "origin": "null",
    "protocol": "asdf:",
    "username": "",
    "password": "",
    "host": "%43%7C",
    "hostname": "%43%7C",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# file URLs relative to other file URLs (via https://github.com/jsdom/whatwg-url/pull/60)",
  {
    "input": "pix/submit.gif",
    "base": "file:///C:/Users/Domenic/Dropbox/GitHub/tmpvar/jsdom/test/level2/html/files/anchor.html",
    "href": "file:///C:/Users/Domenic/Dropbox/GitHub/tmpvar/jsdom/test/level2/html/files/pix/submit.gif",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/Users/Domenic/Dropbox/GitHub/tmpvar/jsdom/test/level2/html/files/pix/submit.gif",
    "search": "",
    "hash": ""
  },
  {
    "input": "..",
    "base": "file:///C:/",
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "..",
    "base": "file:///",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# More file URL tests by zcorpan and annevk",
  {
    "input": "/",
    "base": "file:///C:/a/b",
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "/",
    "base": "file://h/C:/a/b",
    "href": "file://h/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "h",
    "hostname": "h",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "/",
    "base": "file://h/a/b",
    "href": "file://h/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "h",
    "hostname": "h",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "//d:",
    "base": "file:///C:/a/b",
    "href": "file:///d:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/d:",
    "search": "",
    "hash": ""
  },
  {
    "input": "//d:/..",
    "base": "file:///C:/a/b",
    "href": "file:///d:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/d:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "..",
    "base": "file:///ab:/",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "..",
    "base": "file:///1:/",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "",
    "base": "file:///test?test#test",
    "href": "file:///test?test",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?test",
    "hash": ""
  },
  {
    "input": "file:",
    "base": "file:///test?test#test",
    "href": "file:///test?test",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?test",
    "hash": ""
  },
  {
    "input": "?x",
    "base": "file:///test?test#test",
    "href": "file:///test?x",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?x",
    "hash": ""
  },
  {
    "input": "file:?x",
    "base": "file:///test?test#test",
    "href": "file:///test?x",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?x",
    "hash": ""
  },
  {
    "input": "#x",
    "base": "file:///test?test#test",
    "href": "file:///test?test#x",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?test",
    "hash": "#x"
  },
  {
    "input": "file:#x",
    "base": "file:///test?test#test",
    "href": "file:///test?test#x",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?test",
    "hash": "#x"
  },
  "# File URLs and many (back)slashes",
  {
    "input": "file:\\\\//",
    "base": null,
    "href": "file:////",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:\\\\\\\\",
    "base": null,
    "href": "file:////",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:\\\\\\\\?fox",
    "base": null,
    "href": "file:////?fox",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "?fox",
    "hash": ""
  },
  {
    "input": "file:\\\\\\\\#guppy",
    "base": null,
    "href": "file:////#guppy",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": "#guppy"
  },
  {
    "input": "file://spider///",
    "base": null,
    "href": "file://spider///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "spider",
    "hostname": "spider",
    "port": "",
    "pathname": "///",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:\\\\localhost//",
    "base": null,
    "href": "file:////",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///localhost//cat",
    "base": null,
    "href": "file:///localhost//cat",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/localhost//cat",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://\\/localhost//cat",
    "base": null,
    "href": "file:////localhost//cat",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//localhost//cat",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://localhost//a//../..//",
    "base": null,
    "href": "file://///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "///",
    "search": "",
    "hash": ""
  },
  {
    "input": "/////mouse",
    "base": "file:///elephant",
    "href": "file://///mouse",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "///mouse",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\//pig",
    "base": "file://lion/",
    "href": "file:///pig",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/pig",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\/localhost//pig",
    "base": "file://lion/",
    "href": "file:////pig",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//pig",
    "search": "",
    "hash": ""
  },
  {
    "input": "//localhost//pig",
    "base": "file://lion/",
    "href": "file:////pig",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//pig",
    "search": "",
    "hash": ""
  },
  {
    "input": "/..//localhost//pig",
    "base": "file://lion/",
    "href": "file://lion//localhost//pig",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "lion",
    "hostname": "lion",
    "port": "",
    "pathname": "//localhost//pig",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://",
    "base": "file://ape/",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# File URLs with non-empty hosts",
  {
    "input": "/rooibos",
    "base": "file://tea/",
    "href": "file://tea/rooibos",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "tea",
    "hostname": "tea",
    "port": "",
    "pathname": "/rooibos",
    "search": "",
    "hash": ""
  },
  {
    "input": "/?chai",
    "base": "file://tea/",
    "href": "file://tea/?chai",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "tea",
    "hostname": "tea",
    "port": "",
    "pathname": "/",
    "search": "?chai",
    "hash": ""
  },
  "# Windows drive letter handling with the 'file:' base URL",
  {
    "input": "C|",
    "base": "file://host/dir/file",
    "href": "file://host/C:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|",
    "base": "file://host/D:/dir1/dir2/file",
    "href": "file://host/C:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|#",
    "base": "file://host/dir/file",
    "href": "file://host/C:#",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|?",
    "base": "file://host/dir/file",
    "href": "file://host/C:?",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|/",
    "base": "file://host/dir/file",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|\n/",
    "base": "file://host/dir/file",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|\\",
    "base": "file://host/dir/file",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "C",
    "base": "file://host/dir/file",
    "href": "file://host/dir/C",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/dir/C",
    "search": "",
    "hash": ""
  },
  {
    "input": "C|a",
    "base": "file://host/dir/file",
    "href": "file://host/dir/C|a",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/dir/C|a",
    "search": "",
    "hash": ""
  },
  "# Windows drive letter quirk in the file slash state",
  {
    "input": "/c:/foo/bar",
    "base": "file:///c:/baz/qux",
    "href": "file:///c:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/c:/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "/c|/foo/bar",
    "base": "file:///c:/baz/qux",
    "href": "file:///c:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/c:/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:\\c:\\foo\\bar",
    "base": "file:///c:/baz/qux",
    "href": "file:///c:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/c:/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "/c:/foo/bar",
    "base": "file://host/path",
    "href": "file://host/c:/foo/bar",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/c:/foo/bar",
    "search": "",
    "hash": ""
  },
  "# Do not drop the host in the presence of a drive letter",
  {
    "input": "file://example.net/C:/",
    "base": null,
    "href": "file://example.net/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "example.net",
    "hostname": "example.net",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://1.2.3.4/C:/",
    "base": null,
    "href": "file://1.2.3.4/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "1.2.3.4",
    "hostname": "1.2.3.4",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://[1::8]/C:/",
    "base": null,
    "href": "file://[1::8]/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "[1::8]",
    "hostname": "[1::8]",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  "# Copy the host from the base URL in the following cases",
  {
    "input": "C|/",
    "base": "file://host/",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "/C:/",
    "base": "file://host/",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:C:/",
    "base": "file://host/",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:/C:/",
    "base": "file://host/",
    "href": "file://host/C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  "# Copy the empty host from the input in the following cases",
  {
    "input": "//C:/",
    "base": "file://host/",
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://C:/",
    "base": "file://host/",
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///C:/",
    "base": "file://host/",
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///C:/",
    "base": "file://host/",
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  "# Windows drive letter quirk (no host)",
  {
    "input": "file:/C|/",
    "base": null,
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://C|/",
    "base": null,
    "href": "file:///C:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/C:/",
    "search": "",
    "hash": ""
  },
  "# file URLs without base URL by Rimas Misevičius",
  {
    "input": "file:",
    "base": null,
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:?q=v",
    "base": null,
    "href": "file:///?q=v",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "?q=v",
    "hash": ""
  },
  {
    "input": "file:#frag",
    "base": null,
    "href": "file:///#frag",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": "#frag"
  },
  "# file: drive letter cases from https://crbug.com/1078698",
  {
    "input": "file:///Y:",
    "base": null,
    "href": "file:///Y:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/Y:",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///Y:/",
    "base": null,
    "href": "file:///Y:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/Y:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///./Y",
    "base": null,
    "href": "file:///Y",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/Y",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///./Y:",
    "base": null,
    "href": "file:///Y:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/Y:",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\\\\\.\\Y:",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  "# file: drive letter cases from https://crbug.com/1078698 but lowercased",
  {
    "input": "file:///y:",
    "base": null,
    "href": "file:///y:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/y:",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///y:/",
    "base": null,
    "href": "file:///y:/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/y:/",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///./y",
    "base": null,
    "href": "file:///y",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/y",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///./y:",
    "base": null,
    "href": "file:///y:",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/y:",
    "search": "",
    "hash": ""
  },
  {
    "input": "\\\\\\.\\y:",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  "# Additional file URL tests for (https://github.com/whatwg/url/issues/405)",
  {
    "input": "file://localhost//a//../..//foo",
    "base": null,
    "href": "file://///foo",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "///foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://localhost////foo",
    "base": null,
    "href": "file://////foo",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "////foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:////foo",
    "base": null,
    "href": "file:////foo",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//foo",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///one/two",
    "base": "file:///",
    "href": "file:///one/two",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/one/two",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:////one/two",
    "base": "file:///",
    "href": "file:////one/two",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//one/two",
    "search": "",
    "hash": ""
  },
  {
    "input": "//one/two",
    "base": "file:///",
    "href": "file://one/two",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "one",
    "hostname": "one",
    "port": "",
    "pathname": "/two",
    "search": "",
    "hash": ""
  },
  {
    "input": "///one/two",
    "base": "file:///",
    "href": "file:///one/two",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/one/two",
    "search": "",
    "hash": ""
  },
  {
    "input": "////one/two",
    "base": "file:///",
    "href": "file:////one/two",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//one/two",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:///.//",
    "base": "file:////",
    "href": "file:////",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  "File URL tests for https://github.com/whatwg/url/issues/549",
  {
    "input": "file:.//p",
    "base": null,
    "href": "file:////p",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//p",
    "search": "",
    "hash": ""
  },
  {
    "input": "file:/.//p",
    "base": null,
    "href": "file:////p",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//p",
    "search": "",
    "hash": ""
  },
  "# IPv6 tests",
  {
    "input": "http://[1:0::]",
    "base": "http://example.net/",
    "href": "http://[1::]/",
    "origin": "http://[1::]",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[1::]",
    "hostname": "[1::]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://[0:1:2:3:4:5:6:7:8]",
    "base": "http://example.net/",
    "failure": true
  },
  {
    "input": "https://[0::0::0]",
    "base": null,
    "failure": true
  },
  {
    "input": "https://[0:.0]",
    "base": null,
    "failure": true
  },
  {
    "input": "https://[0:0:]",
    "base": null,
    "failure": true
  },
  {
    "input": "https://[0:1:2:3:4:5:6:7.0.0.0.1]",
    "base": null,
    "failure": true
  },
  {
    "input": "https://[0:1.00.0.0.0]",
    "base": null,
    "failure": true
  },
  {
    "input": "https://[0:1.290.0.0.0]",
    "base": null,
    "failure": true
  },
  {
    "input": "https://[0:1.23.23]",
    "base": null,
    "failure": true
  },
  "# Empty host",
  {
    "input": "http://?",
    "base": null,
    "failure": true
  },
  {
    "input": "http://#",
    "base": null,
    "failure": true
  },
  "Port overflow (2^32 + 81)",
  {
    "input": "http://f:4294967377/c",
    "base": "http://example.org/",
    "failure": true
  },
  "Port overflow (2^64 + 81)",
  {
    "input": "http://f:18446744073709551697/c",
    "base": "http://example.org/",
    "failure": true
  },
  "Port overflow (2^128 + 81)",
  {
    "input": "http://f:340282366920938463463374607431768211537/c",
    "base": "http://example.org/",
    "failure": true
  },
  "# Non-special-URL path tests",
  {
    "input": "sc://ñ",
    "base": null,
    "href": "sc://%C3%B1",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1",
    "hostname": "%C3%B1",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "sc://ñ?x",
    "base": null,
    "href": "sc://%C3%B1?x",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1",
    "hostname": "%C3%B1",
    "port": "",
    "pathname": "",
    "search": "?x",
    "hash": ""
  },
  {
    "input": "sc://ñ#x",
    "base": null,
    "href": "sc://%C3%B1#x",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1",
    "hostname": "%C3%B1",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": "#x"
  },
  {
    "input": "#x",
    "base": "sc://ñ",
    "href": "sc://%C3%B1#x",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1",
    "hostname": "%C3%B1",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": "#x"
  },
  {
    "input": "?x",
    "base": "sc://ñ",
    "href": "sc://%C3%B1?x",
    "origin": "null",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "%C3%B1",
    "hostname": "%C3%B1",
    "port": "",
    "pathname": "",
    "search": "?x",
    "hash": ""
  },
  {
    "input": "sc://?",
    "base": null,
    "href": "sc://?",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "sc://#",
    "base": null,
    "href": "sc://#",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "///",
    "base": "sc://x/",
    "href": "sc:///",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "////",
    "base": "sc://x/",
    "href": "sc:////",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "////x/",
    "base": "sc://x/",
    "href": "sc:////x/",
    "protocol": "sc:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//x/",
    "search": "",
    "hash": ""
  },
  {
    "input": "tftp://foobar.com/someconfig;mode=netascii",
    "base": null,
    "href": "tftp://foobar.com/someconfig;mode=netascii",
    "origin": "null",
    "protocol": "tftp:",
    "username": "",
    "password": "",
    "host": "foobar.com",
    "hostname": "foobar.com",
    "port": "",
    "pathname": "/someconfig;mode=netascii",
    "search": "",
    "hash": ""
  },
  {
    "input": "telnet://user:pass@foobar.com:23/",
    "base": null,
    "href": "telnet://user:pass@foobar.com:23/",
    "origin": "null",
    "protocol": "telnet:",
    "username": "user",
    "password": "pass",
    "host": "foobar.com:23",
    "hostname": "foobar.com",
    "port": "23",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "ut2004://10.10.10.10:7777/Index.ut2",
    "base": null,
    "href": "ut2004://10.10.10.10:7777/Index.ut2",
    "origin": "null",
    "protocol": "ut2004:",
    "username": "",
    "password": "",
    "host": "10.10.10.10:7777",
    "hostname": "10.10.10.10",
    "port": "7777",
    "pathname": "/Index.ut2",
    "search": "",
    "hash": ""
  },
  {
    "input": "redis://foo:bar@somehost:6379/0?baz=bam&qux=baz",
    "base": null,
    "href": "redis://foo:bar@somehost:6379/0?baz=bam&qux=baz",
    "origin": "null",
    "protocol": "redis:",
    "username": "foo",
    "password": "bar",
    "host": "somehost:6379",
    "hostname": "somehost",
    "port": "6379",
    "pathname": "/0",
    "search": "?baz=bam&qux=baz",
    "hash": ""
  },
  {
    "input": "rsync://foo@host:911/sup",
    "base": null,
    "href": "rsync://foo@host:911/sup",
    "origin": "null",
    "protocol": "rsync:",
    "username": "foo",
    "password": "",
    "host": "host:911",
    "hostname": "host",
    "port": "911",
    "pathname": "/sup",
    "search": "",
    "hash": ""
  },
  {
    "input": "git://github.com/foo/bar.git",
    "base": null,
    "href": "git://github.com/foo/bar.git",
    "origin": "null",
    "protocol": "git:",
    "username": "",
    "password": "",
    "host": "github.com",
    "hostname": "github.com",
    "port": "",
    "pathname": "/foo/bar.git",
    "search": "",
    "hash": ""
  },
  {
    "input": "irc://myserver.com:6999/channel?passwd",
    "base": null,
    "href": "irc://myserver.com:6999/channel?passwd",
    "origin": "null",
    "protocol": "irc:",
    "username": "",
    "password": "",
    "host": "myserver.com:6999",
    "hostname": "myserver.com",
    "port": "6999",
    "pathname": "/channel",
    "search": "?passwd",
    "hash": ""
  },
  {
    "input": "dns://fw.example.org:9999/foo.bar.org?type=TXT",
    "base": null,
    "href": "dns://fw.example.org:9999/foo.bar.org?type=TXT",
    "origin": "null",
    "protocol": "dns:",
    "username": "",
    "password": "",
    "host": "fw.example.org:9999",
    "hostname": "fw.example.org",
    "port": "9999",
    "pathname": "/foo.bar.org",
    "search": "?type=TXT",
    "hash": ""
  },
  {
    "input": "ldap://localhost:389/ou=People,o=JNDITutorial",
    "base": null,
    "href": "ldap://localhost:389/ou=People,o=JNDITutorial",
    "origin": "null",
    "protocol": "ldap:",
    "username": "",
    "password": "",
    "host": "localhost:389",
    "hostname": "localhost",
    "port": "389",
    "pathname": "/ou=People,o=JNDITutorial",
    "search": "",
    "hash": ""
  },
  {
    "input": "git+https://github.com/foo/bar",
    "base": null,
    "href": "git+https://github.com/foo/bar",
    "origin": "null",
    "protocol": "git+https:",
    "username": "",
    "password": "",
    "host": "github.com",
    "hostname": "github.com",
    "port": "",
    "pathname": "/foo/bar",
    "search": "",
    "hash": ""
  },
  {
    "input": "urn:ietf:rfc:2648",
    "base": null,
    "href": "urn:ietf:rfc:2648",
    "origin": "null",
    "protocol": "urn:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "ietf:rfc:2648",
    "search": "",
    "hash": ""
  },
  {
    "input": "tag:joe@example.org,2001:foo/bar",
    "base": null,
    "href": "tag:joe@example.org,2001:foo/bar",
    "origin": "null",
    "protocol": "tag:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "joe@example.org,2001:foo/bar",
    "search": "",
    "hash": ""
  },
  "Serialize /. in path",
  {
    "input": "non-spec:/.//",
    "base": null,
    "href": "non-spec:/.//",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-spec:/..//",
    "base": null,
    "href": "non-spec:/.//",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-spec:/a/..//",
    "base": null,
    "href": "non-spec:/.//",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-spec:/.//path",
    "base": null,
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-spec:/..//path",
    "base": null,
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-spec:/a/..//path",
    "base": null,
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "/.//path",
    "base": "non-spec:/p",
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "/..//path",
    "base": "non-spec:/p",
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "..//path",
    "base": "non-spec:/p",
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "a/..//path",
    "base": "non-spec:/p",
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  {
    "input": "",
    "base": "non-spec:/..//p",
    "href": "non-spec:/.//p",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//p",
    "search": "",
    "hash": ""
  },
  {
    "input": "path",
    "base": "non-spec:/..//p",
    "href": "non-spec:/.//path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "//path",
    "search": "",
    "hash": ""
  },
  "Do not serialize /. in path",
  {
    "input": "../path",
    "base": "non-spec:/.//p",
    "href": "non-spec:/path",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/path",
    "search": "",
    "hash": ""
  },
  "# percent encoded hosts in non-special-URLs",
  {
    "input": "non-special://%E2%80%A0/",
    "base": null,
    "href": "non-special://%E2%80%A0/",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "%E2%80%A0",
    "hostname": "%E2%80%A0",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://H%4fSt/path",
    "base": null,
    "href": "non-special://H%4fSt/path",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "H%4fSt",
    "hostname": "H%4fSt",
    "port": "",
    "pathname": "/path",
    "search": "",
    "hash": ""
  },
  "# IPv6 in non-special-URLs",
  {
    "input": "non-special://[1:2:0:0:5:0:0:0]/",
    "base": null,
    "href": "non-special://[1:2:0:0:5::]/",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "[1:2:0:0:5::]",
    "hostname": "[1:2:0:0:5::]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://[1:2:0:0:0:0:0:3]/",
    "base": null,
    "href": "non-special://[1:2::3]/",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "[1:2::3]",
    "hostname": "[1:2::3]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://[1:2::3]:80/",
    "base": null,
    "href": "non-special://[1:2::3]:80/",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "[1:2::3]:80",
    "hostname": "[1:2::3]",
    "port": "80",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://[:80/",
    "base": null,
    "failure": true
  },
  {
    "input": "blob:https://example.com:443/",
    "base": null,
    "href": "blob:https://example.com:443/",
    "origin": "https://example.com",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "https://example.com:443/",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:http://example.org:88/",
    "base": null,
    "href": "blob:http://example.org:88/",
    "origin": "http://example.org:88",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "http://example.org:88/",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:d3958f5c-0777-0845-9dcf-2cb28783acaf",
    "base": null,
    "href": "blob:d3958f5c-0777-0845-9dcf-2cb28783acaf",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "d3958f5c-0777-0845-9dcf-2cb28783acaf",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:",
    "base": null,
    "href": "blob:",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  "blob: in blob:",
  {
    "input": "blob:blob:",
    "base": null,
    "href": "blob:blob:",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "blob:",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:blob:https://example.org/",
    "base": null,
    "href": "blob:blob:https://example.org/",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "blob:https://example.org/",
    "search": "",
    "hash": ""
  },
  "Non-http(s): in blob:",
  {
    "input": "blob:about:blank",
    "base": null,
    "href": "blob:about:blank",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "about:blank",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:file://host/path",
    "base": null,
    "href": "blob:file://host/path",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "file://host/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:ftp://host/path",
    "base": null,
    "href": "blob:ftp://host/path",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "ftp://host/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:ws://example.org/",
    "base": null,
    "href": "blob:ws://example.org/",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "ws://example.org/",
    "search": "",
    "hash": ""
  },
  {
    "input": "blob:wss://example.org/",
    "base": null,
    "href": "blob:wss://example.org/",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "wss://example.org/",
    "search": "",
    "hash": ""
  },
  "Percent-encoded http: in blob:",
  {
    "input": "blob:http%3a//example.org/",
    "base": null,
    "href": "blob:http%3a//example.org/",
    "origin": "null",
    "protocol": "blob:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "http%3a//example.org/",
    "search": "",
    "hash": ""
  },
  "Invalid IPv4 radix digits",
  {
    "input": "http://0x7f.0.0.0x7g",
    "base": null,
    "href": "http://0x7f.0.0.0x7g/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "0x7f.0.0.0x7g",
    "hostname": "0x7f.0.0.0x7g",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://0X7F.0.0.0X7G",
    "base": null,
    "href": "http://0x7f.0.0.0x7g/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "0x7f.0.0.0x7g",
    "hostname": "0x7f.0.0.0x7g",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Invalid IPv4 portion of IPv6 address",
  {
    "input": "http://[::127.0.0.0.1]",
    "base": null,
    "failure": true
  },
  "Uncompressed IPv6 addresses with 0",
  {
    "input": "http://[0:1:0:1:0:1:0:1]",
    "base": null,
    "href": "http://[0:1:0:1:0:1:0:1]/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[0:1:0:1:0:1:0:1]",
    "hostname": "[0:1:0:1:0:1:0:1]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://[1:0:1:0:1:0:1:0]",
    "base": null,
    "href": "http://[1:0:1:0:1:0:1:0]/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "[1:0:1:0:1:0:1:0]",
    "hostname": "[1:0:1:0:1:0:1:0]",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "Percent-encoded query and fragment",
  {
    "input": "http://example.org/test?\u0022",
    "base": null,
    "href": "http://example.org/test?%22",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?%22",
    "hash": ""
  },
  {
    "input": "http://example.org/test?\u0023",
    "base": null,
    "href": "http://example.org/test?#",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "http://example.org/test?\u003C",
    "base": null,
    "href": "http://example.org/test?%3C",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?%3C",
    "hash": ""
  },
  {
    "input": "http://example.org/test?\u003E",
    "base": null,
    "href": "http://example.org/test?%3E",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?%3E",
    "hash": ""
  },
  {
    "input": "http://example.org/test?\u2323",
    "base": null,
    "href": "http://example.org/test?%E2%8C%A3",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?%E2%8C%A3",
    "hash": ""
  },
  {
    "input": "http://example.org/test?%23%23",
    "base": null,
    "href": "http://example.org/test?%23%23",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?%23%23",
    "hash": ""
  },
  {
    "input": "http://example.org/test?%GH",
    "base": null,
    "href": "http://example.org/test?%GH",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?%GH",
    "hash": ""
  },
  {
    "input": "http://example.org/test?a#%EF",
    "base": null,
    "href": "http://example.org/test?a#%EF",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?a",
    "hash": "#%EF"
  },
  {
    "input": "http://example.org/test?a#%GH",
    "base": null,
    "href": "http://example.org/test?a#%GH",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?a",
    "hash": "#%GH"
  },
  "URLs that require a non-about:blank base. (Also serve as invalid base tests.)",
  {
    "input": "a",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "a/",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "a//",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  "Bases that don't fail to parse but fail to be bases",
  {
    "input": "test-a-colon.html",
    "base": "a:",
    "failure": true
  },
  {
    "input": "test-a-colon-b.html",
    "base": "a:b",
    "failure": true
  },
  "Other base URL tests, that must succeed",
  {
    "input": "test-a-colon-slash.html",
    "base": "a:/",
    "href": "a:/test-a-colon-slash.html",
    "protocol": "a:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test-a-colon-slash.html",
    "search": "",
    "hash": ""
  },
  {
    "input": "test-a-colon-slash-slash.html",
    "base": "a://",
    "href": "a:///test-a-colon-slash-slash.html",
    "protocol": "a:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test-a-colon-slash-slash.html",
    "search": "",
    "hash": ""
  },
  {
    "input": "test-a-colon-slash-b.html",
    "base": "a:/b",
    "href": "a:/test-a-colon-slash-b.html",
    "protocol": "a:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test-a-colon-slash-b.html",
    "search": "",
    "hash": ""
  },
  {
    "input": "test-a-colon-slash-slash-b.html",
    "base": "a://b",
    "href": "a://b/test-a-colon-slash-slash-b.html",
    "protocol": "a:",
    "username": "",
    "password": "",
    "host": "b",
    "hostname": "b",
    "port": "",
    "pathname": "/test-a-colon-slash-slash-b.html",
    "search": "",
    "hash": ""
  },
  "Null code point in fragment",
  {
    "input": "http://example.org/test?a#b\u0000c",
    "base": null,
    "href": "http://example.org/test?a#b%00c",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?a",
    "hash": "#b%00c"
  },
  {
    "input": "non-spec://example.org/test?a#b\u0000c",
    "base": null,
    "href": "non-spec://example.org/test?a#b%00c",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/test",
    "search": "?a",
    "hash": "#b%00c"
  },
  {
    "input": "non-spec:/test?a#b\u0000c",
    "base": null,
    "href": "non-spec:/test?a#b%00c",
    "protocol": "non-spec:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "?a",
    "hash": "#b%00c"
  },
  "First scheme char - not allowed: https://github.com/whatwg/url/issues/464",
  {
    "input": "10.0.0.7:8080/foo.html",
    "base": "file:///some/dir/bar.html",
    "href": "file:///some/dir/10.0.0.7:8080/foo.html",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/some/dir/10.0.0.7:8080/foo.html",
    "search": "",
    "hash": ""
  },
  "Subsequent scheme chars - not allowed",
  {
    "input": "a!@$*=/foo.html",
    "base": "file:///some/dir/bar.html",
    "href": "file:///some/dir/a!@$*=/foo.html",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/some/dir/a!@$*=/foo.html",
    "search": "",
    "hash": ""
  },
  "First and subsequent scheme chars - allowed",
  {
    "input": "a1234567890-+.:foo/bar",
    "base": "http://example.com/dir/file",
    "href": "a1234567890-+.:foo/bar",
    "protocol": "a1234567890-+.:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "foo/bar",
    "search": "",
    "hash": ""
  },
  "IDNA ignored code points in file URLs hosts",
  {
    "input": "file://a\u00ADb/p",
    "base": null,
    "href": "file://ab/p",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "ab",
    "hostname": "ab",
    "port": "",
    "pathname": "/p",
    "search": "",
    "hash": ""
  },
  {
    "input": "file://a%C2%ADb/p",
    "base": null,
    "href": "file://ab/p",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "ab",
    "hostname": "ab",
    "port": "",
    "pathname": "/p",
    "search": "",
    "hash": ""
  },
  "IDNA hostnames which get mapped to 'localhost'",
  {
    "input": "file://loC𝐀𝐋𝐇𝐨𝐬𝐭/usr/bin",
    "base": null,
    "href": "file:///usr/bin",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/usr/bin",
    "search": "",
    "hash": ""
  },
  "Empty host after the domain to ASCII",
  {
    "input": "file://\u00ad/p",
    "base": null,
    "failure": true
  },
  {
    "input": "file://%C2%AD/p",
    "base": null,
    "failure": true
  },
  {
    "input": "file://xn--/p",
    "base": null,
    "failure": true
  },
  "https://bugzilla.mozilla.org/show_bug.cgi?id=1647058",
  {
    "input": "#link",
    "base": "https://example.org/##link",
    "href": "https://example.org/#link",
    "protocol": "https:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": "#link"
  },
  "UTF-8 percent-encode of C0 control percent-encode set and supersets",
  {
    "input": "non-special:cannot-be-a-base-url-\u0000\u0001\u001F\u001E\u007E\u007F\u0080",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:cannot-be-a-base-url-%00%01%1F%1E~%7F%C2%80",
    "origin": "null",
    "password": "",
    "pathname": "cannot-be-a-base-url-%00%01%1F%1E~%7F%C2%80",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "https://www.example.com/path{\u007Fpath.html?query'\u007F=query#fragment<\u007Ffragment",
    "base": null,
    "hash": "#fragment%3C%7Ffragment",
    "host": "www.example.com",
    "hostname": "www.example.com",
    "href": "https://www.example.com/path%7B%7Fpath.html?query%27%7F=query#fragment%3C%7Ffragment",
    "origin": "https://www.example.com",
    "password": "",
    "pathname": "/path%7B%7Fpath.html",
    "port": "",
    "protocol": "https:",
    "search": "?query%27%7F=query",
    "username": ""
  },
  {
    "input": "https://user:pass[\u007F@foo/bar",
    "base": "http://example.org",
    "hash": "",
    "host": "foo",
    "hostname": "foo",
    "href": "https://user:pass%5B%7F@foo/bar",
    "origin": "https://foo",
    "password": "pass%5B%7F",
    "pathname": "/bar",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": "user"
  },
  "Tests for the distinct percent-encode sets",
  {
    "input": "foo:// !\"$%&'()*+,-.;<=>@[\\]^_`{|}~@host/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "foo://%20!%22$%&'()*+,-.%3B%3C%3D%3E%40%5B%5C%5D%5E_%60%7B%7C%7D~@host/",
    "origin": "null",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": "%20!%22$%&'()*+,-.%3B%3C%3D%3E%40%5B%5C%5D%5E_%60%7B%7C%7D~"
  },
  {
    "input": "wss:// !\"$%&'()*+,-.;<=>@[]^_`{|}~@host/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "wss://%20!%22$%&'()*+,-.%3B%3C%3D%3E%40%5B%5D%5E_%60%7B%7C%7D~@host/",
    "origin": "wss://host",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "wss:",
    "search": "",
    "username": "%20!%22$%&'()*+,-.%3B%3C%3D%3E%40%5B%5D%5E_%60%7B%7C%7D~"
  },
  {
    "input": "foo://joe: !\"$%&'()*+,-.:;<=>@[\\]^_`{|}~@host/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "foo://joe:%20!%22$%&'()*+,-.%3A%3B%3C%3D%3E%40%5B%5C%5D%5E_%60%7B%7C%7D~@host/",
    "origin": "null",
    "password": "%20!%22$%&'()*+,-.%3A%3B%3C%3D%3E%40%5B%5C%5D%5E_%60%7B%7C%7D~",
    "pathname": "/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": "joe"
  },
  {
    "input": "wss://joe: !\"$%&'()*+,-.:;<=>@[]^_`{|}~@host/",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "wss://joe:%20!%22$%&'()*+,-.%3A%3B%3C%3D%3E%40%5B%5D%5E_%60%7B%7C%7D~@host/",
    "origin": "wss://host",
    "password": "%20!%22$%&'()*+,-.%3A%3B%3C%3D%3E%40%5B%5D%5E_%60%7B%7C%7D~",
    "pathname": "/",
    "port":"",
    "protocol": "wss:",
    "search": "",
    "username": "joe"
  },
  {
    "input": "foo://!\"$%&'()*+,-.;=_`{}~/",
    "base": null,
    "hash": "",
    "host": "!\"$%&'()*+,-.;=_`{}~",
    "hostname": "!\"$%&'()*+,-.;=_`{}~",
    "href":"foo://!\"$%&'()*+,-.;=_`{}~/",
    "origin": "null",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": ""
  },
  {
    "input": "wss://!\"$&'()*+,-.;=_`{}~/",
    "base": null,
    "hash": "",
    "host": "!\"$&'()*+,-.;=_`{}~",
    "hostname": "!\"$&'()*+,-.;=_`{}~",
    "href":"wss://!\"$&'()*+,-.;=_`{}~/",
    "origin": "wss://!\"$&'()*+,-.;=_`{}~",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "wss:",
    "search": "",
    "username": ""
  },
  {
    "input": "foo://host/ !\"$%&'()*+,-./:;<=>@[\\]^_`{|}~",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "foo://host/%20!%22$%&'()*+,-./:;%3C=%3E@[\\]^_%60%7B|%7D~",
    "origin": "null",
    "password": "",
    "pathname": "/%20!%22$%&'()*+,-./:;%3C=%3E@[\\]^_%60%7B|%7D~",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": ""
  },
  {
    "input": "wss://host/ !\"$%&'()*+,-./:;<=>@[\\]^_`{|}~",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "wss://host/%20!%22$%&'()*+,-./:;%3C=%3E@[/]^_%60%7B|%7D~",
    "origin": "wss://host",
    "password": "",
    "pathname": "/%20!%22$%&'()*+,-./:;%3C=%3E@[/]^_%60%7B|%7D~",
    "port":"",
    "protocol": "wss:",
    "search": "",
    "username": ""
  },
  {
    "input": "foo://host/dir/? !\"$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "foo://host/dir/?%20!%22$%&'()*+,-./:;%3C=%3E?@[\\]^_`{|}~",
    "origin": "null",
    "password": "",
    "pathname": "/dir/",
    "port":"",
    "protocol": "foo:",
    "search": "?%20!%22$%&'()*+,-./:;%3C=%3E?@[\\]^_`{|}~",
    "username": ""
  },
  {
    "input": "wss://host/dir/? !\"$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
    "base": null,
    "hash": "",
    "host": "host",
    "hostname": "host",
    "href": "wss://host/dir/?%20!%22$%&%27()*+,-./:;%3C=%3E?@[\\]^_`{|}~",
    "origin": "wss://host",
    "password": "",
    "pathname": "/dir/",
    "port":"",
    "protocol": "wss:",
    "search": "?%20!%22$%&%27()*+,-./:;%3C=%3E?@[\\]^_`{|}~",
    "username": ""
  },
  {
    "input": "foo://host/dir/# !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
    "base": null,
    "hash": "#%20!%22#$%&'()*+,-./:;%3C=%3E?@[\\]^_%60{|}~",
    "host": "host",
    "hostname": "host",
    "href": "foo://host/dir/#%20!%22#$%&'()*+,-./:;%3C=%3E?@[\\]^_%60{|}~",
    "origin": "null",
    "password": "",
    "pathname": "/dir/",
    "port":"",
    "protocol": "foo:",
    "search": "",
    "username": ""
  },
  {
    "input": "wss://host/dir/# !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
    "base": null,
    "hash": "#%20!%22#$%&'()*+,-./:;%3C=%3E?@[\\]^_%60{|}~",
    "host": "host",
    "hostname": "host",
    "href": "wss://host/dir/#%20!%22#$%&'()*+,-./:;%3C=%3E?@[\\]^_%60{|}~",
    "origin": "wss://host",
    "password": "",
    "pathname": "/dir/",
    "port":"",
    "protocol": "wss:",
    "search": "",
    "username": ""
  },
  "Ensure that input schemes are not ignored when resolving non-special URLs",
  {
    "input": "abc:rootless",
    "base": "abc://host/path",
    "hash": "",
    "host": "",
    "hostname": "",
    "href":"abc:rootless",
    "password": "",
    "pathname": "rootless",
    "port":"",
    "protocol": "abc:",
    "search": "",
    "username": ""
  },
  {
    "input": "abc:rootless",
    "base": "abc:/path",
    "hash": "",
    "host": "",
    "hostname": "",
    "href":"abc:rootless",
    "password": "",
    "pathname": "rootless",
    "port":"",
    "protocol": "abc:",
    "search": "",
    "username": ""
  },
  {
    "input": "abc:rootless",
    "base": "abc:path",
    "hash": "",
    "host": "",
    "hostname": "",
    "href":"abc:rootless",
    "password": "",
    "pathname": "rootless",
    "port":"",
    "protocol": "abc:",
    "search": "",
    "username": ""
  },
  {
    "input": "abc:/rooted",
    "base": "abc://host/path",
    "hash": "",
    "host": "",
    "hostname": "",
    "href":"abc:/rooted",
    "password": "",
    "pathname": "/rooted",
    "port":"",
    "protocol": "abc:",
    "search": "",
    "username": ""
  },
  "Empty query and fragment with blank should throw an error",
  {
    "input": "#",
    "base": null,
    "failure": true,
    "relativeTo": "any-base"
  },
  {
    "input": "?",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  "Last component looks like a number, but not valid IPv4",
  {
    "input": "http://1.2.3.4.5",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://1.2.3.4.5.",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://0..0x300/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://0..0x300./",
    "base": null,
    "failure": true
  },
  {
    "input": "http://256.256.256.256.256",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://256.256.256.256.256.",
    "base": "http://other.com/",
    "failure": true
  },
  {
    "input": "http://1.2.3.08",
    "base": null,
    "failure": true
  },
  {
    "input": "http://1.2.3.08.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://1.2.3.09",
    "base": null,
    "failure": true
  },
  {
    "input": "http://09.2.3.4",
    "base": null,
    "failure": true
  },
  {
    "input": "http://09.2.3.4.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://01.2.3.4.5",
    "base": null,
    "failure": true
  },
  {
    "input": "http://01.2.3.4.5.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://0x100.2.3.4",
    "base": null,
    "failure": true
  },
  {
    "input": "http://0x100.2.3.4.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://0x1.2.3.4.5",
    "base": null,
    "failure": true
  },
  {
    "input": "http://0x1.2.3.4.5.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.1.2.3.4",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.1.2.3.4.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.2.3.4",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.2.3.4.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.09",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.09.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.0x4",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.0x4.",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.09..",
    "base": null,
    "hash": "",
    "host": "foo.09..",
    "hostname": "foo.09..",
    "href":"http://foo.09../",
    "password": "",
    "pathname": "/",
    "port":"",
    "protocol": "http:",
    "search": "",
    "username": ""
  },
  {
    "input": "http://0999999999999999999/",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.0x",
    "base": null,
    "failure": true
  },
  {
    "input": "http://foo.0XFfFfFfFfFfFfFfFfFfAcE123",
    "base": null,
    "failure": true
  },
  {
    "input": "http://💩.123/",
    "base": null,
    "failure": true
  },
  "U+0000 and U+FFFF in various places",
  {
    "input": "https://\u0000y",
    "base": null,
    "failure": true
  },
  {
    "input": "https://x/\u0000y",
    "base": null,
    "hash": "",
    "host": "x",
    "hostname": "x",
    "href": "https://x/%00y",
    "password": "",
    "pathname": "/%00y",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": ""
  },
  {
    "input": "https://x/?\u0000y",
    "base": null,
    "hash": "",
    "host": "x",
    "hostname": "x",
    "href": "https://x/?%00y",
    "password": "",
    "pathname": "/",
    "port": "",
    "protocol": "https:",
    "search": "?%00y",
    "username": ""
  },
  {
    "input": "https://x/?#\u0000y",
    "base": null,
    "hash": "#%00y",
    "host": "x",
    "hostname": "x",
    "href": "https://x/?#%00y",
    "password": "",
    "pathname": "/",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": ""
  },
  {
    "input": "https://\uFFFFy",
    "base": null,
    "failure": true
  },
  {
    "input": "https://x/\uFFFFy",
    "base": null,
    "hash": "",
    "host": "x",
    "hostname": "x",
    "href": "https://x/%EF%BF%BFy",
    "password": "",
    "pathname": "/%EF%BF%BFy",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": ""
  },
  {
    "input": "https://x/?\uFFFFy",
    "base": null,
    "hash": "",
    "host": "x",
    "hostname": "x",
    "href": "https://x/?%EF%BF%BFy",
    "password": "",
    "pathname": "/",
    "port": "",
    "protocol": "https:",
    "search": "?%EF%BF%BFy",
    "username": ""
  },
  {
    "input": "https://x/?#\uFFFFy",
    "base": null,
    "hash": "#%EF%BF%BFy",
    "host": "x",
    "hostname": "x",
    "href": "https://x/?#%EF%BF%BFy",
    "password": "",
    "pathname": "/",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": ""
  },
  {
    "input": "non-special:\u0000y",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:%00y",
    "password": "",
    "pathname": "%00y",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "non-special:x/\u0000y",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:x/%00y",
    "password": "",
    "pathname": "x/%00y",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "non-special:x/?\u0000y",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:x/?%00y",
    "password": "",
    "pathname": "x/",
    "port": "",
    "protocol": "non-special:",
    "search": "?%00y",
    "username": ""
  },
  {
    "input": "non-special:x/?#\u0000y",
    "base": null,
    "hash": "#%00y",
    "host": "",
    "hostname": "",
    "href": "non-special:x/?#%00y",
    "password": "",
    "pathname": "x/",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "non-special:\uFFFFy",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:%EF%BF%BFy",
    "password": "",
    "pathname": "%EF%BF%BFy",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "non-special:x/\uFFFFy",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:x/%EF%BF%BFy",
    "password": "",
    "pathname": "x/%EF%BF%BFy",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "non-special:x/?\uFFFFy",
    "base": null,
    "hash": "",
    "host": "",
    "hostname": "",
    "href": "non-special:x/?%EF%BF%BFy",
    "password": "",
    "pathname": "x/",
    "port": "",
    "protocol": "non-special:",
    "search": "?%EF%BF%BFy",
    "username": ""
  },
  {
    "input": "non-special:x/?#\uFFFFy",
    "base": null,
    "hash": "#%EF%BF%BFy",
    "host": "",
    "hostname": "",
    "href": "non-special:x/?#%EF%BF%BFy",
    "password": "",
    "pathname": "x/",
    "port": "",
    "protocol": "non-special:",
    "search": "",
    "username": ""
  },
  {
    "input": "",
    "base": null,
    "failure": true,
    "relativeTo": "non-opaque-path-base"
  },
  {
    "input": "https://example.com/\"quoted\"",
    "base": null,
    "hash": "",
    "host": "example.com",
    "hostname": "example.com",
    "href": "https://example.com/%22quoted%22",
    "origin": "https://example.com",
    "password": "",
    "pathname": "/%22quoted%22",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": ""
  },
  {
    "input": "https://a%C2%ADb/",
    "base": null,
    "hash": "",
    "host": "ab",
    "hostname": "ab",
    "href": "https://ab/",
    "origin": "https://ab",
    "password": "",
    "pathname": "/",
    "port": "",
    "protocol": "https:",
    "search": "",
    "username": ""
  },
  {
    "comment": "Empty host after domain to ASCII",
    "input": "https://\u00AD/",
    "base": null,
    "failure": true
  },
  {
    "input": "https://%C2%AD/",
    "base": null,
    "failure": true
  },
  {
    "input": "https://xn--/",
    "base": null,
    "failure": true
  },
  "Non-special schemes that some implementations might incorrectly treat as special",
  {
    "input": "data://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "data://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "data:///test",
    "base": null,
    "href": "data:///test",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "data://test/a/../b",
    "base": null,
    "href": "data://test/b",
    "origin": "null",
    "protocol": "data:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "data://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "data://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "data://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "javascript://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "javascript://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "javascript:///test",
    "base": null,
    "href": "javascript:///test",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript://test/a/../b",
    "base": null,
    "href": "javascript://test/b",
    "origin": "null",
    "protocol": "javascript:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "javascript://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "javascript://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "javascript://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "mailto://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "mailto://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "mailto:///test",
    "base": null,
    "href": "mailto:///test",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto://test/a/../b",
    "base": null,
    "href": "mailto://test/b",
    "origin": "null",
    "protocol": "mailto:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "mailto://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "mailto://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "mailto://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "intent://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "intent://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "intent:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "intent:///test",
    "base": null,
    "href": "intent:///test",
    "origin": "null",
    "protocol": "intent:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "intent://test/a/../b",
    "base": null,
    "href": "intent://test/b",
    "origin": "null",
    "protocol": "intent:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "intent://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "intent://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "intent://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "urn://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "urn://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "urn:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "urn:///test",
    "base": null,
    "href": "urn:///test",
    "origin": "null",
    "protocol": "urn:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "urn://test/a/../b",
    "base": null,
    "href": "urn://test/b",
    "origin": "null",
    "protocol": "urn:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "urn://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "urn://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "urn://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "turn://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "turn://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "turn:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "turn:///test",
    "base": null,
    "href": "turn:///test",
    "origin": "null",
    "protocol": "turn:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "turn://test/a/../b",
    "base": null,
    "href": "turn://test/b",
    "origin": "null",
    "protocol": "turn:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "turn://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "turn://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "turn://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "stun://example.com:8080/pathname?search#hash",
    "base": null,
    "href": "stun://example.com:8080/pathname?search#hash",
    "origin": "null",
    "protocol": "stun:",
    "username": "",
    "password": "",
    "host": "example.com:8080",
    "hostname": "example.com",
    "port": "8080",
    "pathname": "/pathname",
    "search": "?search",
    "hash": "#hash"
  },
  {
    "input": "stun:///test",
    "base": null,
    "href": "stun:///test",
    "origin": "null",
    "protocol": "stun:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/test",
    "search": "",
    "hash": ""
  },
  {
    "input": "stun://test/a/../b",
    "base": null,
    "href": "stun://test/b",
    "origin": "null",
    "protocol": "stun:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/b",
    "search": "",
    "hash": ""
  },
  {
    "input": "stun://:443",
    "base": null,
    "failure": true
  },
  {
    "input": "stun://test:test",
    "base": null,
    "failure": true
  },
  {
    "input": "stun://[:1]",
    "base": null,
    "failure": true
  },
  {
    "input": "w://x:0",
    "base": null,
    "href": "w://x:0",
    "origin": "null",
    "protocol": "w:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "west://x:0",
    "base": null,
    "href": "west://x:0",
    "origin": "null",
    "protocol": "west:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "android://x:0/a",
    "base": null,
    "href": "android://x:0/a",
    "origin": "null",
    "protocol": "android:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "drivefs://x:0/a",
    "base": null,
    "href": "drivefs://x:0/a",
    "origin": "null",
    "protocol": "drivefs:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "chromeos-steam://x:0/a",
    "base": null,
    "href": "chromeos-steam://x:0/a",
    "origin": "null",
    "protocol": "chromeos-steam:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "steam://x:0/a",
    "base": null,
    "href": "steam://x:0/a",
    "origin": "null",
    "protocol": "steam:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "materialized-view://x:0/a",
    "base": null,
    "href": "materialized-view://x:0/a",
    "origin": "null",
    "protocol": "materialized-view:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "/a",
    "search": "",
    "hash": ""
  },
  {
    "input": "android-app://x:0",
    "base": null,
    "href": "android-app://x:0",
    "origin": "null",
    "protocol": "android-app:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "chrome-distiller://x:0",
    "base": null,
    "href": "chrome-distiller://x:0",
    "origin": "null",
    "protocol": "chrome-distiller:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "chrome-extension://x:0",
    "base": null,
    "href": "chrome-extension://x:0",
    "origin": "null",
    "protocol": "chrome-extension:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "chrome-native://x:0",
    "base": null,
    "href": "chrome-native://x:0",
    "origin": "null",
    "protocol": "chrome-native:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "chrome-resource://x:0",
    "base": null,
    "href": "chrome-resource://x:0",
    "origin": "null",
    "protocol": "chrome-resource:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "chrome-search://x:0",
    "base": null,
    "href": "chrome-search://x:0",
    "origin": "null",
    "protocol": "chrome-search:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "fuchsia-dir://x:0",
    "base": null,
    "href": "fuchsia-dir://x:0",
    "origin": "null",
    "protocol": "fuchsia-dir:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  {
    "input": "isolated-app://x:0",
    "base": null,
    "href": "isolated-app://x:0",
    "origin": "null",
    "protocol": "isolated-app:",
    "username": "",
    "password": "",
    "host": "x:0",
    "hostname": "x",
    "port": "0",
    "pathname": "",
    "search": "",
    "hash": ""
  },
  "Scheme relative path starting with multiple slashes",
  {
    "input": "///test",
    "base": "http://example.org/",
    "href": "http://test/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///\\//\\//test",
    "base": "http://example.org/",
    "href": "http://test/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "test",
    "hostname": "test",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///example.org/path",
    "base": "http://example.org/",
    "href": "http://example.org/path",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "///example.org/../path",
    "base": "http://example.org/",
    "href": "http://example.org/path",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "///example.org/../../",
    "base": "http://example.org/",
    "href": "http://example.org/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///example.org/../path/../../",
    "base": "http://example.org/",
    "href": "http://example.org/",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "///example.org/../path/../../path",
    "base": "http://example.org/",
    "href": "http://example.org/path",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "/\\/\\//example.org/../path",
    "base": "http://example.org/",
    "href": "http://example.org/path",
    "protocol": "http:",
    "username": "",
    "password": "",
    "host": "example.org",
    "hostname": "example.org",
    "port": "",
    "pathname": "/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "///abcdef/../",
    "base": "file:///",
    "href": "file:///",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  {
    "input": "/\\//\\/a/../",
    "base": "file:///",
    "href": "file://////",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "////",
    "search": "",
    "hash": ""
  },
  {
    "input": "//a/../",
    "base": "file:///",
    "href": "file://a/",
    "protocol": "file:",
    "username": "",
    "password": "",
    "host": "a",
    "hostname": "a",
    "port": "",
    "pathname": "/",
    "search": "",
    "hash": ""
  },
  "# Non-special URL and backslashes",
  {
    "input": "non-special:\\\\opaque",
    "base": null,
    "href": "non-special:\\\\opaque",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "\\\\opaque",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special:\\\\opaque/path",
    "base": null,
    "href": "non-special:\\\\opaque/path",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "\\\\opaque/path",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special:\\\\opaque\\path",
    "base": null,
    "href": "non-special:\\\\opaque\\path",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "\\\\opaque\\path",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special:\\/opaque",
    "base": null,
    "href": "non-special:\\/opaque",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "\\/opaque",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special:/\\path",
    "base": null,
    "href": "non-special:/\\path",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "",
    "hostname": "",
    "port": "",
    "pathname": "/\\path",
    "search": "",
    "hash": ""
  },
  {
    "input": "non-special://host\\a",
    "base": null,
    "failure": true
  },
  {
    "input": "non-special://host/a\\b",
    "base": null,
    "href": "non-special://host/a\\b",
    "origin": "null",
    "protocol": "non-special:",
    "username": "",
    "password": "",
    "host": "host",
    "hostname": "host",
    "port": "",
    "pathname": "/a\\b",
    "search": "",
    "hash": ""
  }
]
                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/url/toascii.window.js                                                 0000664 0000000 0000000 00000003466 14746647661 0022331 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        promise_test(() => fetch("resources/toascii.json").then(res => res.json()).then(runTests), "Loading data…");

function makeURL(type, input) {
  input = "https://" + input + "/x"
  if(type === "url") {
    return new URL(input)
  } else {
    const url = document.createElement(type)
    url.href = input
    return url
  }
}

function runTests(tests) {
  for(var i = 0, l = tests.length; i < l; i++) {
    let hostTest = tests[i]
    if (typeof hostTest === "string") {
      continue // skip comments
    }
    const typeName = { "url": "URL", "a": "<a>", "area": "<area>" }
    ;["url", "a", "area"].forEach((type) => {
      test(() => {
        if(hostTest.output !== null) {
          const url = makeURL("url", hostTest.input)
          assert_equals(url.host, hostTest.output)
          assert_equals(url.hostname, hostTest.output)
          assert_equals(url.pathname, "/x")
          assert_equals(url.href, "https://" + hostTest.output + "/x")
        } else {
          if(type === "url") {
            assert_throws_js(TypeError, () => makeURL("url", hostTest.input))
          } else {
            const url = makeURL(type, hostTest.input)
            assert_equals(url.host, "")
            assert_equals(url.hostname, "")
            assert_equals(url.pathname, "")
            assert_equals(url.href, "https://" + hostTest.input + "/x")
          }
        }
      }, hostTest.input + " (using " + typeName[type] + ")")
      ;["host", "hostname"].forEach((val) => {
        test(() => {
          const url = makeURL(type, "x")
          url[val] = hostTest.input
          if(hostTest.output !== null) {
            assert_equals(url[val], hostTest.output)
          } else {
            assert_equals(url[val], "x")
          }
        }, hostTest.input + " (using " + typeName[type] + "." + val + ")")
      })
    })
  }
}
                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/url/url-constructor.any.js                                            0000664 0000000 0000000 00000004011 14746647661 0023326 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/common/subset-tests-by-key.js
// META: timeout=long
// META: variant=?include=file
// META: variant=?include=javascript
// META: variant=?include=mailto
// META: variant=?exclude=(file|javascript|mailto)

function runURLTests(urlTests) {
  for (const expected of urlTests) {
    // Skip comments
    if (typeof expected === "string")
      continue;

    const base = expected.base !== null ? expected.base : undefined;

    function getKey(expected) {
      if (expected.protocol) {
        return expected.protocol.replace(":", "");
      }
      if (expected.failure) {
        return expected.input.split(":")[0];
      }
      return "other";
    }

    subsetTestByKey(getKey(expected), test, function() {
      if (expected.failure) {
        assert_throws_js(TypeError, function() {
          new URL(expected.input, base);
        });
        return;
      }

      const url = new URL(expected.input, base);
      assert_equals(url.href, expected.href, "href")
      assert_equals(url.protocol, expected.protocol, "protocol")
      assert_equals(url.username, expected.username, "username")
      assert_equals(url.password, expected.password, "password")
      assert_equals(url.host, expected.host, "host")
      assert_equals(url.hostname, expected.hostname, "hostname")
      assert_equals(url.port, expected.port, "port")
      assert_equals(url.pathname, expected.pathname, "pathname")
      assert_equals(url.search, expected.search, "search")
      if ("searchParams" in expected) {
        assert_true("searchParams" in url)
        assert_equals(url.searchParams.toString(), expected.searchParams, "searchParams")
      }
      assert_equals(url.hash, expected.hash, "hash")
    }, `Parsing: <${expected.input}> ${base ? "against <" + base + ">" : "without base"}`)
  }
}

promise_test(() => Promise.all([
  fetch("resources/urltestdata.json").then(res => res.json()),
  fetch("resources/urltestdata-javascript-only.json").then(res => res.json()),
]).then((tests) => tests.flat()).then(runURLTests), "Loading data…");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/url/url-origin.any.js                                                 0000664 0000000 0000000 00000001371 14746647661 0022236 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        promise_test(() => Promise.all([
  fetch("resources/urltestdata.json").then(res => res.json()),
  fetch("resources/urltestdata-javascript-only.json").then(res => res.json()),
]).then((tests) => tests.flat()).then(runURLTests), "Loading data…");

function runURLTests(urlTests) {
  for (const expected of urlTests) {
    // Skip comments and tests without "origin" expectation
    if (typeof expected === "string" || !("origin" in expected))
      continue;

    const base = expected.base !== null ? expected.base : undefined;

    test(() => {
      const url = new URL(expected.input, base);
      assert_equals(url.origin, expected.origin, "origin");
    }, `Origin parsing: <${expected.input}> ${base ? "against <" + base + ">" : "without base"}`);
  }
}
                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/url/url-searchparams.any.js                                           0000664 0000000 0000000 00000005047 14746647661 0023424 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function bURL(url, base) {
  return new URL(url, base || "about:blank")
}

function runURLSearchParamTests() {
  test(function() {
    var url = bURL('http://example.org/?a=b')
    assert_true("searchParams" in url)
    var searchParams = url.searchParams
    assert_equals(url.searchParams, searchParams, 'Object identity should hold.')
  }, 'URL.searchParams getter')

  test(function() {
    var url = bURL('http://example.org/?a=b')
    assert_true("searchParams" in url)
    var searchParams = url.searchParams
    assert_equals(searchParams.toString(), 'a=b')

    searchParams.set('a', 'b')
    assert_equals(url.searchParams.toString(), 'a=b')
    assert_equals(url.search, '?a=b')
    url.search = ''
    assert_equals(url.searchParams.toString(), '')
    assert_equals(url.search, '')
    assert_equals(searchParams.toString(), '')
  }, 'URL.searchParams updating, clearing')

  test(function() {
    'use strict'
    var urlString = 'http://example.org'
    var url = bURL(urlString)
    assert_throws_js(TypeError, function() { url.searchParams = new URLSearchParams(urlString) })
  }, 'URL.searchParams setter, invalid values')

  test(function() {
    var url = bURL('http://example.org/file?a=b&c=d')
    assert_true("searchParams" in url)
    var searchParams = url.searchParams
    assert_equals(url.search, '?a=b&c=d')
    assert_equals(searchParams.toString(), 'a=b&c=d')

    // Test that setting 'search' propagates to the URL object's query object.
    url.search = 'e=f&g=h'
    assert_equals(url.search, '?e=f&g=h')
    assert_equals(searchParams.toString(), 'e=f&g=h')

    // ..and same but with a leading '?'.
    url.search = '?e=f&g=h'
    assert_equals(url.search, '?e=f&g=h')
    assert_equals(searchParams.toString(), 'e=f&g=h')

    // And in the other direction, altering searchParams propagates
    // back to 'search'.
    searchParams.append('i', ' j ')
    assert_equals(url.search, '?e=f&g=h&i=+j+')
    assert_equals(url.searchParams.toString(), 'e=f&g=h&i=+j+')
    assert_equals(searchParams.get('i'), ' j ')

    searchParams.set('e', 'updated')
    assert_equals(url.search, '?e=updated&g=h&i=+j+')
    assert_equals(searchParams.get('e'), 'updated')

    var url2 = bURL('http://example.org/file??a=b&c=d')
    assert_equals(url2.search, '??a=b&c=d')
    assert_equals(url2.searchParams.toString(), '%3Fa=b&c=d')

    url2.href = 'http://example.org/file??a=b'
    assert_equals(url2.search, '??a=b')
    assert_equals(url2.searchParams.toString(), '%3Fa=b')
  }, 'URL.searchParams and URL.search setters, update propagation')
}
runURLSearchParamTests()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/url/url-setters-a-area.window.js                                      0000664 0000000 0000000 00000003174 14746647661 0024307 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/common/subset-tests-by-key.js
// META: variant=?include=file
// META: variant=?include=javascript
// META: variant=?include=mailto
// META: variant=?exclude=(file|javascript|mailto)

// Keep this file in sync with url-setters.any.js.

promise_test(() => fetch("resources/setters_tests.json").then(res => res.json()).then(runURLSettersTests), "Loading data…");

function runURLSettersTests(all_test_cases) {
  for (var attribute_to_be_set in all_test_cases) {
    if (attribute_to_be_set == "comment") {
      continue;
    }
    var test_cases = all_test_cases[attribute_to_be_set];
    for(var i = 0, l = test_cases.length; i < l; i++) {
      var test_case = test_cases[i];
      var name = "Setting <" + test_case.href + ">." + attribute_to_be_set +
                 " = '" + test_case.new_value + "'";
      if ("comment" in test_case) {
        name += " " + test_case.comment;
      }
      const key = test_case.href.split(":")[0];
      subsetTestByKey(key, test, function() {
        var url = document.createElement("a");
        url.href = test_case.href;
        url[attribute_to_be_set] = test_case.new_value;
        for (var attribute in test_case.expected) {
          assert_equals(url[attribute], test_case.expected[attribute])
        }
      }, "<a>: " + name)
      subsetTestByKey(key, test, function() {
        var url = document.createElement("area");
        url.href = test_case.href;
        url[attribute_to_be_set] = test_case.new_value;
        for (var attribute in test_case.expected) {
          assert_equals(url[attribute], test_case.expected[attribute])
        }
      }, "<area>: " + name)
    }
  }
}
                                                                                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/url/url-setters-stripping.any.js                                      0000664 0000000 0000000 00000013515 14746647661 0024460 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function urlString({ scheme = "https",
                     username = "username",
                     password = "password",
                     host = "host",
                     port = "8000",
                     pathname = "path",
                     search = "query",
                     hash = "fragment" }) {
  return `${scheme}://${username}:${password}@${host}:${port}/${pathname}?${search}#${hash}`;
}

function urlRecord(scheme) {
  return new URL(urlString({ scheme }));
}

for(const scheme of ["https", "wpt++"]) {
  for(let i = 0; i < 0x20; i++) {
    const stripped = i === 0x09 || i === 0x0A || i === 0x0D;

    // It turns out that user agents are surprisingly similar for these ranges so generate fewer
    // tests. If this is changed also change the logic for host below.
    if (i !== 0 && i !== 0x1F && !stripped) {
      continue;
    }

    const cpString = String.fromCodePoint(i);
    const cpReference = "U+" + i.toString(16).toUpperCase().padStart(4, "0");

    test(() => {
      const expected = scheme === "https" ? (stripped ? "http" : "https") : (stripped ? "wpt--" : "wpt++");
      const url = urlRecord(scheme);
      url.protocol = String.fromCodePoint(i) + (scheme === "https" ? "http" : "wpt--");
      assert_equals(url.protocol, expected + ":", "property");
      assert_equals(url.href, urlString({ scheme: expected }), "href");
    }, `Setting protocol with leading ${cpReference} (${scheme}:)`);

    test(() => {
      const expected = scheme === "https" ? (stripped ? "http" : "https") : (stripped ? "wpt--" : "wpt++");
      const url = urlRecord(scheme);
      url.protocol = (scheme === "https" ? "http" : "wpt--") + String.fromCodePoint(i);
      assert_equals(url.protocol, expected + ":", "property");
      assert_equals(url.href, urlString({ scheme: expected }), "href");
    }, `Setting protocol with ${cpReference} before inserted colon (${scheme}:)`);

    // Cannot test protocol with trailing as the algorithm inserts a colon before proceeding

    // These do no stripping
    for (const property of ["username", "password"]) {
      for (const [type, expected, input] of [
        ["leading", encodeURIComponent(cpString) + "test", String.fromCodePoint(i) + "test"],
        ["middle", "te" + encodeURIComponent(cpString) + "st", "te" + String.fromCodePoint(i) + "st"],
        ["trailing", "test" + encodeURIComponent(cpString), "test" + String.fromCodePoint(i)]
      ]) {
        test(() => {
          const url = urlRecord(scheme);
          url[property] = input;
          assert_equals(url[property], expected, "property");
          assert_equals(url.href, urlString({ scheme, [property]: expected }), "href");
        }, `Setting ${property} with ${type} ${cpReference} (${scheme}:)`);
      }
    }

    for (const [type, expectedPart, input] of [
      ["leading", (scheme === "https" ? cpString : encodeURIComponent(cpString)) + "test", String.fromCodePoint(i) + "test"],
      ["middle", "te" + (scheme === "https" ? cpString : encodeURIComponent(cpString)) + "st", "te" + String.fromCodePoint(i) + "st"],
      ["trailing", "test" + (scheme === "https" ? cpString : encodeURIComponent(cpString)), "test" + String.fromCodePoint(i)]
    ]) {
      test(() => {
        const expected = i === 0x00 || (scheme === "https" && i === 0x1F) ? "host" : stripped ? "test" : expectedPart;
        const url = urlRecord(scheme);
        url.host = input;
        assert_equals(url.host, expected + ":8000", "property");
        assert_equals(url.href, urlString({ scheme, host: expected }), "href");
      }, `Setting host with ${type} ${cpReference} (${scheme}:)`);

      test(() => {
        const expected = i === 0x00 || (scheme === "https" && i === 0x1F) ? "host" : stripped ? "test" : expectedPart;
        const url = urlRecord(scheme);
        url.hostname = input;
        assert_equals(url.hostname, expected, "property");
        assert_equals(url.href, urlString({ scheme, host: expected }), "href");
      }, `Setting hostname with ${type} ${cpReference} (${scheme}:)`);
    }

    test(() => {
      const expected = stripped ? "9000" : "8000";
      const url = urlRecord(scheme);
      url.port = String.fromCodePoint(i) + "9000";
      assert_equals(url.port, expected, "property");
      assert_equals(url.href, urlString({ scheme, port: expected }), "href");
    }, `Setting port with leading ${cpReference} (${scheme}:)`);

    test(() => {
      const expected = stripped ? "9000" : "90";
      const url = urlRecord(scheme);
      url.port = "90" + String.fromCodePoint(i) + "00";
      assert_equals(url.port, expected, "property");
      assert_equals(url.href, urlString({ scheme, port: expected }), "href");
    }, `Setting port with middle ${cpReference} (${scheme}:)`);

    test(() => {
      const expected = "9000";
      const url = urlRecord(scheme);
      url.port = "9000" + String.fromCodePoint(i);
      assert_equals(url.port, expected, "property");
      assert_equals(url.href, urlString({ scheme, port: expected }), "href");
    }, `Setting port with trailing ${cpReference} (${scheme}:)`);

    for (const [property, separator] of [["pathname", "/"], ["search", "?"], ["hash", "#"]]) {
      for (const [type, expectedPart, input] of [
        ["leading", encodeURIComponent(cpString) + "test", String.fromCodePoint(i) + "test"],
        ["middle", "te" + encodeURIComponent(cpString) + "st", "te" + String.fromCodePoint(i) + "st"],
        ["trailing", "test" + encodeURIComponent(cpString), "test" + String.fromCodePoint(i)]
      ]) {
        test(() => {
          const expected = stripped ? "test" : expectedPart;
          const url = urlRecord(scheme);
          url[property] = input;
          assert_equals(url[property], separator + expected, "property");
          assert_equals(url.href, urlString({ scheme, [property]: expected }), "href");
        }, `Setting ${property} with ${type} ${cpReference} (${scheme}:)`);
      }
    }
  }
}
                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/url/url-setters.any.js                                                0000664 0000000 0000000 00000002403 14746647661 0022435 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/common/subset-tests-by-key.js
// META: variant=?include=file
// META: variant=?include=javascript
// META: variant=?include=mailto
// META: variant=?exclude=(file|javascript|mailto)

// Keep this file in sync with url-setters-a-area.window.js.

promise_test(() => fetch("resources/setters_tests.json").then(res => res.json()).then(runURLSettersTests), "Loading data…");

function runURLSettersTests(all_test_cases) {
  for (var attribute_to_be_set in all_test_cases) {
    if (attribute_to_be_set == "comment") {
      continue;
    }
    var test_cases = all_test_cases[attribute_to_be_set];
    for(var i = 0, l = test_cases.length; i < l; i++) {
      var test_case = test_cases[i];
      var name = "Setting <" + test_case.href + ">." + attribute_to_be_set +
                 " = '" + test_case.new_value + "'";
      if ("comment" in test_case) {
        name += " " + test_case.comment;
      }
      const key = test_case.href.split(":")[0];
      subsetTestByKey(key, test, function() {
        var url = new URL(test_case.href);
        url[attribute_to_be_set] = test_case.new_value;
        for (var attribute in test_case.expected) {
          assert_equals(url[attribute], test_case.expected[attribute])
        }
      }, "URL: " + name)
    }
  }
}
                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/url/url-statics-canparse.any.js                                       0000664 0000000 0000000 00000001400 14746647661 0024204 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // This intentionally does not use resources/urltestdata.json to preserve resources.
[
  {
    "url": undefined,
    "base": undefined,
    "expected": false
  },
  {
    "url": "aaa:b",
    "base": undefined,
    "expected": true
  },
  {
    "url": undefined,
    "base": "aaa:b",
    "expected": false
  },
  {
    "url": "aaa:/b",
    "base": undefined,
    "expected": true
  },
  {
    "url": undefined,
    "base": "aaa:/b",
    "expected": true
  },
  {
    "url": "https://test:test",
    "base": undefined,
    "expected": false
  },
  {
    "url": "a",
    "base": "https://b/",
    "expected": true
  }
].forEach(({ url, base, expected }) => {
  test(() => {
    assert_equals(URL.canParse(url, base), expected);
  }, `URL.canParse(${url}, ${base})`);
});
                                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/url/url-statics-parse.any.js                                          0000664 0000000 0000000 00000002003 14746647661 0023522 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // This intentionally does not use resources/urltestdata.json to preserve resources.
[
  {
    "url": undefined,
    "base": undefined,
    "expected": false
  },
  {
    "url": "aaa:b",
    "base": undefined,
    "expected": true
  },
  {
    "url": undefined,
    "base": "aaa:b",
    "expected": false
  },
  {
    "url": "aaa:/b",
    "base": undefined,
    "expected": true
  },
  {
    "url": undefined,
    "base": "aaa:/b",
    "expected": true
  },
  {
    "url": "https://test:test",
    "base": undefined,
    "expected": false
  },
  {
    "url": "a",
    "base": "https://b/",
    "expected": true
  }
].forEach(({ url, base, expected }) => {
  test(() => {
    if (expected == false) {
      assert_equals(URL.parse(url, base), null);
    } else {
      assert_equals(URL.parse(url, base).href, new URL(url, base).href);
    }
  }, `URL.parse(${url}, ${base})`);
});

test(() => {
  assert_not_equals(URL.parse("https://example/"), URL.parse("https://example/"));
}, `URL.parse() should return a unique object`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/url/url-tojson.any.js                                                 0000664 0000000 0000000 00000000173 14746647661 0022262 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(() => {
  const a = new URL("https://example.com/")
  assert_equals(JSON.stringify(a), "\"https://example.com/\"")
})
                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/url/urlencoded-parser.any.js                                          0000664 0000000 0000000 00000005706 14746647661 0023573 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        [
  { "input": "test", "output": [["test", ""]] },
  { "input": "\uFEFFtest=\uFEFF", "output": [["\uFEFFtest", "\uFEFF"]] },
  { "input": "%EF%BB%BFtest=%EF%BB%BF", "output": [["\uFEFFtest", "\uFEFF"]] },
  { "input": "%EF%BF%BF=%EF%BF%BF", "output": [["\uFFFF", "\uFFFF"]] },
  { "input": "%FE%FF", "output": [["\uFFFD\uFFFD", ""]] },
  { "input": "%FF%FE", "output": [["\uFFFD\uFFFD", ""]] },
  { "input": "†&†=x", "output": [["†", ""], ["†", "x"]] },
  { "input": "%C2", "output": [["\uFFFD", ""]] },
  { "input": "%C2x", "output": [["\uFFFDx", ""]] },
  { "input": "_charset_=windows-1252&test=%C2x", "output": [["_charset_", "windows-1252"], ["test", "\uFFFDx"]] },
  { "input": '', "output": [] },
  { "input": 'a', "output": [['a', '']] },
  { "input": 'a=b', "output": [['a', 'b']] },
  { "input": 'a=', "output": [['a', '']] },
  { "input": '=b', "output": [['', 'b']] },
  { "input": '&', "output": [] },
  { "input": '&a', "output": [['a', '']] },
  { "input": 'a&', "output": [['a', '']] },
  { "input": 'a&a', "output": [['a', ''], ['a', '']] },
  { "input": 'a&b&c', "output": [['a', ''], ['b', ''], ['c', '']] },
  { "input": 'a=b&c=d', "output": [['a', 'b'], ['c', 'd']] },
  { "input": 'a=b&c=d&', "output": [['a', 'b'], ['c', 'd']] },
  { "input": '&&&a=b&&&&c=d&', "output": [['a', 'b'], ['c', 'd']] },
  { "input": 'a=a&a=b&a=c', "output": [['a', 'a'], ['a', 'b'], ['a', 'c']] },
  { "input": 'a==a', "output": [['a', '=a']] },
  { "input": 'a=a+b+c+d', "output": [['a', 'a b c d']] },
  { "input": '%=a', "output": [['%', 'a']] },
  { "input": '%a=a', "output": [['%a', 'a']] },
  { "input": '%a_=a', "output": [['%a_', 'a']] },
  { "input": '%61=a', "output": [['a', 'a']] },
  { "input": '%61+%4d%4D=', "output": [['a MM', '']] },
  { "input": "id=0&value=%", "output": [['id', '0'], ['value', '%']] },
  { "input": "b=%2sf%2a", "output": [['b', '%2sf*']]},
  { "input": "b=%2%2af%2a", "output": [['b', '%2*f*']]},
  { "input": "b=%%2a", "output": [['b', '%*']]}
].forEach((val) => {
  test(() => {
    let sp = new URLSearchParams(val.input),
        i = 0
    for (let item of sp) {
       assert_array_equals(item, val.output[i])
       i++
    }
  }, "URLSearchParams constructed with: " + val.input)

  promise_test(() => {
    let init = new Request("about:blank", { body: val.input, method: "LADIDA", headers: {"Content-Type": "application/x-www-form-urlencoded;charset=windows-1252"} }).formData()
    return init.then((fd) => {
      let i = 0
      for (let item of fd) {
         assert_array_equals(item, val.output[i])
         i++
      }
    })
  }, "request.formData() with input: " + val.input)

  promise_test(() => {
    let init = new Response(val.input, { headers: {"Content-Type": "application/x-www-form-urlencoded;charset=shift_jis"} }).formData()
    return init.then((fd) => {
      let i = 0
      for (let item of fd) {
         assert_array_equals(item, val.output[i])
         i++
      }
    })
  }, "response.formData() with input: " + val.input)
});
                                                          node-23.7.0/test/fixtures/wpt/url/urlsearchparams-append.any.js                                     0000664 0000000 0000000 00000002707 14746647661 0024614 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams();
    params.append('a', 'b');
    assert_equals(params + '', 'a=b');
    params.append('a', 'b');
    assert_equals(params + '', 'a=b&a=b');
    params.append('a', 'c');
    assert_equals(params + '', 'a=b&a=b&a=c');
}, 'Append same name');

test(function() {
    var params = new URLSearchParams();
    params.append('', '');
    assert_equals(params + '', '=');
    params.append('', '');
    assert_equals(params + '', '=&=');
}, 'Append empty strings');

test(function() {
    var params = new URLSearchParams();
    params.append(null, null);
    assert_equals(params + '', 'null=null');
    params.append(null, null);
    assert_equals(params + '', 'null=null&null=null');
}, 'Append null');

test(function() {
    var params = new URLSearchParams();
    params.append('first', 1);
    params.append('second', 2);
    params.append('third', '');
    params.append('first', 10);
    assert_true(params.has('first'), 'Search params object has name "first"');
    assert_equals(params.get('first'), '1', 'Search params object has name "first" with value "1"');
    assert_equals(params.get('second'), '2', 'Search params object has name "second" with value "2"');
    assert_equals(params.get('third'), '', 'Search params object has name "third" with value ""');
    params.append('first', 10);
    assert_equals(params.get('first'), '1', 'Search params object has name "first" with value "1"');
}, 'Append multiple');
                                                         node-23.7.0/test/fixtures/wpt/url/urlsearchparams-constructor.any.js                                0000664 0000000 0000000 00000023243 14746647661 0025730 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams();
    assert_equals(params + '', '');
    params = new URLSearchParams('');
    assert_equals(params + '', '');
    params = new URLSearchParams('a=b');
    assert_equals(params + '', 'a=b');
    params = new URLSearchParams(params);
    assert_equals(params + '', 'a=b');
}, 'Basic URLSearchParams construction');

test(function() {
    var params = new URLSearchParams()
    assert_equals(params.toString(), "")
}, "URLSearchParams constructor, no arguments")

test(function () {
    var params = new URLSearchParams("?a=b")
    assert_equals(params.toString(), "a=b")
}, 'URLSearchParams constructor, remove leading "?"')

test(() => {
    var params = new URLSearchParams(DOMException);
    assert_equals(params.toString(), "INDEX_SIZE_ERR=1&DOMSTRING_SIZE_ERR=2&HIERARCHY_REQUEST_ERR=3&WRONG_DOCUMENT_ERR=4&INVALID_CHARACTER_ERR=5&NO_DATA_ALLOWED_ERR=6&NO_MODIFICATION_ALLOWED_ERR=7&NOT_FOUND_ERR=8&NOT_SUPPORTED_ERR=9&INUSE_ATTRIBUTE_ERR=10&INVALID_STATE_ERR=11&SYNTAX_ERR=12&INVALID_MODIFICATION_ERR=13&NAMESPACE_ERR=14&INVALID_ACCESS_ERR=15&VALIDATION_ERR=16&TYPE_MISMATCH_ERR=17&SECURITY_ERR=18&NETWORK_ERR=19&ABORT_ERR=20&URL_MISMATCH_ERR=21&QUOTA_EXCEEDED_ERR=22&TIMEOUT_ERR=23&INVALID_NODE_TYPE_ERR=24&DATA_CLONE_ERR=25")
    assert_throws_js(TypeError, () => new URLSearchParams(DOMException.prototype),
                  "Constructing a URLSearchParams from DOMException.prototype should throw due to branding checks");
}, "URLSearchParams constructor, DOMException as argument")

test(() => {
    var params = new URLSearchParams('');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_equals(Object.getPrototypeOf(params), URLSearchParams.prototype, 'expected URLSearchParams.prototype as prototype.');
}, "URLSearchParams constructor, empty string as argument")

test(() => {
    var params = new URLSearchParams({});
    assert_equals(params + '', "");
}, 'URLSearchParams constructor, {} as argument');

test(function() {
    var params = new URLSearchParams('a=b');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_false(params.has('b'), 'Search params object has not got name "b"');

    params = new URLSearchParams('a=b&c');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_true(params.has('c'), 'Search params object has name "c"');

    params = new URLSearchParams('&a&&& &&&&&a+b=& c&m%c3%b8%c3%b8');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_true(params.has('a b'), 'Search params object has name "a b"');
    assert_true(params.has(' '), 'Search params object has name " "');
    assert_false(params.has('c'), 'Search params object did not have the name "c"');
    assert_true(params.has(' c'), 'Search params object has name " c"');
    assert_true(params.has('møø'), 'Search params object has name "møø"');

    params = new URLSearchParams('id=0&value=%');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('id'), 'Search params object has name "id"');
    assert_true(params.has('value'), 'Search params object has name "value"');
    assert_equals(params.get('id'), '0');
    assert_equals(params.get('value'), '%');

    params = new URLSearchParams('b=%2sf%2a');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('b'), 'Search params object has name "b"');
    assert_equals(params.get('b'), '%2sf*');

    params = new URLSearchParams('b=%2%2af%2a');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('b'), 'Search params object has name "b"');
    assert_equals(params.get('b'), '%2*f*');

    params = new URLSearchParams('b=%%2a');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('b'), 'Search params object has name "b"');
    assert_equals(params.get('b'), '%*');
}, 'URLSearchParams constructor, string.');

test(function() {
    var seed = new URLSearchParams('a=b&c=d');
    var params = new URLSearchParams(seed);
    assert_true(params != null, 'constructor returned non-null value.');
    assert_equals(params.get('a'), 'b');
    assert_equals(params.get('c'), 'd');
    assert_false(params.has('d'));
    // The name-value pairs are copied when created; later updates
    // should not be observable.
    seed.append('e', 'f');
    assert_false(params.has('e'));
    params.append('g', 'h');
    assert_false(seed.has('g'));
}, 'URLSearchParams constructor, object.');

test(function() {
    var formData = new FormData()
    formData.append('a', 'b')
    formData.append('c', 'd')
    var params = new URLSearchParams(formData);
    assert_true(params != null, 'constructor returned non-null value.');
    assert_equals(params.get('a'), 'b');
    assert_equals(params.get('c'), 'd');
    assert_false(params.has('d'));
    // The name-value pairs are copied when created; later updates
    // should not be observable.
    formData.append('e', 'f');
    assert_false(params.has('e'));
    params.append('g', 'h');
    assert_false(formData.has('g'));
}, 'URLSearchParams constructor, FormData.');

test(function() {
    var params = new URLSearchParams('a=b+c');
    assert_equals(params.get('a'), 'b c');
    params = new URLSearchParams('a+b=c');
    assert_equals(params.get('a b'), 'c');
}, 'Parse +');

test(function() {
    const testValue = '+15555555555';
    const params = new URLSearchParams();
    params.set('query', testValue);
    var newParams = new URLSearchParams(params.toString());

    assert_equals(params.toString(), 'query=%2B15555555555');
    assert_equals(params.get('query'), testValue);
    assert_equals(newParams.get('query'), testValue);
}, 'Parse encoded +');

test(function() {
    var params = new URLSearchParams('a=b c');
    assert_equals(params.get('a'), 'b c');
    params = new URLSearchParams('a b=c');
    assert_equals(params.get('a b'), 'c');
}, 'Parse space');

test(function() {
    var params = new URLSearchParams('a=b%20c');
    assert_equals(params.get('a'), 'b c');
    params = new URLSearchParams('a%20b=c');
    assert_equals(params.get('a b'), 'c');
}, 'Parse %20');

test(function() {
    var params = new URLSearchParams('a=b\0c');
    assert_equals(params.get('a'), 'b\0c');
    params = new URLSearchParams('a\0b=c');
    assert_equals(params.get('a\0b'), 'c');
}, 'Parse \\0');

test(function() {
    var params = new URLSearchParams('a=b%00c');
    assert_equals(params.get('a'), 'b\0c');
    params = new URLSearchParams('a%00b=c');
    assert_equals(params.get('a\0b'), 'c');
}, 'Parse %00');

test(function() {
    var params = new URLSearchParams('a=b\u2384');
    assert_equals(params.get('a'), 'b\u2384');
    params = new URLSearchParams('a\u2384b=c');
    assert_equals(params.get('a\u2384b'), 'c');
}, 'Parse \u2384');  // Unicode Character 'COMPOSITION SYMBOL' (U+2384)

test(function() {
    var params = new URLSearchParams('a=b%e2%8e%84');
    assert_equals(params.get('a'), 'b\u2384');
    params = new URLSearchParams('a%e2%8e%84b=c');
    assert_equals(params.get('a\u2384b'), 'c');
}, 'Parse %e2%8e%84');  // Unicode Character 'COMPOSITION SYMBOL' (U+2384)

test(function() {
    var params = new URLSearchParams('a=b\uD83D\uDCA9c');
    assert_equals(params.get('a'), 'b\uD83D\uDCA9c');
    params = new URLSearchParams('a\uD83D\uDCA9b=c');
    assert_equals(params.get('a\uD83D\uDCA9b'), 'c');
}, 'Parse \uD83D\uDCA9');  // Unicode Character 'PILE OF POO' (U+1F4A9)

test(function() {
    var params = new URLSearchParams('a=b%f0%9f%92%a9c');
    assert_equals(params.get('a'), 'b\uD83D\uDCA9c');
    params = new URLSearchParams('a%f0%9f%92%a9b=c');
    assert_equals(params.get('a\uD83D\uDCA9b'), 'c');
}, 'Parse %f0%9f%92%a9');  // Unicode Character 'PILE OF POO' (U+1F4A9)

test(function() {
    var params = new URLSearchParams([]);
    assert_true(params != null, 'constructor returned non-null value.');
    params = new URLSearchParams([['a', 'b'], ['c', 'd']]);
    assert_equals(params.get("a"), "b");
    assert_equals(params.get("c"), "d");
    assert_throws_js(TypeError, function() { new URLSearchParams([[1]]); });
    assert_throws_js(TypeError, function() { new URLSearchParams([[1,2,3]]); });
}, "Constructor with sequence of sequences of strings");

[
  { "input": {"+": "%C2"}, "output": [["+", "%C2"]], "name": "object with +" },
  { "input": {c: "x", a: "?"}, "output": [["c", "x"], ["a", "?"]], "name": "object with two keys" },
  { "input": [["c", "x"], ["a", "?"]], "output": [["c", "x"], ["a", "?"]], "name": "array with two keys" },
  { "input": {"\uD835x": "1", "xx": "2", "\uD83Dx": "3"}, "output": [["\uFFFDx", "3"], ["xx", "2"]], "name": "2 unpaired surrogates (no trailing)" },
  { "input": {"x\uDC53": "1", "x\uDC5C": "2", "x\uDC65": "3"}, "output": [["x\uFFFD", "3"]], "name": "3 unpaired surrogates (no leading)" },
  { "input": {"a\0b": "42", "c\uD83D": "23", "d\u1234": "foo"}, "output": [["a\0b", "42"], ["c\uFFFD", "23"], ["d\u1234", "foo"]], "name": "object with NULL, non-ASCII, and surrogate keys" }
].forEach((val) => {
    test(() => {
        let params = new URLSearchParams(val.input),
            i = 0
        for (let param of params) {
            assert_array_equals(param, val.output[i])
            i++
        }
    }, "Construct with " + val.name)
})

test(() => {
  var params = new URLSearchParams()
  params[Symbol.iterator] = function *() {
    yield ["a", "b"]
  }
  let params2 = new URLSearchParams(params)
  assert_equals(params2.get("a"), "b")
}, "Custom [Symbol.iterator]")
                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/url/urlsearchparams-delete.any.js                                     0000664 0000000 0000000 00000006133 14746647661 0024604 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams('a=b&c=d');
    params.delete('a');
    assert_equals(params + '', 'c=d');
    params = new URLSearchParams('a=a&b=b&a=a&c=c');
    params.delete('a');
    assert_equals(params + '', 'b=b&c=c');
    params = new URLSearchParams('a=a&=&b=b&c=c');
    params.delete('');
    assert_equals(params + '', 'a=a&b=b&c=c');
    params = new URLSearchParams('a=a&null=null&b=b');
    params.delete(null);
    assert_equals(params + '', 'a=a&b=b');
    params = new URLSearchParams('a=a&undefined=undefined&b=b');
    params.delete(undefined);
    assert_equals(params + '', 'a=a&b=b');
}, 'Delete basics');

test(function() {
    var params = new URLSearchParams();
    params.append('first', 1);
    assert_true(params.has('first'), 'Search params object has name "first"');
    assert_equals(params.get('first'), '1', 'Search params object has name "first" with value "1"');
    params.delete('first');
    assert_false(params.has('first'), 'Search params object has no "first" name');
    params.append('first', 1);
    params.append('first', 10);
    params.delete('first');
    assert_false(params.has('first'), 'Search params object has no "first" name');
}, 'Deleting appended multiple');

test(function() {
    var url = new URL('http://example.com/?param1&param2');
    url.searchParams.delete('param1');
    url.searchParams.delete('param2');
    assert_equals(url.href, 'http://example.com/', 'url.href does not have ?');
    assert_equals(url.search, '', 'url.search does not have ?');
}, 'Deleting all params removes ? from URL');

test(function() {
    var url = new URL('http://example.com/?');
    url.searchParams.delete('param1');
    assert_equals(url.href, 'http://example.com/', 'url.href does not have ?');
    assert_equals(url.search, '', 'url.search does not have ?');
}, 'Removing non-existent param removes ? from URL');

test(() => {
  const url = new URL('data:space    ?test');
  assert_true(url.searchParams.has('test'));
  url.searchParams.delete('test');
  assert_false(url.searchParams.has('test'));
  assert_equals(url.search, '');
  assert_equals(url.pathname, 'space');
  assert_equals(url.href, 'data:space');
}, 'Changing the query of a URL with an opaque path can impact the path');

test(() => {
  const url = new URL('data:space    ?test#test');
  url.searchParams.delete('test');
  assert_equals(url.search, '');
  assert_equals(url.pathname, 'space    ');
  assert_equals(url.href, 'data:space    #test');
}, 'Changing the query of a URL with an opaque path can impact the path if the URL has no fragment');

test(() => {
  const params = new URLSearchParams();
  params.append('a', 'b');
  params.append('a', 'c');
  params.append('a', 'd');
  params.delete('a', 'c');
  assert_equals(params.toString(), 'a=b&a=d');
}, "Two-argument delete()");

test(() => {
  const params = new URLSearchParams();
  params.append('a', 'b');
  params.append('a', 'c');
  params.append('b', 'c');
  params.append('b', 'd');
  params.delete('b', 'c');
  params.delete('a', undefined);
  assert_equals(params.toString(), 'b=d');
}, "Two-argument delete() respects undefined as second arg");
                                                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/url/urlsearchparams-foreach.any.js                                    0000664 0000000 0000000 00000004445 14746647661 0024755 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams('a=1&b=2&c=3');
    var keys = [];
    var values = [];
    params.forEach(function(value, key) {
        keys.push(key);
        values.push(value);
    });
    assert_array_equals(keys, ['a', 'b', 'c']);
    assert_array_equals(values, ['1', '2', '3']);
}, "ForEach Check");

test(function() {
    let a = new URL("http://a.b/c?a=1&b=2&c=3&d=4");
    let b = a.searchParams;
    var c = [];
    for (const i of b) {
        a.search = "x=1&y=2&z=3";
        c.push(i);
    }
    assert_array_equals(c[0], ["a","1"]);
    assert_array_equals(c[1], ["y","2"]);
    assert_array_equals(c[2], ["z","3"]);
}, "For-of Check");

test(function() {
    let a = new URL("http://a.b/c");
    let b = a.searchParams;
    for (const i of b) {
        assert_unreached(i);
    }
}, "empty");

test(function() {
    const url = new URL("http://localhost/query?param0=0&param1=1&param2=2");
    const searchParams = url.searchParams;
    const seen = [];
    for (const param of searchParams) {
        if (param[0] === 'param0') {
            searchParams.delete('param1');
        }
        seen.push(param);
    }

    assert_array_equals(seen[0], ["param0", "0"]);
    assert_array_equals(seen[1], ["param2", "2"]);
}, "delete next param during iteration");

test(function() {
    const url = new URL("http://localhost/query?param0=0&param1=1&param2=2");
    const searchParams = url.searchParams;
    const seen = [];
    for (const param of searchParams) {
        if (param[0] === 'param0') {
            searchParams.delete('param0');
            // 'param1=1' is now in the first slot, so the next iteration will see 'param2=2'.
        } else {
            seen.push(param);
        }
    }

    assert_array_equals(seen[0], ["param2", "2"]);
}, "delete current param during iteration");

test(function() {
    const url = new URL("http://localhost/query?param0=0&param1=1&param2=2");
    const searchParams = url.searchParams;
    const seen = [];
    for (const param of searchParams) {
        seen.push(param[0]);
        searchParams.delete(param[0]);
    }

    assert_array_equals(seen, ["param0", "param2"], "param1 should not have been seen by the loop");
    assert_equals(String(searchParams), "param1=1", "param1 should remain");
}, "delete every param seen during iteration");
                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/url/urlsearchparams-get.any.js                                        0000664 0000000 0000000 00000002032 14746647661 0024113 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams('a=b&c=d');
    assert_equals(params.get('a'), 'b');
    assert_equals(params.get('c'), 'd');
    assert_equals(params.get('e'), null);
    params = new URLSearchParams('a=b&c=d&a=e');
    assert_equals(params.get('a'), 'b');
    params = new URLSearchParams('=b&c=d');
    assert_equals(params.get(''), 'b');
    params = new URLSearchParams('a=&c=d&a=e');
    assert_equals(params.get('a'), '');
}, 'Get basics');

test(function() {
    var params = new URLSearchParams('first=second&third&&');
    assert_true(params != null, 'constructor returned non-null value.');
    assert_true(params.has('first'), 'Search params object has name "first"');
    assert_equals(params.get('first'), 'second', 'Search params object has name "first" with value "second"');
    assert_equals(params.get('third'), '', 'Search params object has name "third" with the empty value.');
    assert_equals(params.get('fourth'), null, 'Search params object has no "fourth" name and value.');
}, 'More get() basics');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/url/urlsearchparams-getall.any.js                                     0000664 0000000 0000000 00000002446 14746647661 0024615 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams('a=b&c=d');
    assert_array_equals(params.getAll('a'), ['b']);
    assert_array_equals(params.getAll('c'), ['d']);
    assert_array_equals(params.getAll('e'), []);
    params = new URLSearchParams('a=b&c=d&a=e');
    assert_array_equals(params.getAll('a'), ['b', 'e']);
    params = new URLSearchParams('=b&c=d');
    assert_array_equals(params.getAll(''), ['b']);
    params = new URLSearchParams('a=&c=d&a=e');
    assert_array_equals(params.getAll('a'), ['', 'e']);
}, 'getAll() basics');

test(function() {
    var params = new URLSearchParams('a=1&a=2&a=3&a');
    assert_true(params.has('a'), 'Search params object has name "a"');
    var matches = params.getAll('a');
    assert_true(matches && matches.length == 4, 'Search params object has values for name "a"');
    assert_array_equals(matches, ['1', '2', '3', ''], 'Search params object has expected name "a" values');
    params.set('a', 'one');
    assert_equals(params.get('a'), 'one', 'Search params object has name "a" with value "one"');
    var matches = params.getAll('a');
    assert_true(matches && matches.length == 1, 'Search params object has values for name "a"');
    assert_array_equals(matches, ['one'], 'Search params object has expected name "a" values');
}, 'getAll() multiples');
                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/url/urlsearchparams-has.any.js                                        0000664 0000000 0000000 00000003246 14746647661 0024117 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams('a=b&c=d');
    assert_true(params.has('a'));
    assert_true(params.has('c'));
    assert_false(params.has('e'));
    params = new URLSearchParams('a=b&c=d&a=e');
    assert_true(params.has('a'));
    params = new URLSearchParams('=b&c=d');
    assert_true(params.has(''));
    params = new URLSearchParams('null=a');
    assert_true(params.has(null));
}, 'Has basics');

test(function() {
    var params = new URLSearchParams('a=b&c=d&&');
    params.append('first', 1);
    params.append('first', 2);
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_true(params.has('c'), 'Search params object has name "c"');
    assert_true(params.has('first'), 'Search params object has name "first"');
    assert_false(params.has('d'), 'Search params object has no name "d"');
    params.delete('first');
    assert_false(params.has('first'), 'Search params object has no name "first"');
}, 'has() following delete()');

test(() => {
  const params = new URLSearchParams("a=b&a=d&c&e&");
  assert_true(params.has('a', 'b'));
  assert_false(params.has('a', 'c'));
  assert_true(params.has('a', 'd'));
  assert_true(params.has('e', ''));
  params.append('first', null);
  assert_false(params.has('first', ''));
  assert_true(params.has('first', 'null'));
  params.delete('a', 'b');
  assert_true(params.has('a', 'd'));
}, "Two-argument has()");

test(() => {
  const params = new URLSearchParams("a=b&a=d&c&e&");
  assert_true(params.has('a', 'b'));
  assert_false(params.has('a', 'c'));
  assert_true(params.has('a', 'd'));
  assert_true(params.has('a', undefined));
}, "Two-argument has() respects undefined as second arg");                                                                                                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/url/urlsearchparams-set.any.js                                        0000664 0000000 0000000 00000001732 14746647661 0024135 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams('a=b&c=d');
    params.set('a', 'B');
    assert_equals(params + '', 'a=B&c=d');
    params = new URLSearchParams('a=b&c=d&a=e');
    params.set('a', 'B');
    assert_equals(params + '', 'a=B&c=d')
    params.set('e', 'f');
    assert_equals(params + '', 'a=B&c=d&e=f')
}, 'Set basics');

test(function() {
    var params = new URLSearchParams('a=1&a=2&a=3');
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_equals(params.get('a'), '1', 'Search params object has name "a" with value "1"');
    params.set('first', 4);
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_equals(params.get('a'), '1', 'Search params object has name "a" with value "1"');
    params.set('a', 4);
    assert_true(params.has('a'), 'Search params object has name "a"');
    assert_equals(params.get('a'), '4', 'Search params object has name "a" with value "4"');
}, 'URLSearchParams.set');
                                      node-23.7.0/test/fixtures/wpt/url/urlsearchparams-size.any.js                                       0000664 0000000 0000000 00000001731 14746647661 0024313 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(() => {
  const params = new URLSearchParams("a=1&b=2&a=3");
  assert_equals(params.size, 3);

  params.delete("a");
  assert_equals(params.size, 1);
}, "URLSearchParams's size and deletion");

test(() => {
  const params = new URLSearchParams("a=1&b=2&a=3");
  assert_equals(params.size, 3);

  params.append("b", "4");
  assert_equals(params.size, 4);
}, "URLSearchParams's size and addition");

test(() => {
  const url = new URL("http://localhost/query?a=1&b=2&a=3");
  assert_equals(url.searchParams.size, 3);

  url.searchParams.delete("a");
  assert_equals(url.searchParams.size, 1);

  url.searchParams.append("b", 4);
  assert_equals(url.searchParams.size, 2);
}, "URLSearchParams's size when obtained from a URL");

test(() => {
  const url = new URL("http://localhost/query?a=1&b=2&a=3");
  assert_equals(url.searchParams.size, 3);

  url.search = "?";
  assert_equals(url.searchParams.size, 0);
}, "URLSearchParams's size when obtained from a URL and using .search");
                                       node-23.7.0/test/fixtures/wpt/url/urlsearchparams-sort.any.js                                       0000664 0000000 0000000 00000003423 14746647661 0024330 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        [
  {
    "input": "z=b&a=b&z=a&a=a",
    "output": [["a", "b"], ["a", "a"], ["z", "b"], ["z", "a"]]
  },
  {
    "input": "\uFFFD=x&\uFFFC&\uFFFD=a",
    "output": [["\uFFFC", ""], ["\uFFFD", "x"], ["\uFFFD", "a"]]
  },
  {
    "input": "ﬃ&🌈", // 🌈 > code point, but < code unit because two code units
    "output": [["🌈", ""], ["ﬃ", ""]]
  },
  {
    "input": "é&e\uFFFD&e\u0301",
    "output": [["e\u0301", ""], ["e\uFFFD", ""], ["é", ""]]
  },
  {
    "input": "z=z&a=a&z=y&a=b&z=x&a=c&z=w&a=d&z=v&a=e&z=u&a=f&z=t&a=g",
    "output": [["a", "a"], ["a", "b"], ["a", "c"], ["a", "d"], ["a", "e"], ["a", "f"], ["a", "g"], ["z", "z"], ["z", "y"], ["z", "x"], ["z", "w"], ["z", "v"], ["z", "u"], ["z", "t"]]
  },
  {
    "input": "bbb&bb&aaa&aa=x&aa=y",
    "output": [["aa", "x"], ["aa", "y"], ["aaa", ""], ["bb", ""], ["bbb", ""]]
  },
  {
    "input": "z=z&=f&=t&=x",
    "output": [["", "f"], ["", "t"], ["", "x"], ["z", "z"]]
  },
  {
    "input": "a🌈&a💩",
    "output": [["a🌈", ""], ["a💩", ""]]
  }
].forEach((val) => {
  test(() => {
    let params = new URLSearchParams(val.input),
        i = 0
    params.sort()
    for(let param of params) {
      assert_array_equals(param, val.output[i])
      i++
    }
  }, "Parse and sort: " + val.input)

  test(() => {
    let url = new URL("?" + val.input, "https://example/")
    url.searchParams.sort()
    let params = new URLSearchParams(url.search),
        i = 0
    for(let param of params) {
      assert_array_equals(param, val.output[i])
      i++
    }
  }, "URL parse and sort: " + val.input)
})

test(function() {
  const url = new URL("http://example.com/?")
  url.searchParams.sort()
  assert_equals(url.href, "http://example.com/")
  assert_equals(url.search, "")
}, "Sorting non-existent params removes ? from URL")
                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/url/urlsearchparams-stringifier.any.js                                0000664 0000000 0000000 00000010612 14746647661 0025664 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    var params = new URLSearchParams();
    params.append('a', 'b c');
    assert_equals(params + '', 'a=b+c');
    params.delete('a');
    params.append('a b', 'c');
    assert_equals(params + '', 'a+b=c');
}, 'Serialize space');

test(function() {
    var params = new URLSearchParams();
    params.append('a', '');
    assert_equals(params + '', 'a=');
    params.append('a', '');
    assert_equals(params + '', 'a=&a=');
    params.append('', 'b');
    assert_equals(params + '', 'a=&a=&=b');
    params.append('', '');
    assert_equals(params + '', 'a=&a=&=b&=');
    params.append('', '');
    assert_equals(params + '', 'a=&a=&=b&=&=');
}, 'Serialize empty value');

test(function() {
    var params = new URLSearchParams();
    params.append('', 'b');
    assert_equals(params + '', '=b');
    params.append('', 'b');
    assert_equals(params + '', '=b&=b');
}, 'Serialize empty name');

test(function() {
    var params = new URLSearchParams();
    params.append('', '');
    assert_equals(params + '', '=');
    params.append('', '');
    assert_equals(params + '', '=&=');
}, 'Serialize empty name and value');

test(function() {
    var params = new URLSearchParams();
    params.append('a', 'b+c');
    assert_equals(params + '', 'a=b%2Bc');
    params.delete('a');
    params.append('a+b', 'c');
    assert_equals(params + '', 'a%2Bb=c');
}, 'Serialize +');

test(function() {
    var params = new URLSearchParams();
    params.append('=', 'a');
    assert_equals(params + '', '%3D=a');
    params.append('b', '=');
    assert_equals(params + '', '%3D=a&b=%3D');
}, 'Serialize =');

test(function() {
    var params = new URLSearchParams();
    params.append('&', 'a');
    assert_equals(params + '', '%26=a');
    params.append('b', '&');
    assert_equals(params + '', '%26=a&b=%26');
}, 'Serialize &');

test(function() {
    var params = new URLSearchParams();
    params.append('a', '*-._');
    assert_equals(params + '', 'a=*-._');
    params.delete('a');
    params.append('*-._', 'c');
    assert_equals(params + '', '*-._=c');
}, 'Serialize *-._');

test(function() {
    var params = new URLSearchParams();
    params.append('a', 'b%c');
    assert_equals(params + '', 'a=b%25c');
    params.delete('a');
    params.append('a%b', 'c');
    assert_equals(params + '', 'a%25b=c');

    params = new URLSearchParams('id=0&value=%')
    assert_equals(params + '', 'id=0&value=%25')
}, 'Serialize %');

test(function() {
    var params = new URLSearchParams();
    params.append('a', 'b\0c');
    assert_equals(params + '', 'a=b%00c');
    params.delete('a');
    params.append('a\0b', 'c');
    assert_equals(params + '', 'a%00b=c');
}, 'Serialize \\0');

test(function() {
    var params = new URLSearchParams();
    params.append('a', 'b\uD83D\uDCA9c');
    assert_equals(params + '', 'a=b%F0%9F%92%A9c');
    params.delete('a');
    params.append('a\uD83D\uDCA9b', 'c');
    assert_equals(params + '', 'a%F0%9F%92%A9b=c');
}, 'Serialize \uD83D\uDCA9');  // Unicode Character 'PILE OF POO' (U+1F4A9)

test(function() {
    var params;
    params = new URLSearchParams('a=b&c=d&&e&&');
    assert_equals(params.toString(), 'a=b&c=d&e=');
    params = new URLSearchParams('a = b &a=b&c=d%20');
    assert_equals(params.toString(), 'a+=+b+&a=b&c=d+');
    // The lone '=' _does_ survive the roundtrip.
    params = new URLSearchParams('a=&a=b');
    assert_equals(params.toString(), 'a=&a=b');

    params = new URLSearchParams('b=%2sf%2a');
    assert_equals(params.toString(), 'b=%252sf*');

    params = new URLSearchParams('b=%2%2af%2a');
    assert_equals(params.toString(), 'b=%252*f*');

    params = new URLSearchParams('b=%%2a');
    assert_equals(params.toString(), 'b=%25*');
}, 'URLSearchParams.toString');

test(() => {
    const url = new URL('http://www.example.com/?a=b,c');
    const params = url.searchParams;

    assert_equals(url.toString(), 'http://www.example.com/?a=b,c');
    assert_equals(params.toString(), 'a=b%2Cc');

    params.append('x', 'y');

    assert_equals(url.toString(), 'http://www.example.com/?a=b%2Cc&x=y');
    assert_equals(params.toString(), 'a=b%2Cc&x=y');
}, 'URLSearchParams connected to URL');

test(() => {
    const url = new URL('http://www.example.com/');
    const params = url.searchParams;

    params.append('a\nb', 'c\rd');
    params.append('e\n\rf', 'g\r\nh');

    assert_equals(params.toString(), "a%0Ab=c%0Dd&e%0A%0Df=g%0D%0Ah");
}, 'URLSearchParams must not do newline normalization');
                                                                                                                      node-23.7.0/test/fixtures/wpt/user-timing/                                                          0000775 0000000 0000000 00000000000 14746647661 0020462 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/user-timing/META.yml                                                  0000664 0000000 0000000 00000000131 14746647661 0021726 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        spec: https://w3c.github.io/user-timing/
suggested_reviewers:
  - plehegar
  - igrigorik
                                                                                                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/user-timing/buffered-flag.any.js                                      0000664 0000000 0000000 00000002473 14746647661 0024305 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        async_test(t => {
  // First observer creates second in callback to ensure the entry has been dispatched by the time
  // the second observer begins observing.
  new PerformanceObserver(() => {
    // Second observer requires 'buffered: true' to see an entry.
    new PerformanceObserver(t.step_func_done(list => {
      const entries = list.getEntries();
      assert_equals(entries.length, 1, 'There should be 1 mark entry.');
      assert_equals(entries[0].entryType, 'mark');
    })).observe({type: 'mark', buffered: true});
  }).observe({entryTypes: ['mark']});
  performance.mark('foo');
}, 'PerformanceObserver with buffered flag sees previous marks');

async_test(t => {
  // First observer creates second in callback to ensure the entry has been dispatched by the time
  // the second observer begins observing.
  new PerformanceObserver(() => {
    // Second observer requires 'buffered: true' to see an entry.
    new PerformanceObserver(t.step_func_done(list => {
      const entries = list.getEntries();
      assert_equals(entries.length, 1, 'There should be 1 measure entry.');
      assert_equals(entries[0].entryType, 'measure');
    })).observe({type: 'measure', buffered: true});
  }).observe({entryTypes: ['measure']});
  performance.measure('bar');
}, 'PerformanceObserver with buffered flag sees previous measures');
                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/user-timing/case-sensitivity.any.js                                   0000664 0000000 0000000 00000002147 14746647661 0025115 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                          test(function () {
    assert_equals(typeof self.performance, "object");
    assert_equals(typeof self.performance.getEntriesByType, "function");

    self.performance.mark("mark1");
    self.performance.measure("measure1");

    const type = [
      'mark',
      'measure',
    ];
    type.forEach(function(entryType) {
      if (PerformanceObserver.supportedEntryTypes.includes(entryType)) {
        const entryTypeUpperCased = entryType.toUpperCase();
        const entryTypeCapitalized = entryType[0].toUpperCase() + entryType.substring(1);
        const lowerList = self.performance.getEntriesByType(entryType);
        const upperList = self.performance.getEntriesByType(entryTypeUpperCased);
        const mixedList = self.performance.getEntriesByType(entryTypeCapitalized);

        assert_greater_than(lowerList.length, 0, "Entries exist");
        assert_equals(upperList.length, 0, "getEntriesByType('" + entryTypeCapitalized + "').length");
        assert_equals(mixedList.length, 0, "getEntriesByType('" + entryTypeCapitalized + "').length");
      }
    });
  }, "getEntriesByType values are case sensitive");
                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/user-timing/clearMarks.html                                           0000664 0000000 0000000 00000006724 14746647661 0023445 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>functionality test of window.performance.clearMarks</title>
<link rel="author" title="Intel" href="http://www.intel.com/" />
<link rel="help" href="http://www.w3.org/TR/user-timing/#extensions-performance-interface"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/performance-timeline-utils.js"></script>
<script src="resources/webperftestharness.js"></script>
<script src="resources/webperftestharnessextension.js"></script>
<script>
setup({ explicit_done: true });

function onload_test()
{
    const entrylist_checker = new performance_entrylist_checker('mark');
    const string_mark_names = mark_names.map(function (x) { return String(x)});
    mark_names.forEach(function(name) {
        performance.mark(name);
    });

    for (let i = 0; i < mark_names.length; ++i)
    {
        performance.clearMarks(mark_names[i]);
        const retained_entries = performance.getEntriesByType('mark');
        const non_retained_entries = performance.getEntriesByName(mark_names[i], 'mark');
        entrylist_checker.entrylist_check(retained_entries, mark_names.length - i - 1, string_mark_names,
            'First loop: checking entries after removing "' + mark_names[i] + '". ');
        test_equals(non_retained_entries.length, 0,
            'First loop: marks that we cleared for "' + mark_names[i] + '" should not exist anymore.');
    }

    mark_names.forEach(function(name) {
        performance.mark(name);
    });
    performance.clearMarks();
    test_equals(performance.getEntriesByType('mark').length, 0, 'No marks should exist after we clear all.');

    // Following cases test clear existed mark name that is tied for two times.
    mark_names.forEach(function(name) {
        performance.mark(name);
    });
    mark_names.forEach(function(name) {
        performance.mark(name);
    });

    for (let i = 0; i < mark_names.length; ++i)
    {
        performance.clearMarks(mark_names[i]);
        const retained_entries = performance.getEntriesByType('mark');
        const non_retained_entries = performance.getEntriesByName(mark_names[i], 'mark');
        entrylist_checker.entrylist_check(retained_entries, (mark_names.length - i - 1) * 2, string_mark_names,
            'Second loop: checking entries after removing "' + mark_names[i] + '". ');
        test_equals(non_retained_entries.length, 0,
            'Second loop: marks that we cleared for "' + mark_names[i] + '" should not exist anymore.');
    }

    // Following cases test clear functionality when mark names are tied for two times.
    mark_names.forEach(function(name) {
        performance.mark(name);
    });
    mark_names.forEach(function(name) {
        performance.mark(name);
    });
    var entry_number_before_useless_clear = performance.getEntriesByType('Mark').length;
    performance.clearMarks('NonExist');
    var entry_number_after_useless_clear = performance.getEntriesByType('Mark').length;
    test_equals(entry_number_before_useless_clear, entry_number_after_useless_clear, 'Nothing should happen if we clear a non-exist mark.');

    performance.clearMarks();
    test_equals(performance.getEntriesByType('mark').length, 0, 'No marks should exist when we clear all.');

    done();
}
</script>
</head>
<body onload=onload_test()>
    <h1>Description</h1>
    <p>This test validates functionality of the interface window.performance.clearMarks.</p>
    <div id="log"></div>
</body>
</html>
                                            node-23.7.0/test/fixtures/wpt/user-timing/clearMeasures.html                                        0000664 0000000 0000000 00000007056 14746647661 0024153 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>functionality test of window.performance.clearMeasures</title>
<link rel="author" title="Intel" href="http://www.intel.com/" />
<link rel="help" href="http://www.w3.org/TR/user-timing/#extensions-performance-interface"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/performance-timeline-utils.js"></script>
<script src="resources/webperftestharness.js"></script>
<script src="resources/webperftestharnessextension.js"></script>
<script>
setup({ explicit_done: true });

function onload_test()
{
    const context = new PerformanceContext(window.performance);
    const entrylist_checker = new performance_entrylist_checker('measure');
    const measure_names = measures.map(function(x) {return x[0];});

    mark_names.forEach(function(name) {
        context.mark(name);
    });
    measures.forEach(context.initialMeasures, context);
    for (let i = 0; i < measures.length; ++i)
    {
        context.clearMeasures(measures[i][0]);
        const retained_entries = context.getEntriesByType('measure');
        const non_retained_entries = context.getEntriesByName(measures[i][0], 'measure');
        entrylist_checker.entrylist_check(retained_entries, measures.length - i - 1, measure_names,
            'First loop: checking entries after removing "' + measures[i][0] + '". ');
        test_equals(non_retained_entries.length, 0,
            'First loop: measure "' + measures[i][0] + '" should not exist anymore after we cleared it.');
    }

    measures.forEach(context.initialMeasures, context);
    context.clearMeasures();
    test_equals(context.getEntriesByType('measure').length, 0, 'No measures should exist after we clear all (after first loop).');

    // Following cases test clear existed measure name that is tied twice.
    measures.forEach(context.initialMeasures, context);
    mark_names.forEach(function(name) {
        context.mark(name);
    });
    measures.forEach(context.initialMeasures, context);
    for (let i = 0; i < measures.length; ++i)
    {
        context.clearMeasures(measures[i][0]);
        const retained_entries = context.getEntriesByType('measure');
        const non_retained_entries = context.getEntriesByName(measures[i][0], 'measure');
        entrylist_checker.entrylist_check(retained_entries, (measures.length - i - 1) * 2, measure_names,
            'Second loop: checking entries after removing "' + measures[i][0] + '". ');
        test_equals(non_retained_entries.length, 0,
            'Second loop: measure "' + measures[i][0] +'" should not exist anymore after we cleared it.');
    }

    // Following cases test clear functionality when measure names are tied twice.
    measures.forEach(context.initialMeasures, context);
    measures.forEach(context.initialMeasures, context);
    const entry_number_before_useless_clear = context.getEntriesByType('measure').length;
    context.clearMeasures('NonExist');
    const entry_number_after_useless_clear = context.getEntriesByType('measure').length;
    test_equals(entry_number_before_useless_clear, entry_number_after_useless_clear, 'Nothing should happen if we clear a non-exist measure');
    context.clearMeasures();
    test_equals(context.getEntriesByType('measure').length, 0, 'No measures should exist when we clear all (after second loop).');

    done();
}
</script>
</head>
<body onload=onload_test()>
    <h1>Description</h1>
    <p>This test validates functionality of the interface window.performance.clearMeasures.</p>
    <div id="log"></div>
</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/user-timing/clear_all_marks.any.js                                    0000664 0000000 0000000 00000001054 14746647661 0024721 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    self.performance.mark("mark1");
    self.performance.mark("mark2");

    // test that two marks have been created
    var entries = self.performance.getEntriesByType("mark");
    assert_equals(entries.length, 2, "Two marks have been created for this test.");

    // clear all marks
    self.performance.clearMarks();

    // test that all marks were cleared
    entries = self.performance.getEntriesByType("mark");

    assert_equals(entries.length, 0, "All marks have been cleared.");

}, "Clearing all marks remove all of them.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/user-timing/clear_all_measures.any.js                                 0000664 0000000 0000000 00000001444 14746647661 0025433 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function()
{
    self.performance.mark("mark1");
    self.performance.measure("measure1", "mark1");
    self.performance.mark("mark2");
    self.performance.measure("measure2", "mark2");

    // test that two measures have been created
    var entries = self.performance.getEntriesByType("measure");
    assert_equals(entries.length, 2, "Two measures have been created for this test.");

    // clear all measures
    self.performance.clearMeasures();

    // test that all measures were cleared
    entries = self.performance.getEntriesByType("measure");
    assert_equals(entries.length, 0,
              "After a call to self.performance.clearMeasures(), " +
              "self.performance.getEntriesByType(\"measure\") returns an empty object.");

}, "Clearing all marks remove all of them.");
                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/user-timing/clear_non_existent_mark.any.js                            0000664 0000000 0000000 00000002254 14746647661 0026506 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    self.performance.mark("mark1");
    self.performance.mark("mark2");

    // test that two marks have been created
    var entries = self.performance.getEntriesByType("mark");
    assert_equals(entries.length, 2, "Two marks have been created for this test.");

    // clear non-existent mark
    self.performance.clearMarks("mark3");

    // test that "mark1" still exists
    entries = self.performance.getEntriesByName("mark1");
    assert_equals(entries[0].name, "mark1",
              "After a call to self.performance.clearMarks(\"mark3\"), where \"mark3" +
              "\" is a non-existent mark, self.performance.getEntriesByName(\"mark1\") " +
              "returns an object containing the \"mark1\" mark.");

    // test that "mark2" still exists
    entries = self.performance.getEntriesByName("mark2");
    assert_equals(entries[0].name, "mark2",
              "After a call to self.performance.clearMarks(\"mark3\"), where \"mark3" +
              "\" is a non-existent mark, self.performance.getEntriesByName(\"mark2\") " +
              "returns an object containing the \"mark2\" mark.");

}, "Clearing a non-existent mark doesn't affect existing marks");
                                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/user-timing/clear_non_existent_measure.any.js                         0000664 0000000 0000000 00000002546 14746647661 0027221 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function()
{
    self.performance.mark("mark1");
    self.performance.measure("measure1", "mark1");
    self.performance.mark("mark2");
    self.performance.measure("measure2", "mark2");

    // test that two measures have been created
    var entries = self.performance.getEntriesByType("measure");
    assert_equals(entries.length, 2, "Two measures have been created for this test.");

    // clear non-existent measure
    self.performance.clearMeasures("measure3");

    // test that "measure1" still exists
    entries = self.performance.getEntriesByName("measure1");
    assert_equals(entries[0].name, "measure1",
              "After a call to self.performance.clearMeasures(\"measure3\"), where \"measure3" +
              "\" is a non-existent measure, self.performance.getEntriesByName(\"measure1\") " +
              "returns an object containing the \"measure1\" measure.");

    // test that "measure2" still exists
    entries = self.performance.getEntriesByName("measure2");
    assert_equals(entries[0].name, "measure2",
              "After a call to self.performance.clearMeasures(\"measure3\"), where \"measure3" +
              "\" is a non-existent measure, self.performance.getEntriesByName(\"measure2\") " +
              "returns an object containing the \"measure2\" measure.");

}, "Clearing a non-existent measure doesn't affect existing measures");
                                                                                                                                                          node-23.7.0/test/fixtures/wpt/user-timing/clear_one_mark.any.js                                     0000664 0000000 0000000 00000002055 14746647661 0024551 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    self.performance.mark("mark1");
    self.performance.mark("mark2");

    // test that two marks have been created
    var entries = self.performance.getEntriesByType("mark");
    assert_equals(entries.length, 2, "Two marks have been created for this test.");

    // clear existent mark
    self.performance.clearMarks("mark1");

    // test that "mark1" was cleared
    entries = self.performance.getEntriesByName("mark1");

    assert_equals(entries.length, 0,
              "After a call to self.performance.clearMarks(\"mark1\"), " +
              "window.performance.getEntriesByName(\"mark1\") returns an empty object.");

    // test that "mark2" still exists
    entries = self.performance.getEntriesByName("mark2");
    assert_equals(entries[0].name, "mark2",
              "After a call to self.performance.clearMarks(\"mark1\"), " +
              "window.performance.getEntriesByName(\"mark2\") returns an object containing the " +
              "\"mark2\" mark.");

}, "Clearing an existent mark doesn't affect other existing marks");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/user-timing/clear_one_measure.any.js                                  0000664 0000000 0000000 00000002316 14746647661 0025260 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function()
{
    self.performance.mark("mark1");
    self.performance.measure("measure1", "mark1");
    self.performance.mark("mark2");
    self.performance.measure("measure2", "mark2");

    // test that two measures have been created
    var entries = self.performance.getEntriesByType("measure");
    assert_equals(entries.length, 2, "Two measures have been created for this test.");

    // clear existent measure
    self.performance.clearMeasures("measure1");

    // test that "measure1" was cleared
    entries = self.performance.getEntriesByName("measure1");

    assert_equals(entries.length, 0,
              "After a call to self.performance.clearMeasures(\"measure1\"), " +
              "self.performance.getEntriesByName(\"measure1\") returns an empty object.");

    // test that "measure2" still exists
    entries = self.performance.getEntriesByName("measure2");
    assert_equals(entries[0].name, "measure2",
              "After a call to self.performance.clearMeasures(\"measure1\"), " +
              "self.performance.getEntriesByName(\"measure2\") returns an object containing the " +
              "\"measure2\" measure.");

}, "Clearing an existent measure doesn't affect other existing measures");
                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/user-timing/entry_type.any.js                                         0000664 0000000 0000000 00000001236 14746647661 0024012 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function () {
  self.performance.mark('mark');
  var mark_entry = self.performance.getEntriesByName('mark')[0];

  assert_equals(Object.prototype.toString.call(mark_entry), '[object PerformanceMark]', 'Class name of mark entry should be PerformanceMark.');
}, "Validate the user timing entry type PerformanceMark");

test(function () {
  self.performance.measure('measure');
  var measure_entry = self.performance.getEntriesByName('measure')[0];

  assert_equals(Object.prototype.toString.call(measure_entry), '[object PerformanceMeasure]', 'Class name of measure entry should be PerformanceMeasure.');
}, "Validate the user timing entry type PerformanceMeasure");
                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/user-timing/idlharness-shadowrealm.window.js                          0000664 0000000 0000000 00000000210 14746647661 0026757 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/resources/idlharness-shadowrealm.js
idl_test_shadowrealm(["user-timing"], ["hr-time", "performance-timeline", "dom"]);
                                                                                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/user-timing/idlharness.any.js                                         0000664 0000000 0000000 00000001420 14746647661 0023737 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/resources/WebIDLParser.js
// META: script=/resources/idlharness.js
// META: timeout=long

// https://w3c.github.io/user-timing/

'use strict';

idl_test(
  ['user-timing'],
  ['hr-time', 'performance-timeline', 'dom'],
  idl_array => {
    try {
      performance.mark('test');
      performance.measure('test');
      for (const m of performance.getEntriesByType('mark')) {
        self.mark = m;
      }
      for (const m of performance.getEntriesByType('measure')) {
        self.measure = m;
      }
    } catch (e) {
      // Will be surfaced when mark is undefined below.
    }

    idl_array.add_objects({
      Performance: ['performance'],
      PerformanceMark: ['mark'],
      PerformanceMeasure: ['measure'],
    });
  }
);
                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/user-timing/invoke_with_timing_attributes.html                        0000664 0000000 0000000 00000002267 14746647661 0027522 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>exception test of performance.mark and performance.measure</title>
    <meta rel="help" href="https://w3c.github.io/user-timing/#extensions-performance-interface"/>
    <script src="/resources/testharness.js"></script>
    <script src="/resources/testharnessreport.js"></script>
    <script src="resources/webperftestharness.js"></script>
  </head>
  <body>
    <h1>Description</h1>
    <p>This test validates exception scenarios of invoking mark() and measure() with timing attributes as value.</p>
    <div id="log"></div>
    <script>
function emit_test(attrName) {
    test(function() {
        assert_throws_dom("SyntaxError", function() { window.performance.mark(attrName); });
    }, "performance.mark should throw if used with timing attribute " + attrName);
}
for (var i in timingAttributes) {
  emit_test(timingAttributes[i]);
}

function emit_test2(attrName) {
    test(function() {
        window.performance.measure(attrName);
    }, "performance.measure should not throw if used with timing attribute " + attrName);
}
for (var i in timingAttributes) {
  emit_test2(timingAttributes[i]);
}
    </script>
  </body>
</html>
                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/user-timing/invoke_with_timing_attributes.worker.js                   0000664 0000000 0000000 00000001335 14746647661 0030475 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        importScripts("/resources/testharness.js");
importScripts("resources/webperftestharness.js");

function emit_test(attrName) {
    test(function() {
      performance.mark(attrName);
      performance.clearMarks(attrName);
    }, "performance.mark should not throw if used with timing attribute " + attrName
       + " in workers");
}
for (var i in timingAttributes) {
  emit_test(timingAttributes[i]);
}

function emit_test2(attrName) {
    test(function() {
      performance.measure(attrName);
      performance.clearMeasures(attrName);
    }, "performance.measure should not throw if used with timing attribute " + attrName
       + " in workers");
}
for (var i in timingAttributes) {
  emit_test2(timingAttributes[i]);
}
done();
                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/user-timing/invoke_without_parameter.html                             0000664 0000000 0000000 00000002165 14746647661 0026472 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>exception test of performance.mark and performance.measure</title>
        <link rel="author" title="Intel" href="http://www.intel.com/" />
        <link rel="help" href="https://w3c.github.io/user-timing/#extensions-performance-interface"/>
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="resources/webperftestharness.js"></script>
    </head>
    <body>
        <h1>Description</h1>
        <p>This test validates exception scenarios of invoking mark() and measure() without parameter.</p>
        <div id="log"></div>
        <script>
test(function () {
    assert_throws_js(TypeError, function () { window.performance.mark() });
}, "window.performance.mark() throws a TypeError exception when invoke without a parameter.");

test(function () {
    assert_throws_js(TypeError, function () { window.performance.measure(); });
}, "window.performance.measure() throws a TypeError exception when invoke without a parameter.");
        </script>
    </body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/user-timing/mark-entry-constructor.any.js                             0000664 0000000 0000000 00000003274 14746647661 0026270 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=resources/user-timing-helper.js

test(()=>{
  const entry = new PerformanceMark("name");
  assert_true(entry instanceof PerformanceMark);
  checkEntry(entry, {name: "name", entryType: "mark"});
}, "Mark entry can be created by 'new PerformanceMark(string)'.");

test(()=>{
  const entry = new PerformanceMark("name", {});
  assert_true(entry instanceof PerformanceMark);
  checkEntry(entry, {name: "name", entryType: "mark"});
}, "Mark entry can be created by 'new PerformanceMark(string, {})'.");

test(()=>{
  const entry = new PerformanceMark("name", {startTime: 1});
  assert_true(entry instanceof PerformanceMark);
  checkEntry(entry, {name: "name", entryType: "mark", startTime: 1});
}, "Mark entry can be created by 'new PerformanceMark(string, {startTime})'.");

test(()=>{
  const entry = new PerformanceMark("name", {detail: {info: "abc"}});
  assert_true(entry instanceof PerformanceMark);
  checkEntry(entry, {name: "name", entryType: "mark", detail: {info: "abc"}});
}, "Mark entry can be created by 'new PerformanceMark(string, {detail})'.");

test(()=>{
  const entry =
      new PerformanceMark("name", {startTime: 1, detail: {info: "abc"}});
  assert_true(entry instanceof PerformanceMark);
  checkEntry(entry, {name: "name", entryType: "mark", startTime: 1, detail: {info: "abc"}});
}, "Mark entry can be created by " +
   "'new PerformanceMark(string, {startTime, detail})'.");

test(()=>{
  const entry = new PerformanceMark("name");
  assert_true(entry instanceof PerformanceMark);
  checkEntry(entry, {name: "name", entryType: "mark"});
  assert_equals(performance.getEntriesByName("name").length, 0);
}, "Using new PerformanceMark() shouldn't add the entry to performance timeline.");
                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/user-timing/mark-errors.any.js                                        0000664 0000000 0000000 00000003731 14746647661 0024056 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // If you're testing an API that constructs a PerformanceMark, add your test here.
// See the for loop below for details.
const markConstructionTests = [
  {
    testName: "Number should be rejected as the mark-options.",
    testFunction: function(newMarkFunction) {
      assert_throws_js(TypeError, function() { newMarkFunction("mark1", 123); }, "Number passed as a dict argument should cause type-error.");
    },
  },

  {
    testName: "NaN should be rejected as the mark-options.",
    testFunction: function(newMarkFunction) {
      assert_throws_js(TypeError, function() { newMarkFunction("mark1", NaN); }, "NaN passed as a dict argument should cause type-error.");
    },
  },

  {
    testName: "Infinity should be rejected as the mark-options.",
    testFunction: function(newMarkFunction) {
      assert_throws_js(TypeError, function() { newMarkFunction("mark1", Infinity); }, "Infinity passed as a dict argument should cause type-error.");
    },
  },

  {
    testName: "String should be rejected as the mark-options.",
    testFunction: function(newMarkFunction) {
      assert_throws_js(TypeError, function() { newMarkFunction("mark1", "string"); }, "String passed as a dict argument should cause type-error.")
    },
  },

  {
    testName: "Negative startTime in mark-options should be rejected",
    testFunction: function(newMarkFunction) {
      assert_throws_js(TypeError, function() { newMarkFunction("mark1", {startTime: -1}); }, "Negative startTime should cause type-error.")
    },
  },
];

// There are multiple function calls that can construct a mark using the same arguments so we run
// each test on each construction method here, avoiding duplication.
for (let testInfo of markConstructionTests) {
  test(function() {
    testInfo.testFunction(self.performance.mark);
  }, `[performance.mark]: ${testInfo.testName}`);

  test(function() {
    testInfo.testFunction((markName, obj) => new PerformanceMark(markName, obj));
  }, `[new PerformanceMark]: ${testInfo.testName}`);
}
                                       node-23.7.0/test/fixtures/wpt/user-timing/mark-l3.any.js                                            0000664 0000000 0000000 00000003717 14746647661 0023064 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=resources/user-timing-helper.js

async_test(function (t) {
    let mark_entries = [];
    const expected_entries =
        [{ entryType: "mark", name: "mark1", detail: null},
        { entryType: "mark", name: "mark2", detail: null},
        { entryType: "mark", name: "mark3", detail: null},
        { entryType: "mark", name: "mark4", detail: null},
        { entryType: "mark", name: "mark5", detail: null},
        { entryType: "mark", name: "mark6", detail: {}},
        { entryType: "mark", name: "mark7", detail: {info: 'abc'}},
        { entryType: "mark", name: "mark8", detail: null, startTime: 234.56},
        { entryType: "mark", name: "mark9", detail: {count: 3}, startTime: 345.67}];
    const observer = new PerformanceObserver(
        t.step_func(function (entryList, obs) {
          mark_entries =
            mark_entries.concat(entryList.getEntries());
          if (mark_entries.length >= expected_entries.length) {
            checkEntries(mark_entries, expected_entries);
            observer.disconnect();
            t.done();
          }
        })
      );
    self.performance.clearMarks();
    observer.observe({entryTypes: ["mark"]});
    const returned_entries = [];
    returned_entries.push(self.performance.mark("mark1"));
    returned_entries.push(self.performance.mark("mark2", undefined));
    returned_entries.push(self.performance.mark("mark3", null));
    returned_entries.push(self.performance.mark("mark4", {}));
    returned_entries.push(self.performance.mark("mark5", {detail: null}));
    returned_entries.push(self.performance.mark("mark6", {detail: {}}));
    returned_entries.push(self.performance.mark("mark7", {detail: {info: 'abc'}}));
    returned_entries.push(self.performance.mark("mark8", {startTime: 234.56}));
    returned_entries.push(self.performance.mark("mark9", {detail: {count: 3}, startTime: 345.67}));
    checkEntries(returned_entries, expected_entries);
}, "mark entries' detail and startTime are customizable.");
                                                 node-23.7.0/test/fixtures/wpt/user-timing/mark-measure-feature-detection.html                       0000664 0000000 0000000 00000002644 14746647661 0027354 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<meta charset=utf-8>
<title>User Timing: L2 vs L3 feature detection</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
  test(() => {
    // Feature detection for PerformanceMark.
    assert_equals(typeof(PerformanceMark.prototype), "object");
    // Test for UserTiming L3.
    if (PerformanceMark.prototype.hasOwnProperty('detail')) {
      assert_equals(typeof(performance.mark("mark")), "object",
        "performance.mark should return an object in UserTiming L3.");
    }
    // Test for UserTiming L2.
    else {
      assert_equals(typeof(performance.mark("mark")), "undefined",
        "performance.mark should be void in UserTiming L2.");
    }
  }, "Test PerformanceMark existence and feature detection");

  test(() => {
    // Feature detection for PerformanceMeasure.
    assert_equals(typeof(PerformanceMeasure.prototype), "object");
    // Test for UserTiming L3.
    if (PerformanceMeasure.prototype.hasOwnProperty('detail')) {
      assert_equals(typeof(performance.measure("measure")), "object",
        "performance.measure should return an object in UserTiming L3.");
    }
    // Test for UserTiming L2.
    else {
      assert_equals(typeof(performance.measure("measure")), "undefined",
        "performance.measure should be void in UserTiming L2.");
    }
  }, "Test PerformanceMeasure existence and feature detection");
</script>
                                                                                            node-23.7.0/test/fixtures/wpt/user-timing/mark-measure-return-objects.any.js                        0000664 0000000 0000000 00000002471 14746647661 0027147 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        async_test(function (t) {
  self.performance.clearMeasures();
  const measure = self.performance.measure("measure1");
  assert_true(measure instanceof PerformanceMeasure);
  t.done();
}, "L3: performance.measure(name) should return an entry.");

async_test(function (t) {
  self.performance.clearMeasures();
  const measure = self.performance.measure("measure2",
      { start: 12, end: 23 });
  assert_true(measure instanceof PerformanceMeasure);
  t.done();
}, "L3: performance.measure(name, param1) should return an entry.");

async_test(function (t) {
  self.performance.clearMeasures();
  self.performance.mark("1");
  self.performance.mark("2");
  const measure = self.performance.measure("measure3", "1", "2");
  assert_true(measure instanceof PerformanceMeasure);
  t.done();
}, "L3: performance.measure(name, param1, param2) should return an entry.");

async_test(function (t) {
  self.performance.clearMarks();
  const mark = self.performance.mark("mark1");
  assert_true(mark instanceof PerformanceMark);
  t.done();
}, "L3: performance.mark(name) should return an entry.");

async_test(function (t) {
  self.performance.clearMarks();
  const mark = self.performance.mark("mark2", { startTime: 34 });
  assert_true(mark instanceof PerformanceMark);
  t.done();
}, "L3: performance.mark(name, param) should return an entry.");
                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/user-timing/mark.any.js                                               0000664 0000000 0000000 00000007641 14746647661 0022550 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // test data
var testThreshold = 20;

var expectedTimes = new Array();

function match_entries(entries, index)
{
    var entry = entries[index];
    var match = self.performance.getEntriesByName("mark")[index];
    assert_equals(entry.name, match.name, "entry.name");
    assert_equals(entry.startTime, match.startTime, "entry.startTime");
    assert_equals(entry.entryType, match.entryType, "entry.entryType");
    assert_equals(entry.duration, match.duration, "entry.duration");
}

function filter_entries_by_type(entryList, entryType)
{
    var testEntries = new Array();

    // filter entryList
    for (var i in entryList)
    {
        if (entryList[i].entryType == entryType)
        {
            testEntries.push(entryList[i]);
        }
    }

    return testEntries;
}

test(function () {
  // create first mark
  self.performance.mark("mark");

  expectedTimes[0] = self.performance.now();

  const entries = self.performance.getEntriesByName("mark");
  assert_equals(entries.length, 1);
}, "Entry 0 is properly created");

test(function () {
    // create second, duplicate mark
    self.performance.mark("mark");

    expectedTimes[1] = self.performance.now();

    const entries = self.performance.getEntriesByName("mark");
    assert_equals(entries.length, 2);

}, "Entry 1 is properly created");

function test_mark(index) {
   test(function () {
       const entries = self.performance.getEntriesByName("mark");
       assert_equals(entries[index].name, "mark", "Entry has the proper name");
   }, "Entry " + index + " has the proper name");

   test(function () {
       const entries = self.performance.getEntriesByName("mark");
       assert_approx_equals(entries[index].startTime, expectedTimes[index], testThreshold);
   }, "Entry " + index + " startTime is approximately correct (up to " + testThreshold +
              "ms difference allowed)");

   test(function () {
       const entries = self.performance.getEntriesByName("mark");
       assert_equals(entries[index].entryType, "mark");
   }, "Entry " + index + " has the proper entryType");

   test(function () {
       const entries = self.performance.getEntriesByName("mark");
       assert_equals(entries[index].duration, 0);
   }, "Entry " + index +  " duration == 0");

   test(function () {
    const entries = self.performance.getEntriesByName("mark", "mark");
    assert_equals(entries[index].name, "mark");
   }, "getEntriesByName(\"mark\", \"mark\")[" + index + "] returns an " +
                "object containing a \"mark\" mark");

   test(function () {
    const entries = self.performance.getEntriesByName("mark", "mark");
    match_entries(entries, index);
   }, "The mark returned by getEntriesByName(\"mark\", \"mark\")[" + index
      + "] matches the mark returned by " +
              "getEntriesByName(\"mark\")[" + index + "]");

   test(function () {
    const entries = filter_entries_by_type(self.performance.getEntries(), "mark");
    assert_equals(entries[index].name, "mark");
   }, "getEntries()[" + index + "] returns an " +
                "object containing a \"mark\" mark");

   test(function () {
    const entries = filter_entries_by_type(self.performance.getEntries(), "mark");
    match_entries(entries, index);
   }, "The mark returned by getEntries()[" + index
      + "] matches the mark returned by " +
              "getEntriesByName(\"mark\")[" + index + "]");

   test(function () {
    const entries = self.performance.getEntriesByType("mark");
    assert_equals(entries[index].name, "mark");
   }, "getEntriesByType(\"mark\")[" + index + "] returns an " +
                "object containing a \"mark\" mark");

   test(function () {
    const entries = self.performance.getEntriesByType("mark");
    match_entries(entries, index);
   }, "The mark returned by getEntriesByType(\"mark\")[" + index
      + "] matches the mark returned by " +
              "getEntriesByName(\"mark\")[" + index + "]");

}

for (var i = 0; i < expectedTimes.length; i++) {
  test_mark(i);
}
                                                                                               node-23.7.0/test/fixtures/wpt/user-timing/mark.html                                                 0000664 0000000 0000000 00000004434 14746647661 0022307 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>functionality test of window.performance.mark</title>
<link rel="author" title="Intel" href="http://www.intel.com/" />
<link rel="help" href="http://www.w3.org/TR/user-timing/#extensions-performance-interface"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/performance-timeline-utils.js"></script>
<script src="resources/webperftestharness.js"></script>
<script src="resources/webperftestharnessextension.js"></script>
<script>
setup({ explicit_done: true });

function onload_test()
{
    const entrylist_checker = new performance_entrylist_checker('mark');
    const string_mark_names = mark_names.map(function (x) { return String(x)});

    test_equals(performance.getEntriesByType("mark").length, 0, 'There should be ' + 0 + ' marks');
    mark_names.forEach(function(name) {
        performance.mark(name);
    });
    let mark_entrylist = performance.getEntriesByType('mark');

    entrylist_checker.entrylist_check(mark_entrylist, mark_names.length, string_mark_names, 'Checking all entries.');

    for (let i = 0; i < mark_entrylist.length; ++i)
    {
        const mark_entrylist_by_name = performance.getEntriesByName(mark_entrylist[i].name, 'mark');
        entrylist_checker.entrylist_check(mark_entrylist_by_name, 1, string_mark_names,
            'First loop: checking entry of name "' + mark_entrylist[i].name + '".');
    }

    mark_names.forEach(function(name) {
        performance.mark(name);
    });
    mark_entrylist = performance.getEntriesByType('mark');
    entrylist_checker.entrylist_check(mark_entrylist, mark_names.length * 2, string_mark_names, 'Checking all doubly marked entries.');

    for (let i = 0; i < mark_entrylist.length; ++i)
    {
        const mark_entrylist_by_name = performance.getEntriesByName(mark_entrylist[i].name, 'mark');
        entrylist_checker.entrylist_check(mark_entrylist_by_name, 2, string_mark_names,
            'Second loop step ' + i + ': checking entries of name "' + mark_entrylist[i].name + '".');
    }

    done();
}
</script>
</head>
<body onload=onload_test()>
    <h1>Description</h1>
    <p>This test validates functionality of the interface window.performance.mark.</p>
    <div id="log"></div>
</body>
</html>
                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/user-timing/mark_exceptions.html                                      0000664 0000000 0000000 00000002552 14746647661 0024547 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>window.performance User Timing mark() method is throwing the proper exceptions</title>
        <link rel="author" title="Microsoft" href="http://www.microsoft.com/" />
        <link rel="help" href="http://w3c.github.io/user-timing/#dom-performance-mark"/>
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="resources/webperftestharness.js"></script>

    <script>
function test_exception(attrName) {
    test(function () {
        assert_throws_dom("SyntaxError", function () {
            window.performance.mark(attrName);
        })
    }, "window.performance.mark(\"" + attrName + "\") throws a SyntaxError exception.");
}

test(() => {
    assert_throws_js(TypeError, function() {
        window.performance.mark();
    });
}, 'window.performance.mark() throws a TypeError exception.')

// loop through mark scenarios
for (var i in timingAttributes) {
    test_exception(timingAttributes[i]);
}
    </script>
    </head>
    <body>
        <h1>Description</h1>
        <p>This test validates that the performance.mark() method throws a SYNTAX_ERR exception whenever a navigation
           timing attribute is provided for the name parameter.
        </p>

        <div id="log"></div>
    </body>
</html>
                                                                                                                                                      node-23.7.0/test/fixtures/wpt/user-timing/measure-exceptions.html                                   0000664 0000000 0000000 00000002744 14746647661 0025177 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
    This tests that 'performance.measure' throws exceptions with reasonable messages.
</head>
<body>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    window.performance.clearMarks();
    window.performance.clearMeasures();

    window.performance.mark('mark');

    const eventMarks = [
        'unloadEventStart',
        'unloadEventEnd',
        'redirectStart',
        'redirectEnd',
        'secureConnectionStart',
        'domInteractive',
        'domContentLoadedEventStart',
        'domContentLoadedEventEnd',
        'domComplete',
        'loadEventStart',
        'loadEventEnd',
    ];
    eventMarks.forEach(function(name) {
        test(()=>{
            assert_throws_dom("InvalidAccessError", ()=>{
                window.performance.measure("measuring", name, "mark");
            }, "Should throw");
        }, `Passing '${name}' as a mark to measure API should cause error when the mark is empty.`);
    });

    const args = [
        51.15,  // Verify that number is parsed as string, not number.
        "DoesNotExist", // Non-existent mark name should cause error.
    ];
    args.forEach(each => {
        test(()=>{
            assert_throws_dom("SyntaxError", ()=>{
                window.performance.measure("measuring", each, "mark");
            }, "Should throw");
        }, `Passing ${each} as a mark to measure API should cause error.`);
    });
</script>
</body>
</html>                            node-23.7.0/test/fixtures/wpt/user-timing/measure-l3.any.js                                         0000664 0000000 0000000 00000003333 14746647661 0023565 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=resources/user-timing-helper.js

function endTime(entry) {
  return entry.startTime + entry.duration;
}

test(function() {
  performance.clearMarks();
  performance.clearMeasures();
  const markEntry = performance.mark("mark", {startTime: 123});
  const measureEntry = performance.measure("A", undefined, "mark");
  assert_equals(measureEntry.startTime, 0);
  assert_equals(endTime(measureEntry), markEntry.startTime);
}, "When the end mark is given and the start is unprovided, the end time of the measure entry should be the end mark's time, the start time should be 0.");

test(function() {
  performance.clearMarks();
  performance.clearMeasures();
  const markEntry = performance.mark("mark", {startTime: 123});
  const endMin = Number(performance.now().toFixed(2));
  const measureEntry = performance.measure("A", "mark", undefined);
  const endMax = Number(performance.now().toFixed(2));
  assert_equals(measureEntry.startTime, markEntry.startTime);
  assert_greater_than_equal(Number(endTime(measureEntry).toFixed(2)), endMin);
  assert_greater_than_equal(endMax, Number(endTime(measureEntry).toFixed(2)));
}, "When the start mark is given and the end is unprovided, the start time of the measure entry should be the start mark's time, the end should be now.");

test(function() {
  performance.clearMarks();
  performance.clearMeasures();
  const markEntry = performance.mark("mark", {startTime: 123});
  const measureEntry = performance.measure("A", "mark", "mark");
  assert_equals(endTime(measureEntry), markEntry.startTime);
  assert_equals(measureEntry.startTime, markEntry.startTime);
}, "When start and end mark are both given, the start time and end time of the measure entry should be the the marks' time, repectively");
                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/user-timing/measure-with-dict.any.js                                  0000664 0000000 0000000 00000014616 14746647661 0025151 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=resources/user-timing-helper.js

function cleanupPerformanceTimeline() {
    performance.clearMarks();
    performance.clearMeasures();
}

async_test(function (t) {
    this.add_cleanup(cleanupPerformanceTimeline);
    let measureEntries = [];
    const timeStamp1 = 784.4;
    const timeStamp2 = 1234.5;
    const timeStamp3 = 66.6;
    const timeStamp4 = 5566;
    const expectedEntries =
        [{ entryType: "measure", name: "measure1", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure2", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure3", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure4", detail: null },
        { entryType: "measure", name: "measure5", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure6", detail: null, startTime: timeStamp1 },
        { entryType: "measure", name: "measure7", detail: null, startTime: timeStamp1, duration: timeStamp2 - timeStamp1 },
        { entryType: "measure", name: "measure8", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure9", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure10", detail: null, startTime: timeStamp1 },
        { entryType: "measure", name: "measure11", detail: null, startTime: timeStamp3 },
        { entryType: "measure", name: "measure12", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure13", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure14", detail: null, startTime: timeStamp3, duration: timeStamp1 - timeStamp3 },
        { entryType: "measure", name: "measure15", detail: null, startTime: timeStamp1, duration: timeStamp2 - timeStamp1 },
        { entryType: "measure", name: "measure16", detail: null, startTime: timeStamp1 },
        { entryType: "measure", name: "measure17", detail: { customInfo: 159 }, startTime: timeStamp3, duration: timeStamp2 - timeStamp3 },
        { entryType: "measure", name: "measure18", detail: null, startTime: timeStamp1, duration: timeStamp2 - timeStamp1 },
        { entryType: "measure", name: "measure19", detail: null, startTime: timeStamp1, duration: timeStamp2 - timeStamp1 },
        { entryType: "measure", name: "measure20", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure21", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure22", detail: null, startTime: 0 },
        { entryType: "measure", name: "measure23", detail: null, startTime: 0 }];
    const observer = new PerformanceObserver(
        t.step_func(function (entryList, obs) {
          measureEntries =
            measureEntries.concat(entryList.getEntries());
          if (measureEntries.length >= expectedEntries.length) {
            checkEntries(measureEntries, expectedEntries);
            observer.disconnect();
            t.done();
          }
        })
      );
    observer.observe({ entryTypes: ["measure"] });
    self.performance.mark("mark1", { detail: { randomInfo: 3 }, startTime: timeStamp1 });
    self.performance.mark("mark2", { startTime: timeStamp2 });

    const returnedEntries = [];
    returnedEntries.push(self.performance.measure("measure1"));
    returnedEntries.push(self.performance.measure("measure2", undefined));
    returnedEntries.push(self.performance.measure("measure3", null));
    returnedEntries.push(self.performance.measure("measure4", 'mark1'));
    returnedEntries.push(
        self.performance.measure("measure5", null, 'mark1'));
    returnedEntries.push(
        self.performance.measure("measure6", 'mark1', undefined));
    returnedEntries.push(
        self.performance.measure("measure7", 'mark1', 'mark2'));
    returnedEntries.push(
        self.performance.measure("measure8", {}));
    returnedEntries.push(
        self.performance.measure("measure9", { start: undefined }));
    returnedEntries.push(
        self.performance.measure("measure10", { start: 'mark1' }));
    returnedEntries.push(
        self.performance.measure("measure11", { start: timeStamp3 }));
    returnedEntries.push(
        self.performance.measure("measure12", { end: undefined }));
    returnedEntries.push(
        self.performance.measure("measure13", { end: 'mark1' }));
    returnedEntries.push(
        self.performance.measure("measure14", { start: timeStamp3, end: 'mark1' }));
    returnedEntries.push(
        self.performance.measure("measure15", { start: timeStamp1, end: timeStamp2, detail: undefined }));
    returnedEntries.push(
        self.performance.measure("measure16", { start: 'mark1', end: undefined, detail: null }));
    returnedEntries.push(
        self.performance.measure("measure17", { start: timeStamp3, end: 'mark2', detail: { customInfo: 159 }}));
    returnedEntries.push(
        self.performance.measure("measure18", { start: timeStamp1, duration: timeStamp2 - timeStamp1 }));
    returnedEntries.push(
        self.performance.measure("measure19", { duration: timeStamp2 - timeStamp1, end: timeStamp2 }));
    // {}, null, undefined, invalid-dict passed to startOrOptions are interpreted as start time being 0.
    returnedEntries.push(self.performance.measure("measure20", {}, 'mark1'));
    returnedEntries.push(self.performance.measure("measure21", null, 'mark1'));
    returnedEntries.push(self.performance.measure("measure22", undefined, 'mark1'));
    returnedEntries.push(self.performance.measure("measure23", { invalidDict:1 }, 'mark1'));
    checkEntries(returnedEntries, expectedEntries);
}, "measure entries' detail and start/end are customizable");

test(function() {
    this.add_cleanup(cleanupPerformanceTimeline);
    assert_throws_js(TypeError, function() {
      self.performance.measure("optionsAndNumberEnd", {'start': 2}, 12);
    }, "measure should throw a TypeError when passed an options object and an end time");
    assert_throws_js(TypeError, function() {
      self.performance.measure("optionsAndMarkEnd", {'start': 2}, 'mark1');
    }, "measure should throw a TypeError when passed an options object and an end mark");
    assert_throws_js(TypeError, function() {
      self.performance.measure("negativeStartInOptions", {'start': -1});
    }, "measure cannot have a negative time stamp.");
    assert_throws_js(TypeError, function() {
      self.performance.measure("negativeEndInOptions", {'end': -1});
    }, "measure cannot have a negative time stamp for end.");
}, "measure should throw a TypeError when passed an invalid argument combination");

                                                                                                                  node-23.7.0/test/fixtures/wpt/user-timing/measure.html                                              0000664 0000000 0000000 00000041050 14746647661 0023011 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>window.performance User Timing measure() method is working properly</title>
        <link rel="author" title="Microsoft" href="http://www.microsoft.com/" />
        <link rel="help" href="https://w3c.github.io/user-timing/#dom-performance-measure"/>
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="/common/performance-timeline-utils.js"></script>
        <script src="resources/webperftestharness.js"></script>

    <script>
        // test data
        var startMarkName = "mark_start";
        var startMarkValue;
        var endMarkName = "mark_end";
        var endMarkValue;
        var measures;
        var testThreshold = 20;

        // test measures
        var measureTestDelay = 200;
        var TEST_MEASURES =
        [
            {
                name:                   "measure_no_start_no_end",
                startMark:              undefined,
                endMark:                undefined,
                startTime:              undefined,
                duration:               undefined,
                entryType:              "measure",
                entryMatch:             undefined,
                order:                  undefined,
                found:                  false
            },
            {
                name:                   "measure_start_no_end",
                startMark:              "mark_start",
                endMark:                undefined,
                startTime:              undefined,
                duration:               undefined,
                entryType:              "measure",
                entryMatch:             undefined,
                order:                  undefined,
                found:                  false
            },
            {
                name:                   "measure_start_end",
                startMark:              "mark_start",
                endMark:                "mark_end",
                startTime:              undefined,
                duration:               undefined,
                entryType:              "measure",
                entryMatch:             undefined,
                order:                  undefined,
                found:                  false
            },
            {
                name:                   "measure_no_start_end",
                startMark:              undefined,
                endMark:                "mark_end",
                startTime:              undefined,
                duration:               undefined,
                entryType:              "measure",
                entryMatch:             undefined,
                order:                  undefined,
                found:                  false
            },
            // intentional duplicate of the first measure, used to confirm names can be re-used
            {
                name:                   "measure_no_start_no_end",
                startMark:              undefined,
                endMark:                undefined,
                startTime:              undefined,
                duration:               undefined,
                entryType:              "measure",
                entryMatch:             undefined,
                order:                  undefined,
                found:                  false
            }
        ];
        // the index of the duplicate "measure_no_start_no_end"
        const duplicate_index = TEST_MEASURES.map(m=>m.name).lastIndexOf('measure_no_start_no_end');

        setup({explicit_done: true});

        test_namespace();

        function onload_test()
        {
            // test for existence of User Timing and Performance Timeline interface
            if (!has_required_interfaces())
            {
                test_true(false,
                          "The User Timing and Performance Timeline interfaces, which are required for this test, " +
                          "are defined.");

                done();
            }
            else
            {
                // create the start mark for the test measures
                window.performance.mark(startMarkName);

                // get the start mark's value
                startMarkValue = window.performance.getEntriesByName(startMarkName)[0].startTime;

                // create the test end mark using the test delay; this will allow for a significant difference between
                // the mark values that should be represented in the duration of measures using these marks
                step_timeout(measure_test_cb, measureTestDelay);
            }
        }

        function measure_test_cb()
        {
            // create the end mark for the test measures
            window.performance.mark(endMarkName);

            // get the end mark's value
            endMarkValue = window.performance.getEntriesByName(endMarkName)[0].startTime;

            // loop through all measure scenarios and create the corresponding measures
            for (var i in TEST_MEASURES)
            {
                var scenario = TEST_MEASURES[i];

                if (scenario.startMark == undefined && scenario.endMark == undefined)
                {
                    // both startMark and endMark are undefined, don't provide either parameters
                    window.performance.measure(scenario.name);

                    // when startMark isn't provided to the measure() call, a DOMHighResTimeStamp corresponding
                    // to the navigationStart attribute with a timebase of the same attribute is used; this is
                    // equivalent to 0
                    scenario.startTime = 0;

                    // when endMark isn't provided to the measure() call, a DOMHighResTimeStamp corresponding to
                    // the current time with a timebase of the navigationStart attribute is used
                    scenario.duration = (new Date()) - window.performance.timing.navigationStart;
                }
                else if (scenario.startMark != undefined && scenario.endMark == undefined)
                {
                    // only startMark is defined, provide startMark and don't provide endMark
                    window.performance.measure(scenario.name, scenario.startMark);

                    // when startMark is provided to the measure() call, the value of the mark whose name is
                    // provided is used for the startMark
                    scenario.startTime = startMarkValue;

                    // when endMark isn't provided to the measure() call, a DOMHighResTimeStamp corresponding to
                    // the current time with a timebase of the navigationStart attribute is used
                    scenario.duration = window.performance.now() -
                                                startMarkValue;
                }
                else if (scenario.startMark != undefined && scenario.endMark != undefined)
                {
                    // both startMark and endMark are defined, provide both parameters
                    window.performance.measure(scenario.name, scenario.startMark, scenario.endMark);

                    // when startMark is provided to the measure() call, the value of the mark whose name is
                    // provided is used for the startMark
                    scenario.startTime = startMarkValue;

                    // when endMark is provided to the measure() call, the value of the mark whose name is
                    // provided is used for the endMark
                    scenario.duration = endMarkValue - startMarkValue;
                }
                else if (scenario.startMark == undefined && scenario.endMark != undefined)
                {
                    // endMark is defined but startMark is undefined, provide both parameters
                    window.performance.measure(scenario.name, scenario.startMark, scenario.endMark);

                    // when startMark isn't provided to the measure() call, a DOMHighResTimeStamp corresponding
                    // to the navigationStart attribute with a timebase of the same attribute is used; this is
                    // equivalent to 0
                    scenario.startTime = 0;

                    // when endMark is provided to the measure() call, the value of the mark whose name is
                    // provided is used for the endMark
                    scenario.duration = endMarkValue;
                } else
                {
                    test_true(false, 'Test measure scenario unhandled');
                }
            }

            // test that expected measures are returned by getEntriesByName
            for (var i in TEST_MEASURES)
            {
                entries = window.performance.getEntriesByName(TEST_MEASURES[i].name);
                // for all test measures, the test will be validate the test measure against the first entry returned
                // by getEntriesByName(), except for the last measure, where since it is a duplicate measure, the test
                // will validate it against the second entry returned by getEntriesByName()
                test_measure(entries[(i == duplicate_index ? 1 : 0)],
                            "window.performance.getEntriesByName(\"" + TEST_MEASURES[i].name + "\")[" +
                            (i == duplicate_index ? 1 : 0) + "]",
                            TEST_MEASURES[i].name,
                            TEST_MEASURES[i].startTime,
                            TEST_MEASURES[i].duration);
                TEST_MEASURES[i].entryMatch = entries[(i == duplicate_index ? 1 : 0)];
            }

            // test that expected measures are returned by getEntriesByName with the entryType parameter provided
            for (var i in TEST_MEASURES)
            {
                entries = window.performance.getEntriesByName(TEST_MEASURES[i].name, "measure");

                test_true(match_entries(entries[(i == duplicate_index ? 1 : 0)], TEST_MEASURES[i].entryMatch),
                          "window.performance.getEntriesByName(\"" + TEST_MEASURES[i].name + "\", \"measure\")[" +
                          (i == duplicate_index ? 1 : 0) + "] returns an object containing the \"" + TEST_MEASURES[i].name +
                          "\" measure in the correct order, and its value matches the \"" + TEST_MEASURES[i].name +
                          "\" measure returned by window.performance.getEntriesByName(\"" + TEST_MEASURES[i].name +
                          "\")");
            }

            // test that expected measures are returned by getEntries
            entries = get_test_entries(window.performance.getEntries(), "measure");

            test_measure_list(entries, "window.performance.getEntries()", TEST_MEASURES);

            // test that expected measures are returned by getEntriesByType
            entries = window.performance.getEntriesByType("measure");

            test_measure_list(entries, "window.performance.getEntriesByType(\"measure\")", TEST_MEASURES);

            done();
        }

        function match_entries(entry1, entry2, threshold)
        {
            if (threshold == undefined)
            {
                threshold = 0;
            }

            var pass = true;

            // match name
            pass = pass && (entry1.name == entry2.name);

            // match startTime
            pass = pass && (Math.abs(entry1.startTime - entry2.startTime) <= testThreshold);

            // match entryType
            pass = pass && (entry1.entryType == entry2.entryType);

            // match duration
            pass = pass && (Math.abs(entry1.duration - entry2.duration) <= testThreshold);

            return pass;
        }

        function test_measure(measureEntry, measureEntryCommand, expectedName, expectedStartTime, expectedDuration)
        {
            // test name
            test_true(measureEntry.name == expectedName, measureEntryCommand + ".name == \"" + expectedName + "\"");

            // test startTime; since for a mark, the startTime is always equal to a mark's value or the value of a
            // navigation timing attribute, the actual startTime should match the expected value exactly
            test_true(Math.abs(measureEntry.startTime - expectedStartTime) == 0,
                      measureEntryCommand + ".startTime is correct");

            // test entryType
            test_true(measureEntry.entryType == "measure", measureEntryCommand + ".entryType == \"measure\"");

            // test duration, allow for an acceptable threshold in the difference between the actual duration and the
            // expected value for the duration
            test_true(Math.abs(measureEntry.duration - expectedDuration) <= testThreshold, measureEntryCommand +
                      ".duration is approximately correct (up to " + testThreshold + "ms difference allowed)");
        }

        function test_measure_list(measureEntryList, measureEntryListCommand, measureScenarios)
        {
            // give all entries a "found" property that can be set to ensure it isn't tested twice
            for (var i in measureEntryList)
            {
                measureEntryList[i].found = false;
            }

            for (var i in measureScenarios)
            {
                measureScenarios[i].found = false;

                for (var j in measureEntryList)
                {
                    if (match_entries(measureEntryList[j], measureScenarios[i]) && !measureEntryList[j].found)
                    {
                        test_true(match_entries(measureEntryList[j], measureScenarios[i].entryMatch),
                                  measureEntryListCommand + " returns an object containing the \"" +
                                  measureScenarios[i].name + "\" measure, and it's value matches the measure " +
                                  "returned by window.performance.getEntriesByName(\"" + measureScenarios[i].name +
                                  "\")[" + (i == duplicate_index ? 1 : 0) + "].");

                        measureEntryList[j].found = true;
                        measureScenarios[i].found = true;
                        break;
                    }
                }

                if (!measureScenarios[i].found)
                {
                    test_true(false,
                              measureEntryListCommand + " returns an object containing the \"" +
                              measureScenarios[i].name + "\" measure.");
                }
            }

            // verify order of output of getEntriesByType
            var startTimeCurr = 0;
            var pass = true;
            for (var i in measureEntryList)
            {
                if (measureEntryList[i].startTime < startTimeCurr)
                {
                    pass = false;
                }
                startTimeCurr = measureEntryList[i].startTime;
            }
            test_true(pass,
                      measureEntryListCommand + " returns an object containing all test " +
                      "measures in order.");
        }

        function get_test_entries(entryList, entryType)
        {
            var testEntries = new Array();

            // filter entryList
            for (var i in entryList)
            {
                if (entryList[i].entryType == entryType)
                {
                    testEntries.push(entryList[i]);
                }
            }

            return testEntries;
        }
    </script>
    </head>
    <body onload="onload_test();">
        <h1>Description</h1>
        <p>This test validates that the performance.measure() method is working properly. This test creates the
           following measures to test this method:
            <ul>
                <li>"measure_no_start_no_end": created using a measure() call without a startMark or endMark
                    provided</li>
                <li>"measure_start_no_end": created using a measure() call with only the startMark provided</li>
                <li>"measure_start_end": created using a measure() call with both a startMark or endMark provided</li>
                <li>"measure_no_start_end": created using a measure() call with only the endMark provided</li>
                <li>"measure_no_start_no_end": duplicate of the first measure, used to confirm names can be re-used</li>
            </ul>
           After creating each measure, the existence of these measures is validated by calling
           performance.getEntriesByName() (both with and without the entryType parameter provided),
           performance.getEntriesByType(), and performance.getEntries()
        </p>

        <div id="log"></div>
    </body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/user-timing/measure_associated_with_navigation_timing.html            0000664 0000000 0000000 00000007651 14746647661 0032042 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>functionality test of window.performance.measure</title>
<link rel="author" title="Intel" href="http://www.intel.com/" />
<link rel="help" href="http://www.w3.org/TR/user-timing/#extensions-performance-interface"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/performance-timeline-utils.js"></script>
<script src="resources/webperftestharness.js"></script>
<script src="resources/webperftestharnessextension.js"></script>
<script>
setup({ explicit_done: true });

function onload_test()
{
    const measures_for_timing_order = [
        ['nav2now', 'navigationStart'],
        ['loadTime', 'navigationStart', 'loadEventEnd'],
        ['loadEventEnd2a', 'loadEventEnd', 'abc'],
        ['nav2a', 'navigationStart', 'abc'],
        ['domComplete2a', 'domComplete', 'abc'],
        ['negativeValue', 1, 'navigationStart'],
    ];
    const context = new PerformanceContext(window.performance);

    mark_names.forEach(function(name) {
        context.mark(name);
    });
    measures_for_timing_order.forEach(context.initialMeasures, context);
    test_greater_than(context.getEntriesByName('nav2now', 'measure')[0].duration, 0, 'Measure of navigationStart to now should be positive value.');
    test_greater_than(context.getEntriesByName('loadTime', 'measure')[0].duration, 0, 'Measure of navigationStart to loadEventEnd should be positive value.');
    test_greater_than(0, context.getEntriesByName('negativeValue', 'measure')[0].duration, 'Measure of current mark to navigationStart should be negative value.');
    test_equals(context.getEntriesByName('loadTime', 'measure')[0].duration + context.getEntriesByName('loadEventEnd2a', 'measure')[0].duration, context.getEntriesByName('nav2a', 'measure')[0].duration, 'loadTime plus loadEventEnd to a mark "a" should equal to navigationStart to "a".');

    // We later assert that time has passed between setting one set of marks and another set.
    // However, this assertion will fail if the test executes fast enough such that the marks occur
    // at the same clock time. This is more likely in browsers such as Firefox that reduce the
    // precision of the clock exposed through this API to mitigate timing attacks. To mitigate the
    // test failure, we sleep. Firefox may round timestamps to the nearest millisecond in either
    // direction - e.g. 10ms & 11.999ms may both round to 11ms - so we need to sleep at least 2ms to
    // avoid test failures. To be safe, we sleep 3ms.
    sleep_milliseconds(3);

    // Following cases test for scenarios that measure names are tied twice.
    mark_names.forEach(function(name) {
        context.mark(name);
    });
    measures_for_timing_order.forEach(context.initialMeasures, context);

    test_greater_than(context.getEntriesByName('nav2now', 'measure')[1].duration, context.getEntriesByName('nav2now', 'measure')[0].duration, 'Second measure of current mark to navigationStart should be negative value.');
    test_equals(context.getEntriesByName('loadTime', 'measure')[0].duration, context.getEntriesByName('loadTime', 'measure')[1].duration, 'Measures of loadTime should have same duration.');
    test_greater_than(context.getEntriesByName('domComplete2a', 'measure')[1].duration, context.getEntriesByName('domComplete2a', 'measure')[0].duration, 'Measure from domComplete event to most recent mark "a" should have longer duration.');
    test_greater_than(context.getEntriesByName('negativeValue', 'measure')[0].duration, context.getEntriesByName('negativeValue', 'measure')[1].duration, 'Measure from most recent mark to navigationStart should have longer duration.');

    done();
}
</script>
</head>
<body onload="setTimeout(onload_test,0)">
    <h1>Description</h1>
    <p>This test validates functionality of the interface window.performance.measure using keywords from the Navigation Timing spec.</p>
    <div id="log"></div>
</body>
</html>
                                                                                       node-23.7.0/test/fixtures/wpt/user-timing/measure_exception.html                                    0000664 0000000 0000000 00000003465 14746647661 0025077 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>exception test of window.performance.measure</title>
<link rel="author" title="Intel" href="http://www.intel.com/" />
<link rel="help" href="http://www.w3.org/TR/user-timing/#extensions-performance-interface"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/performance-timeline-utils.js"></script>
<script src="resources/webperftestharness.js"></script>
<script src="resources/webperftestharnessextension.js"></script>
</head>

<body>
<h1>Description</h1>
<p>This test validates all exception scenarios of method window.performance.measure in User Timing API</p>

<div id="log"></div>
<script>
performance.mark('ExistMark');
test_method_throw_exception('performance.measure()', TypeError);
test_method_throw_exception('performance.measure("Exception1", "NonExistMark1")', 'SYNTAX_ERR');
test_method_throw_exception('performance.measure("Exception2", "NonExistMark1", "navigationStart")', 'SYNTAX_ERR');
test_method_throw_exception('performance.measure("Exception3", "navigationStart", "NonExistMark1")', 'SYNTAX_ERR');
test_method_throw_exception('performance.measure("Exception4", "NonExistMark1", "ExistMark")', 'SYNTAX_ERR');
test_method_throw_exception('performance.measure("Exception5", "ExistMark", "NonExistMark1")', 'SYNTAX_ERR');
test_method_throw_exception('performance.measure("Exception6", "NonExistMark1", "NonExistMark2")', 'SYNTAX_ERR');
test_method_throw_exception('performance.measure("Exception7", "redirectStart")', 'INVALID_ACCESS_ERR');
test_method_throw_exception('performance.measure("Exception8", {"detail": "non-empty"})', TypeError);
test_method_throw_exception('performance.measure("Exception9", {"start": 1, "duration": 2, "end": 3})', TypeError);
</script>
</body>
</html>
                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/user-timing/measure_exceptions_navigation_timing.html                 0000664 0000000 0000000 00000006334 14746647661 0031046 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>window.performance User Timing measure() method is throwing the proper exceptions</title>
        <link rel="author" title="Microsoft" href="http://www.microsoft.com/" />
        <link rel="help" href="https://w3c.github.io/user-timing/#dom-performance-measure"/>
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="resources/webperftestharness.js"></script>

    <script>
// test data
var zeroedNavTimingAtt = undefined;

setup(function () {
   // for testing the INVALID_ACCESS_ERR exception, find a navigation timing attribute with a value of zero
   for (var i in timingAttributes) {
     if (window.performance.timing[timingAttributes[i]] == 0) {
        zeroedNavTimingAtt = timingAttributes[i];
     }
   }
   if (zeroedNavTimingAtt == undefined) {
       throw new Error("A navigation timing attribute with a value of 0 was not found to test for the " +
                          "INVALID_ACCESS_ERR exception thrown by window.performance.measure().")
   }
});

test(function () {
   assert_throws_dom("InvalidAccessError", function () {
       window.performance.measure("measure", zeroedNavTimingAtt);
   });
}, "window.performance.measure(\"measure\", \"" + zeroedNavTimingAtt + "\"), where \"" +
                              zeroedNavTimingAtt + "\" is a navigation timing attribute with a value of 0, throws a " +
                              "InvalidAccessError exception.");

test(function () {
   assert_throws_dom("InvalidAccessError", function () {
       window.performance.measure("measure", zeroedNavTimingAtt, "responseEnd");
   });
}, "window.performance.measure(\"measure\", \"" + zeroedNavTimingAtt + "\", " +
                              "\"responseEnd\"), where \"" + zeroedNavTimingAtt + "\" is a navigation timing " +
                              "attribute with a value of 0, throws a InvalidAccessError exception.");

test(function () {
   assert_throws_dom("InvalidAccessError", function () {
       window.performance.measure("measure", "navigationStart", zeroedNavTimingAtt);
   });
}, "window.performance.measure(\"measure\", \"navigationStart\", \"" + zeroedNavTimingAtt +
                              "\"), where \"" + zeroedNavTimingAtt + "\" is a navigation timing attribute with a " +
                              "value of 0, throws a InvalidAccessError exception.");

test(function () {
   assert_throws_dom("InvalidAccessError", function () {
       window.performance.measure("measure", zeroedNavTimingAtt, zeroedNavTimingAtt);
   });
}, "window.performance.measure(\"measure\", \"" + zeroedNavTimingAtt + "\", \"" +
                              zeroedNavTimingAtt + "\"), where \"" + zeroedNavTimingAtt + "\" is a navigation timing " +
                              "attribute with a value of 0, throws a InvalidAccessError exception.");
    </script>
    </head>
    <body>
        <h1>Description</h1>
        <p><code>window.performance.measure()</code> method throws a InvalidAccessError
           whenever a navigation timing attribute with a value of zero is provided as the startMark or endMark.
        </p>

        <div id="log"></div>
    </body>
</html>
                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/user-timing/measure_navigation_timing.html                            0000664 0000000 0000000 00000024704 14746647661 0026606 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>window.performance User Timing clearMeasures() method is working properly with navigation timing
               attributes</title>
        <link rel="author" title="Microsoft" href="http://www.microsoft.com/" />
        <link rel="help" href="https://w3c.github.io/user-timing/#dom-performance-measure"/>
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="/common/performance-timeline-utils.js"></script>
        <script src="resources/webperftestharness.js"></script>

    <script>
        // test data
        var startMarkName = "mark_start";
        var startMarkValue;
        var endMarkName = "mark_end";
        var endMarkValue;
        var measures;
        var testThreshold = 20;

        // test measures
        measureTestDelay = 200;
        var TEST_MEASURES =
        [
            {
                name:                   "measure_nav_start_no_end",
                startMark:              "navigationStart",
                endMark:                undefined,
                exceptionTestMessage:   "window.performance.measure(\"measure_nav_start_no_end\", " +
                                        "\"navigationStart\") ran without throwing any exceptions.",
                expectedStartTime:      undefined,
                expectedDuration:       undefined,
                entryMatch:             undefined
            },
            {
                name:                   "measure_nav_start_mark_end",
                startMark:              "navigationStart",
                endMark:                "mark_end",
                exceptionTestMessage:   "window.performance.measure(\"measure_nav_start_end\", \"navigationStart\", " +
                                        "\"mark_end\") ran without throwing any exceptions.",
                expectedStartTime:      undefined,
                expectedDuration:       undefined,
                entryMatch:             undefined
            },
            {
                name:                   "measure_mark_start_nav_end",
                startMark:              "mark_start",
                endMark:                "responseEnd",
                exceptionTestMessage:   "window.performance.measure(\"measure_start_nav_end\", \"mark_start\", " +
                                        "\"responseEnd\") ran without throwing any exceptions.",
                expectedStartTime:      undefined,
                expectedDuration:       undefined,
                entryMatch:             undefined
            },
            {
                name:                   "measure_nav_start_nav_end",
                startMark:              "navigationStart",
                endMark:                "responseEnd",
                exceptionTestMessage:   "window.performance.measure(\"measure_nav_start_nav_end\", " +
                                        "\"navigationStart\", \"responseEnd\") ran without throwing any exceptions.",
                expectedStartTime:      undefined,
                expectedDuration:       undefined,
                entryMatch:             undefined
            }
        ];

        setup({explicit_done: true});

        test_namespace();

        function onload_test()
        {
            // test for existence of User Timing and Performance Timeline interface
            if (!has_required_interfaces())
            {
                test_true(false,
                          "The User Timing and Performance Timeline interfaces, which are required for this test, " +
                          "are defined.");

                done();
            }
            else
            {
                // create the start mark for the test measures
                window.performance.mark(startMarkName);

                // get the start mark's value
                startMarkValue = window.performance.getEntriesByName(startMarkName)[0].startTime;

                // create the test end mark using the test delay; this will allow for a significant difference between
                // the mark values that should be represented in the duration of measures using these marks
                step_timeout(measure_test_cb, measureTestDelay);
            }
        }

        function measure_test_cb()
        {
            // create the end mark for the test measures
            window.performance.mark(endMarkName);

            // get the end mark's value
            endMarkValue = window.performance.getEntriesByName(endMarkName)[0].startTime;

            // loop through measure scenarios
            for (var i in TEST_MEASURES)
            {
                var scenario = TEST_MEASURES[i];

                if (scenario.startMark != undefined && scenario.endMark == undefined)
                {
                    // only startMark is defined, provide startMark and don't provide endMark
                    window.performance.measure(scenario.name, scenario.startMark);

                    // when startMark is provided to the measure() call, the value of the mark or navigation
                    // timing attribute whose name is provided is used for the startMark
                    scenario.expectedStartTime = (timingAttributes.indexOf(scenario.startMark) != -1 ?
                                                  window.performance.timing[scenario.startMark] -
                                                  window.performance.timing.navigationStart :
                                                  startMarkValue);

                    // when endMark isn't provided to the measure() call, a DOMHighResTimeStamp corresponding to
                    // the current time with a timebase of the navigationStart attribute is used
                    scenario.expectedDuration = ((new Date()) - window.performance.timing.navigationStart) -
                                                scenario.expectedStartTime;
                }
                else if (scenario.startMark != undefined && scenario.endMark != undefined)
                {
                    // both startMark and endMark are defined, provide both parameters
                    window.performance.measure(scenario.name, scenario.startMark, scenario.endMark);

                    // when startMark is provided to the measure() call, the value of the mark or navigation
                    // timing attribute whose name is provided is used for the startMark
                    scenario.expectedStartTime = (timingAttributes.indexOf(scenario.startMark) != -1 ?
                                                  window.performance.timing[scenario.startMark] -
                                                  window.performance.timing.navigationStart :
                                                  startMarkValue);

                    // when endMark is provided to the measure() call, the value of the mark whose name is
                    // provided is used for the startMark
                    scenario.expectedDuration = (timingAttributes.indexOf(scenario.endMark) != -1 ?
                                                 window.performance.timing[scenario.endMark] -
                                                 window.performance.timing.navigationStart :
                                                 endMarkValue) - scenario.expectedStartTime;
                }
            }

            // test the test measures are returned by getEntriesByName
            for (var i in TEST_MEASURES)
            {
                entries = window.performance.getEntriesByName(TEST_MEASURES[i].name);
                test_measure(entries[0],
                            "window.performance.getEntriesByName(\"" + TEST_MEASURES[i].name + "\")[0]",
                            TEST_MEASURES[i].name,
                            TEST_MEASURES[i].expectedStartTime,
                            TEST_MEASURES[i].expectedDuration);
                TEST_MEASURES[i].entryMatch = entries[0];
            }

            done();
        }

        function test_measure(measureEntry, measureEntryCommand, expectedName, expectedStartTime, expectedDuration)
        {
            // test name
            test_true(measureEntry.name == expectedName, measureEntryCommand + ".name == \"" + expectedName + "\"");

            // test startTime; since for a mark, the startTime is always equal to a mark's value or the value of a
            // navigation timing attribute, the actual startTime should match the expected value exactly
            test_true(Math.abs(measureEntry.startTime - expectedStartTime) == 0,
                      measureEntryCommand + ".startTime is correct");

            // test entryType
            test_true(measureEntry.entryType == "measure", measureEntryCommand + ".entryType == \"measure\"");

            // test duration, allow for an acceptable threshold in the difference between the actual duration and the
            // expected value for the duration
            test_true(Math.abs(measureEntry.duration - expectedDuration) <= testThreshold, measureEntryCommand +
                      ".duration is approximately correct (up to " + testThreshold + "ms difference allowed)");
        }
    </script>
    </head>
    <body onload="onload_test();">
        <h1>Description</h1>
        <p>This test validates that the performance.measure() method is working properly when navigation timing
           attributes are used in place of mark names. This test creates the following measures to test this method:
            <ul>
                <li>"measure_nav_start_no_end": created using a measure() call with a navigation timing attribute
                    provided as the startMark and nothing provided as the endMark</li>
                <li>"measure_nav_start_mark_end": created using a measure() call with a navigation timing attribute
                    provided as the startMark and a mark name provided as the endMark</li>
                <li>"measure_mark_start_nav_end": created using a measure() call with a mark name provided as the
                    startMark and a navigation timing attribute provided as the endMark</li>
                <li>"measure_nav_start_nav_end":created using a measure() call with a navigation timing attribute
                    provided as both the startMark and endMark</li>
            </ul>
           After creating each measure, the existence of these measures is validated by calling
           performance.getEntriesByName() with each measure name
        </p>

        <div id="log"></div>
    </body>
</html>
                                                            node-23.7.0/test/fixtures/wpt/user-timing/measure_syntax_err.any.js                                 0000664 0000000 0000000 00000002737 14746647661 0025536 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function () {
   self.performance.mark("existing_mark");
   var entries = self.performance.getEntriesByName("existing_mark");
   assert_equals(entries.length, 1);
   self.performance.measure("measure", "existing_mark");
}, "Create a mark \"existing_mark\"");
test(function () {
   assert_throws_dom("SyntaxError", function () {
       self.performance.measure("measure", "mark");
   });
}, "self.performance.measure(\"measure\", \"mark\"), where \"mark\" is a non-existent mark, " +
                          "throws a SyntaxError exception.");

test(function () {
   assert_throws_dom("SyntaxError", function () {
       self.performance.measure("measure", "mark", "existing_mark");
   });
}, "self.performance.measure(\"measure\", \"mark\", \"existing_mark\"), where \"mark\" is a " +
                          "non-existent mark, throws a SyntaxError exception.");

test(function () {
   assert_throws_dom("SyntaxError", function () {
       self.performance.measure("measure", "existing_mark", "mark");
   });
}, "self.performance.measure(\"measure\", \"existing_mark\", \"mark\"), where \"mark\" " +
                            "is a non-existent mark, throws a SyntaxError exception.");

test(function () {
   assert_throws_dom("SyntaxError", function () {
       self.performance.measure("measure", "mark", "mark");
   });
}, "self.performance.measure(\"measure\", \"mark\", \"mark\"), where \"mark\" is a " +
                          "non-existent mark, throws a SyntaxError exception.");
                                 node-23.7.0/test/fixtures/wpt/user-timing/measures.html                                             0000664 0000000 0000000 00000005104 14746647661 0023174 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>functionality test of window.performance.measure</title>
<link rel="author" title="Intel" href="http://www.intel.com/" />
<link rel="help" href="http://www.w3.org/TR/user-timing/#extensions-performance-interface"/>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/performance-timeline-utils.js"></script>
<script src="resources/webperftestharness.js"></script>
<script src="resources/webperftestharnessextension.js"></script>
<script>
setup({ explicit_done: true });

function onload_test()
{
    const context = new PerformanceContext(window.performance);
    const entrylist_checker = new performance_entrylist_checker('measure');
    const measure_names = measures.map(function(x) {return x[0];});

    test_equals(context.getEntriesByType('measure').length, 0, 'There should be ' + 0 + ' entries returned.');

    mark_names.forEach(function(name) {
        context.mark(name);
    });
    measures.forEach(context.initialMeasures, context);

    let measure_entrylist = context.getEntriesByType('measure');
    entrylist_checker.entrylist_check(measure_entrylist, measures.length, measure_names,
        'Checking all entries.');

    for (let i = 0; i < measure_entrylist.length; ++i)
    {
        const measure_entrylist_by_name = context.getEntriesByName(measure_entrylist[i].name, 'measure');
        entrylist_checker.entrylist_check(measure_entrylist_by_name, 1, measure_names,
            'First loop: checking entry of name "' + measure_entrylist[i].name + '".');
    }

    // Following cases test for scenarios that measure names are tied for two times
    mark_names.forEach(function(name) {
        context.mark(name);
    });
    measures.forEach(context.initialMeasures, context);

    measure_entrylist = context.getEntriesByType('measure');
    entrylist_checker.entrylist_check(measure_entrylist, measures.length * 2, measure_names,
        'Checking all doubly measured entries.');

    for (let i = 0; i < measure_entrylist.length; ++i)
    {
        const measure_entrylist_by_name = context.getEntriesByName(measure_entrylist[i].name, 'measure');
        entrylist_checker.entrylist_check(measure_entrylist_by_name, 2, measure_names,
            'Second loop step ' + i + ': checking entry of name "' + measure_entrylist[i].name + '".');
    }

    done();
}
</script>
</head>
<body onload=onload_test()>
    <h1>Description</h1>
    <p>This test validates functionality of the interface window.performance.measure.</p>
    <div id="log"></div>
</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/user-timing/performance-measure-invalid.worker.js                     0000664 0000000 0000000 00000001126 14746647661 0027714 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        importScripts("/resources/testharness.js");

test(() => {
  assert_throws_js(TypeError, () => {
    performance.measure('name', 'navigationStart', 'navigationStart');
  });
}, "When converting 'navigationStart' to a timestamp, the global object has to be a Window object.");

test(() => {
  assert_throws_js(TypeError, () => {
    performance.mark('navigationStart');
    performance.measure('name', 'navigationStart', 'navigationStart');
  });
}, "When converting 'navigationStart' to a timestamp and a mark named 'navigationStart' exists, the global object has to be a Window object.");

done();
                                                                                                                                                                                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/user-timing/resources/                                                0000775 0000000 0000000 00000000000 14746647661 0022474 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/user-timing/resources/user-timing-helper.js                           0000664 0000000 0000000 00000003074 14746647661 0026556 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // Compares a list of performance entries to a predefined one.
// actualEntries is an array of performance entries from the user agent,
// and expectedEntries is an array of performance entries minted by the test.
// The comparison doesn't assert the order of the entries.
function checkEntries(actualEntries, expectedEntries) {
  assert_equals(actualEntries.length, expectedEntries.length,
      `The length of actual and expected entries should match.
      actual: ${JSON.stringify(actualEntries)},
      expected: ${JSON.stringify(expectedEntries)}`);
  const actualEntrySet = new Set(actualEntries.map(ae=>ae.name));
  assert_equals(actualEntrySet.size, actualEntries.length, `Actual entry names are not unique: ${JSON.stringify(actualEntries)}`);
  const expectedEntrySet = new Set(expectedEntries.map(ee=>ee.name));
  assert_equals(expectedEntrySet.size, expectedEntries.length, `Expected entry names are not unique: ${JSON.stringify(expectedEntries)}`);
  actualEntries.forEach(ae=>{
    const expectedEntry = expectedEntries.find(e=>e.name === ae.name);
    assert_true(!!expectedEntry, `Entry name '${ae.name}' was not found.`);
    checkEntry(ae, expectedEntry);
  });
}

function checkEntry(entry, {name, entryType, startTime, detail, duration}) {
  assert_equals(entry.name, name);
  assert_equals(entry.entryType, entryType);
  if (startTime !== undefined)
    assert_equals(entry.startTime, startTime);
  if (detail !== undefined)
    assert_equals(JSON.stringify(entry.detail), JSON.stringify(detail));
  if (duration !== undefined)
    assert_equals(entry.duration, duration);
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/user-timing/resources/webperftestharness.js                           0000664 0000000 0000000 00000010033 14746647661 0026745 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        //
// Helper functions for User Timing tests
//

var timingAttributes = [
    "navigationStart",
    "unloadEventStart",
    "unloadEventEnd",
    "redirectStart",
    "redirectEnd",
    "fetchStart",
    "domainLookupStart",
    "domainLookupEnd",
    "connectStart",
    "connectEnd",
    "secureConnectionStart",
    "requestStart",
    "responseStart",
    "responseEnd",
    "domLoading",
    "domInteractive",
    "domContentLoadedEventStart",
    "domContentLoadedEventEnd",
    "domComplete",
    "loadEventStart",
    "loadEventEnd"
];

function has_required_interfaces()
{
    if (window.performance.mark == undefined ||
        window.performance.clearMarks == undefined ||
        window.performance.measure == undefined ||
        window.performance.clearMeasures == undefined ||
        window.performance.getEntriesByName == undefined ||
        window.performance.getEntriesByType == undefined ||
        window.performance.getEntries == undefined) {
        return false;
    }

    return true;
}

function test_namespace(child_name, skip_root)
{
    if (skip_root === undefined) {
        var msg = 'window.performance is defined';
        wp_test(function () { assert_not_equals(performanceNamespace, undefined, msg); }, msg);
    }

    if (child_name !== undefined) {
        var msg2 = 'window.performance.' + child_name + ' is defined';
        wp_test(function() { assert_not_equals(performanceNamespace[child_name], undefined, msg2); }, msg2);
    }
}

function test_attribute_exists(parent_name, attribute_name, properties)
{
    var msg = 'window.performance.' + parent_name + '.' + attribute_name + ' is defined.';
    wp_test(function() { assert_not_equals(performanceNamespace[parent_name][attribute_name], undefined, msg); }, msg, properties);
}

function test_enum(parent_name, enum_name, value, properties)
{
    var msg = 'window.performance.' + parent_name + '.' + enum_name + ' is defined.';
    wp_test(function() { assert_not_equals(performanceNamespace[parent_name][enum_name], undefined, msg); }, msg, properties);

    msg = 'window.performance.' + parent_name + '.' + enum_name + ' = ' + value;
    wp_test(function() { assert_equals(performanceNamespace[parent_name][enum_name], value, msg); }, msg, properties);
}

function test_timing_order(attribute_name, greater_than_attribute, properties)
{
    // ensure it's not 0 first
    var msg = "window.performance.timing." + attribute_name + " > 0";
    wp_test(function() { assert_true(performanceNamespace.timing[attribute_name] > 0, msg); }, msg, properties);

    // ensure it's in the right order
    msg = "window.performance.timing." + attribute_name + " >= window.performance.timing." + greater_than_attribute;
    wp_test(function() { assert_true(performanceNamespace.timing[attribute_name] >= performanceNamespace.timing[greater_than_attribute], msg); }, msg, properties);
}

function test_timing_greater_than(attribute_name, greater_than, properties)
{
    var msg = "window.performance.timing." + attribute_name + " > " + greater_than;
    test_greater_than(performanceNamespace.timing[attribute_name], greater_than, msg, properties);
}

function test_timing_equals(attribute_name, equals, msg, properties)
{
    var test_msg = msg || "window.performance.timing." + attribute_name + " == " + equals;
    test_equals(performanceNamespace.timing[attribute_name], equals, test_msg, properties);
}

//
// Non-test related helper functions
//

function sleep_milliseconds(n)
{
    var start = new Date().getTime();
    while (true) {
        if ((new Date().getTime() - start) >= n) break;
    }
}

//
// Common helper functions
//

function test_greater_than(value, greater_than, msg, properties)
{
    wp_test(function () { assert_greater_than(value, greater_than, msg); }, msg, properties);
}

function test_greater_or_equals(value, greater_than, msg, properties)
{
    wp_test(function () { assert_greater_than_equal(value, greater_than, msg); }, msg, properties);
}

function test_not_equals(value, notequals, msg, properties)
{
    wp_test(function() { assert_not_equals(value, notequals, msg); }, msg, properties);
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/user-timing/resources/webperftestharnessextension.js                  0000664 0000000 0000000 00000014125 14746647661 0030710 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        //
// Helper functions for User Timing tests
//

var mark_names = [
    '',
    '1',
    'abc',
];

var measures = [
    [''],
    ['2', 1],
    ['aaa', 'navigationStart', ''],
];

function test_method_exists(method, method_name, properties)
{
    var msg;
    if (typeof method === 'function')
        msg = 'performance.' + method.name + ' is supported!';
    else
        msg = 'performance.' + method_name + ' is supported!';
    wp_test(function() { assert_equals(typeof method, 'function', msg); }, msg, properties);
}

function test_method_throw_exception(func_str, exception, msg)
{
    let exception_name;
    let test_func;
    if (typeof exception == "function") {
        exception_name = exception.name;
        test_func = assert_throws_js;
    } else {
        exception_name = exception;
        test_func = assert_throws_dom;
    }
    var msg = 'Invocation of ' + func_str + ' should throw ' + exception_name  + ' Exception.';
    wp_test(function() { test_func(exception, function() {eval(func_str)}, msg); }, msg);
}

function test_noless_than(value, greater_than, msg, properties)
{
    wp_test(function () { assert_true(value >= greater_than, msg); }, msg, properties);
}

function test_fail(msg, properties)
{
    wp_test(function() { assert_unreached(); }, msg, properties);
}

function test_resource_entries(entries, expected_entries)
{
    // This is slightly convoluted so that we can sort the output.
    var actual_entries = {};
    var origin = window.location.protocol + "//" + window.location.host;

    for (var i = 0; i < entries.length; ++i) {
        var entry = entries[i];
        var found = false;
        for (var expected_entry in expected_entries) {
            if (entry.name == origin + expected_entry) {
                found = true;
                if (expected_entry in actual_entries) {
                    test_fail(expected_entry + ' is not expected to have duplicate entries');
                }
                actual_entries[expected_entry] = entry;
                break;
            }
        }
        if (!found) {
            test_fail(entries[i].name + ' is not expected to be in the Resource Timing buffer');
        }
    }

    sorted_urls = [];
    for (var i in actual_entries) {
        sorted_urls.push(i);
    }
    sorted_urls.sort();
    for (var i in sorted_urls) {
        var url = sorted_urls[i];
        test_equals(actual_entries[url].initiatorType,
                    expected_entries[url],
                    origin + url + ' is expected to have initiatorType ' + expected_entries[url]);
    }
    for (var j in expected_entries) {
        if (!(j in actual_entries)) {
            test_fail(origin + j + ' is expected to be in the Resource Timing buffer');
        }
    }
}

function performance_entrylist_checker(type)
{
    const entryType = type;

    function entry_check(entry, expectedNames, testDescription = '')
    {
        const msg = testDescription + 'Entry \"' + entry.name + '\" should be one that we have set.';
        wp_test(function() { assert_in_array(entry.name, expectedNames, msg); }, msg);
        test_equals(entry.entryType, entryType, testDescription + 'entryType should be \"' + entryType + '\".');
        if (type === "measure") {
            test_true(isFinite(entry.startTime), testDescription + 'startTime should be a number.');
            test_true(isFinite(entry.duration), testDescription + 'duration should be a number.');
        } else if (type === "mark") {
            test_greater_than(entry.startTime, 0, testDescription + 'startTime should greater than 0.');
            test_equals(entry.duration, 0, testDescription + 'duration of mark should be 0.');
        }
    }

    function entrylist_order_check(entryList)
    {
        let inOrder = true;
        for (let i = 0; i < entryList.length - 1; ++i)
        {
            if (entryList[i + 1].startTime < entryList[i].startTime) {
                inOrder = false;
                break;
            }
        }
        return inOrder;
    }

    function entrylist_check(entryList, expectedLength, expectedNames, testDescription = '')
    {
        test_equals(entryList.length, expectedLength, testDescription + 'There should be ' + expectedLength + ' entries.');
        test_true(entrylist_order_check(entryList), testDescription + 'Entries in entrylist should be in order.');
        for (let i = 0; i < entryList.length; ++i)
        {
            entry_check(entryList[i], expectedNames, testDescription + 'Entry_list ' + i + '. ');
        }
    }

    return{"entrylist_check":entrylist_check};
}

function PerformanceContext(context)
{
    this.performanceContext = context;
}

PerformanceContext.prototype =
{

    initialMeasures: function(item, index, array)
    {
        this.performanceContext.measure.apply(this.performanceContext, item);
    },

    mark: function()
    {
        this.performanceContext.mark.apply(this.performanceContext, arguments);
    },

    measure: function()
    {
        this.performanceContext.measure.apply(this.performanceContext, arguments);
    },

    clearMarks: function()
    {
        this.performanceContext.clearMarks.apply(this.performanceContext, arguments);
    },

    clearMeasures: function()
    {
        this.performanceContext.clearMeasures.apply(this.performanceContext, arguments);

    },

    getEntries: function()
    {
        return this.performanceContext.getEntries.apply(this.performanceContext, arguments);
    },

    getEntriesByType: function()
    {
        return this.performanceContext.getEntriesByType.apply(this.performanceContext, arguments);
    },

    getEntriesByName: function()
    {
        return this.performanceContext.getEntriesByName.apply(this.performanceContext, arguments);
    },

    setResourceTimingBufferSize: function()
    {
        return this.performanceContext.setResourceTimingBufferSize.apply(this.performanceContext, arguments);
    },

    registerResourceTimingBufferFullCallback: function(func)
    {
        this.performanceContext.onresourcetimingbufferfull = func;
    },

    clearResourceTimings: function()
    {
        this.performanceContext.clearResourceTimings.apply(this.performanceContext, arguments);
    }

};
                                                                                                                                                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/user-timing/structured-serialize-detail.any.js                        0000664 0000000 0000000 00000005203 14746647661 0027237 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
  performance.clearMarks();
  const detail = { randomInfo: 123 }
  const markEntry = new PerformanceMark("A", { detail });
  assert_equals(markEntry.detail.randomInfo, detail.randomInfo);
  assert_not_equals(markEntry.detail, detail);
}, "The detail property in the mark constructor should be structured-clone.");

test(function() {
  performance.clearMarks();
  const detail = { randomInfo: 123 }
  const markEntry = performance.mark("A", { detail });
  assert_equals(markEntry.detail.randomInfo, detail.randomInfo);
  assert_not_equals(markEntry.detail, detail);
}, "The detail property in the mark method should be structured-clone.");

test(function() {
  performance.clearMarks();
  const markEntry = performance.mark("A");
  assert_equals(markEntry.detail, null);
}, "When accessing detail from a mark entry and the detail is not provided, just return a null value.");

test(function() {
  performance.clearMarks();
  const detail = { unserializable: Symbol() };
  assert_throws_dom("DataCloneError", ()=>{
    new PerformanceMark("A", { detail });
  }, "Trying to structured-serialize a Symbol.");
}, "Mark: Throw an exception when the detail property cannot be structured-serialized.");

test(function() {
  performance.clearMeasures();
  const detail = { randomInfo: 123 }
  const measureEntry = performance.measure("A", { start: 0, detail });
  assert_equals(measureEntry.detail.randomInfo, detail.randomInfo);
  assert_not_equals(measureEntry.detail, detail);
}, "The detail property in the measure method should be structured-clone.");

test(function() {
  performance.clearMeasures();
  const detail = { randomInfo: 123 }
  const measureEntry = performance.measure("A", { start: 0, detail });
  assert_equals(measureEntry.detail, measureEntry.detail);
}, "The detail property in the measure method should be the same reference.");

test(function() {
  performance.clearMeasures();
  const measureEntry = performance.measure("A");
  assert_equals(measureEntry.detail, null);
}, "When accessing detail from a measure entry and the detail is not provided, just return a null value.");

test(function() {
  performance.clearMeasures();
  const detail = { unserializable: Symbol() };
  assert_throws_dom("DataCloneError", ()=>{
    performance.measure("A", { start: 0, detail });
  }, "Trying to structured-serialize a Symbol.");
}, "Measure: Throw an exception when the detail property cannot be structured-serialized.");

test(function() {
  const bar = { 1: 2 };
  const detail = { foo: 1, bar };
  const mark = performance.mark("m", { detail });
  detail.foo = 2;
  assert_equals(mark.detail.foo, 1);
}, "The detail object is cloned when passed to mark API.");
                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/user-timing/supported-usertiming-types.any.js                         0000664 0000000 0000000 00000002512 14746647661 0027161 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(() => {
  if (typeof PerformanceObserver.supportedEntryTypes === "undefined")
    assert_unreached("supportedEntryTypes is not supported.");
  const types = PerformanceObserver.supportedEntryTypes;
  assert_true(types.includes("mark"),
    "There should be 'mark' in PerformanceObserver.supportedEntryTypes");
  assert_true(types.includes("measure"),
    "There should be 'measure' in PerformanceObserver.supportedEntryTypes");
  assert_greater_than(types.indexOf("measure"), types.indexOf('mark'),
    "The 'measure' entry should appear after the 'mark' entry");
}, "supportedEntryTypes contains 'mark' and 'measure'.");

if (typeof PerformanceObserver.supportedEntryTypes !== "undefined") {
  const entryTypes = {
    "mark": () => {
      performance.mark('foo');
    },
    "measure": () => {
      performance.measure('bar');
    }
  }
  for (let entryType in entryTypes) {
    if (PerformanceObserver.supportedEntryTypes.includes(entryType)) {
      promise_test(async() => {
        await new Promise((resolve) => {
          new PerformanceObserver(function (list, observer) {
            observer.disconnect();
            resolve();
          }).observe({entryTypes: [entryType]});

          // Force the PerformanceEntry.
          entryTypes[entryType]();
        })
      }, `'${entryType}' entries should be observable.`)
    }
  }
}
                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/user-timing/user-timing-tojson.html                                   0000664 0000000 0000000 00000002565 14746647661 0025135 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<html>
<head>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<script>
const keys = [
  'name',
  'entryType',
  'startTime',
  'duration',
];
test(() => {
  performance.mark('a');
  const markEntries = performance.getEntriesByType('mark');
  assert_equals(1, markEntries.length);
  const markEntry = markEntries[0];
  assert_equals(markEntry.entryType, 'mark');
  assert_equals(typeof(markEntry.toJSON), 'function');
  const markJSON = markEntry.toJSON();
  assert_equals(typeof(markJSON), 'object');
  for (const key of keys) {
    assert_equals(markJSON[key], markEntry[key], `PerformanceMark ${key} entry does not match its toJSON value`);
  }
}, 'Test toJSON() in PerformanceMark');

test(() => {
  performance.measure('m');
  const measureEntries = performance.getEntriesByType('measure');
  assert_equals(1, measureEntries.length);
  const measureEntry = measureEntries[0];
  assert_equals(measureEntry.entryType, 'measure');
  assert_equals(typeof(measureEntry.toJSON), 'function');
  const measureJSON = measureEntry.toJSON();
  assert_equals(typeof(measureJSON), 'object');
  for (const key of keys) {
    assert_equals(measureJSON[key], measureEntry[key], `PerformanceMeasure ${key} entry does not match its toJSON value`);
  }
}, 'Test toJSON() in PerformanceMeasure');
</script>
</body>
</html>
                                                                                                                                           node-23.7.0/test/fixtures/wpt/user-timing/user_timing_exists.any.js                                 0000664 0000000 0000000 00000000764 14746647661 0025541 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    assert_not_equals(self.performance.mark, undefined);
}, "self.performance.mark is defined.");
test(function() {
    assert_not_equals(self.performance.clearMarks, undefined);
}, "self.performance.clearMarks is defined.");
test(function() {
    assert_not_equals(self.performance.measure, undefined);
}, "self.performance.measure is defined.");
test(function() {
    assert_not_equals(self.performance.clearMeasures, undefined);
}, "self.performance.clearMeasures is defined.");
            node-23.7.0/test/fixtures/wpt/versions.json                                                         0000664 0000000 0000000 00000005675 14746647661 0020777 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        {
  "common": {
    "commit": "dbd648158d337580885e70a54f929daf215211a0",
    "path": "common"
  },
  "compression": {
    "commit": "da8d6860b22271d8ef4dc7894509692aaab9adf8",
    "path": "compression"
  },
  "console": {
    "commit": "e48251b77834f9689e9df3f49b93b3387dee72d6",
    "path": "console"
  },
  "dom/abort": {
    "commit": "0143fe244b3d622441717ce630e0114eb204f9a7",
    "path": "dom/abort"
  },
  "dom/events": {
    "commit": "0a811c51619b14f78fec60ba7dd1603795ca6a21",
    "path": "dom/events"
  },
  "encoding": {
    "commit": "1ac8deee082ecfb5d3b6f9c56cf9d1688a2fc218",
    "path": "encoding"
  },
  "fetch/data-urls/resources": {
    "commit": "7c79d998ff42e52de90290cb847d1b515b3b58f7",
    "path": "fetch/data-urls/resources"
  },
  "FileAPI": {
    "commit": "cceaf3628da950621004d9b5d8c1d1f367073347",
    "path": "FileAPI"
  },
  "hr-time": {
    "commit": "34cafd797e58dad280d20040eee012d49ccfa91f",
    "path": "hr-time"
  },
  "html/webappapis/atob": {
    "commit": "f267e1dca6f57a9f4d69f32a6920adfdb3268656",
    "path": "html/webappapis/atob"
  },
  "html/webappapis/microtask-queuing": {
    "commit": "2c5c3c4c27d27a419c1fdba3e9879c2d22037074",
    "path": "html/webappapis/microtask-queuing"
  },
  "html/webappapis/structured-clone": {
    "commit": "47d3fb280c9c632e684dee3b78ae1f4c5d5ba640",
    "path": "html/webappapis/structured-clone"
  },
  "html/webappapis/timers": {
    "commit": "5873f2d8f1f7bbb9c64689e52d04498614632906",
    "path": "html/webappapis/timers"
  },
  "interfaces": {
    "commit": "e90ece61d6e7ff84a0dc9c496588690e6a61cb17",
    "path": "interfaces"
  },
  "performance-timeline": {
    "commit": "94caab7038b27c16d605fa3547dacbee3a2fde4e",
    "path": "performance-timeline"
  },
  "resource-timing": {
    "commit": "22d38586d04c1d22b64db36f439c6bb84f03db7d",
    "path": "resource-timing"
  },
  "resources": {
    "commit": "1e140d63ec885703ce24b3798abd81912696bb85",
    "path": "resources"
  },
  "streams": {
    "commit": "bc9dcbbf1a4c2c741ef47f47d6ede6458f40c4a4",
    "path": "streams"
  },
  "url": {
    "commit": "6fa3fe8a929be45422cd46a8961e647e13d0cab8",
    "path": "url"
  },
  "user-timing": {
    "commit": "5ae85bf8267ac617833dc013dee9774c9e2a18b7",
    "path": "user-timing"
  },
  "wasm/jsapi": {
    "commit": "cde25e7e3c3b9d2280eb088a3fb9da988793d255",
    "path": "wasm/jsapi"
  },
  "wasm/webapi": {
    "commit": "fd1b23eeaaf9a01555d4fa29cf79ed11a4c44a50",
    "path": "wasm/webapi"
  },
  "WebCryptoAPI": {
    "commit": "3e3374efde7ce73d551ea908d52d0afab046971a",
    "path": "WebCryptoAPI"
  },
  "webidl/ecmascript-binding/es-exceptions": {
    "commit": "a370aad338d6ed743abb4d2c6ae84a7f1058558c",
    "path": "webidl/ecmascript-binding/es-exceptions"
  },
  "webmessaging/broadcastchannel": {
    "commit": "6495c91853a3cf028a401cf4d228fc0b6a5465e4",
    "path": "webmessaging/broadcastchannel"
  },
  "webstorage": {
    "commit": "9dafa892146c4b5b1f604a39b3cf8677f8f70d44",
    "path": "webstorage"
  }
}
                                                                   node-23.7.0/test/fixtures/wpt/wasm/                                                                 0000775 0000000 0000000 00000000000 14746647661 0017166 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/                                                           0000775 0000000 0000000 00000000000 14746647661 0020274 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/META.yml                                                   0000664 0000000 0000000 00000000061 14746647661 0021542 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        spec: https://webassembly.github.io/spec/js-api/
                                                                                                                                                                                                                                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/assertions.js                                              0000664 0000000 0000000 00000012036 14746647661 0023026 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function assert_function_name(fn, name, description) {
  const propdesc = Object.getOwnPropertyDescriptor(fn, "name");
  assert_equals(typeof propdesc, "object", `${description} should have name property`);
  assert_false(propdesc.writable, "writable", `${description} name should not be writable`);
  assert_false(propdesc.enumerable, "enumerable", `${description} name should not be enumerable`);
  assert_true(propdesc.configurable, "configurable", `${description} name should be configurable`);
  assert_equals(propdesc.value, name, `${description} name should be ${name}`);
}

function assert_function_length(fn, length, description) {
  const propdesc = Object.getOwnPropertyDescriptor(fn, "length");
  assert_equals(typeof propdesc, "object", `${description} should have length property`);
  assert_false(propdesc.writable, "writable", `${description} length should not be writable`);
  assert_false(propdesc.enumerable, "enumerable", `${description} length should not be enumerable`);
  assert_true(propdesc.configurable, "configurable", `${description} length should be configurable`);
  assert_equals(propdesc.value, length, `${description} length should be ${length}`);
}

function assert_exported_function(fn, { name, length }, description) {
  if (WebAssembly.Function === undefined) {
    assert_equals(Object.getPrototypeOf(fn), Function.prototype,
                  `${description}: prototype`);
  } else {
    assert_equals(Object.getPrototypeOf(fn), WebAssembly.Function.prototype,
                  `${description}: prototype`);
  }

  assert_function_name(fn, name, description);
  assert_function_length(fn, length, description);
}

function assert_Instance(instance, expected_exports) {
  assert_equals(Object.getPrototypeOf(instance), WebAssembly.Instance.prototype,
                "prototype");
  assert_true(Object.isExtensible(instance), "extensible");

  assert_equals(instance.exports, instance.exports, "exports should be idempotent");
  const exports = instance.exports;

  assert_equals(Object.getPrototypeOf(exports), null, "exports prototype");
  assert_false(Object.isExtensible(exports), "extensible exports");
  assert_array_equals(Object.keys(exports), Object.keys(expected_exports), "matching export keys");
  for (const [key, expected] of Object.entries(expected_exports)) {
    const property = Object.getOwnPropertyDescriptor(exports, key);
    assert_equals(typeof property, "object", `${key} should be present`);
    assert_false(property.writable, `${key}: writable`);
    assert_true(property.enumerable, `${key}: enumerable`);
    assert_false(property.configurable, `${key}: configurable`);
    const actual = property.value;
    assert_true(Object.isExtensible(actual), `${key}: extensible`);

    switch (expected.kind) {
    case "function":
      assert_exported_function(actual, expected, `value of ${key}`);
      break;
    case "global":
      assert_equals(Object.getPrototypeOf(actual), WebAssembly.Global.prototype,
                    `value of ${key}: prototype`);
      assert_equals(actual.value, expected.value, `value of ${key}: value`);
      assert_equals(actual.valueOf(), expected.value, `value of ${key}: valueOf()`);
      break;
    case "memory":
      assert_equals(Object.getPrototypeOf(actual), WebAssembly.Memory.prototype,
                    `value of ${key}: prototype`);
      assert_equals(Object.getPrototypeOf(actual.buffer), ArrayBuffer.prototype,
                    `value of ${key}: prototype of buffer`);
      assert_equals(actual.buffer.byteLength, 0x10000 * expected.size, `value of ${key}: size of buffer`);
      const array = new Uint8Array(actual.buffer);
      assert_equals(array[0], 0, `value of ${key}: first element of buffer`);
      assert_equals(array[array.byteLength - 1], 0, `value of ${key}: last element of buffer`);
      break;
    case "table":
      assert_equals(Object.getPrototypeOf(actual), WebAssembly.Table.prototype,
                    `value of ${key}: prototype`);
      assert_equals(actual.length, expected.length, `value of ${key}: length of table`);
      break;
    }
  }
}

function assert_WebAssemblyInstantiatedSource(actual, expected_exports={}) {
  assert_equals(Object.getPrototypeOf(actual), Object.prototype,
                "Prototype");
  assert_true(Object.isExtensible(actual), "Extensibility");

  const module = Object.getOwnPropertyDescriptor(actual, "module");
  assert_equals(typeof module, "object", "module: type of descriptor");
  assert_true(module.writable, "module: writable");
  assert_true(module.enumerable, "module: enumerable");
  assert_true(module.configurable, "module: configurable");
  assert_equals(Object.getPrototypeOf(module.value), WebAssembly.Module.prototype,
                "module: prototype");

  const instance = Object.getOwnPropertyDescriptor(actual, "instance");
  assert_equals(typeof instance, "object", "instance: type of descriptor");
  assert_true(instance.writable, "instance: writable");
  assert_true(instance.enumerable, "instance: enumerable");
  assert_true(instance.configurable, "instance: configurable");
  assert_Instance(instance.value, expected_exports);
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/jsapi/bad-imports.js                                             0000664 0000000 0000000 00000012362 14746647661 0023057 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        /**
 * `t` should be a function that takes at least three arguments:
 *
 * - the name of the test;
 * - the expected error (to be passed to `assert_throws_js`);
 * - a function that takes a `WasmModuleBuilder` and initializes it;
 * - (optionally) an options object.
 *
 * The function is expected to create a test that checks if instantiating a
 * module with the result of the `WasmModuleBuilder` and the options object
 * (if any) yields the correct error.
 */
function test_bad_imports(t) {
  function value_type(type) {
    switch (type) {
      case "i32": return kWasmI32;
      case "i64": return kWasmI64;
      case "f32": return kWasmF32;
      case "f64": return kWasmF64;
      default: throw new TypeError(`Unexpected type ${type}`);
    }
  }

  for (const value of [null, true, "", Symbol(), 1, 0.1, NaN]) {
    t(`Non-object imports argument: ${format_value(value)}`,
      TypeError,
      builder => {},
      value);
  }

  for (const value of [undefined, null, true, "", Symbol(), 1, 0.1, NaN]) {
    const imports = {
      "module": value,
    };
    t(`Non-object module: ${format_value(value)}`,
      TypeError,
      builder => {
        builder.addImport("module", "fn", kSig_v_v);
      },
      imports);
  }

  t(`Missing imports argument`,
    TypeError,
    builder => {
      builder.addImport("module", "fn", kSig_v_v);
    });

  for (const [value, name] of [[undefined, "undefined"], [{}, "empty object"], [{ "module\0": null }, "wrong property"]]) {
    t(`Imports argument with missing property: ${name}`,
      TypeError,
      builder => {
        builder.addImport("module", "fn", kSig_v_v);
      },
      value);
  }

  for (const value of [undefined, null, true, "", Symbol(), 1, 0.1, NaN, {}]) {
    t(`Importing a function with an incorrectly-typed value: ${format_value(value)}`,
      WebAssembly.LinkError,
      builder => {
        builder.addImport("module", "fn", kSig_v_v);
      },
      {
        "module": {
          "fn": value,
        },
      });
  }

  const nonGlobals = [
    [undefined],
    [null],
    [true],
    [""],
    [Symbol()],
    [{}, "plain object"],
    [WebAssembly.Global, "WebAssembly.Global"],
    [WebAssembly.Global.prototype, "WebAssembly.Global.prototype"],
    [Object.create(WebAssembly.Global.prototype), "Object.create(WebAssembly.Global.prototype)"],
  ];

  for (const type of ["i32", "i64", "f32", "f64"]) {
    const extendedNonGlobals = nonGlobals.concat([
      type === "i64" ? [0, "Number"] : [0n, "BigInt"],
      [new WebAssembly.Global({value: type === "f32" ? "f64" : "f32"}), "WebAssembly.Global object (wrong value type)"],
    ]);
    for (const [value, name = format_value(value)] of extendedNonGlobals) {
      t(`Importing an ${type} global with an incorrectly-typed value: ${name}`,
        WebAssembly.LinkError,
        builder => {
          builder.addImportedGlobal("module", "global", value_type(type));
        },
        {
          "module": {
            "global": value,
          },
        });
    }
  }

  for (const type of ["i32", "i64", "f32", "f64"]) {
    const value = type === "i64" ? 0n : 0;
    t(`Importing an ${type} mutable global with a primitive value`,
      WebAssembly.LinkError,
      builder => {
        builder.addImportedGlobal("module", "global", value_type(type), true);
      },
      {
        "module": {
          "global": value,
        },
      });

    const global = new WebAssembly.Global({ "value": type }, value);
    t(`Importing an ${type} mutable global with an immutable Global object`,
      WebAssembly.LinkError,
      builder => {
        builder.addImportedGlobal("module", "global", value_type(type), true);
      },
      {
        "module": {
          "global": global,
        },
      });
  }

  const nonMemories = [
    [undefined],
    [null],
    [true],
    [""],
    [Symbol()],
    [1],
    [0.1],
    [NaN],
    [{}, "plain object"],
    [WebAssembly.Memory, "WebAssembly.Memory"],
    [WebAssembly.Memory.prototype, "WebAssembly.Memory.prototype"],
    [Object.create(WebAssembly.Memory.prototype), "Object.create(WebAssembly.Memory.prototype)"],
    [new WebAssembly.Memory({"initial": 256}), "WebAssembly.Memory object (too large)"],
  ];

  for (const [value, name = format_value(value)] of nonMemories) {
    t(`Importing memory with an incorrectly-typed value: ${name}`,
      WebAssembly.LinkError,
      builder => {
        builder.addImportedMemory("module", "memory", 0, 128);
      },
      {
        "module": {
          "memory": value,
        },
      });
  }

  const nonTables = [
    [undefined],
    [null],
    [true],
    [""],
    [Symbol()],
    [1],
    [0.1],
    [NaN],
    [{}, "plain object"],
    [WebAssembly.Table, "WebAssembly.Table"],
    [WebAssembly.Table.prototype, "WebAssembly.Table.prototype"],
    [Object.create(WebAssembly.Table.prototype), "Object.create(WebAssembly.Table.prototype)"],
    [new WebAssembly.Table({"element": "anyfunc", "initial": 256}), "WebAssembly.Table object (too large)"],
  ];

  for (const [value, name = format_value(value)] of nonTables) {
    t(`Importing table with an incorrectly-typed value: ${name}`,
      WebAssembly.LinkError,
      builder => {
        builder.addImportedTable("module", "table", 0, 128);
      },
      {
        "module": {
          "table": value,
        },
      });
  }
}
                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/                                               0000775 0000000 0000000 00000000000 14746647661 0022661 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/compile.any.js                                 0000664 0000000 0000000 00000004434 14746647661 0025442 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

function assert_Module(module) {
  assert_equals(Object.getPrototypeOf(module), WebAssembly.Module.prototype,
                "Prototype");
  assert_true(Object.isExtensible(module), "Extensibility");
}

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

promise_test(t => {
  return promise_rejects_js(t, TypeError, WebAssembly.compile());
}, "Missing argument");

promise_test(t => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    ArrayBuffer,
    ArrayBuffer.prototype,
    Array.from(emptyModuleBinary),
  ];
  return Promise.all(invalidArguments.map(argument => {
    return promise_rejects_js(t, TypeError, WebAssembly.compile(argument),
                           `compile(${format_value(argument)})`);
  }));
}, "Invalid arguments");

promise_test(() => {
  const fn = WebAssembly.compile;
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly,
  ];
  return Promise.all(thisValues.map(thisValue => {
    return fn.call(thisValue, emptyModuleBinary).then(assert_Module);
  }));
}, "Branding");

test(() => {
  const promise = WebAssembly.compile(emptyModuleBinary);
  assert_equals(Object.getPrototypeOf(promise), Promise.prototype, "prototype");
  assert_true(Object.isExtensible(promise), "extensibility");
}, "Promise type");

promise_test(t => {
  const buffer = new Uint8Array();
  return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly.compile(buffer));
}, "Empty buffer");

promise_test(t => {
  const buffer = new Uint8Array(Array.from(emptyModuleBinary).concat([0, 0]));
  return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly.compile(buffer));
}, "Invalid code");

promise_test(() => {
  return WebAssembly.compile(emptyModuleBinary).then(assert_Module);
}, "Result type");

promise_test(() => {
  return WebAssembly.compile(emptyModuleBinary, {}).then(assert_Module);
}, "Stray argument");

promise_test(() => {
  const buffer = new WasmModuleBuilder().toBuffer();
  assert_equals(buffer[0], 0);
  const promise = WebAssembly.compile(buffer);
  buffer[0] = 1;
  return promise.then(assert_Module);
}, "Changing the buffer");
                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/instantiate-bad-imports.any.js                 0000664 0000000 0000000 00000001514 14746647661 0030550 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/bad-imports.js

test_bad_imports((name, error, build, ...arguments) => {
  promise_test(t => {
    const builder = new WasmModuleBuilder();
    build(builder);
    const buffer = builder.toBuffer();
    const module = new WebAssembly.Module(buffer);
    return promise_rejects_js(t, error, WebAssembly.instantiate(module, ...arguments));
  }, `WebAssembly.instantiate(module): ${name}`);
});

test_bad_imports((name, error, build, ...arguments) => {
  promise_test(t => {
    const builder = new WasmModuleBuilder();
    build(builder);
    const buffer = builder.toBuffer();
    return promise_rejects_js(t, error, WebAssembly.instantiate(buffer, ...arguments));
  }, `WebAssembly.instantiate(buffer): ${name}`);
});
                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/instantiate.any.js                             0000664 0000000 0000000 00000010151 14746647661 0026326 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/instanceTestFactory.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

promise_test(t => {
  return promise_rejects_js(t, TypeError, WebAssembly.instantiate());
}, "Missing arguments");

promise_test(() => {
  const fn = WebAssembly.instantiate;
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly,
  ];
  return Promise.all(thisValues.map(thisValue => {
    return fn.call(thisValue, emptyModuleBinary).then(assert_WebAssemblyInstantiatedSource);
  }));
}, "Branding");

promise_test(t => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
    ArrayBuffer,
    ArrayBuffer.prototype,
    Array.from(emptyModuleBinary),
  ];
  return Promise.all(invalidArguments.map(argument => {
    return promise_rejects_js(t, TypeError, WebAssembly.instantiate(argument),
                           `instantiate(${format_value(argument)})`);
  }));
}, "Invalid arguments");

test(() => {
  const promise = WebAssembly.instantiate(emptyModuleBinary);
  assert_equals(Object.getPrototypeOf(promise), Promise.prototype, "prototype");
  assert_true(Object.isExtensible(promise), "extensibility");
}, "Promise type");

for (const [name, fn] of instanceTestFactory) {
  promise_test(() => {
    const { buffer, args, exports, verify } = fn();
    return WebAssembly.instantiate(buffer, ...args).then(result => {
      assert_WebAssemblyInstantiatedSource(result, exports);
      verify(result.instance);
    });
  }, `${name}: BufferSource argument`);

  promise_test(() => {
    const { buffer, args, exports, verify } = fn();
    const module = new WebAssembly.Module(buffer);
    return WebAssembly.instantiate(module, ...args).then(instance => {
      assert_Instance(instance, exports);
      verify(instance);
    });
  }, `${name}: Module argument`);
}

promise_test(() => {
  const builder = new WasmModuleBuilder();
  builder.addImportedGlobal("module", "global", kWasmI32);
  const buffer = builder.toBuffer();
  const order = [];

  const imports = {
    get module() {
      order.push("module getter");
      return {
        get global() {
          order.push("global getter");
          return 0;
        },
      }
    },
  };

  const expected = [
    "module getter",
    "global getter",
  ];
  const p = WebAssembly.instantiate(buffer, imports);
  assert_array_equals(order, []);
  return p.then(result => {
    assert_WebAssemblyInstantiatedSource(result);
    assert_array_equals(order, expected);
  });
}, "Synchronous options handling: Buffer argument");

promise_test(() => {
  const builder = new WasmModuleBuilder();
  builder.addImportedGlobal("module", "global", kWasmI32);
  const buffer = builder.toBuffer();
  const module = new WebAssembly.Module(buffer);
  const order = [];

  const imports = {
    get module() {
      order.push("module getter");
      return {
        get global() {
          order.push("global getter");
          return 0;
        },
      }
    },
  };

  const expected = [
    "module getter",
    "global getter",
  ];
  const p = WebAssembly.instantiate(module, imports);
  assert_array_equals(order, expected);
  return p.then(instance => assert_Instance(instance, {}));
}, "Synchronous options handling: Module argument");

promise_test(t => {
  const buffer = new Uint8Array();
  return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly.instantiate(buffer));
}, "Empty buffer");

promise_test(t => {
  const buffer = new Uint8Array(Array.from(emptyModuleBinary).concat([0, 0]));
  return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly.instantiate(buffer));
}, "Invalid code");

promise_test(() => {
  const buffer = new WasmModuleBuilder().toBuffer();
  assert_equals(buffer[0], 0);
  const promise = WebAssembly.instantiate(buffer);
  buffer[0] = 1;
  return promise.then(assert_WebAssemblyInstantiatedSource);
}, "Changing the buffer");
                                                                                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/multi-value.any.js                             0000664 0000000 0000000 00000010104 14746647661 0026245 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/assertions.js

const type_if_fi = makeSig([kWasmF64, kWasmI32], [kWasmI32, kWasmF64]);

promise_test(async () => {
  const builder = new WasmModuleBuilder();

  builder
    .addFunction("swap", type_if_fi)
    .addBody([
        kExprLocalGet, 1,
        kExprLocalGet, 0,
        kExprReturn,
    ])
    .exportFunc();

  const buffer = builder.toBuffer();

  const result = await WebAssembly.instantiate(buffer);
  const swapped = result.instance.exports.swap(4.2, 7);
  assert_true(Array.isArray(swapped));
  assert_equals(Object.getPrototypeOf(swapped), Array.prototype);
  assert_array_equals(swapped, [7, 4.2]);
}, "multiple return values from wasm to js");

promise_test(async () => {
  const builder = new WasmModuleBuilder();

  const swap = builder
    .addFunction("swap", type_if_fi)
    .addBody([
        kExprLocalGet, 1,
        kExprLocalGet, 0,
        kExprReturn,
    ]);
  builder
    .addFunction("callswap", kSig_i_v)
    .addBody([
        ...wasmF64Const(4.2),
        ...wasmI32Const(7),
        kExprCallFunction, swap.index,
        kExprDrop,
        kExprReturn,
    ])
    .exportFunc();

  const buffer = builder.toBuffer();

  const result = await WebAssembly.instantiate(buffer);
  const swapped = result.instance.exports.callswap();
  assert_equals(swapped, 7);
}, "multiple return values inside wasm");

promise_test(async () => {
  const builder = new WasmModuleBuilder();

  const fnIndex = builder.addImport("module", "fn", type_if_fi);
  builder
    .addFunction("callfn", kSig_i_v)
    .addBody([
        ...wasmF64Const(4.2),
        ...wasmI32Const(7),
        kExprCallFunction, fnIndex,
        kExprDrop,
        kExprReturn,
    ])
    .exportFunc();

  const buffer = builder.toBuffer();

  const actual = [];
  const imports = {
    "module": {
      fn(f32, i32) {
        assert_equals(f32, 4.2);
        assert_equals(i32, 7);
        const result = [2, 7.3];
        let i = 0;
        return {
          get [Symbol.iterator]() {
            actual.push("@@iterator getter");
            return function iterator() {
              actual.push("@@iterator call");
              return {
                get next() {
                  actual.push("next getter");
                  return function next(...args) {
                    assert_array_equals(args, []);
                    let j = ++i;
                    actual.push(`next call ${j}`);
                    if (j > result.length) {
                      return {
                        get done() {
                          actual.push(`done call ${j}`);
                          return true;
                        }
                      };
                    }
                    return {
                      get done() {
                        actual.push(`done call ${j}`);
                        return false;
                      },
                      get value() {
                        actual.push(`value call ${j}`);
                        return {
                          get valueOf() {
                            actual.push(`valueOf get ${j}`);
                            return function() {
                              actual.push(`valueOf call ${j}`);
                              return result[j - 1];
                            };
                          }
                        };
                      }
                    };
                  };
                }
              };
            }
          },
        };
      },
    }
  };

  const { instance } = await WebAssembly.instantiate(buffer, imports);
  const result = instance.exports.callfn();
  assert_equals(result, 2);
  assert_array_equals(actual, [
    "@@iterator getter",
    "@@iterator call",
    "next getter",
    "next call 1",
    "done call 1",
    "value call 1",
    "next call 2",
    "done call 2",
    "value call 2",
    "next call 3",
    "done call 3",
    "valueOf get 1",
    "valueOf call 1",
    "valueOf get 2",
    "valueOf call 2",
  ]);
}, "multiple return values from js to wasm");
                                                                                                                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/toStringTag.any.js                             0000664 0000000 0000000 00000003625 14746647661 0026260 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

"use strict";
// https://webidl.spec.whatwg.org/#es-namespaces
// https://webassembly.github.io/spec/js-api/#namespacedef-webassembly

test(() => {
  assert_own_property(WebAssembly, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(WebAssembly, Symbol.toStringTag);
  assert_equals(propDesc.value, "WebAssembly", "value");
  assert_equals(propDesc.writable, false, "writable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.configurable, true, "configurable");
}, "@@toStringTag exists on the namespace object with the appropriate descriptor");

test(() => {
  assert_equals(WebAssembly.toString(), "[object WebAssembly]");
  assert_equals(Object.prototype.toString.call(WebAssembly), "[object WebAssembly]");
}, "Object.prototype.toString applied to the namespace object");

test(t => {
  assert_own_property(WebAssembly, Symbol.toStringTag, "Precondition: @@toStringTag on the namespace object");
  t.add_cleanup(() => {
    Object.defineProperty(WebAssembly, Symbol.toStringTag, { value: "WebAssembly" });
  });

  Object.defineProperty(WebAssembly, Symbol.toStringTag, { value: "Test" });
  assert_equals(WebAssembly.toString(), "[object Test]");
  assert_equals(Object.prototype.toString.call(WebAssembly), "[object Test]");
}, "Object.prototype.toString applied after modifying the namespace object's @@toStringTag");

test(t => {
  assert_own_property(WebAssembly, Symbol.toStringTag, "Precondition: @@toStringTag on the namespace object");
  t.add_cleanup(() => {
    Object.defineProperty(WebAssembly, Symbol.toStringTag, { value: "WebAssembly" });
  });

  assert_true(delete WebAssembly[Symbol.toStringTag]);
  assert_equals(WebAssembly.toString(), "[object Object]");
  assert_equals(Object.prototype.toString.call(WebAssembly), "[object Object]");
}, "Object.prototype.toString applied after deleting @@toStringTag");
                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/jsapi/constructor/validate.any.js                                0000664 0000000 0000000 00000005032 14746647661 0025576 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  assert_throws_js(TypeError, () => WebAssembly.validate());
}, "Missing argument");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    ArrayBuffer,
    ArrayBuffer.prototype,
    Array.from(emptyModuleBinary),
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => WebAssembly.validate(argument),
                     `validate(${format_value(argument)})`);
  }
}, "Invalid arguments");

test(() => {
  const fn = WebAssembly.validate;
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly,
  ];
  for (const thisValue of thisValues) {
    assert_true(fn.call(thisValue, emptyModuleBinary), `this=${format_value(thisValue)}`);
  }
}, "Branding");

const modules = [
  // Incomplete header.
  [[], false],
  [[0x00], false],
  [[0x00, 0x61], false],
  [[0x00, 0x61, 0x73], false],
  [[0x00, 0x61, 0x73, 0x6d], false],
  [[0x00, 0x61, 0x73, 0x6d, 0x01], false],
  [[0x00, 0x61, 0x73, 0x6d, 0x01, 0x00], false],
  [[0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00], false],

  // Complete header.
  [[0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00], true],

  // Invalid version.
  [[0x00, 0x61, 0x73, 0x6d, 0x00, 0x00, 0x00, 0x00], false],
  [[0x00, 0x61, 0x73, 0x6d, 0x02, 0x00, 0x00, 0x00], false],

  // Nameless custom section.
  [[0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00], false],

  // Custom section with empty name.
  [[0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00], true],

  // Custom section with name "a".
  [[0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x61], true],
];
const bufferTypes = [
  Uint8Array,
  Int8Array,
  Uint16Array,
  Int16Array,
  Uint32Array,
  Int32Array,
];
for (const [module, expected] of modules) {
  const name = module.map(n => n.toString(16)).join(" ");
  for (const bufferType of bufferTypes) {
    if (module.length % bufferType.BYTES_PER_ELEMENT === 0) {
      test(() => {
        const bytes = new Uint8Array(module);
        const moduleBuffer = new bufferType(bytes.buffer);
        assert_equals(WebAssembly.validate(moduleBuffer), expected);
      }, `Validating module [${name}] in ${bufferType.name}`);
    }
  }
}

test(() => {
  assert_true(WebAssembly.validate(emptyModuleBinary, {}));
}, "Stray argument");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/jsapi/error-interfaces-no-symbol-tostringtag.js                  0000664 0000000 0000000 00000000625 14746647661 0030367 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=jsshell

test(() => {
  assert_not_own_property(WebAssembly.CompileError.prototype, Symbol.toStringTag);
}, "WebAssembly.CompileError");

test(() => {
  assert_not_own_property(WebAssembly.LinkError.prototype, Symbol.toStringTag);
}, "WebAssembly.LinkError");

test(() => {
  assert_not_own_property(WebAssembly.RuntimeError.prototype, Symbol.toStringTag);
}, "WebAssembly.RuntimeError");
                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/                                                 0000775 0000000 0000000 00000000000 14746647661 0022272 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/basic.tentative.any.js                           0000664 0000000 0000000 00000006561 14746647661 0026511 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

function assert_throws_wasm(fn, message) {
  try {
    fn();
    assert_not_reached(`expected to throw with ${message}`);
  } catch (e) {
    assert_true(e instanceof WebAssembly.Exception, `Error should be a WebAssembly.Exception with ${message}`);
  }
}

promise_test(async () => {
  const kWasmAnyRef = 0x6f;
  const kSig_v_r = makeSig([kWasmAnyRef], []);
  const builder = new WasmModuleBuilder();
  const tagIndex = builder.addTag(kSig_v_r);
  builder.addFunction("throw_param", kSig_v_r)
    .addBody([
      kExprLocalGet, 0,
      kExprThrow, tagIndex,
    ])
    .exportFunc();
  const buffer = builder.toBuffer();
  const {instance} = await WebAssembly.instantiate(buffer, {});
  const values = [
    undefined,
    null,
    true,
    false,
    "test",
    Symbol(),
    0,
    1,
    4.2,
    NaN,
    Infinity,
    {},
    () => {},
  ];
  for (const v of values) {
    assert_throws_wasm(() => instance.exports.throw_param(v), String(v));
  }
}, "Wasm function throws argument");

promise_test(async () => {
  const builder = new WasmModuleBuilder();
  const tagIndex = builder.addTag(kSig_v_a);
  builder.addFunction("throw_null", kSig_v_v)
    .addBody([
      kExprRefNull, kWasmAnyFunc,
      kExprThrow, tagIndex,
    ])
    .exportFunc();
  const buffer = builder.toBuffer();
  const {instance} = await WebAssembly.instantiate(buffer, {});
  assert_throws_wasm(() => instance.exports.throw_null());
}, "Wasm function throws null");

promise_test(async () => {
  const builder = new WasmModuleBuilder();
  const tagIndex = builder.addTag(kSig_v_i);
  builder.addFunction("throw_int", kSig_v_v)
    .addBody([
      ...wasmI32Const(7),
      kExprThrow, tagIndex,
    ])
    .exportFunc();
  const buffer = builder.toBuffer();
  const {instance} = await WebAssembly.instantiate(buffer, {});
  assert_throws_wasm(() => instance.exports.throw_int());
}, "Wasm function throws integer");

promise_test(async () => {
  const builder = new WasmModuleBuilder();
  const fnIndex = builder.addImport("module", "fn", kSig_v_v);
  const tagIndex= builder.addTag(kSig_v_r);
  builder.addFunction("catch_exception", kSig_r_v)
    .addBody([
      kExprTry, kWasmStmt,
        kExprCallFunction, fnIndex,
      kExprCatch, tagIndex,
        kExprReturn,
      kExprEnd,
      kExprRefNull, kWasmAnyRef,
    ])
    .exportFunc();

  const buffer = builder.toBuffer();

  const error = new Error();
  const fn = () => { throw error };
  const {instance} = await WebAssembly.instantiate(buffer, {
    module: { fn }
  });
  assert_throws_exactly(error, () => instance.exports.catch_exception());
}, "Imported JS function throws");

promise_test(async () => {
  const builder = new WasmModuleBuilder();
  const fnIndex = builder.addImport("module", "fn", kSig_v_v);
  builder.addFunction("catch_and_rethrow", kSig_r_v)
    .addBody([
      kExprTry, kWasmStmt,
        kExprCallFunction, fnIndex,
      kExprCatchAll,
        kExprRethrow, 0x00,
      kExprEnd,
      kExprRefNull, kWasmAnyRef,
    ])
    .exportFunc();

  const buffer = builder.toBuffer();

  const error = new Error();
  const fn = () => { throw error };
  const {instance} = await WebAssembly.instantiate(buffer, {
    module: { fn }
  });
  assert_throws_exactly(error, () => instance.exports.catch_and_rethrow());
}, "Imported JS function throws, Wasm catches and rethrows");
                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/constructor.tentative.any.js                     0000664 0000000 0000000 00000002536 14746647661 0030013 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

test(() => {
  assert_function_name(
    WebAssembly.Exception,
    "Exception",
    "WebAssembly.Exception"
  );
}, "name");

test(() => {
  assert_function_length(WebAssembly.Exception, 1, "WebAssembly.Exception");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Exception());
}, "No arguments");

test(() => {
  const tag = new WebAssembly.Tag({ parameters: [] });
  assert_throws_js(TypeError, () => WebAssembly.Exception(tag));
}, "Calling");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    false,
    true,
    "",
    "test",
    Symbol(),
    1,
    NaN,
    {},
  ];
  for (const invalidArgument of invalidArguments) {
    assert_throws_js(
      TypeError,
      () => new WebAssembly.Exception(invalidArgument),
      `new Exception(${format_value(invalidArgument)})`
    );
  }
}, "Invalid descriptor argument");

test(() => {
  const typesAndArgs = [
    ["i32", 123n],
    ["i32", Symbol()],
    ["f32", 123n],
    ["f64", 123n],
    ["i64", undefined],
  ];
  for (const typeAndArg of typesAndArgs) {
    const tag = new WebAssembly.Tag({ parameters: [typeAndArg[0]] });
    assert_throws_js(
      TypeError,
      () => new WebAssembly.Exception(tag, typeAndArg[1])
    );
  }
}, "Invalid exception argument");
                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/getArg.tentative.any.js                          0000664 0000000 0000000 00000003005 14746647661 0026627 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/memory/assertions.js

test(() => {
  const tag = new WebAssembly.Tag({ parameters: [] });
  const exn = new WebAssembly.Exception(tag, []);
  assert_throws_js(TypeError, () => exn.getArg());
  assert_throws_js(TypeError, () => exn.getArg(tag));
}, "Missing arguments");

test(() => {
  const invalidValues = [undefined, null, true, "", Symbol(), 1, {}];
  const tag = new WebAssembly.Tag({ parameters: [] });
  const exn = new WebAssembly.Exception(tag, []);
  for (argument of invalidValues) {
    assert_throws_js(TypeError, () => exn.getArg(argument, 0));
  }
}, "Invalid exception argument");

test(() => {
  const tag = new WebAssembly.Tag({ parameters: [] });
  const exn = new WebAssembly.Exception(tag, []);
  assert_throws_js(RangeError, () => exn.getArg(tag, 1));
}, "Index out of bounds");

test(() => {
  const outOfRangeValues = [
    undefined,
    NaN,
    Infinity,
    -Infinity,
    -1,
    0x100000000,
    0x1000000000,
    "0x100000000",
    {
      valueOf() {
        return 0x100000000;
      },
    },
  ];

  const tag = new WebAssembly.Tag({ parameters: [] });
  const exn = new WebAssembly.Exception(tag, []);
  for (const value of outOfRangeValues) {
    assert_throws_js(RangeError, () => exn.getArg(tag, value));
  }
}, "Getting out-of-range argument");

test(() => {
  const tag = new WebAssembly.Tag({ parameters: ["i32"] });
  const exn = new WebAssembly.Exception(tag, [42]);
  assert_equals(exn.getArg(tag, 0), 42);
}, "getArg");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/identity.tentative.any.js                        0000664 0000000 0000000 00000003244 14746647661 0027254 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/wasm-module-builder.js

test(() => {
  const tag = new WebAssembly.Tag({ parameters: ["i32"] });
  const exn = new WebAssembly.Exception(tag, [42]);
  const exn_same_payload = new WebAssembly.Exception(tag, [42]);
  const exn_diff_payload = new WebAssembly.Exception(tag, [53]);

  const builder = new WasmModuleBuilder();
  const jsfuncIndex = builder.addImport("module", "jsfunc", kSig_v_v);
  const tagIndex = builder.addImportedTag("module", "tag", kSig_v_i);
  const imports = {
    module: {
      jsfunc: function() { throw exn; },
      tag: tag
    }
  };

  builder
    .addFunction("catch_rethrow", kSig_v_v)
    .addBody([
      kExprTry, kWasmStmt,
        kExprCallFunction, jsfuncIndex,
      kExprCatch, tagIndex,
        kExprDrop,
        kExprRethrow, 0x00,
      kExprEnd
    ])
    .exportFunc();

  builder
    .addFunction("catch_all_rethrow", kSig_v_v)
    .addBody([
      kExprTry, kWasmStmt,
        kExprCallFunction, jsfuncIndex,
      kExprCatchAll,
        kExprRethrow, 0x00,
      kExprEnd
    ])
    .exportFunc();

  const buffer = builder.toBuffer();
  WebAssembly.instantiate(buffer, imports).then(result => {
    try {
      result.instance.exports.catch_rethrow();
    } catch (e) {
      assert_equals(e, exn);
      assert_not_equals(e, exn_same_payload);
      assert_not_equals(e, exn_diff_payload);
    }
    try {
      result.instance.exports.catch_all_rethrow();
    } catch (e) {
      assert_equals(e, exn);
      assert_not_equals(e, exn_same_payload);
      assert_not_equals(e, exn_diff_payload);
    }
  });
}, "Identity check");
                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/is.tentative.any.js                              0000664 0000000 0000000 00000001541 14746647661 0026034 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/memory/assertions.js

test(() => {
  const tag = new WebAssembly.Tag({ parameters: [] });
  const exn = new WebAssembly.Exception(tag, []);
  assert_throws_js(TypeError, () => exn.is());
}, "Missing arguments");

test(() => {
  const invalidValues = [undefined, null, true, "", Symbol(), 1, {}];
  const tag = new WebAssembly.Tag({ parameters: [] });
  const exn = new WebAssembly.Exception(tag, []);
  for (argument of invalidValues) {
    assert_throws_js(TypeError, () => exn.is(argument));
  }
}, "Invalid exception argument");

test(() => {
  const tag1 = new WebAssembly.Tag({ parameters: ["i32"] });
  const tag2 = new WebAssembly.Tag({ parameters: ["i32"] });
  const exn = new WebAssembly.Exception(tag1, [42]);
  assert_true(exn.is(tag1));
  assert_false(exn.is(tag2));
}, "is");
                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/exception/toString.tentative.any.js                        0000664 0000000 0000000 00000001471 14746647661 0027234 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const argument = { parameters: [] };
  const tag = new WebAssembly.Tag(argument);
  const exn = new WebAssembly.Exception(tag, []);
  assert_class_string(exn, "WebAssembly.Exception");
}, "Object.prototype.toString on an Exception");

test(() => {
  assert_own_property(WebAssembly.Exception.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(
    WebAssembly.Exception.prototype,
    Symbol.toStringTag
  );
  assert_equals(propDesc.value, "WebAssembly.Exception", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/jsapi/function/                                                  0000775 0000000 0000000 00000000000 14746647661 0022121 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/function/call.tentative.any.js                             0000664 0000000 0000000 00000000762 14746647661 0026167 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function addxy(x, y) {
    return x + y
}

test(() => {
    var fun = new WebAssembly.Function({parameters: ["i32", "i32"], results: ["i32"]}, addxy);
    assert_equals(fun(1, 2), 3)
}, "test calling function")

test(() => {
    var fun = new WebAssembly.Function({parameters: ["i32", "i32"], results: ["i32"]}, addxy);
    assert_throws_js(TypeError, () => new fun(1, 2));
}, "test constructing function");
              node-23.7.0/test/fixtures/wpt/wasm/jsapi/function/constructor.tentative.any.js                      0000664 0000000 0000000 00000005461 14746647661 0027642 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function addxy(x, y) {
    return x + y
}

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_function_name(WebAssembly.Function, "Function", "WebAssembly.Function");
}, "name");

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_function_length(WebAssembly.Function, 2, "WebAssembly.Function");
}, "length");

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function());
    const argument = {parameters: [], results: []};
    assert_throws_js(TypeError, () => new WebAssembly.Function(argument));
}, "Too few arguments");

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    const arguments = [{parameters: ["i32", "i32"], results: ["i32"]}, addxy];
    assert_throws_js(TypeError, () => WebAssembly.Function(...arguments));
}, "Calling");

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    var fun = new WebAssembly.Function({parameters: ["i32", "i32"], results: ["i32"]}, addxy);
    assert_true(fun instanceof WebAssembly.Function)
}, "construct with JS function")

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function({parameters: []}, addxy))
}, "fail with missing results")

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function({results: []}, addxy))
}, "fail with missing parameters")

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function({parameters: [1], results: [true]}, addxy))
}, "fail with non-string parameters & results")

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function({parameters: ["invalid"], results: ["invalid"]}, addxy))
}, "fail with non-existent parameter and result type")

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function({parameters: [], results: []}, 72))
}, "fail with non-function object")

test(() => {
    assert_implements(WebAssembly.Function, "WebAssembly.Function is not implemented");
    assert_throws_js(TypeError, () => new WebAssembly.Function({parameters: [], results: []}, {}))
}, "fail to construct with non-callable object")
                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/function/table.tentative.any.js                            0000664 0000000 0000000 00000002167 14746647661 0026344 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function testfunc(n) {}

test(() => {
    var table = new WebAssembly.Table({element: "anyfunc", initial: 3})
    var func1 = new WebAssembly.Function({parameters: ["i32"], results: []}, testfunc)
    table.set(0, func1)
    var func2 = new WebAssembly.Function({parameters: ["f32"], results: []}, testfunc)
    table.set(1, func2)
    var func3 = new WebAssembly.Function({parameters: ["i64"], results: []}, testfunc)
    table.set(2, func3)

    var first = table.get(0)
    assert_true(first instanceof WebAssembly.Function)
    assert_equals(first, func1)
    assert_equals(first.type().parameters[0], func1.type().parameters[0])

    var second = table.get(1)
    assert_true(second instanceof WebAssembly.Function)
    assert_equals(second, func2)
    assert_equals(second.type().parameters[0], func2.type().parameters[0])

    var third = table.get(2)
    assert_true(third instanceof WebAssembly.Function)
    assert_equals(third, func3)
    assert_equals(third.type().parameters[0], func3.type().parameters[0])

}, "Test insertion into table")
                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/jsapi/function/type.tentative.any.js                             0000664 0000000 0000000 00000001663 14746647661 0026236 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function addNumbers(x, y, z) {
    return x+y+z;
}

function doNothing() {}

function assert_function(functype, func) {
    var wasmFunc = new WebAssembly.Function(functype, func);
    assert_equals(functype.parameters.length, wasmFunc.type().parameters.length);
    for(let i = 0; i < functype.parameters.length; i++) {
        assert_equals(functype.parameters[i], wasmFunc.type().parameters[i]);
    }
    assert_equals(functype.results.length, wasmFunc.type().results.length);
    for(let i = 0; i < functype.results.length; i++) {
        assert_equals(functype.results[i], wasmFunc.type().results[i]);
    }
}

test(() => {
    assert_function({results: [], parameters: []}, doNothing);
}, "Check empty results and parameters")

test(() => {
    assert_function({results: ["f64"], parameters: ["i32", "i64", "f32"]}, addNumbers)
}, "Check all types")
                                                                             node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/                                                 0000775 0000000 0000000 00000000000 14746647661 0022304 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/entry-different-function-realm.html              0000664 0000000 0000000 00000003223 14746647661 0031220 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Entry settings object for host functions when the function realm is different from the test realm</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/wasm/jsapi/wasm-module-builder.js"></script>
<script src="/wasm/jsapi/functions/helper.js"></script>

<!-- This is what would normally be considered the entry page. However, we use functions from the
     resources/function/function.html realm. So window.open() should resolve relative to that realm
     inside host functions. -->

<iframe src="resources/entry-incumbent.html"></iframe>
<iframe src="resources/function/function.html" id="function-frame"></iframe>

<script>
setup({ explicit_done: true });

const relativeURL = "resources/window-to-open.html";
const expectedURL = (new URL(relativeURL, document.querySelector("#function-frame").src)).href;

const incumbentWindow = frames[0];
const functionWindow = frames[1];
const FunctionFromAnotherWindow = functionWindow.Function;

window.onload = () => {
  async_test(t => {
    t.add_cleanup(() => { delete functionWindow.args; });
    functionWindow.args = [incumbentWindow, relativeURL, t, assert_equals, expectedURL];

    const func = FunctionFromAnotherWindow(`
      const [incumbentWindow, relativeURL, t, assert_equals, expectedURL] = window.args;

      const w = incumbentWindow.runWindowOpenVeryIndirectly(relativeURL);
      w.onload = t.step_func_done(() => {
        t.add_cleanup(() => w.close());
        assert_equals(w.location.href, expectedURL);
      });
    `);
    call_later(func);
  }, "Start function");

  done();
};
</script>
                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/entry.html                                       0000664 0000000 0000000 00000002536 14746647661 0024341 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Entry settings object for host functions</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/wasm/jsapi/wasm-module-builder.js"></script>
<script src="/wasm/jsapi/functions/helper.js"></script>

<!-- This is the entry page, so window.open() should resolve relative to it, even inside host functions. -->

<iframe src="resources/entry-incumbent.html"></iframe>

<script>
setup({ explicit_done: true });

const relativeURL = "resources/window-to-open.html";
const expectedURL = (new URL(relativeURL, location.href)).href;

const incumbentWindow = frames[0];

window.onload = () => {
  async_test(t => {
    const w = incumbentWindow.runWindowOpenVeryIndirectly(relativeURL);
    w.onload = t.step_func_done(() => {
      t.add_cleanup(() => w.close());
      assert_equals(w.location.href, expectedURL);
    });
  }, "Sanity check: this all works as expected synchronously");

  async_test(t => {
    // No t.step_func because that could change the realms
    call_later(() => {
      const w = incumbentWindow.runWindowOpenVeryIndirectly(relativeURL);
      w.onload = t.step_func_done(() => {
        t.add_cleanup(() => w.close());
        assert_equals(w.location.href, expectedURL);
      });
    });
  }, "Start function");

  done();
};
</script>
                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/helper.js                                        0000664 0000000 0000000 00000000457 14746647661 0024127 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function call_later(f) {
  const builder = new WasmModuleBuilder();
  const functionIndex = builder.addImport("module", "imported", kSig_v_v);
  builder.addStart(functionIndex);
  const buffer = builder.toBuffer();

  WebAssembly.instantiate(buffer, {
    "module": {
      "imported": f,
    }
  });
}
                                                                                                                                                                                                                 node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/incumbent.html                                   0000664 0000000 0000000 00000002635 14746647661 0025164 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Incumbent settings object for host functions</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>

<!-- This is the entry page. -->

<iframe src="resources/incumbent-incumbent.html"></iframe>

<script>
setup({ explicit_done: true });

// postMessage should pick the incumbent page as its .source value to set on the MessageEvent, even
// inside host functions.
const expectedURL = (new URL("resources/incumbent-incumbent.html", location.href)).href;

let testId = 0;

window.onload = () => {
  const relevantWindow = frames[0].document.querySelector("#r").contentWindow;

  function setupTest(t) {
    ++testId;
    const thisTestId = testId;

    relevantWindow.addEventListener("messagereceived", t.step_func(e => {
      const [receivedTestId, receivedSourceURL] = e.detail;

      if (receivedTestId !== thisTestId) {
        return;
      }

      assert_equals(receivedSourceURL, expectedURL);
      t.done();
    }));

    return thisTestId;
  }

  async_test(t => {
    const thisTestId = setupTest(t);

    frames[0].runWindowPostMessageVeryIndirectly(thisTestId, "*");
  }, "Sanity check: this all works as expected synchronously");

  async_test(t => {
    const thisTestId = setupTest(t);
    frames[0].runWindowPostMessageVeryIndirectlyWithNoUserCode(thisTestId, "*");
  }, "Start function");

  done();
};
</script>
                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/                                       0000775 0000000 0000000 00000000000 14746647661 0024316 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/README.md                              0000664 0000000 0000000 00000000747 14746647661 0025605 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        A couple notes about the files scattered in this `resources/` directory:

* The nested directory structure is necessary here so that relative URL resolution can be tested; we need different sub-paths for each document.

* The semi-duplicate `window-to-open.html`s scattered throughout are present because Firefox, at least, does not fire `Window` `load` events for 404s, so we want to ensure that no matter which global is used, `window`'s `load` event is hit and our tests can proceed.
                         node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/current/                               0000775 0000000 0000000 00000000000 14746647661 0026000 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/current/current.html                   0000664 0000000 0000000 00000000132 14746647661 0030344 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Current page used as a test helper</title>

                                                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/current/resources/                     0000775 0000000 0000000 00000000000 14746647661 0030012 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/current/resources/window-to-open.html  0000664 0000000 0000000 00000000166 14746647661 0033571 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>If the current settings object is used this page will be opened</title>
                                                                                                                                                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/entry-incumbent.html                   0000664 0000000 0000000 00000000672 14746647661 0030334 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Incumbent page used as a test helper</title>

<iframe src="relevant/relevant.html" id="r"></iframe>
<iframe src="current/current.html" id="c"></iframe>

<script>
const relevant = document.querySelector("#r");
const current = document.querySelector("#c");

window.runWindowOpenVeryIndirectly = (...args) => {
  return current.contentWindow.open.call(relevant.contentWindow, ...args);
};
</script>
                                                                      node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/function/                              0000775 0000000 0000000 00000000000 14746647661 0026143 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/function/function.html                 0000664 0000000 0000000 00000000146 14746647661 0030657 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Realm for a host function used as a test helper</title>
                                                                                                                                                                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/function/resources/                    0000775 0000000 0000000 00000000000 14746647661 0030155 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/function/resources/window-to-open.html 0000664 0000000 0000000 00000000171 14746647661 0033730 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>If the function's settings object is used this page will be opened</title>
                                                                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/incumbent-incumbent.html               0000664 0000000 0000000 00000001604 14746647661 0031153 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Incumbent page used as a test helper</title>

<script src="/wasm/jsapi/wasm-module-builder.js"></script>
<script src="/wasm/jsapi/functions/helper.js"></script>

<iframe src="relevant/relevant.html" id="r"></iframe>
<iframe src="current/current.html" id="c"></iframe>

<script>
const relevant = document.querySelector("#r");
const current = document.querySelector("#c");

window.runWindowPostMessageVeryIndirectly = (...args) => {
  return current.contentWindow.postMessage.call(relevant.contentWindow, ...args);
};

// This tests the backup incumbent settings object stack scenario, by avoiding putting user code on the stack.
window.runWindowPostMessageVeryIndirectlyWithNoUserCode = (...args) => {
  const runWindowPostMessage = current.contentWindow.postMessage.bind(relevant.contentWindow, ...args);
  call_later(runWindowPostMessage);
};
</script>
                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/relevant/                              0000775 0000000 0000000 00000000000 14746647661 0026136 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/relevant/relevant.html                 0000664 0000000 0000000 00000000614 14746647661 0030645 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>Relevant page used as a test helper</title>

<script>
// incumbent.html will end up posting a message to here. We need to signal back the "source".

window.onmessage = e => {
  const testId = e.data;
  const sourceURL = e.source.document.URL;

  window.dispatchEvent(new CustomEvent("messagereceived", { detail: [testId, sourceURL] }));
};
</script>
                                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/relevant/resources/                    0000775 0000000 0000000 00000000000 14746647661 0030150 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/relevant/resources/window-to-open.html 0000664 0000000 0000000 00000000167 14746647661 0033730 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>If the relevant settings object is used this page will be opened</title>
                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/resources/                             0000775 0000000 0000000 00000000000 14746647661 0026330 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/resources/window-to-open.html          0000664 0000000 0000000 00000000170 14746647661 0032102 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>If the incumbent settings object is used this page will be opened</title>
                                                                                                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/functions/resources/window-to-open.html                    0000664 0000000 0000000 00000000164 14746647661 0030073 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>If the entry settings object is used this page will be opened</title>
                                                                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/jsapi/global/                                                    0000775 0000000 0000000 00000000000 14746647661 0021534 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/global/constructor.any.js                                  0000664 0000000 0000000 00000011273 14746647661 0025251 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function assert_Global(actual, expected) {
  assert_equals(Object.getPrototypeOf(actual), WebAssembly.Global.prototype,
                "prototype");
  assert_true(Object.isExtensible(actual), "extensible");

  assert_equals(actual.value, expected, "value");
  assert_equals(actual.valueOf(), expected, "valueOf");
}

test(() => {
  assert_function_name(WebAssembly.Global, "Global", "WebAssembly.Global");
}, "name");

test(() => {
  assert_function_length(WebAssembly.Global, 1, "WebAssembly.Global");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Global());
}, "No arguments");

test(() => {
  const argument = { "value": "i32" };
  assert_throws_js(TypeError, () => WebAssembly.Global(argument));
}, "Calling");

test(() => {
  const order = [];

  new WebAssembly.Global({
    get value() {
      order.push("descriptor value");
      return {
        toString() {
          order.push("descriptor value toString");
          return "f64";
        },
      };
    },

    get mutable() {
      order.push("descriptor mutable");
      return false;
    },
  }, {
    valueOf() {
      order.push("value valueOf()");
    }
  });

  assert_array_equals(order, [
    "descriptor mutable",
    "descriptor value",
    "descriptor value toString",
    "value valueOf()",
  ]);
}, "Order of evaluation");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    false,
    true,
    "",
    "test",
    Symbol(),
    1,
    NaN,
    {},
  ];
  for (const invalidArgument of invalidArguments) {
    assert_throws_js(TypeError,
                     () => new WebAssembly.Global(invalidArgument),
                     `new Global(${format_value(invalidArgument)})`);
  }
}, "Invalid descriptor argument");

test(() => {
  const invalidTypes = ["i16", "i128", "f16", "f128", "u32", "u64", "i32\0"];
  for (const value of invalidTypes) {
    const argument = { value };
    assert_throws_js(TypeError, () => new WebAssembly.Global(argument));
  }
}, "Invalid type argument");

test(() => {
  const argument = { "value": "v128" };
  assert_throws_js(TypeError, () => new WebAssembly.Global(argument));
}, "Construct v128 global");

test(() => {
  const argument = { "value": "i64" };
  const global = new WebAssembly.Global(argument);
  assert_Global(global, 0n);
}, "i64 with default");

for (const type of ["i32", "f32", "f64"]) {
  test(() => {
    const argument = { "value": type };
    const global = new WebAssembly.Global(argument);
    assert_Global(global, 0);
  }, `Default value for type ${type}`);

  const valueArguments = [
    [undefined, 0],
    [null, 0],
    [true, 1],
    [false, 0],
    [2, 2],
    ["3", 3],
    [{ toString() { return "5" } }, 5, "object with toString returning string"],
    [{ valueOf() { return "8" } }, 8, "object with valueOf returning string"],
    [{ toString() { return 6 } }, 6, "object with toString returning number"],
    [{ valueOf() { return 9 } }, 9, "object with valueOf returning number"],
  ];
  for (const [value, expected, name = format_value(value)] of valueArguments) {
    test(() => {
      const argument = { "value": type };
      const global = new WebAssembly.Global(argument, value);
      assert_Global(global, expected);
    }, `Explicit value ${name} for type ${type}`);
  }

  test(() => {
    const argument = { "value": type };
    assert_throws_js(TypeError, () => new WebAssembly.Global(argument, 0n));
  }, `BigInt value for type ${type}`);
}

const valueArguments = [
  [undefined, 0n],
  [true, 1n],
  [false, 0n],
  ["3", 3n],
  [123n, 123n],
  [{ toString() { return "5" } }, 5n, "object with toString returning string"],
  [{ valueOf() { return "8" } }, 8n, "object with valueOf returning string"],
  [{ toString() { return 6n } }, 6n, "object with toString returning bigint"],
  [{ valueOf() { return 9n } }, 9n, "object with valueOf returning bigint"],
];
for (const [value, expected, name = format_value(value)] of valueArguments) {
  test(() => {
    const argument = { "value": "i64" };
    const global = new WebAssembly.Global(argument, value);
    assert_Global(global, expected);
  }, `Explicit value ${name} for type i64`);
}

const invalidBigints = [
  null,
  666,
  { toString() { return 5 } },
  { valueOf() { return 8 } },
  Symbol(),
];
for (const invalidBigint of invalidBigints) {
  test(() => {
    var argument = { "value": "i64" };
    assert_throws_js(TypeError, () => new WebAssembly.Global(argument, invalidBigint));
  }, `Pass non-bigint as i64 Global value: ${format_value(invalidBigint)}`);
}

test(() => {
  const argument = { "value": "i32" };
  const global = new WebAssembly.Global(argument, 0, {});
  assert_Global(global, 0);
}, "Stray argument");
                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/jsapi/global/toString.any.js                                     0000664 0000000 0000000 00000001365 14746647661 0024476 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const argument = { "value": "i32" };
  const global = new WebAssembly.Global(argument);
  assert_class_string(global, "WebAssembly.Global");
}, "Object.prototype.toString on an Global");

test(() => {
  assert_own_property(WebAssembly.Global.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(WebAssembly.Global.prototype, Symbol.toStringTag);
  assert_equals(propDesc.value, "WebAssembly.Global", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/jsapi/global/type.tentative.any.js                               0000664 0000000 0000000 00000003244 14746647661 0025646 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function assert_type(argument) {
    const myglobal = new WebAssembly.Global(argument);
    const globaltype = myglobal.type();

    assert_equals(globaltype.value, argument.value);
    assert_equals(globaltype.mutable, argument.mutable);
}

test(() => {
    assert_type({ "value": "i32", "mutable": true});
}, "i32, mutable");

test(() => {
    assert_type({ "value": "i32", "mutable": false});
}, "i32, immutable");

test(() => {
    assert_type({ "value": "i64", "mutable": true});
}, "i64, mutable");

test(() => {
    assert_type({ "value": "i64", "mutable": false});
}, "i64, immutable");

test(() => {
    assert_type({ "value": "f32", "mutable": true});
}, "f32, mutable");

test(() => {
    assert_type({ "value": "f32", "mutable": false});
}, "f32, immutable");

test(() => {
    assert_type({ "value": "f64", "mutable": true});
}, "f64, mutable");

test(() => {
    assert_type({ "value": "f64", "mutable": false});
}, "f64, immutable");

test(() => {
    assert_type({"value": "externref", "mutable": true})
}, "externref, mutable")

test(() => {
    assert_type({"value": "externref", "mutable": false})
}, "externref, immutable")

test(() => {
    assert_type({"value": "funcref", "mutable": true})
}, "funcref, mutable")

test(() => {
    assert_type({"value": "funcref", "mutable": false})
}, "funcref, immutable")

test(() => {
    const myglobal = new WebAssembly.Global({"value": "i32", "mutable": true});
    const propertyNames = Object.getOwnPropertyNames(myglobal.type());
    assert_equals(propertyNames[0], "mutable");
    assert_equals(propertyNames[1], "value");
}, "key ordering");
                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/jsapi/global/value-get-set.any.js                                0000664 0000000 0000000 00000011061 14746647661 0025341 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Global,
    WebAssembly.Global.prototype,
  ];

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Global.prototype, "value");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  const setter = desc.set;
  assert_equals(typeof setter, "function");

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => getter.call(thisValue), `getter with this=${format_value(thisValue)}`);
    assert_throws_js(TypeError, () => setter.call(thisValue, 1), `setter with this=${format_value(thisValue)}`);
  }
}, "Branding");

for (const type of ["i32", "i64", "f32", "f64"]) {
  const [initial, value, invalid] = type === "i64" ? [0n, 1n, 2] : [0, 1, 2n];
  const immutableOptions = [
    [{}, "missing"],
    [{ "mutable": undefined }, "undefined"],
    [{ "mutable": null }, "null"],
    [{ "mutable": false }, "false"],
    [{ "mutable": "" }, "empty string"],
    [{ "mutable": 0 }, "zero"],
  ];
  for (const [opts, name] of immutableOptions) {
    test(() => {
      opts.value = type;
      const global = new WebAssembly.Global(opts);
      assert_equals(global.value, initial, "initial value");
      assert_equals(global.valueOf(), initial, "initial valueOf");

      assert_throws_js(TypeError, () => global.value = value);

      assert_equals(global.value, initial, "post-set value");
      assert_equals(global.valueOf(), initial, "post-set valueOf");
    }, `Immutable ${type} (${name})`);

    test(t => {
      opts.value = type;
      const global = new WebAssembly.Global(opts);
      assert_equals(global.value, initial, "initial value");
      assert_equals(global.valueOf(), initial, "initial valueOf");

      const value = {
        valueOf: t.unreached_func("should not call valueOf"),
        toString: t.unreached_func("should not call toString"),
      };
      assert_throws_js(TypeError, () => global.value = value);

      assert_equals(global.value, initial, "post-set value");
      assert_equals(global.valueOf(), initial, "post-set valueOf");
    }, `Immutable ${type} with ToNumber side-effects (${name})`);
  }

  const mutableOptions = [
    [{ "mutable": true }, "true"],
    [{ "mutable": 1 }, "one"],
    [{ "mutable": "x" }, "string"],
    [Object.create({ "mutable": true }), "true on prototype"],
  ];
  for (const [opts, name] of mutableOptions) {
    test(() => {
      opts.value = type;
      const global = new WebAssembly.Global(opts);
      assert_equals(global.value, initial, "initial value");
      assert_equals(global.valueOf(), initial, "initial valueOf");

      global.value = value;

      assert_throws_js(TypeError, () => global.value = invalid);

      assert_equals(global.value, value, "post-set value");
      assert_equals(global.valueOf(), value, "post-set valueOf");
    }, `Mutable ${type} (${name})`);
  }
}

test(() => {
  const argument = { "value": "i64", "mutable": true };
  const global = new WebAssembly.Global(argument);

  assert_equals(global.value, 0n, "initial value using ToJSValue");

  const valid = [
    [123n, 123n],
    [2n ** 63n, - (2n ** 63n)],
    [true, 1n],
    [false, 0n],
    ["456", 456n],
  ];
  for (const [input, output] of valid) {
    global.value = input;
    assert_equals(global.valueOf(), output, "post-set valueOf");
  }

  const invalid = [
    undefined,
    null,
    0,
    1,
    4.2,
    Symbol(),
  ];
  for (const input of invalid) {
    assert_throws_js(TypeError, () => global.value = input);
  }
}, "i64 mutability");

test(() => {
  const argument = { "value": "i32", "mutable": true };
  const global = new WebAssembly.Global(argument);
  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Global.prototype, "value");
  assert_equals(typeof desc, "object");

  const setter = desc.set;
  assert_equals(typeof setter, "function");

  assert_throws_js(TypeError, () => setter.call(global));
}, "Calling setter without argument");

test(() => {
  const argument = { "value": "i32", "mutable": true };
  const global = new WebAssembly.Global(argument);
  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Global.prototype, "value");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  const setter = desc.set;
  assert_equals(typeof setter, "function");

  assert_equals(getter.call(global, {}), 0);
  assert_equals(setter.call(global, 1, {}), undefined);
  assert_equals(global.value, 1);
}, "Stray argument");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/global/valueOf.any.js                                      0000664 0000000 0000000 00000001172 14746647661 0024262 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const argument = { "value": "i32" };
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Global,
    WebAssembly.Global.prototype,
  ];

  const fn = WebAssembly.Global.prototype.valueOf;

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => fn.call(thisValue), `this=${format_value(thisValue)}`);
  }
}, "Branding");

test(() => {
  const argument = { "value": "i32" };
  const global = new WebAssembly.Global(argument, 0);
  assert_equals(global.valueOf({}), 0);
}, "Stray argument");
                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/jsapi/idlharness.any.js                                          0000664 0000000 0000000 00000000770 14746647661 0023560 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/resources/WebIDLParser.js
// META: script=/resources/idlharness.js
// META: script=../resources/load_wasm.js

'use strict';

// https://webassembly.github.io/spec/js-api/

idl_test(
  ['wasm-js-api'],
  [],
  async idl_array => {
    self.mod = await createWasmModule();
    self.instance = new WebAssembly.Instance(self.mod);

    idl_array.add_objects({
      Memory: [new WebAssembly.Memory({initial: 1024})],
      Module: [self.mod],
      Instance: [self.instance],
    });
  }
);
        node-23.7.0/test/fixtures/wpt/wasm/jsapi/instance/                                                  0000775 0000000 0000000 00000000000 14746647661 0022100 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/instance/constructor-bad-imports.any.js                    0000664 0000000 0000000 00000000773 14746647661 0030037 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/bad-imports.js

test_bad_imports((name, error, build, ...arguments) => {
  test(() => {
    const builder = new WasmModuleBuilder();
    build(builder);
    const buffer = builder.toBuffer();
    const module = new WebAssembly.Module(buffer);
    assert_throws_js(error, () => new WebAssembly.Instance(module, ...arguments));
  }, `new WebAssembly.Instance(module): ${name}`);
});
     node-23.7.0/test/fixtures/wpt/wasm/jsapi/instance/constructor-caching.any.js                        0000664 0000000 0000000 00000003343 14746647661 0027206 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

function getExports() {
  const builder = new WasmModuleBuilder();
  builder
    .addFunction("fn", kSig_v_d)
    .addBody([])
    .exportFunc();

  builder.setTableBounds(1);
  builder.addExportOfKind("table", kExternalTable, 0);
  builder.addGlobal(kWasmI32, false).exportAs("global");
  builder.addMemory(4, 8, true);

  const buffer = builder.toBuffer();
  const module = new WebAssembly.Module(buffer);
  const instance = new WebAssembly.Instance(module);
  return instance.exports;
}

test(() => {
  const exports = getExports();

  const builder = new WasmModuleBuilder();
  const functionIndex = builder.addImport("module", "imported", kSig_v_d);
  builder.addExport("exportedFunction", functionIndex);

  const globalIndex = builder.addImportedGlobal("module", "global", kWasmI32);
  builder.addExportOfKind("exportedGlobal", kExternalGlobal, globalIndex);

  builder.addImportedMemory("module", "memory", 4);
  builder.exportMemoryAs("exportedMemory");

  const tableIndex = builder.addImportedTable("module", "table", 1);
  builder.addExportOfKind("exportedTable", kExternalTable, tableIndex);

  const buffer = builder.toBuffer();

  const module = new WebAssembly.Module(buffer);
  const instance = new WebAssembly.Instance(module, {
    "module": {
      "imported": exports.fn,
      "global": exports.global,
      "memory": exports.memory,
      "table": exports.table,
    }
  });

  assert_equals(instance.exports.exportedFunction, exports.fn);
  assert_equals(instance.exports.exportedGlobal, exports.global);
  assert_equals(instance.exports.exportedMemory, exports.memory);
  assert_equals(instance.exports.exportedTable, exports.table);
});
                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/jsapi/instance/constructor.any.js                                0000664 0000000 0000000 00000002662 14746647661 0025617 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/instanceTestFactory.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  assert_function_name(WebAssembly.Instance, "Instance", "WebAssembly.Instance");
}, "name");

test(() => {
  assert_function_length(WebAssembly.Instance, 1, "WebAssembly.Instance");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Instance());
}, "No arguments");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => new WebAssembly.Instance(argument),
                     `new Instance(${format_value(argument)})`);
  }
}, "Non-Module arguments");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_throws_js(TypeError, () => WebAssembly.Instance(module));
}, "Calling");

for (const [name, fn] of instanceTestFactory) {
  test(() => {
    const { buffer, args, exports, verify } = fn();
    const module = new WebAssembly.Module(buffer);
    const instance = new WebAssembly.Instance(module, ...args);
    assert_Instance(instance, exports);
    verify(instance);
  }, name);
}
                                                                              node-23.7.0/test/fixtures/wpt/wasm/jsapi/instance/exports.any.js                                    0000664 0000000 0000000 00000003530 14746647661 0024731 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Instance,
    WebAssembly.Instance.prototype,
  ];

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Instance.prototype, "exports");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  assert_equals(typeof desc.set, "undefined");

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => getter.call(thisValue), `this=${format_value(thisValue)}`);
  }
}, "Branding");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const instance = new WebAssembly.Instance(module);
  const exports = instance.exports;

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Instance.prototype, "exports");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  assert_equals(getter.call(instance, {}), exports);
}, "Stray argument");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const instance = new WebAssembly.Instance(module);
  const exports = instance.exports;
  instance.exports = {};
  assert_equals(instance.exports, exports, "Should not change the exports");
}, "Setting (sloppy mode)");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const instance = new WebAssembly.Instance(module);
  const exports = instance.exports;
  assert_throws_js(TypeError, () => {
    "use strict";
    instance.exports = {};
  });
  assert_equals(instance.exports, exports, "Should not change the exports");
}, "Setting (strict mode)");
                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/instance/toString.any.js                                   0000664 0000000 0000000 00000001613 14746647661 0025036 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

test(() => {
  const emptyModuleBinary = new WasmModuleBuilder().toBuffer();
  const module = new WebAssembly.Module(emptyModuleBinary);
  const instance = new WebAssembly.Instance(module);
  assert_class_string(instance, "WebAssembly.Instance");
}, "Object.prototype.toString on an Instance");

test(() => {
  assert_own_property(WebAssembly.Instance.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(WebAssembly.Instance.prototype, Symbol.toStringTag);
  assert_equals(propDesc.value, "WebAssembly.Instance", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/jsapi/instanceTestFactory.js                                     0000664 0000000 0000000 00000042335 14746647661 0024635 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        const instanceTestFactory = [
  [
    "Empty module without imports argument",
    function() {
      return {
        buffer: emptyModuleBinary,
        args: [],
        exports: {},
        verify: () => {},
      };
    }
  ],

  [
    "Empty module with undefined imports argument",
    function() {
      return {
        buffer: emptyModuleBinary,
        args: [undefined],
        exports: {},
        verify: () => {},
      };
    }
  ],

  [
    "Empty module with empty imports argument",
    function() {
      return {
        buffer: emptyModuleBinary,
        args: [{}],
        exports: {},
        verify: () => {},
      };
    }
  ],

  [
    "getter order for imports object",
    function() {
      const builder = new WasmModuleBuilder();
      builder.addImportedGlobal("module", "global1", kWasmI32);
      builder.addImportedGlobal("module2", "global3", kWasmI32);
      builder.addImportedMemory("module", "memory", 0, 128);
      builder.addImportedGlobal("module", "global2", kWasmI32);
      const buffer = builder.toBuffer();
      const order = [];

      const imports = {
        get module() {
          order.push("module getter");
          return {
            get global1() {
              order.push("global1 getter");
              return 0;
            },
            get global2() {
              order.push("global2 getter");
              return 0;
            },
            get memory() {
              order.push("memory getter");
              return new WebAssembly.Memory({ "initial": 64, maximum: 128 });
            },
          }
        },
        get module2() {
          order.push("module2 getter");
          return {
            get global3() {
              order.push("global3 getter");
              return 0;
            },
          }
        },
      };

      const expected = [
        "module getter",
        "global1 getter",
        "module2 getter",
        "global3 getter",
        "module getter",
        "memory getter",
        "module getter",
        "global2 getter",
      ];
      return {
        buffer,
        args: [imports],
        exports: {},
        verify: () => assert_array_equals(order, expected),
      };
    }
  ],

  [
    "imports",
    function() {
      const builder = new WasmModuleBuilder();

      builder.addImport("module", "fn", kSig_v_v);
      builder.addImportedGlobal("module", "global", kWasmI32);
      builder.addImportedMemory("module", "memory", 0, 128);
      builder.addImportedTable("module", "table", 0, 128);

      const buffer = builder.toBuffer();
      const imports = {
        "module": {
          "fn": function() {},
          "global": 0,
          "memory": new WebAssembly.Memory({ "initial": 64, maximum: 128 }),
          "table": new WebAssembly.Table({ "element": "anyfunc", "initial": 64, maximum: 128 }),
        },
        get "module2"() {
          assert_unreached("Should not get modules that are not imported");
        },
      };

      return {
        buffer,
        args: [imports],
        exports: {},
        verify: () => {},
      };
    }
  ],

  [
    "imports with empty module names",
    function() {
      const builder = new WasmModuleBuilder();

      builder.addImport("", "fn", kSig_v_v);
      builder.addImportedGlobal("", "global", kWasmI32);
      builder.addImportedMemory("", "memory", 0, 128);
      builder.addImportedTable("", "table", 0, 128);

      const buffer = builder.toBuffer();
      const imports = {
        "": {
          "fn": function() {},
          "global": 0,
          "memory": new WebAssembly.Memory({ "initial": 64, maximum: 128 }),
          "table": new WebAssembly.Table({ "element": "anyfunc", "initial": 64, maximum: 128 }),
        },
      };

      return {
        buffer,
        args: [imports],
        exports: {},
        verify: () => {},
      };
    }
  ],

  [
    "imports with empty names",
    function() {
      const builder = new WasmModuleBuilder();

      builder.addImport("a", "", kSig_v_v);
      builder.addImportedGlobal("b", "", kWasmI32);
      builder.addImportedMemory("c", "", 0, 128);
      builder.addImportedTable("d", "", 0, 128);

      const buffer = builder.toBuffer();
      const imports = {
        "a": { "": function() {} },
        "b": { "": 0 },
        "c": { "": new WebAssembly.Memory({ "initial": 64, maximum: 128 }) },
        "d": { "": new WebAssembly.Table({ "element": "anyfunc", "initial": 64, maximum: 128 }) },
      };

      return {
        buffer,
        args: [imports],
        exports: {},
        verify: () => {},
      };
    }
  ],

  [
    "exports with empty name: function",
    function() {
      const builder = new WasmModuleBuilder();

      builder
        .addFunction("", kSig_v_d)
        .addBody([])
        .exportFunc();

      const buffer = builder.toBuffer();

      const exports = {
        "": { "kind": "function", "name": "0", "length": 1 },
      };

      return {
        buffer,
        args: [],
        exports,
        verify: () => {},
      };
    }
  ],

  [
    "exports with empty name: table",
    function() {
      const builder = new WasmModuleBuilder();

      builder.setTableBounds(1);
      builder.addExportOfKind("", kExternalTable, 0);

      const buffer = builder.toBuffer();

      const exports = {
        "": { "kind": "table", "length": 1 },
      };

      return {
        buffer,
        args: [],
        exports,
        verify: () => {},
      };
    }
  ],

  [
    "exports with empty name: global",
    function() {
      const builder = new WasmModuleBuilder();

      builder.addGlobal(kWasmI32, true)
        .exportAs("")
        .init = 7;

      const buffer = builder.toBuffer();

      const exports = {
        "": { "kind": "global", "value": 7 },
      };

      return {
        buffer,
        args: [],
        exports,
        verify: () => {},
      };
    }
  ],

  [
    "No imports",
    function() {
      const builder = new WasmModuleBuilder();

      builder
        .addFunction("fn", kSig_v_d)
        .addBody([])
        .exportFunc();
      builder
        .addFunction("fn2", kSig_v_v)
        .addBody([])
        .exportFunc();

      builder.setTableBounds(1);
      builder.addExportOfKind("table", kExternalTable, 0);

      builder.addGlobal(kWasmI32, true)
        .exportAs("global")
        .init = 7;
      builder.addGlobal(kWasmF64, true)
        .exportAs("global2")
        .init = 1.2;

      builder.addMemory(4, 8, true);

      const buffer = builder.toBuffer();

      const exports = {
        "fn": { "kind": "function", "name": "0", "length": 1 },
        "fn2": { "kind": "function", "name": "1", "length": 0 },
        "table": { "kind": "table", "length": 1 },
        "global": { "kind": "global", "value": 7 },
        "global2": { "kind": "global", "value": 1.2 },
        "memory": { "kind": "memory", "size": 4 },
      };

      return {
        buffer,
        args: [],
        exports,
        verify: () => {},
      };
    }
  ],

  [
    "exports and imports",
    function() {
      const value = 102;

      const builder = new WasmModuleBuilder();

      const index = builder.addImportedGlobal("module", "global", kWasmI32);
      builder
        .addFunction("fn", kSig_i_v)
        .addBody([
            kExprGlobalGet,
            index,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      const imports = {
        "module": {
          "global": value,
        },
      };

      const exports = {
        "fn": { "kind": "function", "name": "0", "length": 0 },
      };

      return {
        buffer,
        args: [imports],
        exports,
        verify: instance => assert_equals(instance.exports.fn(), value)
      };
    }
  ],

  [
    "i64 exports and imports",
    function() {
      const value = 102n;

      const builder = new WasmModuleBuilder();

      const index = builder.addImportedGlobal("module", "global", kWasmI64);
      builder
        .addFunction("fn", kSig_l_v)
        .addBody([
            kExprGlobalGet,
            index,
            kExprReturn,
        ])
        .exportFunc();

      const index2 = builder.addImportedGlobal("module", "global2", kWasmI64);
      builder.addExportOfKind("global", kExternalGlobal, index2);

      const buffer = builder.toBuffer();

      const imports = {
        "module": {
          "global": value,
          "global2": 2n ** 63n,
        },
      };

      const exports = {
        "fn": { "kind": "function", "name": "0", "length": 0 },
        "global": { "kind": "global", "value": -(2n ** 63n) },
      };

      return {
        buffer,
        args: [imports],
        exports,
        verify: instance => assert_equals(instance.exports.fn(), value)
      };
    }
  ],

  [
    "import with i32-returning function",
    function() {
      const builder = new WasmModuleBuilder();

      const fnIndex = builder.addImport("module", "fn", kSig_i_v);
      const fn2 = builder
        .addFunction("fn2", kSig_v_v)
        .addBody([
            kExprCallFunction,
            fnIndex,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      let called = false;
      const imports = {
        "module": {
          "fn": function() {
            called = true;
            return 6n;
          },
        },
      };

      return {
        buffer,
        args: [imports],
        exports: {
          "fn2": { "kind": "function", "name": String(fn2.index), "length": 0 },
        },
        verify: instance => {
          assert_throws_js(TypeError, () => instance.exports.fn2());
          assert_true(called, "Should have called into JS");
        }
      };
    }
  ],

  [
    "import with function that takes and returns i32",
    function() {
      const builder = new WasmModuleBuilder();

      const fnIndex = builder.addImport("module", "fn", kSig_i_i);
      const fn2 = builder
        .addFunction("fn2", kSig_i_v)
        .addBody([
            kExprI32Const, 0x66,
            kExprCallFunction,
            fnIndex,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      let called = false;
      const imports = {
        "module": {
          "fn": function(n) {
            called = true;
            assert_equals(n, -26);
            return { valueOf() { return 6; } };
          },
        },
      };

      return {
        buffer,
        args: [imports],
        exports: {
          "fn2": { "kind": "function", "name": String(fn2.index), "length": 0 },
        },
        verify: instance => {
          assert_equals(instance.exports.fn2(), 6);
          assert_true(called, "Should have called into JS");
        }
      };
    }
  ],

  [
    "import with i64-returning function",
    function() {
      const builder = new WasmModuleBuilder();

      const fnIndex = builder.addImport("module", "fn", kSig_l_v);
      const fn2 = builder
        .addFunction("fn2", kSig_v_v)
        .addBody([
            kExprCallFunction,
            fnIndex,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      let called = false;
      const imports = {
        "module": {
          "fn": function() {
            called = true;
            return 6;
          },
        },
      };

      return {
        buffer,
        args: [imports],
        exports: {
          "fn2": { "kind": "function", "name": String(fn2.index), "length": 0 },
        },
        verify: instance => {
          assert_throws_js(TypeError, () => instance.exports.fn2());
          assert_true(called, "Should have called into JS");
        }
      };
    }
  ],

  [
    "import with function that takes and returns i64",
    function() {
      const builder = new WasmModuleBuilder();

      const fnIndex = builder.addImport("module", "fn", kSig_l_l);
      const fn2 = builder
        .addFunction("fn2", kSig_l_v)
        .addBody([
            kExprI64Const, 0x66,
            kExprCallFunction,
            fnIndex,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      let called = false;
      const imports = {
        "module": {
          "fn": function(n) {
            called = true;
            assert_equals(n, -26n);
            return { valueOf() { return 6n; } };
          },
        },
      };

      return {
        buffer,
        args: [imports],
        exports: {
          "fn2": { "kind": "function", "name": String(fn2.index), "length": 0 },
        },
        verify: instance => {
          assert_equals(instance.exports.fn2(), 6n);
          assert_true(called, "Should have called into JS");
        }
      };
    }
  ],

  [
    "import with i32-taking function",
    function() {
      const builder = new WasmModuleBuilder();

      const fn = builder
        .addFunction("fn", kSig_v_i)
        .addBody([
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      return {
        buffer,
        args: [],
        exports: {
          "fn": { "kind": "function", "name": String(fn.index), "length": 1 },
        },
        verify: instance => assert_throws_js(TypeError, () => instance.exports.fn(6n))
      };
    }
  ],

  [
    "import with i64-taking function",
    function() {
      const builder = new WasmModuleBuilder();

      const fn = builder
        .addFunction("fn", kSig_v_l)
        .addBody([
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      return {
        buffer,
        args: [],
        exports: {
          "fn": { "kind": "function", "name": String(fn.index), "length": 1 },
        },
        verify: instance => assert_throws_js(TypeError, () => instance.exports.fn(6))
      };
    }
  ],

  [
    "export i64-returning function",
    function() {
      const builder = new WasmModuleBuilder();

      const fn = builder
        .addFunction("fn", kSig_l_v)
        .addBody([
            kExprI64Const, 0x66,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      return {
        buffer,
        args: [],
        exports: {
          "fn": { "kind": "function", "name": String(fn.index), "length": 0 },
        },
        verify: instance => assert_equals(instance.exports.fn(), -26n)
      };
    }
  ],

  [
    "i32 mutable WebAssembly.Global import",
    function() {
      const initial = 102;
      const value = new WebAssembly.Global({ "value": "i32", "mutable": true }, initial);

      const builder = new WasmModuleBuilder();

      const index = builder.addImportedGlobal("module", "global", kWasmI32, true);
      const fn = builder
        .addFunction("fn", kSig_i_v)
        .addBody([
            kExprGlobalGet,
            index,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      const imports = {
        "module": {
          "global": value,
        },
      };

      const exports = {
        "fn": { "kind": "function", "name": String(fn.index), "length": 0 },
      };

      return {
        buffer,
        args: [imports],
        exports,
        verify: instance => {
          assert_equals(instance.exports.fn(), initial);
          const after = 201;
          value.value = after;
          assert_equals(instance.exports.fn(), after);
        }
      };
    }
  ],

  [
    "i64 mutable WebAssembly.Global import",
    function() {
      const initial = 102n;
      const value = new WebAssembly.Global({ "value": "i64", "mutable": true }, initial);

      const builder = new WasmModuleBuilder();

      const index = builder.addImportedGlobal("module", "global", kWasmI64, true);
      const fn = builder
        .addFunction("fn", kSig_l_v)
        .addBody([
            kExprGlobalGet,
            index,
            kExprReturn,
        ])
        .exportFunc();

      const buffer = builder.toBuffer();

      const imports = {
        "module": {
          "global": value,
        },
      };

      const exports = {
        "fn": { "kind": "function", "name": String(fn.index), "length": 0 },
      };

      return {
        buffer,
        args: [imports],
        exports,
        verify: instance => {
          assert_equals(instance.exports.fn(), initial);
          const after = 201n;
          value.value = after;
          assert_equals(instance.exports.fn(), after);
        }
      };
    }
  ],

  [
    "Multiple i64 arguments",
    function() {
      const builder = new WasmModuleBuilder();

      const fn = builder
          .addFunction("fn", kSig_l_ll)
          .addBody([
              kExprLocalGet, 1,
          ])
          .exportFunc();

      const buffer = builder.toBuffer();

      const exports = {
        "fn": { "kind": "function", "name": String(fn.index), "length": 2 },
      };

      return {
        buffer,
        args: [],
        exports,
        verify: instance => {
          const fn = instance.exports.fn;
          assert_equals(fn(1n, 0n), 0n);
          assert_equals(fn(1n, 123n), 123n);
          assert_equals(fn(1n, -123n), -123n);
          assert_equals(fn(1n, "5"), 5n);
          assert_throws_js(TypeError, () => fn(1n, 5));
        }
      };
    }
  ],

  [
    "stray argument",
    function() {
      return {
        buffer: emptyModuleBinary,
        args: [{}, {}],
        exports: {},
        verify: () => {}
      };
    }
  ],
];
                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/jsapi/interface.any.js                                           0000664 0000000 0000000 00000011773 14746647661 0023371 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function test_operations(object, object_name, operations) {
  for (const [name, length] of operations) {
    test(() => {
      const propdesc = Object.getOwnPropertyDescriptor(object, name);
      assert_equals(typeof propdesc, "object");
      assert_true(propdesc.writable, "writable");
      assert_true(propdesc.enumerable, "enumerable");
      assert_true(propdesc.configurable, "configurable");
      assert_equals(propdesc.value, object[name]);
    }, `${object_name}.${name}`);

    test(() => {
      assert_function_name(object[name], name, `${object_name}.${name}`);
    }, `${object_name}.${name}: name`);

    test(() => {
      assert_function_length(object[name], length, `${object_name}.${name}`);
    }, `${object_name}.${name}: length`);
  }
}

function test_attributes(object, object_name, attributes) {
  for (const [name, mutable] of attributes) {
    test(() => {
      const propdesc = Object.getOwnPropertyDescriptor(object, name);
      assert_equals(typeof propdesc, "object");
      assert_true(propdesc.enumerable, "enumerable");
      assert_true(propdesc.configurable, "configurable");
    }, `${object_name}.${name}`);

    test(() => {
      const propdesc = Object.getOwnPropertyDescriptor(object, name);
      assert_equals(typeof propdesc, "object");
      assert_equals(typeof propdesc.get, "function");
      assert_function_name(propdesc.get, "get " + name, `getter for "${name}"`);
      assert_function_length(propdesc.get, 0, `getter for "${name}"`);
    }, `${object_name}.${name}: getter`);

    test(() => {
      const propdesc = Object.getOwnPropertyDescriptor(object, name);
      assert_equals(typeof propdesc, "object");
      if (mutable) {
        assert_equals(typeof propdesc.set, "function");
        assert_function_name(propdesc.set, "set " + name, `setter for "${name}"`);
        assert_function_length(propdesc.set, 1, `setter for "${name}"`);
      } else {
        assert_equals(typeof propdesc.set, "undefined");
      }
    }, `${object_name}.${name}: setter`);
  }
}

test(() => {
  const propdesc = Object.getOwnPropertyDescriptor(this, "WebAssembly");
  assert_equals(typeof propdesc, "object");
  assert_true(propdesc.writable, "writable");
  assert_false(propdesc.enumerable, "enumerable");
  assert_true(propdesc.configurable, "configurable");
  assert_equals(propdesc.value, this.WebAssembly);
}, "WebAssembly: property descriptor");

test(() => {
  assert_throws_js(TypeError, () => WebAssembly());
}, "WebAssembly: calling");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly());
}, "WebAssembly: constructing");

const interfaces = [
  "Module",
  "Instance",
  "Memory",
  "Table",
  "Global",
  "CompileError",
  "LinkError",
  "RuntimeError",
];

for (const name of interfaces) {
  test(() => {
    const propdesc = Object.getOwnPropertyDescriptor(WebAssembly, name);
    assert_equals(typeof propdesc, "object");
    assert_true(propdesc.writable, "writable");
    assert_false(propdesc.enumerable, "enumerable");
    assert_true(propdesc.configurable, "configurable");
    assert_equals(propdesc.value, WebAssembly[name]);
  }, `WebAssembly.${name}: property descriptor`);

  test(() => {
    const interface_object = WebAssembly[name];
    const propdesc = Object.getOwnPropertyDescriptor(interface_object, "prototype");
    assert_equals(typeof propdesc, "object");
    assert_false(propdesc.writable, "writable");
    assert_false(propdesc.enumerable, "enumerable");
    assert_false(propdesc.configurable, "configurable");
  }, `WebAssembly.${name}: prototype`);

  test(() => {
    const interface_object = WebAssembly[name];
    const interface_prototype_object = interface_object.prototype;
    const propdesc = Object.getOwnPropertyDescriptor(interface_prototype_object, "constructor");
    assert_equals(typeof propdesc, "object");
    assert_true(propdesc.writable, "writable");
    assert_false(propdesc.enumerable, "enumerable");
    assert_true(propdesc.configurable, "configurable");
    assert_equals(propdesc.value, interface_object);
  }, `WebAssembly.${name}: prototype.constructor`);
}

test_operations(WebAssembly, "WebAssembly", [
  ["validate", 1],
  ["compile", 1],
  ["instantiate", 1],
]);


test_operations(WebAssembly.Module, "WebAssembly.Module", [
  ["exports", 1],
  ["imports", 1],
  ["customSections", 2],
]);


test_attributes(WebAssembly.Instance.prototype, "WebAssembly.Instance", [
  ["exports", false],
]);


test_operations(WebAssembly.Memory.prototype, "WebAssembly.Memory", [
  ["grow", 1],
]);

test_attributes(WebAssembly.Memory.prototype, "WebAssembly.Memory", [
  ["buffer", false],
]);


test_operations(WebAssembly.Table.prototype, "WebAssembly.Table", [
  ["grow", 1],
  ["get", 1],
  ["set", 1],
]);

test_attributes(WebAssembly.Table.prototype, "WebAssembly.Table", [
  ["length", false],
]);


test_operations(WebAssembly.Global.prototype, "WebAssembly.Global", [
  ["valueOf", 0],
]);

test_attributes(WebAssembly.Global.prototype, "WebAssembly.Global", [
  ["value", true],
]);
     node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/                                                    0000775 0000000 0000000 00000000000 14746647661 0021604 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/assertions.js                                       0000664 0000000 0000000 00000003311 14746647661 0024332 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function assert_ArrayBuffer(actual, { size=0, shared=false, detached=false }, message) {
  // https://github.com/WebAssembly/spec/issues/840
  // See https://github.com/whatwg/html/issues/5380 for why not `self.SharedArrayBuffer`
  const isShared = !("isView" in actual.constructor);
  assert_equals(isShared, shared, `${message}: constructor`);
  const sharedString = shared ? "Shared" : "";
  assert_equals(actual.toString(), `[object ${sharedString}ArrayBuffer]`, `${message}: toString()`);
  assert_equals(Object.getPrototypeOf(actual).toString(), `[object ${sharedString}ArrayBuffer]`, `${message}: prototype toString()`);
  if (detached) {
    // https://github.com/tc39/ecma262/issues/678
    let byteLength;
    try {
      byteLength = actual.byteLength;
    } catch (e) {
      byteLength = 0;
    }
    assert_equals(byteLength, 0, `${message}: detached size`);
  } else {
    assert_equals(actual.byteLength, 0x10000 * size, `${message}: size`);
    if (size > 0) {
      const array = new Uint8Array(actual);
      assert_equals(array[0], 0, `${message}: first element`);
      assert_equals(array[array.byteLength - 1], 0, `${message}: last element`);
    }
  }
  assert_equals(Object.isFrozen(actual), shared, "buffer frozen");
  assert_equals(Object.isExtensible(actual), !shared, "buffer extensibility");
}

function assert_Memory(memory, { size=0, shared=false }) {
  assert_equals(Object.getPrototypeOf(memory), WebAssembly.Memory.prototype,
                "prototype");
  assert_true(Object.isExtensible(memory), "extensible");

  // https://github.com/WebAssembly/spec/issues/840
  assert_equals(memory.buffer, memory.buffer, "buffer should be idempotent");
  assert_ArrayBuffer(memory.buffer, { size, shared });
}
                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/buffer.any.js                                       0000664 0000000 0000000 00000003541 14746647661 0024204 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Memory,
    WebAssembly.Memory.prototype,
  ];

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Memory.prototype, "buffer");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  assert_equals(typeof desc.set, "undefined");

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => getter.call(thisValue), `this=${format_value(thisValue)}`);
  }
}, "Branding");

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  const buffer = memory.buffer;

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Memory.prototype, "buffer");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  assert_equals(getter.call(memory, {}), buffer);
}, "Stray argument");

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  const memory2 = new WebAssembly.Memory(argument);
  const buffer = memory.buffer;
  assert_not_equals(buffer, memory2.buffer, "Need two distinct buffers");
  memory.buffer = memory2.buffer;
  assert_equals(memory.buffer, buffer, "Should not change the buffer");
}, "Setting (sloppy mode)");

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  const memory2 = new WebAssembly.Memory(argument);
  const buffer = memory.buffer;
  assert_not_equals(buffer, memory2.buffer, "Need two distinct buffers");
  assert_throws_js(TypeError, () => {
    "use strict";
    memory.buffer = memory2.buffer;
  });
  assert_equals(memory.buffer, buffer, "Should not change the buffer");
}, "Setting (strict mode)");
                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/constructor-shared.tentative.any.js                 0000664 0000000 0000000 00000002325 14746647661 0030565 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/memory/assertions.js

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Memory({ "initial": 10, "shared": true }));
}, "Shared memory without maximum");

test(t => {
  const order = [];

  new WebAssembly.Memory({
    get maximum() {
      order.push("maximum");
      return {
        valueOf() {
          order.push("maximum valueOf");
          return 1;
        },
      };
    },

    get initial() {
      order.push("initial");
      return {
        valueOf() {
          order.push("initial valueOf");
          return 1;
        },
      };
    },

    get shared() {
      order.push("shared");
      return {
        valueOf: t.unreached_func("should not call shared valueOf"),
      };
    },
  });

  assert_array_equals(order, [
    "initial",
    "initial valueOf",
    "maximum",
    "maximum valueOf",
    "shared",
  ]);
}, "Order of evaluation for descriptor (with shared)");

test(() => {
  const argument = { "initial": 4, "maximum": 10, shared: true };
  const memory = new WebAssembly.Memory(argument);
  assert_Memory(memory, { "size": 4, "shared": true });
}, "Shared memory");
                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/constructor-types.tentative.any.js                  0000664 0000000 0000000 00000001227 14746647661 0030463 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/memory/assertions.js

test(() => {
    const argument = { initial: 5, minimum: 6 };
    assert_throws_js(TypeError, () => new WebAssembly.Memory(argument));
}, "Initializing with both initial and minimum");

test(() => {
    const argument = { minimum: 0 };
    const memory = new WebAssembly.Memory(argument);
    assert_Memory(memory, { "size": 0 });
  }, "Zero minimum");

test(() => {
    const argument = { minimum: 4 };
    const memory = new WebAssembly.Memory(argument);
    assert_Memory(memory, { "size": 4 });
  }, "Non-zero minimum");                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/constructor.any.js                                  0000664 0000000 0000000 00000006437 14746647661 0025327 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/memory/assertions.js

test(() => {
  assert_function_name(WebAssembly.Memory, "Memory", "WebAssembly.Memory");
}, "name");

test(() => {
  assert_function_length(WebAssembly.Memory, 1, "WebAssembly.Memory");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Memory());
}, "No arguments");

test(() => {
  const argument = { "initial": 0 };
  assert_throws_js(TypeError, () => WebAssembly.Memory(argument));
}, "Calling");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    false,
    true,
    "",
    "test",
    Symbol(),
    1,
    NaN,
    {},
  ];
  for (const invalidArgument of invalidArguments) {
    assert_throws_js(TypeError,
                     () => new WebAssembly.Memory(invalidArgument),
                     `new Memory(${format_value(invalidArgument)})`);
  }
}, "Invalid descriptor argument");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Memory({ "initial": undefined }));
}, "Undefined initial value in descriptor");

const outOfRangeValues = [
  NaN,
  Infinity,
  -Infinity,
  -1,
  0x100000000,
  0x1000000000,
];

for (const value of outOfRangeValues) {
  test(() => {
    assert_throws_js(TypeError, () => new WebAssembly.Memory({ "initial": value }));
  }, `Out-of-range initial value in descriptor: ${format_value(value)}`);

  test(() => {
    assert_throws_js(TypeError, () => new WebAssembly.Memory({ "initial": 0, "maximum": value }));
  }, `Out-of-range maximum value in descriptor: ${format_value(value)}`);
}

test(() => {
  assert_throws_js(RangeError, () => new WebAssembly.Memory({ "initial": 10, "maximum": 9 }));
}, "Initial value exceeds maximum");

test(() => {
  const proxy = new Proxy({}, {
    has(o, x) {
      assert_unreached(`Should not call [[HasProperty]] with ${x}`);
    },
    get(o, x) {
      // Due to the requirement not to supply both minimum and initial, we need to ignore one of them.
      switch (x) {
        case "shared":
          return false;
        case "initial":
        case "maximum":
          return 0;
        default:
          return undefined;
      }
    },
  });
  new WebAssembly.Memory(proxy);
}, "Proxy descriptor");

test(() => {
  const order = [];

  new WebAssembly.Memory({
    get maximum() {
      order.push("maximum");
      return {
        valueOf() {
          order.push("maximum valueOf");
          return 1;
        },
      };
    },

    get initial() {
      order.push("initial");
      return {
        valueOf() {
          order.push("initial valueOf");
          return 1;
        },
      };
    },
  });

  assert_array_equals(order, [
    "initial",
    "initial valueOf",
    "maximum",
    "maximum valueOf",
  ]);
}, "Order of evaluation for descriptor");

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  assert_Memory(memory, { "size": 0 });
}, "Zero initial");

test(() => {
  const argument = { "initial": 4 };
  const memory = new WebAssembly.Memory(argument);
  assert_Memory(memory, { "size": 4 });
}, "Non-zero initial");

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument, {});
  assert_Memory(memory, { "size": 0 });
}, "Stray argument");
                                                                                                                                                                                                                                 node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/grow.any.js                                         0000664 0000000 0000000 00000014623 14746647661 0023714 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/memory/assertions.js

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  assert_throws_js(TypeError, () => memory.grow());
}, "Missing arguments");

test(t => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Memory,
    WebAssembly.Memory.prototype,
  ];

  const argument = {
    valueOf: t.unreached_func("Should not touch the argument (valueOf)"),
    toString: t.unreached_func("Should not touch the argument (toString)"),
  };

  const fn = WebAssembly.Memory.prototype.grow;

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => fn.call(thisValue, argument), `this=${format_value(thisValue)}`);
  }
}, "Branding");

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 0 }, "Buffer before growing");

  const result = memory.grow(2);
  assert_equals(result, 0);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "Old buffer after growing");
  assert_ArrayBuffer(newMemory, { "size": 2 }, "New buffer after growing");
}, "Zero initial");

test(() => {
  const argument = { "initial": { valueOf() { return 0 } } };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 0 }, "Buffer before growing");

  const result = memory.grow({ valueOf() { return 2 } });
  assert_equals(result, 0);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "Old buffer after growing");
  assert_ArrayBuffer(newMemory, { "size": 2 }, "New buffer after growing");
}, "Zero initial with valueOf");

test(() => {
  const argument = { "initial": 3 };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 3 }, "Buffer before growing");

  const result = memory.grow(2);
  assert_equals(result, 3);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "Old buffer after growing");
  assert_ArrayBuffer(newMemory, { "size": 5 }, "New buffer after growing");
}, "Non-zero initial");

test(() => {
  const argument = { "initial": 0, "maximum": 2 };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 0 }, "Buffer before growing");

  const result = memory.grow(2);
  assert_equals(result, 0);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "Old buffer after growing");
  assert_ArrayBuffer(newMemory, { "size": 2 }, "New buffer after growing");
}, "Zero initial with respected maximum");

test(() => {
  const argument = { "initial": 0, "maximum": 2 };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 0 }, "Buffer before growing");

  const result = memory.grow(1);
  assert_equals(result, 0);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "Old buffer after growing once");
  assert_ArrayBuffer(newMemory, { "size": 1 }, "New buffer after growing once");

  const result2 = memory.grow(1);
  assert_equals(result2, 1);

  const newestMemory = memory.buffer;
  assert_not_equals(newMemory, newestMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "New buffer after growing twice");
  assert_ArrayBuffer(newMemory, { "detached": true }, "New buffer after growing twice");
  assert_ArrayBuffer(newestMemory, { "size": 2 }, "Newest buffer after growing twice");
}, "Zero initial with respected maximum grown twice");

test(() => {
  const argument = { "initial": 1, "maximum": 2 };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 1 }, "Buffer before growing");

  assert_throws_js(RangeError, () => memory.grow(2));
  assert_equals(memory.buffer, oldMemory);
  assert_ArrayBuffer(memory.buffer, { "size": 1 }, "Buffer before trying to grow");
}, "Zero initial growing too much");

const outOfRangeValues = [
  undefined,
  NaN,
  Infinity,
  -Infinity,
  -1,
  0x100000000,
  0x1000000000,
  "0x100000000",
  { valueOf() { return 0x100000000; } },
];

for (const value of outOfRangeValues) {
  test(() => {
    const argument = { "initial": 0 };
    const memory = new WebAssembly.Memory(argument);
    assert_throws_js(TypeError, () => memory.grow(value));
  }, `Out-of-range argument: ${format_value(value)}`);
}

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 0 }, "Buffer before growing");

  const result = memory.grow(2, {});
  assert_equals(result, 0);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "detached": true }, "Old buffer after growing");
  assert_ArrayBuffer(newMemory, { "size": 2 }, "New buffer after growing");
}, "Stray argument");

test(() => {
  const argument = { "initial": 1, "maximum": 2, "shared": true };
  const memory = new WebAssembly.Memory(argument);
  const oldMemory = memory.buffer;
  assert_ArrayBuffer(oldMemory, { "size": 1, "shared": true }, "Buffer before growing");

  const result = memory.grow(1);
  assert_equals(result, 1);

  const newMemory = memory.buffer;
  assert_not_equals(oldMemory, newMemory);
  assert_ArrayBuffer(oldMemory, { "size": 1, "shared": true }, "Old buffer after growing");
  assert_ArrayBuffer(newMemory, { "size": 2, "shared": true }, "New buffer after growing");

  // The old and new buffers must have the same value for the
  // [[ArrayBufferData]] internal slot.
  const oldArray = new Uint8Array(oldMemory);
  const newArray = new Uint8Array(newMemory);
  assert_equals(oldArray[0], 0, "old first element");
  assert_equals(newArray[0], 0, "new first element");
  oldArray[0] = 1;
  assert_equals(oldArray[0], 1, "old first element");
  assert_equals(newArray[0], 1, "new first element");

}, "Growing shared memory does not detach old buffer");
                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/toString.any.js                                     0000664 0000000 0000000 00000001363 14746647661 0024544 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const argument = { "initial": 0 };
  const memory = new WebAssembly.Memory(argument);
  assert_class_string(memory, "WebAssembly.Memory");
}, "Object.prototype.toString on an Memory");

test(() => {
  assert_own_property(WebAssembly.Memory.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(WebAssembly.Memory.prototype, Symbol.toStringTag);
  assert_equals(propDesc.value, "WebAssembly.Memory", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/jsapi/memory/type.tentative.any.js                               0000664 0000000 0000000 00000001722 14746647661 0025715 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function assert_type(argument) {
    const memory = new WebAssembly.Memory(argument);
    const memorytype = memory.type()

    assert_equals(memorytype.minimum, argument.minimum);
    assert_equals(memorytype.maximum, argument.maximum);
    if (argument.shared !== undefined) {
        assert_equals(memorytype.shared, argument.shared);
    }
}

test(() => {
    assert_type({ "minimum": 0 });
}, "Zero initial, no maximum");

test(() => {
    assert_type({ "minimum": 5 });
}, "Non-zero initial, no maximum");

test(() => {
    assert_type({ "minimum": 0, "maximum": 0 });
}, "Zero maximum");

test(() => {
    assert_type({ "minimum": 0, "maximum": 5 });
}, "None-zero maximum");

test(() => {
    assert_type({ "minimum": 0, "maximum": 10,  "shared": false});
}, "non-shared memory");

test(() => {
    assert_type({ "minimum": 0, "maximum": 10, "shared": true});
}, "shared memory");                                              node-23.7.0/test/fixtures/wpt/wasm/jsapi/module/                                                    0000775 0000000 0000000 00000000000 14746647661 0021561 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/module/constructor.any.js                                  0000664 0000000 0000000 00000003554 14746647661 0025301 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/assertions.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  assert_function_name(WebAssembly.Module, "Module", "WebAssembly.Module");
}, "name");

test(() => {
  assert_function_length(WebAssembly.Module, 1, "WebAssembly.Module");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Module());
}, "No arguments");

test(() => {
  assert_throws_js(TypeError, () => WebAssembly.Module(emptyModuleBinary));
}, "Calling");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "test",
    Symbol(),
    7,
    NaN,
    {},
    ArrayBuffer,
    ArrayBuffer.prototype,
    Array.from(emptyModuleBinary),
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => new WebAssembly.Module(argument),
                     `new Module(${format_value(argument)})`);
  }
}, "Invalid arguments");

test(() => {
  const buffer = new Uint8Array();
  assert_throws_js(WebAssembly.CompileError, () => new WebAssembly.Module(buffer));
}, "Empty buffer");

test(() => {
  const buffer = new Uint8Array(Array.from(emptyModuleBinary).concat([0, 0]));
  assert_throws_js(WebAssembly.CompileError, () => new WebAssembly.Module(buffer));
}, "Invalid code");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_equals(Object.getPrototypeOf(module), WebAssembly.Module.prototype);
}, "Prototype");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_true(Object.isExtensible(module));
}, "Extensibility");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary, {});
  assert_equals(Object.getPrototypeOf(module), WebAssembly.Module.prototype);
}, "Stray argument");
                                                                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/jsapi/module/customSections.any.js                               0000664 0000000 0000000 00000010640 14746647661 0025730 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

function assert_ArrayBuffer(buffer, expected) {
  assert_equals(Object.getPrototypeOf(buffer), ArrayBuffer.prototype, "Prototype");
  assert_true(Object.isExtensible(buffer), "isExtensible");
  assert_array_equals(new Uint8Array(buffer), expected);
}

function assert_sections(sections, expected) {
  assert_true(Array.isArray(sections), "Should be array");
  assert_equals(Object.getPrototypeOf(sections), Array.prototype, "Prototype");
  assert_true(Object.isExtensible(sections), "isExtensible");

  assert_equals(sections.length, expected.length);
  for (let i = 0; i < expected.length; ++i) {
    assert_ArrayBuffer(sections[i], expected[i]);
  }
}

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  assert_throws_js(TypeError, () => WebAssembly.Module.customSections());
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_throws_js(TypeError, () => WebAssembly.Module.customSections(module));
}, "Missing arguments");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => WebAssembly.Module.customSections(argument, ""),
                     `customSections(${format_value(argument)})`);
  }
}, "Non-Module arguments");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const fn = WebAssembly.Module.customSections;
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const thisValue of thisValues) {
    assert_sections(fn.call(thisValue, module, ""), []);
  }
}, "Branding");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_sections(WebAssembly.Module.customSections(module, ""), []);
}, "Empty module");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_not_equals(WebAssembly.Module.customSections(module, ""),
                    WebAssembly.Module.customSections(module, ""));
}, "Empty module: array caching");

test(() => {
  const bytes1 = [87, 101, 98, 65, 115, 115, 101, 109, 98, 108, 121];
  const bytes2 = [74, 83, 65, 80, 73];

  const builder = new WasmModuleBuilder();
  builder.addCustomSection("name", bytes1);
  builder.addCustomSection("name", bytes2);
  builder.addCustomSection("foo", bytes1);
  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);

  assert_sections(WebAssembly.Module.customSections(module, "name"), [
    bytes1,
    bytes2,
  ])

  assert_sections(WebAssembly.Module.customSections(module, "foo"), [
    bytes1,
  ])

  assert_sections(WebAssembly.Module.customSections(module, ""), [])
  assert_sections(WebAssembly.Module.customSections(module, "\0"), [])
  assert_sections(WebAssembly.Module.customSections(module, "name\0"), [])
  assert_sections(WebAssembly.Module.customSections(module, "foo\0"), [])
}, "Custom sections");

test(() => {
  const bytes = [87, 101, 98, 65, 115, 115, 101, 109, 98, 108, 121];
  const name = "yee\uD801\uDC37eey"

  const builder = new WasmModuleBuilder();
  builder.addCustomSection(name, bytes);
  const buffer = builder.toBuffer();
  const module = new WebAssembly.Module(buffer);

  assert_sections(WebAssembly.Module.customSections(module, name), [
    bytes,
  ]);
  assert_sections(WebAssembly.Module.customSections(module, "yee\uFFFDeey"), []);
  assert_sections(WebAssembly.Module.customSections(module, "yee\uFFFD\uFFFDeey"), []);
}, "Custom sections with surrogate pairs");

test(() => {
  const bytes = [87, 101, 98, 65, 115, 115, 101, 109, 98, 108, 121];

  const builder = new WasmModuleBuilder();
  builder.addCustomSection("na\uFFFDme", bytes);
  const buffer = builder.toBuffer();
  const module = new WebAssembly.Module(buffer);

  assert_sections(WebAssembly.Module.customSections(module, "name"), []);
  assert_sections(WebAssembly.Module.customSections(module, "na\uFFFDme"), [
    bytes,
  ]);
  assert_sections(WebAssembly.Module.customSections(module, "na\uDC01me"), []);
}, "Custom sections with U+FFFD");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_sections(WebAssembly.Module.customSections(module, "", {}), []);
}, "Stray argument");
                                                                                                node-23.7.0/test/fixtures/wpt/wasm/jsapi/module/exports.any.js                                      0000664 0000000 0000000 00000012107 14746647661 0024412 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

function assert_ModuleExportDescriptor(export_, expected) {
  assert_equals(Object.getPrototypeOf(export_), Object.prototype, "Prototype");
  assert_true(Object.isExtensible(export_), "isExtensible");

  const name = Object.getOwnPropertyDescriptor(export_, "name");
  assert_true(name.writable, "name: writable");
  assert_true(name.enumerable, "name: enumerable");
  assert_true(name.configurable, "name: configurable");
  assert_equals(name.value, expected.name);

  const kind = Object.getOwnPropertyDescriptor(export_, "kind");
  assert_true(kind.writable, "kind: writable");
  assert_true(kind.enumerable, "kind: enumerable");
  assert_true(kind.configurable, "kind: configurable");
  assert_equals(kind.value, expected.kind);
}

function assert_exports(exports, expected) {
  assert_true(Array.isArray(exports), "Should be array");
  assert_equals(Object.getPrototypeOf(exports), Array.prototype, "Prototype");
  assert_true(Object.isExtensible(exports), "isExtensible");

  assert_equals(exports.length, expected.length);
  for (let i = 0; i < expected.length; ++i) {
    assert_ModuleExportDescriptor(exports[i], expected[i]);
  }
}

test(() => {
  assert_throws_js(TypeError, () => WebAssembly.Module.exports());
}, "Missing arguments");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => WebAssembly.Module.exports(argument),
                     `exports(${format_value(argument)})`);
  }
}, "Non-Module arguments");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const fn = WebAssembly.Module.exports;
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const thisValue of thisValues) {
    assert_array_equals(fn.call(thisValue, module), []);
  }
}, "Branding");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const exports = WebAssembly.Module.exports(module);
  assert_true(Array.isArray(exports));
}, "Return type");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const exports = WebAssembly.Module.exports(module);
  assert_exports(exports, []);
}, "Empty module");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_not_equals(WebAssembly.Module.exports(module), WebAssembly.Module.exports(module));
}, "Empty module: array caching");

test(() => {
  const builder = new WasmModuleBuilder();

  builder
    .addFunction("fn", kSig_v_v)
    .addBody([])
    .exportFunc();
  builder
    .addFunction("fn2", kSig_v_v)
    .addBody([])
    .exportFunc();

  builder.setTableBounds(1);
  builder.addExportOfKind("table", kExternalTable, 0);

  builder.addGlobal(kWasmI32, true)
    .exportAs("global")
    .init = 7;
  builder.addGlobal(kWasmF64, true)
    .exportAs("global2")
    .init = 1.2;

  builder.addMemory(0, 256, true);

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const exports = WebAssembly.Module.exports(module);
  const expected = [
    { "kind": "function", "name": "fn" },
    { "kind": "function", "name": "fn2" },
    { "kind": "table", "name": "table" },
    { "kind": "global", "name": "global" },
    { "kind": "global", "name": "global2" },
    { "kind": "memory", "name": "memory" },
  ];
  assert_exports(exports, expected);
}, "exports");

test(() => {
  const builder = new WasmModuleBuilder();

  builder
    .addFunction("", kSig_v_v)
    .addBody([])
    .exportFunc();

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const exports = WebAssembly.Module.exports(module);
  const expected = [
    { "kind": "function", "name": "" },
  ];
  assert_exports(exports, expected);
}, "exports with empty name: function");

test(() => {
  const builder = new WasmModuleBuilder();

  builder.setTableBounds(1);
  builder.addExportOfKind("", kExternalTable, 0);

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const exports = WebAssembly.Module.exports(module);
  const expected = [
    { "kind": "table", "name": "" },
  ];
  assert_exports(exports, expected);
}, "exports with empty name: table");

test(() => {
  const builder = new WasmModuleBuilder();

  builder.addGlobal(kWasmI32, true)
    .exportAs("")
    .init = 7;

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const exports = WebAssembly.Module.exports(module);
  const expected = [
    { "kind": "global", "name": "" },
  ];
  assert_exports(exports, expected);
}, "exports with empty name: global");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const exports = WebAssembly.Module.exports(module, {});
  assert_exports(exports, []);
}, "Stray argument");
                                                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/jsapi/module/imports.any.js                                      0000664 0000000 0000000 00000013740 14746647661 0024407 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

function assert_ModuleImportDescriptor(import_, expected) {
  assert_equals(Object.getPrototypeOf(import_), Object.prototype, "Prototype");
  assert_true(Object.isExtensible(import_), "isExtensible");

  const module = Object.getOwnPropertyDescriptor(import_, "module");
  assert_true(module.writable, "module: writable");
  assert_true(module.enumerable, "module: enumerable");
  assert_true(module.configurable, "module: configurable");
  assert_equals(module.value, expected.module);

  const name = Object.getOwnPropertyDescriptor(import_, "name");
  assert_true(name.writable, "name: writable");
  assert_true(name.enumerable, "name: enumerable");
  assert_true(name.configurable, "name: configurable");
  assert_equals(name.value, expected.name);

  const kind = Object.getOwnPropertyDescriptor(import_, "kind");
  assert_true(kind.writable, "kind: writable");
  assert_true(kind.enumerable, "kind: enumerable");
  assert_true(kind.configurable, "kind: configurable");
  assert_equals(kind.value, expected.kind);
}

function assert_imports(imports, expected) {
  assert_true(Array.isArray(imports), "Should be array");
  assert_equals(Object.getPrototypeOf(imports), Array.prototype, "Prototype");
  assert_true(Object.isExtensible(imports), "isExtensible");

  assert_equals(imports.length, expected.length);
  for (let i = 0; i < expected.length; ++i) {
    assert_ModuleImportDescriptor(imports[i], expected[i]);
  }
}

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  assert_throws_js(TypeError, () => WebAssembly.Module.imports());
}, "Missing arguments");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => WebAssembly.Module.imports(argument),
                     `imports(${format_value(argument)})`);
  }
}, "Non-Module arguments");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const fn = WebAssembly.Module.imports;
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Module,
    WebAssembly.Module.prototype,
  ];
  for (const thisValue of thisValues) {
    assert_array_equals(fn.call(thisValue, module), []);
  }
}, "Branding");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const imports = WebAssembly.Module.imports(module);
  assert_true(Array.isArray(imports));
}, "Return type");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const imports = WebAssembly.Module.imports(module);
  assert_imports(imports, []);
}, "Empty module");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_not_equals(WebAssembly.Module.imports(module), WebAssembly.Module.imports(module));
}, "Empty module: array caching");

test(() => {
  const builder = new WasmModuleBuilder();

  builder.addImport("module", "fn", kSig_v_v);
  builder.addImportedGlobal("module", "global", kWasmI32);
  builder.addImportedMemory("module", "memory", 0, 128);
  builder.addImportedTable("module", "table", 0, 128);

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const imports = WebAssembly.Module.imports(module);
  const expected = [
    { "module": "module", "kind": "function", "name": "fn" },
    { "module": "module", "kind": "global", "name": "global" },
    { "module": "module", "kind": "memory", "name": "memory" },
    { "module": "module", "kind": "table", "name": "table" },
  ];
  assert_imports(imports, expected);
}, "imports");

test(() => {
  const builder = new WasmModuleBuilder();

  builder.addImport("", "fn", kSig_v_v);
  builder.addImportedGlobal("", "global", kWasmI32);
  builder.addImportedMemory("", "memory", 0, 128);
  builder.addImportedTable("", "table", 0, 128);

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const imports = WebAssembly.Module.imports(module);
  const expected = [
    { "module": "", "kind": "function", "name": "fn" },
    { "module": "", "kind": "global", "name": "global" },
    { "module": "", "kind": "memory", "name": "memory" },
    { "module": "", "kind": "table", "name": "table" },
  ];
  assert_imports(imports, expected);
}, "imports with empty module name");

test(() => {
  const builder = new WasmModuleBuilder();

  builder.addImport("a", "", kSig_v_v);
  builder.addImportedGlobal("b", "", kWasmI32);
  builder.addImportedMemory("c", "", 0, 128);
  builder.addImportedTable("d", "", 0, 128);

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const imports = WebAssembly.Module.imports(module);
  const expected = [
    { "module": "a", "kind": "function", "name": "" },
    { "module": "b", "kind": "global", "name": "" },
    { "module": "c", "kind": "memory", "name": "" },
    { "module": "d", "kind": "table", "name": "" },
  ];
  assert_imports(imports, expected);
}, "imports with empty names");

test(() => {
  const builder = new WasmModuleBuilder();

  builder.addImport("", "", kSig_v_v);
  builder.addImportedGlobal("", "", kWasmI32);
  builder.addImportedMemory("", "", 0, 128);
  builder.addImportedTable("", "", 0, 128);

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const imports = WebAssembly.Module.imports(module);
  const expected = [
    { "module": "", "kind": "function", "name": "" },
    { "module": "", "kind": "global", "name": "" },
    { "module": "", "kind": "memory", "name": "" },
    { "module": "", "kind": "table", "name": "" },
  ];
  assert_imports(imports, expected);
}, "imports with empty module names and names");

test(() => {
  const module = new WebAssembly.Module(emptyModuleBinary);
  const imports = WebAssembly.Module.imports(module, {});
  assert_imports(imports, []);
}, "Stray argument");
                                node-23.7.0/test/fixtures/wpt/wasm/jsapi/module/toString.any.js                                     0000664 0000000 0000000 00000001512 14746647661 0024515 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js

test(() => {
  const emptyModuleBinary = new WasmModuleBuilder().toBuffer();
  const module = new WebAssembly.Module(emptyModuleBinary);
  assert_class_string(module, "WebAssembly.Module");
}, "Object.prototype.toString on an Module");

test(() => {
  assert_own_property(WebAssembly.Module.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(WebAssembly.Module.prototype, Symbol.toStringTag);
  assert_equals(propDesc.value, "WebAssembly.Module", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/jsapi/proto-from-ctor-realm.html                                 0000664 0000000 0000000 00000006715 14746647661 0025342 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>WebAssembly JS API: Default [[Prototype]] value is from NewTarget's Realm</title>
<link rel="help" href="https://webidl.spec.whatwg.org/#internally-create-a-new-object-implementing-the-interface">
<link rel="help" href="https://tc39.es/ecma262/#sec-nativeerror">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="wasm-module-builder.js"></script>
<body>
<iframe id="constructor-iframe" hidden></iframe>
<iframe id="new-target-iframe" hidden></iframe>
<iframe id="other-iframe" hidden></iframe>
<script>
"use strict";

const constructorRealm = document.querySelector("#constructor-iframe").contentWindow;
const newTargetRealm = document.querySelector("#new-target-iframe").contentWindow;
const otherRealm = document.querySelector("#other-iframe").contentWindow;

const emptyModuleBinary = new WasmModuleBuilder().toBuffer();
const interfaces = [
  ["Module", emptyModuleBinary],
  ["Instance", new WebAssembly.Module(emptyModuleBinary)],
  ["Memory", {initial: 0}],
  ["Table", {element: "anyfunc", initial: 0}],
  ["Global", {value: "i32"}],

  // See step 2 of https://tc39.es/ecma262/#sec-nativeerror
  ["CompileError"],
  ["LinkError"],
  ["RuntimeError"],
];

const primitives = [
  undefined,
  null,
  false,
  true,
  0,
  -1,
  "",
  "str",
  Symbol(),
];

const getNewTargets = function* (realm) {
  for (const primitive of primitives) {
    const newTarget = new realm.Function();
    newTarget.prototype = primitive;
    yield [newTarget, "cross-realm NewTarget with `" + format_value(primitive) + "` prototype"];
  }

  // GetFunctionRealm (https://tc39.es/ecma262/#sec-getfunctionrealm) coverage:
  const bindOther = otherRealm.Function.prototype.bind;
  const ProxyOther = otherRealm.Proxy;

  const bound = new realm.Function();
  bound.prototype = undefined;
  yield [bindOther.call(bound), "bound cross-realm NewTarget with `undefined` prototype"];

  const boundBound = new realm.Function();
  boundBound.prototype = null;
  yield [bindOther.call(bindOther.call(boundBound)), "bound bound cross-realm NewTarget with `null` prototype"];

  const boundProxy = new realm.Function();
  boundProxy.prototype = false;
  yield [bindOther.call(new ProxyOther(boundProxy, {})), "bound Proxy of cross-realm NewTarget with `false` prototype"];

  const proxy = new realm.Function();
  proxy.prototype = true;
  yield [new ProxyOther(proxy, {}), "Proxy of cross-realm NewTarget with `true` prototype"];

  const proxyProxy = new realm.Function();
  proxyProxy.prototype = -0;
  yield [new ProxyOther(new ProxyOther(proxyProxy, {}), {}), "Proxy of Proxy of cross-realm NewTarget with `-0` prototype"];

  const proxyBound = new realm.Function();
  proxyBound.prototype = NaN;
  yield [new ProxyOther(bindOther.call(proxyBound), {}), "Proxy of bound cross-realm NewTarget with `NaN` prototype"];
};

for (const [interfaceName, constructorArg] of interfaces) {
  for (const [newTarget, testDescription] of getNewTargets(newTargetRealm)) {
    test(() => {
      const Constructor = constructorRealm.WebAssembly[interfaceName];
      const object = Reflect.construct(Constructor, [constructorArg], newTarget);

      const NewTargetConstructor = newTargetRealm.WebAssembly[interfaceName];
      assert_true(object instanceof NewTargetConstructor);
      assert_equals(Object.getPrototypeOf(object), NewTargetConstructor.prototype);
    }, `WebAssembly.${interfaceName}: ${testDescription}`);
  }
}
</script>
</body>
                                                   node-23.7.0/test/fixtures/wpt/wasm/jsapi/prototypes.any.js                                          0000664 0000000 0000000 00000003333 14746647661 0023652 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/wasm-module-builder.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

test(() => {
  class _Module extends WebAssembly.Module {}
  let module = new _Module(emptyModuleBinary);
  assert_true(module instanceof _Module, "_Module instanceof _Module");
  assert_true(module instanceof WebAssembly.Module, "_Module instanceof WebAssembly.Module");
}, "_Module");

test(() => {
  class _Instance extends WebAssembly.Instance {}
  let instance = new _Instance(new WebAssembly.Module(emptyModuleBinary));
  assert_true(instance instanceof _Instance, "_Instance instanceof _Instance");
  assert_true(instance instanceof WebAssembly.Instance, "_Instance instanceof WebAssembly.Instance");
}, "_Instance");

test(() => {
  class _Memory extends WebAssembly.Memory {}
  let memory = new _Memory({initial: 0, maximum: 1});
  assert_true(memory instanceof _Memory, "_Memory instanceof _Memory");
  assert_true(memory instanceof WebAssembly.Memory, "_Memory instanceof WebAssembly.Memory");
}, "_Memory");

test(() => {
  class _Table extends WebAssembly.Table {}
  let table = new _Table({initial: 0, element: "anyfunc"});
  assert_true(table instanceof _Table, "_Table instanceof _Table");
  assert_true(table instanceof WebAssembly.Table, "_Table instanceof WebAssembly.Table");
}, "_Table");

test(() => {
  class _Global extends WebAssembly.Global {}
  let global = new _Global({value: "i32", mutable: false}, 0);
  assert_true(global instanceof _Global, "_Global instanceof _Global");
  assert_true(global instanceof WebAssembly.Global, "_Global instanceof WebAssembly.Global");
}, "_Global");
                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/                                                     0000775 0000000 0000000 00000000000 14746647661 0021363 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/assertions.js                                        0000664 0000000 0000000 00000002251 14746647661 0024113 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function assert_equal_to_array(table, expected, message) {
  assert_equals(table.length, expected.length, `${message}: length`);
  // The argument check in get() happens before the range check, and negative numbers
  // are illegal, hence will throw TypeError per spec.
  assert_throws_js(TypeError, () => table.get(-1), `${message}: table.get(-1)`);
  for (let i = 0; i < expected.length; ++i) {
    assert_equals(table.get(i), expected[i], `${message}: table.get(${i} of ${expected.length})`);
  }
  assert_throws_js(RangeError, () => table.get(expected.length),
                   `${message}: table.get(${expected.length} of ${expected.length})`);
  assert_throws_js(RangeError, () => table.get(expected.length + 1),
                   `${message}: table.get(${expected.length + 1} of ${expected.length})`);
}

function assert_Table(actual, expected) {
  assert_equals(Object.getPrototypeOf(actual), WebAssembly.Table.prototype,
                "prototype");
  assert_true(Object.isExtensible(actual), "extensible");

  assert_equals(actual.length, expected.length, "length");
  for (let i = 0; i < expected.length; ++i) {
    assert_equals(actual.get(i), null, `actual.get(${i})`);
  }
}
                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/constructor-types.tentative.any.js                   0000664 0000000 0000000 00000001307 14746647661 0030241 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/table/assertions.js

test(() => {
  const argument = { "element": "anyfunc", "initial": 0, "minimum": 0 };
  assert_throws_js(TypeError, () => new WebAssembly.Table(argument));
}, "Initializing with both initial and minimum");

test(() => {
  const argument = { "element": "anyfunc", "minimum": 0 };
  const table = new WebAssembly.Table(argument);
  assert_Table(table, { "length": 0 });
}, "Zero minimum");

test(() => {
  const argument = { "element": "anyfunc", "minimum": 5 };
  const table = new WebAssembly.Table(argument);
  assert_Table(table, { "length": 5 });
}, "Non-zero minimum");                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/constructor.any.js                                   0000664 0000000 0000000 00000013136 14746647661 0025100 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/table/assertions.js

test(() => {
  assert_function_name(WebAssembly.Table, "Table", "WebAssembly.Table");
}, "name");

test(() => {
  assert_function_length(WebAssembly.Table, 1, "WebAssembly.Table");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Table());
}, "No arguments");

test(() => {
  const argument = { "element": "anyfunc", "initial": 0 };
  assert_throws_js(TypeError, () => WebAssembly.Table(argument));
}, "Calling");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Table({}));
}, "Empty descriptor");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    false,
    true,
    "",
    "test",
    Symbol(),
    1,
    NaN,
    {},
  ];
  for (const invalidArgument of invalidArguments) {
    assert_throws_js(TypeError,
                     () => new WebAssembly.Table(invalidArgument),
                     `new Table(${format_value(invalidArgument)})`);
  }
}, "Invalid descriptor argument");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Table({ "element": "anyfunc", "initial": undefined }));
}, "Undefined initial value in descriptor");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Table({ "element": undefined, "initial": 0 }));
}, "Undefined element value in descriptor");

const outOfRangeValues = [
  NaN,
  Infinity,
  -Infinity,
  -1,
  0x100000000,
  0x1000000000,
];

for (const value of outOfRangeValues) {
  test(() => {
    assert_throws_js(TypeError, () => new WebAssembly.Table({ "element": "anyfunc", "initial": value }));
  }, `Out-of-range initial value in descriptor: ${format_value(value)}`);

  test(() => {
    assert_throws_js(TypeError, () => new WebAssembly.Table({ "element": "anyfunc", "initial": 0, "maximum": value }));
  }, `Out-of-range maximum value in descriptor: ${format_value(value)}`);
}

test(() => {
  assert_throws_js(RangeError, () => new WebAssembly.Table({ "element": "anyfunc", "initial": 10, "maximum": 9 }));
}, "Initial value exceeds maximum");

test(() => {
  const argument = { "element": "anyfunc", "initial": 0 };
  const table = new WebAssembly.Table(argument);
  assert_Table(table, { "length": 0 });
}, "Basic (zero)");

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_Table(table, { "length": 5 });
}, "Basic (non-zero)");

test(() => {
  const argument = { "element": "anyfunc", "initial": 0 };
  const table = new WebAssembly.Table(argument, null, {});
  assert_Table(table, { "length": 0 });
}, "Stray argument");

test(() => {
  const proxy = new Proxy({}, {
    has(o, x) {
      assert_unreached(`Should not call [[HasProperty]] with ${x}`);
    },
    get(o, x) {
      switch (x) {
      case "element":
        return "anyfunc";
      case "initial":
      case "maximum":
        return 0;
      default:
        return undefined;
      }
    },
  });
  const table = new WebAssembly.Table(proxy);
  assert_Table(table, { "length": 0 });
}, "Proxy descriptor");

test(() => {
  const table = new WebAssembly.Table({
    "element": {
      toString() { return "anyfunc"; },
    },
    "initial": 1,
  });
  assert_Table(table, { "length": 1 });
}, "Type conversion for descriptor.element");

test(() => {
  const order = [];

  new WebAssembly.Table({
    get maximum() {
      order.push("maximum");
      return {
        valueOf() {
          order.push("maximum valueOf");
          return 1;
        },
      };
    },

    get initial() {
      order.push("initial");
      return {
        valueOf() {
          order.push("initial valueOf");
          return 1;
        },
      };
    },

    get element() {
      order.push("element");
      return {
        toString() {
          order.push("element toString");
          return "anyfunc";
        },
      };
    },
  });

  assert_array_equals(order, [
    "element",
    "element toString",
    "initial",
    "initial valueOf",
    "maximum",
    "maximum valueOf",
  ]);
}, "Order of evaluation for descriptor");

test(() => {
  const testObject = {};
  const argument = { "element": "externref", "initial": 3 };
  const table = new WebAssembly.Table(argument, testObject);
  assert_equals(table.length, 3);
  assert_equals(table.get(0), testObject);
  assert_equals(table.get(1), testObject);
  assert_equals(table.get(2), testObject);
}, "initialize externref table with default value");

test(() => {
  const argument = { "element": "i32", "initial": 3 };
  assert_throws_js(TypeError, () => new WebAssembly.Table(argument));
}, "initialize table with a wrong element value");

test(() => {
  const builder = new WasmModuleBuilder();
  builder
    .addFunction("fn", kSig_v_v)
    .addBody([])
    .exportFunc();
  const bin = builder.toBuffer();
  const fn = new WebAssembly.Instance(new WebAssembly.Module(bin)).exports.fn;
  const argument = { "element": "anyfunc", "initial": 3 };
  const table = new WebAssembly.Table(argument, fn);
  assert_equals(table.length, 3);
  assert_equals(table.get(0), fn);
  assert_equals(table.get(1), fn);
  assert_equals(table.get(2), fn);
}, "initialize anyfunc table with default value");

test(() => {
  const argument = { "element": "anyfunc", "initial": 3 };
  assert_throws_js(TypeError, () => new WebAssembly.Table(argument, {}));
  assert_throws_js(TypeError, () => new WebAssembly.Table(argument, "cannot be used as a wasm function"));
  assert_throws_js(TypeError, () => new WebAssembly.Table(argument, 37));
}, "initialize anyfunc table with a bad default value");
                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/get-set.any.js                                       0000664 0000000 0000000 00000015710 14746647661 0024063 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=assertions.js

let functions = {};
setup(() => {
  const builder = new WasmModuleBuilder();

  builder
    .addFunction("fn", kSig_v_d)
    .addBody([])
    .exportFunc();
  builder
    .addFunction("fn2", kSig_v_v)
    .addBody([])
    .exportFunc();

  const buffer = builder.toBuffer()
  const module = new WebAssembly.Module(buffer);
  const instance = new WebAssembly.Instance(module, {});
  functions = instance.exports;
});

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_throws_js(TypeError, () => table.get());
}, "Missing arguments: get");

test(t => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Table,
    WebAssembly.Table.prototype,
  ];

  const argument = {
    valueOf: t.unreached_func("Should not touch the argument (valueOf)"),
    toString: t.unreached_func("Should not touch the argument (toString)"),
  };

  const fn = WebAssembly.Table.prototype.get;

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => fn.call(thisValue, argument), `this=${format_value(thisValue)}`);
  }
}, "Branding: get");

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_throws_js(TypeError, () => table.set());
}, "Missing arguments: set");

test(t => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Table,
    WebAssembly.Table.prototype,
  ];

  const argument = {
    valueOf: t.unreached_func("Should not touch the argument (valueOf)"),
    toString: t.unreached_func("Should not touch the argument (toString)"),
  };

  const fn = WebAssembly.Table.prototype.set;

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => fn.call(thisValue, argument, null), `this=${format_value(thisValue)}`);
  }
}, "Branding: set");

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, [null, null, null, null, null]);

  const {fn, fn2} = functions;

  assert_equals(table.set(0, fn), undefined, "set() returns undefined.");
  table.set(2, fn2);
  table.set(4, fn);

  assert_equal_to_array(table, [fn, null, fn2, null, fn]);

  table.set(0, null);
  assert_equal_to_array(table, [null, null, fn2, null, fn]);
}, "Basic");

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, [null, null, null, null, null]);

  const {fn, fn2} = functions;

  table.set(0, fn);
  table.set(2, fn2);
  table.set(4, fn);

  assert_equal_to_array(table, [fn, null, fn2, null, fn]);

  table.grow(4);

  assert_equal_to_array(table, [fn, null, fn2, null, fn, null, null, null, null]);
}, "Growing");

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, [null, null, null, null, null]);

  const {fn} = functions;

  // -1 is the wrong type hence the type check on entry gets this
  // before the range check does.
  assert_throws_js(TypeError, () => table.set(-1, fn));
  assert_throws_js(RangeError, () => table.set(5, fn));
  assert_equal_to_array(table, [null, null, null, null, null]);
}, "Setting out-of-bounds");

test(() => {
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, [null]);

  const invalidArguments = [
    undefined,
    true,
    false,
    "test",
    Symbol(),
    7,
    NaN,
    {},
  ];
  for (const argument of invalidArguments) {
    assert_throws_js(TypeError, () => table.set(0, argument),
                     `set(${format_value(argument)})`);
  }
  assert_equal_to_array(table, [null]);
}, "Setting non-function");

test(() => {
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, [null]);

  const fn = function() {};
  assert_throws_js(TypeError, () => table.set(0, fn));
  assert_equal_to_array(table, [null]);
}, "Setting non-wasm function");

test(() => {
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, [null]);

  const fn = () => {};
  assert_throws_js(TypeError, () => table.set(0, fn));
  assert_equal_to_array(table, [null]);
}, "Setting non-wasm arrow function");

const outOfRangeValues = [
  undefined,
  NaN,
  Infinity,
  -Infinity,
  -1,
  0x100000000,
  0x1000000000,
  "0x100000000",
  { valueOf() { return 0x100000000; } },
];

for (const value of outOfRangeValues) {
  test(() => {
    const argument = { "element": "anyfunc", "initial": 1 };
    const table = new WebAssembly.Table(argument);
    assert_throws_js(TypeError, () => table.get(value));
  }, `Getting out-of-range argument: ${format_value(value)}`);

  test(() => {
    const argument = { "element": "anyfunc", "initial": 1 };
    const table = new WebAssembly.Table(argument);
    assert_throws_js(TypeError, () => table.set(value, null));
  }, `Setting out-of-range argument: ${format_value(value)}`);
}

test(() => {
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  let called = 0;
  const value = {
    valueOf() {
      called++;
      return 0;
    },
  };
  assert_throws_js(TypeError, () => table.set(value, {}));
  assert_equals(called, 1);
}, "Order of argument conversion");

test(() => {
  const {fn} = functions;
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);

  assert_equals(table.get(0, {}), null);
  assert_equals(table.set(0, fn, {}), undefined);
}, "Stray argument");

test(() => {
  const builder = new WasmModuleBuilder();
  builder
    .addFunction("fn", kSig_v_v)
    .addBody([])
    .exportFunc();
  const bin = builder.toBuffer();
  const fn = new WebAssembly.Instance(new WebAssembly.Module(bin)).exports.fn;

  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument, fn);

  assert_equals(table.get(0), fn);
  table.set(0);
  assert_equals(table.get(0), null);

  table.set(0, fn);
  assert_equals(table.get(0), fn);

  assert_throws_js(TypeError, () => table.set(0, {}));
  assert_throws_js(TypeError, () => table.set(0, 37));
}, "Arguments for anyfunc table set");

test(() => {
  const testObject = {};
  const argument = { "element": "externref", "initial": 1 };
  const table = new WebAssembly.Table(argument, testObject);

  assert_equals(table.get(0), testObject);
  table.set(0);
  assert_equals(table.get(0), undefined);

  table.set(0, testObject);
  assert_equals(table.get(0), testObject);

  table.set(0, 37);
  assert_equals(table.get(0), 37);
}, "Arguments for externref table set");
                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/grow.any.js                                          0000664 0000000 0000000 00000007115 14746647661 0023471 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=assertions.js

function nulls(n) {
  return Array(n).fill(null);
}

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_throws_js(TypeError, () => table.grow());
}, "Missing arguments");

test(t => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Table,
    WebAssembly.Table.prototype,
  ];

  const argument = {
    valueOf: t.unreached_func("Should not touch the argument (valueOf)"),
    toString: t.unreached_func("Should not touch the argument (toString)"),
  };

  const fn = WebAssembly.Table.prototype.grow;

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => fn.call(thisValue, argument), `this=${format_value(thisValue)}`);
  }
}, "Branding");

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, nulls(5), "before");

  const result = table.grow(3);
  assert_equals(result, 5);
  assert_equal_to_array(table, nulls(8), "after");
}, "Basic");

test(() => {
  const argument = { "element": "anyfunc", "initial": 3, "maximum": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, nulls(3), "before");

  const result = table.grow(2);
  assert_equals(result, 3);
  assert_equal_to_array(table, nulls(5), "after");
}, "Reached maximum");

test(() => {
  const argument = { "element": "anyfunc", "initial": 2, "maximum": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, nulls(2), "before");

  assert_throws_js(RangeError, () => table.grow(4));
  assert_equal_to_array(table, nulls(2), "after");
}, "Exceeded maximum");

const outOfRangeValues = [
  undefined,
  NaN,
  Infinity,
  -Infinity,
  -1,
  0x100000000,
  0x1000000000,
  "0x100000000",
  { valueOf() { return 0x100000000; } },
];

for (const value of outOfRangeValues) {
  test(() => {
    const argument = { "element": "anyfunc", "initial": 1 };
    const table = new WebAssembly.Table(argument);
    assert_throws_js(TypeError, () => table.grow(value));
  }, `Out-of-range argument: ${format_value(value)}`);
}

test(() => {
  const argument = { "element": "anyfunc", "initial": 5 };
  const table = new WebAssembly.Table(argument);
  assert_equal_to_array(table, nulls(5), "before");

  const result = table.grow(3, null, {});
  assert_equals(result, 5);
  assert_equal_to_array(table, nulls(8), "after");
}, "Stray argument");

test(() => {
  const builder = new WasmModuleBuilder();
  builder
    .addFunction("fn", kSig_v_v)
    .addBody([])
    .exportFunc();
  const bin = builder.toBuffer()
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  const fn = new WebAssembly.Instance(new WebAssembly.Module(bin)).exports.fn;
  const result = table.grow(2, fn);
  assert_equals(result, 1);
  assert_equals(table.get(0), null);
  assert_equals(table.get(1), fn);
  assert_equals(table.get(2), fn);
}, "Grow with exported-function argument");

test(() => {
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  assert_throws_js(TypeError, () => table.grow(2, {}));
}, "Grow with non-function argument");

test(() => {
  const argument = { "element": "anyfunc", "initial": 1 };
  const table = new WebAssembly.Table(argument);
  assert_throws_js(TypeError, () => table.grow(2, () => true));
}, "Grow with JS-function argument");
                                                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/length.any.js                                        0000664 0000000 0000000 00000003253 14746647661 0023773 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const thisValues = [
    undefined,
    null,
    true,
    "",
    Symbol(),
    1,
    {},
    WebAssembly.Table,
    WebAssembly.Table.prototype,
  ];

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Table.prototype, "length");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  assert_equals(typeof desc.set, "undefined");

  for (const thisValue of thisValues) {
    assert_throws_js(TypeError, () => getter.call(thisValue), `this=${format_value(thisValue)}`);
  }
}, "Branding");

test(() => {
  const argument = { "element": "anyfunc", "initial": 2 };
  const table = new WebAssembly.Table(argument);
  assert_equals(table.length, 2, "Initial length");

  const desc = Object.getOwnPropertyDescriptor(WebAssembly.Table.prototype, "length");
  assert_equals(typeof desc, "object");

  const getter = desc.get;
  assert_equals(typeof getter, "function");

  assert_equals(getter.call(table, {}), 2);
}, "Stray argument");

test(() => {
  const argument = { "element": "anyfunc", "initial": 2 };
  const table = new WebAssembly.Table(argument);
  assert_equals(table.length, 2, "Initial length");
  table.length = 4;
  assert_equals(table.length, 2, "Should not change the length");
}, "Setting (sloppy mode)");

test(() => {
  const argument = { "element": "anyfunc", "initial": 2 };
  const table = new WebAssembly.Table(argument);
  assert_equals(table.length, 2, "Initial length");
  assert_throws_js(TypeError, () => {
    "use strict";
    table.length = 4;
  });
  assert_equals(table.length, 2, "Should not change the length");
}, "Setting (strict mode)");
                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/toString.any.js                                      0000664 0000000 0000000 00000001401 14746647661 0024314 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const argument = { "element": "anyfunc", "initial": 0 };
  const table = new WebAssembly.Table(argument);
  assert_class_string(table, "WebAssembly.Table");
}, "Object.prototype.toString on an Table");

test(() => {
  assert_own_property(WebAssembly.Table.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(WebAssembly.Table.prototype, Symbol.toStringTag);
  assert_equals(propDesc.value, "WebAssembly.Table", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/jsapi/table/type.tentative.any.js                                0000664 0000000 0000000 00000001446 14746647661 0025477 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function assert_type(argument) {
    const mytable = new WebAssembly.Table(argument);
    const tabletype = mytable.type()
    assert_equals(tabletype.minimum, argument.minimum);
    assert_equals(tabletype.maximum, argument.maximum);
    assert_equals(tabletype.element, argument.element);
}

test(() => {
    assert_type({ "minimum": 0, "element": "funcref"});
}, "Zero initial, no maximum");

test(() => {
    assert_type({ "minimum": 5, "element": "funcref" });
}, "Non-zero initial, no maximum");

test(() => {
    assert_type({ "minimum": 0, "maximum": 0, "element": "funcref" });
}, "Zero maximum");

test(() => {
    assert_type({ "minimum": 0, "maximum": 5, "element": "funcref" });
}, "Non-zero maximum");
                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/wasm/jsapi/tag/                                                       0000775 0000000 0000000 00000000000 14746647661 0021047 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/tag/constructor.tentative.any.js                           0000664 0000000 0000000 00000002222 14746647661 0026560 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

test(() => {
  assert_function_name(WebAssembly.Tag, "Tag", "WebAssembly.Tag");
}, "name");

test(() => {
  assert_function_length(WebAssembly.Tag, 1, "WebAssembly.Tag");
}, "length");

test(() => {
  assert_throws_js(TypeError, () => new WebAssembly.Tag());
}, "No arguments");

test(() => {
  const argument = { parameters: [] };
  assert_throws_js(TypeError, () => WebAssembly.Tag(argument));
}, "Calling");

test(() => {
  const invalidArguments = [
    undefined,
    null,
    false,
    true,
    "",
    "test",
    Symbol(),
    1,
    NaN,
    {},
  ];
  for (const invalidArgument of invalidArguments) {
    assert_throws_js(
      TypeError,
      () => new WebAssembly.Tag(invalidArgument),
      `new Tag(${format_value(invalidArgument)})`
    );
  }
}, "Invalid descriptor argument");

test(() => {
  const invalidTypes = ["i16", "i128", "f16", "f128", "u32", "u64", "i32\0"];
  for (const value of invalidTypes) {
    const argument = { parameters: [value] };
    assert_throws_js(TypeError, () => new WebAssembly.Tag(argument));
  }
}, "Invalid type parameter");
                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/jsapi/tag/toString.tentative.any.js                              0000664 0000000 0000000 00000001350 14746647661 0026005 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell

test(() => {
  const argument = { parameters: [] };
  const tag = new WebAssembly.Tag(argument);
  assert_class_string(tag, "WebAssembly.Tag");
}, "Object.prototype.toString on a Tag");

test(() => {
  assert_own_property(WebAssembly.Tag.prototype, Symbol.toStringTag);

  const propDesc = Object.getOwnPropertyDescriptor(
    WebAssembly.Tag.prototype,
    Symbol.toStringTag
  );
  assert_equals(propDesc.value, "WebAssembly.Tag", "value");
  assert_equals(propDesc.configurable, true, "configurable");
  assert_equals(propDesc.enumerable, false, "enumerable");
  assert_equals(propDesc.writable, false, "writable");
}, "@@toStringTag exists on the prototype with the appropriate descriptor");
                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/jsapi/tag/type.tentative.any.js                                  0000664 0000000 0000000 00000000766 14746647661 0025167 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,dedicatedworker,jsshell
// META: script=/wasm/jsapi/assertions.js

function assert_type(argument) {
  const tag = new WebAssembly.Tag(argument);
  const tagtype = tag.type();

  assert_array_equals(tagtype.parameters, argument.parameters);
}

test(() => {
  assert_type({ parameters: [] });
}, "[]");

test(() => {
  assert_type({ parameters: ["i32", "i64"] });
}, "[i32 i64]");

test(() => {
  assert_type({ parameters: ["i32", "i64", "f32", "f64"] });
}, "[i32 i64 f32 f64]");
          node-23.7.0/test/fixtures/wpt/wasm/jsapi/wasm-module-builder.js                                     0000664 0000000 0000000 00000116501 14746647661 0024514 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // Copyright 2016 the V8 project authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

// Used for encoding f32 and double constants to bits.
let byte_view = new Uint8Array(8);
let data_view = new DataView(byte_view.buffer);

// The bytes function receives one of
//  - several arguments, each of which is either a number or a string of length
//    1; if it's a string, the charcode of the contained character is used.
//  - a single array argument containing the actual arguments
//  - a single string; the returned buffer will contain the char codes of all
//    contained characters.
function bytes(...input) {
  if (input.length == 1 && typeof input[0] == 'array') input = input[0];
  if (input.length == 1 && typeof input[0] == 'string') {
    let len = input[0].length;
    let view = new Uint8Array(len);
    for (let i = 0; i < len; i++) view[i] = input[0].charCodeAt(i);
    return view.buffer;
  }
  let view = new Uint8Array(input.length);
  for (let i = 0; i < input.length; i++) {
    let val = input[i];
    if (typeof val == 'string') {
      assertEquals(1, val.length, 'string inputs must have length 1');
      val = val.charCodeAt(0);
    }
    view[i] = val | 0;
  }
  return view.buffer;
}

// Header declaration constants
var kWasmH0 = 0;
var kWasmH1 = 0x61;
var kWasmH2 = 0x73;
var kWasmH3 = 0x6d;

var kWasmV0 = 0x1;
var kWasmV1 = 0;
var kWasmV2 = 0;
var kWasmV3 = 0;

var kHeaderSize = 8;
var kPageSize = 65536;
var kSpecMaxPages = 65535;
var kMaxVarInt32Size = 5;
var kMaxVarInt64Size = 10;

let kDeclNoLocals = 0;

// Section declaration constants
let kUnknownSectionCode = 0;
let kTypeSectionCode = 1;        // Function signature declarations
let kImportSectionCode = 2;      // Import declarations
let kFunctionSectionCode = 3;    // Function declarations
let kTableSectionCode = 4;       // Indirect function table and other tables
let kMemorySectionCode = 5;      // Memory attributes
let kGlobalSectionCode = 6;      // Global declarations
let kExportSectionCode = 7;      // Exports
let kStartSectionCode = 8;       // Start function declaration
let kElementSectionCode = 9;     // Elements section
let kCodeSectionCode = 10;       // Function code
let kDataSectionCode = 11;       // Data segments
let kDataCountSectionCode = 12;  // Data segment count (between Element & Code)
let kTagSectionCode = 13;        // Tag section (between Memory & Global)

// Name section types
let kModuleNameCode = 0;
let kFunctionNamesCode = 1;
let kLocalNamesCode = 2;

let kWasmFunctionTypeForm = 0x60;
let kWasmAnyFunctionTypeForm = 0x70;

let kHasMaximumFlag = 1;
let kSharedHasMaximumFlag = 3;

// Segment flags
let kActiveNoIndex = 0;
let kPassive = 1;
let kActiveWithIndex = 2;
let kPassiveWithElements = 5;

// Function declaration flags
let kDeclFunctionName   = 0x01;
let kDeclFunctionImport = 0x02;
let kDeclFunctionLocals = 0x04;
let kDeclFunctionExport = 0x08;

// Local types
let kWasmStmt = 0x40;
let kWasmI32 = 0x7f;
let kWasmI64 = 0x7e;
let kWasmF32 = 0x7d;
let kWasmF64 = 0x7c;
let kWasmS128 = 0x7b;
let kWasmAnyRef = 0x6f;
let kWasmAnyFunc = 0x70;

let kExternalFunction = 0;
let kExternalTable = 1;
let kExternalMemory = 2;
let kExternalGlobal = 3;
let kExternalTag = 4;

let kTableZero = 0;
let kMemoryZero = 0;
let kSegmentZero = 0;

let kTagAttribute = 0;

// Useful signatures
let kSig_i_i = makeSig([kWasmI32], [kWasmI32]);
let kSig_l_l = makeSig([kWasmI64], [kWasmI64]);
let kSig_i_l = makeSig([kWasmI64], [kWasmI32]);
let kSig_i_ii = makeSig([kWasmI32, kWasmI32], [kWasmI32]);
let kSig_i_iii = makeSig([kWasmI32, kWasmI32, kWasmI32], [kWasmI32]);
let kSig_v_iiii = makeSig([kWasmI32, kWasmI32, kWasmI32, kWasmI32], []);
let kSig_f_ff = makeSig([kWasmF32, kWasmF32], [kWasmF32]);
let kSig_d_dd = makeSig([kWasmF64, kWasmF64], [kWasmF64]);
let kSig_l_ll = makeSig([kWasmI64, kWasmI64], [kWasmI64]);
let kSig_i_dd = makeSig([kWasmF64, kWasmF64], [kWasmI32]);
let kSig_v_v = makeSig([], []);
let kSig_i_v = makeSig([], [kWasmI32]);
let kSig_l_v = makeSig([], [kWasmI64]);
let kSig_f_v = makeSig([], [kWasmF32]);
let kSig_d_v = makeSig([], [kWasmF64]);
let kSig_v_i = makeSig([kWasmI32], []);
let kSig_v_ii = makeSig([kWasmI32, kWasmI32], []);
let kSig_v_iii = makeSig([kWasmI32, kWasmI32, kWasmI32], []);
let kSig_v_l = makeSig([kWasmI64], []);
let kSig_v_d = makeSig([kWasmF64], []);
let kSig_v_dd = makeSig([kWasmF64, kWasmF64], []);
let kSig_v_ddi = makeSig([kWasmF64, kWasmF64, kWasmI32], []);
let kSig_ii_v = makeSig([], [kWasmI32, kWasmI32]);
let kSig_iii_v = makeSig([], [kWasmI32, kWasmI32, kWasmI32]);
let kSig_ii_i = makeSig([kWasmI32], [kWasmI32, kWasmI32]);
let kSig_iii_i = makeSig([kWasmI32], [kWasmI32, kWasmI32, kWasmI32]);
let kSig_ii_ii = makeSig([kWasmI32, kWasmI32], [kWasmI32, kWasmI32]);
let kSig_iii_ii = makeSig([kWasmI32, kWasmI32], [kWasmI32, kWasmI32, kWasmI32]);

let kSig_v_f = makeSig([kWasmF32], []);
let kSig_f_f = makeSig([kWasmF32], [kWasmF32]);
let kSig_f_d = makeSig([kWasmF64], [kWasmF32]);
let kSig_d_d = makeSig([kWasmF64], [kWasmF64]);
let kSig_r_r = makeSig([kWasmAnyRef], [kWasmAnyRef]);
let kSig_a_a = makeSig([kWasmAnyFunc], [kWasmAnyFunc]);
let kSig_i_r = makeSig([kWasmAnyRef], [kWasmI32]);
let kSig_v_r = makeSig([kWasmAnyRef], []);
let kSig_v_a = makeSig([kWasmAnyFunc], []);
let kSig_v_rr = makeSig([kWasmAnyRef, kWasmAnyRef], []);
let kSig_v_aa = makeSig([kWasmAnyFunc, kWasmAnyFunc], []);
let kSig_r_v = makeSig([], [kWasmAnyRef]);
let kSig_a_v = makeSig([], [kWasmAnyFunc]);
let kSig_a_i = makeSig([kWasmI32], [kWasmAnyFunc]);

function makeSig(params, results) {
  return {params: params, results: results};
}

function makeSig_v_x(x) {
  return makeSig([x], []);
}

function makeSig_v_xx(x) {
  return makeSig([x, x], []);
}

function makeSig_r_v(r) {
  return makeSig([], [r]);
}

function makeSig_r_x(r, x) {
  return makeSig([x], [r]);
}

function makeSig_r_xx(r, x) {
  return makeSig([x, x], [r]);
}

// Opcodes
let kExprUnreachable = 0x00;
let kExprNop = 0x01;
let kExprBlock = 0x02;
let kExprLoop = 0x03;
let kExprIf = 0x04;
let kExprElse = 0x05;
let kExprTry = 0x06;
let kExprCatch = 0x07;
let kExprCatchAll = 0x19;
let kExprThrow = 0x08;
let kExprRethrow = 0x09;
let kExprBrOnExn = 0x0a;
let kExprEnd = 0x0b;
let kExprBr = 0x0c;
let kExprBrIf = 0x0d;
let kExprBrTable = 0x0e;
let kExprReturn = 0x0f;
let kExprCallFunction = 0x10;
let kExprCallIndirect = 0x11;
let kExprReturnCall = 0x12;
let kExprReturnCallIndirect = 0x13;
let kExprDrop = 0x1a;
let kExprSelect = 0x1b;
let kExprLocalGet = 0x20;
let kExprLocalSet = 0x21;
let kExprLocalTee = 0x22;
let kExprGlobalGet = 0x23;
let kExprGlobalSet = 0x24;
let kExprTableGet = 0x25;
let kExprTableSet = 0x26;
let kExprI32LoadMem = 0x28;
let kExprI64LoadMem = 0x29;
let kExprF32LoadMem = 0x2a;
let kExprF64LoadMem = 0x2b;
let kExprI32LoadMem8S = 0x2c;
let kExprI32LoadMem8U = 0x2d;
let kExprI32LoadMem16S = 0x2e;
let kExprI32LoadMem16U = 0x2f;
let kExprI64LoadMem8S = 0x30;
let kExprI64LoadMem8U = 0x31;
let kExprI64LoadMem16S = 0x32;
let kExprI64LoadMem16U = 0x33;
let kExprI64LoadMem32S = 0x34;
let kExprI64LoadMem32U = 0x35;
let kExprI32StoreMem = 0x36;
let kExprI64StoreMem = 0x37;
let kExprF32StoreMem = 0x38;
let kExprF64StoreMem = 0x39;
let kExprI32StoreMem8 = 0x3a;
let kExprI32StoreMem16 = 0x3b;
let kExprI64StoreMem8 = 0x3c;
let kExprI64StoreMem16 = 0x3d;
let kExprI64StoreMem32 = 0x3e;
let kExprMemorySize = 0x3f;
let kExprMemoryGrow = 0x40;
let kExprI32Const = 0x41;
let kExprI64Const = 0x42;
let kExprF32Const = 0x43;
let kExprF64Const = 0x44;
let kExprI32Eqz = 0x45;
let kExprI32Eq = 0x46;
let kExprI32Ne = 0x47;
let kExprI32LtS = 0x48;
let kExprI32LtU = 0x49;
let kExprI32GtS = 0x4a;
let kExprI32GtU = 0x4b;
let kExprI32LeS = 0x4c;
let kExprI32LeU = 0x4d;
let kExprI32GeS = 0x4e;
let kExprI32GeU = 0x4f;
let kExprI64Eqz = 0x50;
let kExprI64Eq = 0x51;
let kExprI64Ne = 0x52;
let kExprI64LtS = 0x53;
let kExprI64LtU = 0x54;
let kExprI64GtS = 0x55;
let kExprI64GtU = 0x56;
let kExprI64LeS = 0x57;
let kExprI64LeU = 0x58;
let kExprI64GeS = 0x59;
let kExprI64GeU = 0x5a;
let kExprF32Eq = 0x5b;
let kExprF32Ne = 0x5c;
let kExprF32Lt = 0x5d;
let kExprF32Gt = 0x5e;
let kExprF32Le = 0x5f;
let kExprF32Ge = 0x60;
let kExprF64Eq = 0x61;
let kExprF64Ne = 0x62;
let kExprF64Lt = 0x63;
let kExprF64Gt = 0x64;
let kExprF64Le = 0x65;
let kExprF64Ge = 0x66;
let kExprI32Clz = 0x67;
let kExprI32Ctz = 0x68;
let kExprI32Popcnt = 0x69;
let kExprI32Add = 0x6a;
let kExprI32Sub = 0x6b;
let kExprI32Mul = 0x6c;
let kExprI32DivS = 0x6d;
let kExprI32DivU = 0x6e;
let kExprI32RemS = 0x6f;
let kExprI32RemU = 0x70;
let kExprI32And = 0x71;
let kExprI32Ior = 0x72;
let kExprI32Xor = 0x73;
let kExprI32Shl = 0x74;
let kExprI32ShrS = 0x75;
let kExprI32ShrU = 0x76;
let kExprI32Rol = 0x77;
let kExprI32Ror = 0x78;
let kExprI64Clz = 0x79;
let kExprI64Ctz = 0x7a;
let kExprI64Popcnt = 0x7b;
let kExprI64Add = 0x7c;
let kExprI64Sub = 0x7d;
let kExprI64Mul = 0x7e;
let kExprI64DivS = 0x7f;
let kExprI64DivU = 0x80;
let kExprI64RemS = 0x81;
let kExprI64RemU = 0x82;
let kExprI64And = 0x83;
let kExprI64Ior = 0x84;
let kExprI64Xor = 0x85;
let kExprI64Shl = 0x86;
let kExprI64ShrS = 0x87;
let kExprI64ShrU = 0x88;
let kExprI64Rol = 0x89;
let kExprI64Ror = 0x8a;
let kExprF32Abs = 0x8b;
let kExprF32Neg = 0x8c;
let kExprF32Ceil = 0x8d;
let kExprF32Floor = 0x8e;
let kExprF32Trunc = 0x8f;
let kExprF32NearestInt = 0x90;
let kExprF32Sqrt = 0x91;
let kExprF32Add = 0x92;
let kExprF32Sub = 0x93;
let kExprF32Mul = 0x94;
let kExprF32Div = 0x95;
let kExprF32Min = 0x96;
let kExprF32Max = 0x97;
let kExprF32CopySign = 0x98;
let kExprF64Abs = 0x99;
let kExprF64Neg = 0x9a;
let kExprF64Ceil = 0x9b;
let kExprF64Floor = 0x9c;
let kExprF64Trunc = 0x9d;
let kExprF64NearestInt = 0x9e;
let kExprF64Sqrt = 0x9f;
let kExprF64Add = 0xa0;
let kExprF64Sub = 0xa1;
let kExprF64Mul = 0xa2;
let kExprF64Div = 0xa3;
let kExprF64Min = 0xa4;
let kExprF64Max = 0xa5;
let kExprF64CopySign = 0xa6;
let kExprI32ConvertI64 = 0xa7;
let kExprI32SConvertF32 = 0xa8;
let kExprI32UConvertF32 = 0xa9;
let kExprI32SConvertF64 = 0xaa;
let kExprI32UConvertF64 = 0xab;
let kExprI64SConvertI32 = 0xac;
let kExprI64UConvertI32 = 0xad;
let kExprI64SConvertF32 = 0xae;
let kExprI64UConvertF32 = 0xaf;
let kExprI64SConvertF64 = 0xb0;
let kExprI64UConvertF64 = 0xb1;
let kExprF32SConvertI32 = 0xb2;
let kExprF32UConvertI32 = 0xb3;
let kExprF32SConvertI64 = 0xb4;
let kExprF32UConvertI64 = 0xb5;
let kExprF32ConvertF64 = 0xb6;
let kExprF64SConvertI32 = 0xb7;
let kExprF64UConvertI32 = 0xb8;
let kExprF64SConvertI64 = 0xb9;
let kExprF64UConvertI64 = 0xba;
let kExprF64ConvertF32 = 0xbb;
let kExprI32ReinterpretF32 = 0xbc;
let kExprI64ReinterpretF64 = 0xbd;
let kExprF32ReinterpretI32 = 0xbe;
let kExprF64ReinterpretI64 = 0xbf;
let kExprI32SExtendI8 = 0xc0;
let kExprI32SExtendI16 = 0xc1;
let kExprI64SExtendI8 = 0xc2;
let kExprI64SExtendI16 = 0xc3;
let kExprI64SExtendI32 = 0xc4;
let kExprRefNull = 0xd0;
let kExprRefIsNull = 0xd1;
let kExprRefFunc = 0xd2;

// Prefix opcodes
let kNumericPrefix = 0xfc;
let kSimdPrefix = 0xfd;
let kAtomicPrefix = 0xfe;

// Numeric opcodes.
let kExprMemoryInit = 0x08;
let kExprDataDrop = 0x09;
let kExprMemoryCopy = 0x0a;
let kExprMemoryFill = 0x0b;
let kExprTableInit = 0x0c;
let kExprElemDrop = 0x0d;
let kExprTableCopy = 0x0e;
let kExprTableGrow = 0x0f;
let kExprTableSize = 0x10;
let kExprTableFill = 0x11;

// Atomic opcodes.
let kExprAtomicNotify = 0x00;
let kExprI32AtomicWait = 0x01;
let kExprI64AtomicWait = 0x02;
let kExprI32AtomicLoad = 0x10;
let kExprI32AtomicLoad8U = 0x12;
let kExprI32AtomicLoad16U = 0x13;
let kExprI32AtomicStore = 0x17;
let kExprI32AtomicStore8U = 0x19;
let kExprI32AtomicStore16U = 0x1a;
let kExprI32AtomicAdd = 0x1e;
let kExprI32AtomicAdd8U = 0x20;
let kExprI32AtomicAdd16U = 0x21;
let kExprI32AtomicSub = 0x25;
let kExprI32AtomicSub8U = 0x27;
let kExprI32AtomicSub16U = 0x28;
let kExprI32AtomicAnd = 0x2c;
let kExprI32AtomicAnd8U = 0x2e;
let kExprI32AtomicAnd16U = 0x2f;
let kExprI32AtomicOr = 0x33;
let kExprI32AtomicOr8U = 0x35;
let kExprI32AtomicOr16U = 0x36;
let kExprI32AtomicXor = 0x3a;
let kExprI32AtomicXor8U = 0x3c;
let kExprI32AtomicXor16U = 0x3d;
let kExprI32AtomicExchange = 0x41;
let kExprI32AtomicExchange8U = 0x43;
let kExprI32AtomicExchange16U = 0x44;
let kExprI32AtomicCompareExchange = 0x48;
let kExprI32AtomicCompareExchange8U = 0x4a;
let kExprI32AtomicCompareExchange16U = 0x4b;

let kExprI64AtomicLoad = 0x11;
let kExprI64AtomicLoad8U = 0x14;
let kExprI64AtomicLoad16U = 0x15;
let kExprI64AtomicLoad32U = 0x16;
let kExprI64AtomicStore = 0x18;
let kExprI64AtomicStore8U = 0x1b;
let kExprI64AtomicStore16U = 0x1c;
let kExprI64AtomicStore32U = 0x1d;
let kExprI64AtomicAdd = 0x1f;
let kExprI64AtomicAdd8U = 0x22;
let kExprI64AtomicAdd16U = 0x23;
let kExprI64AtomicAdd32U = 0x24;
let kExprI64AtomicSub = 0x26;
let kExprI64AtomicSub8U = 0x29;
let kExprI64AtomicSub16U = 0x2a;
let kExprI64AtomicSub32U = 0x2b;
let kExprI64AtomicAnd = 0x2d;
let kExprI64AtomicAnd8U = 0x30;
let kExprI64AtomicAnd16U = 0x31;
let kExprI64AtomicAnd32U = 0x32;
let kExprI64AtomicOr = 0x34;
let kExprI64AtomicOr8U = 0x37;
let kExprI64AtomicOr16U = 0x38;
let kExprI64AtomicOr32U = 0x39;
let kExprI64AtomicXor = 0x3b;
let kExprI64AtomicXor8U = 0x3e;
let kExprI64AtomicXor16U = 0x3f;
let kExprI64AtomicXor32U = 0x40;
let kExprI64AtomicExchange = 0x42;
let kExprI64AtomicExchange8U = 0x45;
let kExprI64AtomicExchange16U = 0x46;
let kExprI64AtomicExchange32U = 0x47;
let kExprI64AtomicCompareExchange = 0x49
let kExprI64AtomicCompareExchange8U = 0x4c;
let kExprI64AtomicCompareExchange16U = 0x4d;
let kExprI64AtomicCompareExchange32U = 0x4e;

// Simd opcodes.
let kExprS128LoadMem = 0x00;
let kExprS128StoreMem = 0x01;
let kExprI32x4Splat = 0x0c;
let kExprI32x4Eq = 0x2c;
let kExprS1x4AllTrue = 0x75;
let kExprF32x4Min = 0x9e;

class Binary {
  constructor() {
    this.length = 0;
    this.buffer = new Uint8Array(8192);
  }

  ensure_space(needed) {
    if (this.buffer.length - this.length >= needed) return;
    let new_capacity = this.buffer.length * 2;
    while (new_capacity - this.length < needed) new_capacity *= 2;
    let new_buffer = new Uint8Array(new_capacity);
    new_buffer.set(this.buffer);
    this.buffer = new_buffer;
  }

  trunc_buffer() {
    return new Uint8Array(this.buffer.buffer, 0, this.length);
  }

  reset() {
    this.length = 0;
  }

  emit_u8(val) {
    this.ensure_space(1);
    this.buffer[this.length++] = val;
  }

  emit_u16(val) {
    this.ensure_space(2);
    this.buffer[this.length++] = val;
    this.buffer[this.length++] = val >> 8;
  }

  emit_u32(val) {
    this.ensure_space(4);
    this.buffer[this.length++] = val;
    this.buffer[this.length++] = val >> 8;
    this.buffer[this.length++] = val >> 16;
    this.buffer[this.length++] = val >> 24;
  }

  emit_leb_u(val, max_len) {
    this.ensure_space(max_len);
    for (let i = 0; i < max_len; ++i) {
      let v = val & 0xff;
      val = val >>> 7;
      if (val == 0) {
        this.buffer[this.length++] = v;
        return;
      }
      this.buffer[this.length++] = v | 0x80;
    }
    throw new Error("Leb value exceeds maximum length of " + max_len);
  }

  emit_u32v(val) {
    this.emit_leb_u(val, kMaxVarInt32Size);
  }

  emit_u64v(val) {
    this.emit_leb_u(val, kMaxVarInt64Size);
  }

  emit_bytes(data) {
    this.ensure_space(data.length);
    this.buffer.set(data, this.length);
    this.length += data.length;
  }

  emit_string(string) {
    // When testing illegal names, we pass a byte array directly.
    if (string instanceof Array) {
      this.emit_u32v(string.length);
      this.emit_bytes(string);
      return;
    }

    // This is the hacky way to convert a JavaScript string to a UTF8 encoded
    // string only containing single-byte characters.
    let string_utf8 = unescape(encodeURIComponent(string));
    this.emit_u32v(string_utf8.length);
    for (let i = 0; i < string_utf8.length; i++) {
      this.emit_u8(string_utf8.charCodeAt(i));
    }
  }

  emit_header() {
    this.emit_bytes([
      kWasmH0, kWasmH1, kWasmH2, kWasmH3, kWasmV0, kWasmV1, kWasmV2, kWasmV3
    ]);
  }

  emit_section(section_code, content_generator) {
    // Emit section name.
    this.emit_u8(section_code);
    // Emit the section to a temporary buffer: its full length isn't know yet.
    const section = new Binary;
    content_generator(section);
    // Emit section length.
    this.emit_u32v(section.length);
    // Copy the temporary buffer.
    // Avoid spread because {section} can be huge.
    this.emit_bytes(section.trunc_buffer());
  }
}

class WasmFunctionBuilder {
  constructor(module, name, type_index) {
    this.module = module;
    this.name = name;
    this.type_index = type_index;
    this.body = [];
    this.locals = [];
    this.local_names = [];
  }

  numLocalNames() {
    let num_local_names = 0;
    for (let loc_name of this.local_names) {
      if (loc_name !== undefined) ++num_local_names;
    }
    return num_local_names;
  }

  exportAs(name) {
    this.module.addExport(name, this.index);
    return this;
  }

  exportFunc() {
    this.exportAs(this.name);
    return this;
  }

  addBody(body) {
    for (let b of body) {
      if (typeof b !== 'number' || (b & (~0xFF)) !== 0 )
        throw new Error('invalid body (entries must be 8 bit numbers): ' + body);
    }
    this.body = body.slice();
    // Automatically add the end for the function block to the body.
    this.body.push(kExprEnd);
    return this;
  }

  addBodyWithEnd(body) {
    this.body = body;
    return this;
  }

  getNumLocals() {
    let total_locals = 0;
    for (let l of this.locals) {
      for (let type of ["i32", "i64", "f32", "f64", "s128"]) {
        total_locals += l[type + "_count"] || 0;
      }
    }
    return total_locals;
  }

  addLocals(locals, names) {
    const old_num_locals = this.getNumLocals();
    this.locals.push(locals);
    if (names) {
      const missing_names = old_num_locals - this.local_names.length;
      this.local_names.push(...new Array(missing_names), ...names);
    }
    return this;
  }

  end() {
    return this.module;
  }
}

class WasmGlobalBuilder {
  constructor(module, type, mutable) {
    this.module = module;
    this.type = type;
    this.mutable = mutable;
    this.init = 0;
  }

  exportAs(name) {
    this.module.exports.push({name: name, kind: kExternalGlobal,
                              index: this.index});
    return this;
  }
}

class WasmTableBuilder {
  constructor(module, type, initial_size, max_size) {
    this.module = module;
    this.type = type;
    this.initial_size = initial_size;
    this.has_max = max_size != undefined;
    this.max_size = max_size;
  }

  exportAs(name) {
    this.module.exports.push({name: name, kind: kExternalTable,
                              index: this.index});
    return this;
  }
}

class WasmModuleBuilder {
  constructor() {
    this.types = [];
    this.imports = [];
    this.exports = [];
    this.globals = [];
    this.tables = [];
    this.tags = [];
    this.functions = [];
    this.element_segments = [];
    this.data_segments = [];
    this.explicit = [];
    this.num_imported_funcs = 0;
    this.num_imported_globals = 0;
    this.num_imported_tables = 0;
    this.num_imported_tags = 0;
    return this;
  }

  addStart(start_index) {
    this.start_index = start_index;
    return this;
  }

  addMemory(min, max, exp, shared) {
    this.memory = {min: min, max: max, exp: exp, shared: shared};
    return this;
  }

  addExplicitSection(bytes) {
    this.explicit.push(bytes);
    return this;
  }

  stringToBytes(name) {
    var result = new Binary();
    result.emit_string(name);
    return result.trunc_buffer()
  }

  createCustomSection(name, bytes) {
    name = this.stringToBytes(name);
    var section = new Binary();
    section.emit_u8(kUnknownSectionCode);
    section.emit_u32v(name.length + bytes.length);
    section.emit_bytes(name);
    section.emit_bytes(bytes);
    return section.trunc_buffer();
  }

  addCustomSection(name, bytes) {
    this.explicit.push(this.createCustomSection(name, bytes));
  }

  addType(type) {
    this.types.push(type);
    var pl = type.params.length;  // should have params
    var rl = type.results.length; // should have results
    return this.types.length - 1;
  }

  addGlobal(local_type, mutable) {
    let glob = new WasmGlobalBuilder(this, local_type, mutable);
    glob.index = this.globals.length + this.num_imported_globals;
    this.globals.push(glob);
    return glob;
  }

  addTable(type, initial_size, max_size = undefined) {
    if (type != kWasmAnyRef && type != kWasmAnyFunc) {
      throw new Error('Tables must be of type kWasmAnyRef or kWasmAnyFunc');
    }
    let table = new WasmTableBuilder(this, type, initial_size, max_size);
    table.index = this.tables.length + this.num_imported_tables;
    this.tables.push(table);
    return table;
  }

  addTag(type) {
    let type_index = (typeof type) == "number" ? type : this.addType(type);
    let except_index = this.tags.length + this.num_imported_tags;
    this.tags.push(type_index);
    return except_index;
  }

  addFunction(name, type) {
    let type_index = (typeof type) == "number" ? type : this.addType(type);
    let func = new WasmFunctionBuilder(this, name, type_index);
    func.index = this.functions.length + this.num_imported_funcs;
    this.functions.push(func);
    return func;
  }

  addImport(module, name, type) {
    if (this.functions.length != 0) {
      throw new Error('Imported functions must be declared before local ones');
    }
    let type_index = (typeof type) == "number" ? type : this.addType(type);
    this.imports.push({module: module, name: name, kind: kExternalFunction,
                       type: type_index});
    return this.num_imported_funcs++;
  }

  addImportedGlobal(module, name, type, mutable = false) {
    if (this.globals.length != 0) {
      throw new Error('Imported globals must be declared before local ones');
    }
    let o = {module: module, name: name, kind: kExternalGlobal, type: type,
             mutable: mutable};
    this.imports.push(o);
    return this.num_imported_globals++;
  }

  addImportedMemory(module, name, initial = 0, maximum, shared) {
    let o = {module: module, name: name, kind: kExternalMemory,
             initial: initial, maximum: maximum, shared: shared};
    this.imports.push(o);
    return this;
  }

  addImportedTable(module, name, initial, maximum, type) {
    if (this.tables.length != 0) {
      throw new Error('Imported tables must be declared before local ones');
    }
    let o = {module: module, name: name, kind: kExternalTable, initial: initial,
             maximum: maximum, type: type || kWasmAnyFunctionTypeForm};
    this.imports.push(o);
    return this.num_imported_tables++;
  }

  addImportedTag(module, name, type) {
    if (this.tags.length != 0) {
      throw new Error('Imported tags must be declared before local ones');
    }
    let type_index = (typeof type) == "number" ? type : this.addType(type);
    let o = {module: module, name: name, kind: kExternalTag, type: type_index};
    this.imports.push(o);
    return this.num_imported_tags++;
  }

  addExport(name, index) {
    this.exports.push({name: name, kind: kExternalFunction, index: index});
    return this;
  }

  addExportOfKind(name, kind, index) {
    this.exports.push({name: name, kind: kind, index: index});
    return this;
  }

  addDataSegment(addr, data, is_global = false) {
    this.data_segments.push(
        {addr: addr, data: data, is_global: is_global, is_active: true});
    return this.data_segments.length - 1;
  }

  addPassiveDataSegment(data) {
    this.data_segments.push({data: data, is_active: false});
    return this.data_segments.length - 1;
  }

  exportMemoryAs(name) {
    this.exports.push({name: name, kind: kExternalMemory, index: 0});
  }

  addElementSegment(table, base, is_global, array) {
    this.element_segments.push({table: table, base: base, is_global: is_global,
                                    array: array, is_active: true});
    return this;
  }

  addPassiveElementSegment(array, is_import = false) {
    this.element_segments.push({array: array, is_active: false});
    return this;
  }

  appendToTable(array) {
    for (let n of array) {
      if (typeof n != 'number')
        throw new Error('invalid table (entries have to be numbers): ' + array);
    }
    if (this.tables.length == 0) {
      this.addTable(kWasmAnyFunc, 0);
    }
    // Adjust the table to the correct size.
    let table = this.tables[0];
    const base = table.initial_size;
    const table_size = base + array.length;
    table.initial_size = table_size;
    if (table.has_max && table_size > table.max_size) {
      table.max_size = table_size;
    }
    return this.addElementSegment(0, base, false, array);
  }

  setTableBounds(min, max = undefined) {
    if (this.tables.length != 0) {
      throw new Error("The table bounds of table '0' have already been set.");
    }
    this.addTable(kWasmAnyFunc, min, max);
    return this;
  }

  setName(name) {
    this.name = name;
    return this;
  }

  toBuffer(debug = false) {
    let binary = new Binary;
    let wasm = this;

    // Add header
    binary.emit_header();

    // Add type section
    if (wasm.types.length > 0) {
      if (debug) print("emitting types @ " + binary.length);
      binary.emit_section(kTypeSectionCode, section => {
        section.emit_u32v(wasm.types.length);
        for (let type of wasm.types) {
          section.emit_u8(kWasmFunctionTypeForm);
          section.emit_u32v(type.params.length);
          for (let param of type.params) {
            section.emit_u8(param);
          }
          section.emit_u32v(type.results.length);
          for (let result of type.results) {
            section.emit_u8(result);
          }
        }
      });
    }

    // Add imports section
    if (wasm.imports.length > 0) {
      if (debug) print("emitting imports @ " + binary.length);
      binary.emit_section(kImportSectionCode, section => {
        section.emit_u32v(wasm.imports.length);
        for (let imp of wasm.imports) {
          section.emit_string(imp.module);
          section.emit_string(imp.name || '');
          section.emit_u8(imp.kind);
          if (imp.kind == kExternalFunction) {
            section.emit_u32v(imp.type);
          } else if (imp.kind == kExternalGlobal) {
            section.emit_u32v(imp.type);
            section.emit_u8(imp.mutable);
          } else if (imp.kind == kExternalMemory) {
            var has_max = (typeof imp.maximum) != "undefined";
            var is_shared = (typeof imp.shared) != "undefined";
            if (is_shared) {
              section.emit_u8(has_max ? 3 : 2); // flags
            } else {
              section.emit_u8(has_max ? 1 : 0); // flags
            }
            section.emit_u32v(imp.initial); // initial
            if (has_max) section.emit_u32v(imp.maximum); // maximum
          } else if (imp.kind == kExternalTable) {
            section.emit_u8(imp.type);
            var has_max = (typeof imp.maximum) != "undefined";
            section.emit_u8(has_max ? 1 : 0); // flags
            section.emit_u32v(imp.initial); // initial
            if (has_max) section.emit_u32v(imp.maximum); // maximum
          } else if (imp.kind == kExternalTag) {
            section.emit_u32v(kTagAttribute);
            section.emit_u32v(imp.type);
          } else {
            throw new Error("unknown/unsupported import kind " + imp.kind);
          }
        }
      });
    }

    // Add functions declarations
    if (wasm.functions.length > 0) {
      if (debug) print("emitting function decls @ " + binary.length);
      binary.emit_section(kFunctionSectionCode, section => {
        section.emit_u32v(wasm.functions.length);
        for (let func of wasm.functions) {
          section.emit_u32v(func.type_index);
        }
      });
    }

    // Add table section
    if (wasm.tables.length > 0) {
      if (debug) print ("emitting tables @ " + binary.length);
      binary.emit_section(kTableSectionCode, section => {
        section.emit_u32v(wasm.tables.length);
        for (let table of wasm.tables) {
          section.emit_u8(table.type);
          section.emit_u8(table.has_max);
          section.emit_u32v(table.initial_size);
          if (table.has_max) section.emit_u32v(table.max_size);
        }
      });
    }

    // Add memory section
    if (wasm.memory !== undefined) {
      if (debug) print("emitting memory @ " + binary.length);
      binary.emit_section(kMemorySectionCode, section => {
        section.emit_u8(1);  // one memory entry
        const has_max = wasm.memory.max !== undefined;
        const is_shared = wasm.memory.shared !== undefined;
        // Emit flags (bit 0: reszeable max, bit 1: shared memory)
        if (is_shared) {
          section.emit_u8(has_max ? kSharedHasMaximumFlag : 2);
        } else {
          section.emit_u8(has_max ? kHasMaximumFlag : 0);
        }
        section.emit_u32v(wasm.memory.min);
        if (has_max) section.emit_u32v(wasm.memory.max);
      });
    }

    // Add global section.
    if (wasm.globals.length > 0) {
      if (debug) print ("emitting globals @ " + binary.length);
      binary.emit_section(kGlobalSectionCode, section => {
        section.emit_u32v(wasm.globals.length);
        for (let global of wasm.globals) {
          section.emit_u8(global.type);
          section.emit_u8(global.mutable);
          if ((typeof global.init_index) == "undefined") {
            // Emit a constant initializer.
            switch (global.type) {
            case kWasmI32:
              section.emit_u8(kExprI32Const);
              section.emit_u32v(global.init);
              break;
            case kWasmI64:
              section.emit_u8(kExprI64Const);
              section.emit_u64v(global.init);
              break;
            case kWasmF32:
              section.emit_bytes(wasmF32Const(global.init));
              break;
            case kWasmF64:
              section.emit_bytes(wasmF64Const(global.init));
              break;
            case kWasmAnyFunc:
            case kWasmAnyRef:
              if (global.function_index !== undefined) {
                section.emit_u8(kExprRefFunc);
                section.emit_u32v(global.function_index);
              } else {
                section.emit_u8(kExprRefNull);
              }
              break;
            }
          } else {
            // Emit a global-index initializer.
            section.emit_u8(kExprGlobalGet);
            section.emit_u32v(global.init_index);
          }
          section.emit_u8(kExprEnd);  // end of init expression
        }
      });
    }

    // Add tags.
    if (wasm.tags.length > 0) {
      if (debug) print("emitting tags @ " + binary.length);
      binary.emit_section(kTagSectionCode, section => {
        section.emit_u32v(wasm.tags.length);
        for (let type of wasm.tags) {
          section.emit_u32v(kTagAttribute);
          section.emit_u32v(type);
        }
      });
    }

    // Add export table.
    var mem_export = (wasm.memory !== undefined && wasm.memory.exp);
    var exports_count = wasm.exports.length + (mem_export ? 1 : 0);
    if (exports_count > 0) {
      if (debug) print("emitting exports @ " + binary.length);
      binary.emit_section(kExportSectionCode, section => {
        section.emit_u32v(exports_count);
        for (let exp of wasm.exports) {
          section.emit_string(exp.name);
          section.emit_u8(exp.kind);
          section.emit_u32v(exp.index);
        }
        if (mem_export) {
          section.emit_string("memory");
          section.emit_u8(kExternalMemory);
          section.emit_u8(0);
        }
      });
    }

    // Add start function section.
    if (wasm.start_index !== undefined) {
      if (debug) print("emitting start function @ " + binary.length);
      binary.emit_section(kStartSectionCode, section => {
        section.emit_u32v(wasm.start_index);
      });
    }

    // Add element segments
    if (wasm.element_segments.length > 0) {
      if (debug) print("emitting element segments @ " + binary.length);
      binary.emit_section(kElementSectionCode, section => {
        var inits = wasm.element_segments;
        section.emit_u32v(inits.length);

        for (let init of inits) {
          if (init.is_active) {
            // Active segment.
            if (init.table == 0) {
              section.emit_u32v(kActiveNoIndex);
            } else {
              section.emit_u32v(kActiveWithIndex);
              section.emit_u32v(init.table);
            }
            if (init.is_global) {
              section.emit_u8(kExprGlobalGet);
            } else {
              section.emit_u8(kExprI32Const);
            }
            section.emit_u32v(init.base);
            section.emit_u8(kExprEnd);
            if (init.table != 0) {
              section.emit_u8(kExternalFunction);
            }
            section.emit_u32v(init.array.length);
            for (let index of init.array) {
              section.emit_u32v(index);
            }
          } else {
            // Passive segment.
            section.emit_u8(kPassiveWithElements);  // flags
            section.emit_u8(kWasmAnyFunc);
            section.emit_u32v(init.array.length);
            for (let index of init.array) {
              if (index === null) {
                section.emit_u8(kExprRefNull);
                section.emit_u8(kExprEnd);
              } else {
                section.emit_u8(kExprRefFunc);
                section.emit_u32v(index);
                section.emit_u8(kExprEnd);
              }
            }
          }
        }
      });
    }

    // If there are any passive data segments, add the DataCount section.
    if (wasm.data_segments.some(seg => !seg.is_active)) {
      binary.emit_section(kDataCountSectionCode, section => {
        section.emit_u32v(wasm.data_segments.length);
      });
    }

    // Add function bodies.
    if (wasm.functions.length > 0) {
      // emit function bodies
      if (debug) print("emitting code @ " + binary.length);
      binary.emit_section(kCodeSectionCode, section => {
        section.emit_u32v(wasm.functions.length);
        let header = new Binary;
        for (let func of wasm.functions) {
          header.reset();
          // Function body length will be patched later.
          let local_decls = [];
          for (let l of func.locals || []) {
            if (l.i32_count > 0) {
              local_decls.push({count: l.i32_count, type: kWasmI32});
            }
            if (l.i64_count > 0) {
              local_decls.push({count: l.i64_count, type: kWasmI64});
            }
            if (l.f32_count > 0) {
              local_decls.push({count: l.f32_count, type: kWasmF32});
            }
            if (l.f64_count > 0) {
              local_decls.push({count: l.f64_count, type: kWasmF64});
            }
            if (l.s128_count > 0) {
              local_decls.push({count: l.s128_count, type: kWasmS128});
            }
            if (l.anyref_count > 0) {
              local_decls.push({count: l.anyref_count, type: kWasmAnyRef});
            }
            if (l.anyfunc_count > 0) {
              local_decls.push({count: l.anyfunc_count, type: kWasmAnyFunc});
            }
          }

          header.emit_u32v(local_decls.length);
          for (let decl of local_decls) {
            header.emit_u32v(decl.count);
            header.emit_u8(decl.type);
          }

          section.emit_u32v(header.length + func.body.length);
          section.emit_bytes(header.trunc_buffer());
          section.emit_bytes(func.body);
        }
      });
    }

    // Add data segments.
    if (wasm.data_segments.length > 0) {
      if (debug) print("emitting data segments @ " + binary.length);
      binary.emit_section(kDataSectionCode, section => {
        section.emit_u32v(wasm.data_segments.length);
        for (let seg of wasm.data_segments) {
          if (seg.is_active) {
            section.emit_u8(0);  // linear memory index 0 / flags
            if (seg.is_global) {
              // initializer is a global variable
              section.emit_u8(kExprGlobalGet);
              section.emit_u32v(seg.addr);
            } else {
              // initializer is a constant
              section.emit_u8(kExprI32Const);
              section.emit_u32v(seg.addr);
            }
            section.emit_u8(kExprEnd);
          } else {
            section.emit_u8(kPassive);  // flags
          }
          section.emit_u32v(seg.data.length);
          section.emit_bytes(seg.data);
        }
      });
    }

    // Add any explicitly added sections
    for (let exp of wasm.explicit) {
      if (debug) print("emitting explicit @ " + binary.length);
      binary.emit_bytes(exp);
    }

    // Add names.
    let num_function_names = 0;
    let num_functions_with_local_names = 0;
    for (let func of wasm.functions) {
      if (func.name !== undefined) ++num_function_names;
      if (func.numLocalNames() > 0) ++num_functions_with_local_names;
    }
    if (num_function_names > 0 || num_functions_with_local_names > 0 ||
        wasm.name !== undefined) {
      if (debug) print('emitting names @ ' + binary.length);
      binary.emit_section(kUnknownSectionCode, section => {
        section.emit_string('name');
        // Emit module name.
        if (wasm.name !== undefined) {
          section.emit_section(kModuleNameCode, name_section => {
            name_section.emit_string(wasm.name);
          });
        }
        // Emit function names.
        if (num_function_names > 0) {
          section.emit_section(kFunctionNamesCode, name_section => {
            name_section.emit_u32v(num_function_names);
            for (let func of wasm.functions) {
              if (func.name === undefined) continue;
              name_section.emit_u32v(func.index);
              name_section.emit_string(func.name);
            }
          });
        }
        // Emit local names.
        if (num_functions_with_local_names > 0) {
          section.emit_section(kLocalNamesCode, name_section => {
            name_section.emit_u32v(num_functions_with_local_names);
            for (let func of wasm.functions) {
              if (func.numLocalNames() == 0) continue;
              name_section.emit_u32v(func.index);
              name_section.emit_u32v(func.numLocalNames());
              for (let i = 0; i < func.local_names.length; ++i) {
                if (func.local_names[i] === undefined) continue;
                name_section.emit_u32v(i);
                name_section.emit_string(func.local_names[i]);
              }
            }
          });
        }
      });
    }

    return binary.trunc_buffer();
  }

  toArray(debug = false) {
    return Array.from(this.toBuffer(debug));
  }

  instantiate(ffi) {
    let module = this.toModule();
    let instance = new WebAssembly.Instance(module, ffi);
    return instance;
  }

  asyncInstantiate(ffi) {
    return WebAssembly.instantiate(this.toBuffer(), ffi)
        .then(({module, instance}) => instance);
  }

  toModule(debug = false) {
    return new WebAssembly.Module(this.toBuffer(debug));
  }
}

function wasmSignedLeb(val, max_len = 5) {
  let res = [];
  for (let i = 0; i < max_len; ++i) {
    let v = val & 0x7f;
    // If {v} sign-extended from 7 to 32 bits is equal to val, we are done.
    if (((v << 25) >> 25) == val) {
      res.push(v);
      return res;
    }
    res.push(v | 0x80);
    val = val >> 7;
  }
  throw new Error(
      'Leb value <' + val + '> exceeds maximum length of ' + max_len);
}

function wasmI32Const(val) {
  return [kExprI32Const, ...wasmSignedLeb(val, 5)];
}

function wasmF32Const(f) {
  // Write in little-endian order at offset 0.
  data_view.setFloat32(0, f, true);
  return [
    kExprF32Const, byte_view[0], byte_view[1], byte_view[2], byte_view[3]
  ];
}

function wasmF64Const(f) {
  // Write in little-endian order at offset 0.
  data_view.setFloat64(0, f, true);
  return [
    kExprF64Const, byte_view[0], byte_view[1], byte_view[2],
    byte_view[3], byte_view[4], byte_view[5], byte_view[6], byte_view[7]
  ];
}
                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/webapi/                                                          0000775 0000000 0000000 00000000000 14746647661 0020435 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/META.yml                                                  0000664 0000000 0000000 00000000062 14746647661 0021704 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        spec: https://webassembly.github.io/spec/web-api/
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/abort.any.js                                              0000664 0000000 0000000 00000002570 14746647661 0022674 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        const methods = [
  "compileStreaming",
  "instantiateStreaming",
];

for (const method of methods) {
  promise_test(async t => {
    const controller = new AbortController();
    const signal = controller.signal;
    controller.abort();
    const request = fetch('../incrementer.wasm', { signal });
    return promise_rejects_dom(t, 'AbortError', WebAssembly[method](request),
                              `${method} should reject`);
  }, `${method}() on an already-aborted request should reject with AbortError`);

  promise_test(async t => {
    const controller = new AbortController();
    const signal = controller.signal;
    const request = fetch('../incrementer.wasm', { signal });
    const promise = WebAssembly[method](request);
    controller.abort();
    return promise_rejects_dom(t, 'AbortError', promise, `${method} should reject`);
  }, `${method}() synchronously followed by abort should reject with AbortError`);

  promise_test(async t => {
    const controller = new AbortController();
    const signal = controller.signal;
    return fetch('../incrementer.wasm', { signal })
    .then(response => {
      Promise.resolve().then(() => controller.abort());
      return WebAssembly[method](response);
    })
    .catch(err => {
      assert_equals(err.name, "AbortError");
    });
  }, `${method}() asynchronously racing with abort should succeed or reject with AbortError`);
}
                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/body.any.js                                               0000664 0000000 0000000 00000001454 14746647661 0022522 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/wasm/jsapi/wasm-module-builder.js

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  promise_test(t => {
    const buffer = new WasmModuleBuilder().toBuffer();
    const argument = new Response(buffer, { headers: { "Content-Type": "application/wasm" } });
    argument.arrayBuffer();
    return promise_rejects_js(t, TypeError, WebAssembly[method](argument));
  }, `${method} after consumption`);

  promise_test(t => {
    const buffer = new WasmModuleBuilder().toBuffer();
    const argument = new Response(buffer, { headers: { "Content-Type": "application/wasm" } });
    const promise = WebAssembly[method](argument);
    argument.arrayBuffer();
    return promise_rejects_js(t, TypeError, promise);
  }, `${method} before consumption`);
}
                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/webapi/contenttype.any.js                                        0000664 0000000 0000000 00000004700 14746647661 0024136 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/wasm/jsapi/assertions.js

promise_test(t => {
  const response = fetch("/wasm/incrementer.wasm").then(res => new Response(res.body));
  return promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(response));
}, "Response with no Content-Type: compileStreaming");

promise_test(t => {
  const response = fetch("/wasm/incrementer.wasm").then(res => new Response(res.body));
  return promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(response));
}, "Response with no Content-Type: instantiateStreaming");

const invalidContentTypes = [
  "",
  "application/javascript",
  "application/octet-stream",
  "text/wasm",
  "application/wasm;",
  "application/wasm;x",
  "application/wasm;charset=UTF-8",
];

for (const contenttype of invalidContentTypes) {
  promise_test(t => {
    const response = fetch(`/wasm/incrementer.wasm?pipe=header(Content-Type,${encodeURIComponent(contenttype)})`);
    return promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(response));
  }, `Response with Content-Type ${format_value(contenttype)}: compileStreaming`);

  promise_test(t => {
    const response = fetch(`/wasm/incrementer.wasm?pipe=header(Content-Type,${encodeURIComponent(contenttype)})`);
    return promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(response));
  }, `Response with Content-Type ${format_value(contenttype)}: instantiateStreaming`);
}

const validContentTypes = [
  "application/wasm",
  "APPLICATION/wasm",
  "APPLICATION/WASM",
];

for (const contenttype of validContentTypes) {
  promise_test(async t => {
    const response = fetch(`/wasm/incrementer.wasm?pipe=header(Content-Type,${encodeURIComponent(contenttype)})`);
    const module = await WebAssembly.compileStreaming(response);
    assert_equals(Object.getPrototypeOf(module), WebAssembly.Module.prototype,
                  "prototype");
  }, `Response with Content-Type ${format_value(contenttype)}: compileStreaming`);

  promise_test(async t => {
    const response = fetch(`/wasm/incrementer.wasm?pipe=header(Content-Type,${encodeURIComponent(contenttype)})`);
    const result = await WebAssembly.instantiateStreaming(response);
    assert_WebAssemblyInstantiatedSource(
        result,
        {
          "increment": {
            "kind": "function",
            "name": "0",
            "length": 1
          }
        }
      );
  }, `Response with Content-Type ${format_value(contenttype)}: instantiateStreaming`);
}
                                                                node-23.7.0/test/fixtures/wpt/wasm/webapi/empty-body.any.js                                         0000664 0000000 0000000 00000001440 14746647661 0023651 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker

const invalidArguments = [
  [() => new Response(undefined, { headers: { "Content-Type": "application/wasm" } }), "no body"],
  [() => new Response("", { headers: { "Content-Type": "application/wasm" } }), "empty body"],
];

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  for (const [argumentFactory, name] of invalidArguments) {
    promise_test(t => {
      const argument = argumentFactory();
      return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly[method](argument));
    }, `${method}: ${name}`);

    promise_test(t => {
      const argument = Promise.resolve(argumentFactory());
      return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly[method](argument));
    }, `${method}: ${name} in a promise`);
  }
}
                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/                                          0000775 0000000 0000000 00000000000 14746647661 0023542 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/execute-start.tentative.html              0000664 0000000 0000000 00000001343 14746647661 0031230 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<title>Check execution of WebAssembly start function</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    const test_load = async_test(
        "Importing a WebAssembly module should execute the start function.");

    window.log = [];
    window.addEventListener("error", ev => {
      log.push(ev.message);
    });

    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_array_equals(log, ["executed"]);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resources/execute-start.wasm" onerror="unreachable()""></script>
                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/exported-names.tentative.html             0000664 0000000 0000000 00000001236 14746647661 0031367 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Exported names from a WebAssembly module</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script type=module>
setup({ single_test: true });
import * as mod from "./resources/exported-names.wasm";
assert_array_equals(Object.getOwnPropertyNames(mod).sort(),
                    ["func", "glob", "mem", "tab"]);
assert_true(mod.func instanceof Function);
assert_true(mod.mem instanceof WebAssembly.Memory);
assert_true(mod.glob instanceof WebAssembly.Global);
assert_true(mod.tab instanceof WebAssembly.Table);
assert_throws_js(TypeError, () => { mod.func = 2; });
done();
</script>
                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/invalid-bytecode.tentative.html           0000664 0000000 0000000 00000001716 14746647661 0031661 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<title>Handling of importing invalid WebAssembly modules</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    window.log = [];

    window.addEventListener("error", ev => log.push(ev.error));

    const test_load = async_test(
        "Test that imports of invalid WebAssembly modules leads to WebAssembly.CompileError on window.");
    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_equals(log.length, 2);
      assert_equals(log[0].constructor, WebAssembly.CompileError);
      assert_equals(log[1].constructor, WebAssembly.CompileError);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resources/invalid-bytecode.wasm" onerror="unreachable()"></script>
<script type="module" src="./resources/invalid-module.wasm" onerror="unreachable()"></script>
                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/js-wasm-cycle-errors.tentative.html       0000664 0000000 0000000 00000003027 14746647661 0032424 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Cyclic linking between JavaScript and WebAssembly (JS higher)</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    const test_load = async_test(
        "Check cyclic linking between JavaScript and WebAssembly where JavaScript is higher in the module graph.");

    window.log = [];
    window.addEventListener("error", ev => {
      test_load.step(() => assert_equals(ev.error.constructor, WebAssembly.LinkError));
      log.push(ev.message);
    });

    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_equals(log.length, 10);
      assert_equals(log[1], 1);
      assert_equals(log[3], 2);
      assert_equals(log[5], 3);
      assert_equals(log[7], 4);
      assert_equals(log[9], 5);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resources/js-wasm-cycle-value.js"
    onerror="unreachable()" onload="log.push(1)"></script>
<script type="module" src="./resources/js-wasm-cycle-global.js"
    onerror="unreachable()" onload="log.push(2)"></script>
<script type="module" src="./resources/js-wasm-cycle-memory.js"
    onerror="unreachable()" onload="log.push(3)"></script>
<script type="module" src="./resources/js-wasm-cycle-table.js"
    onerror="unreachable()" onload="log.push(4)"></script>
<script type="module" src="./resources/js-wasm-cycle-function-error.js"
    onerror="unreachable()" onload="log.push(5)"></script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/js-wasm-cycle.tentative.html              0000664 0000000 0000000 00000000530 14746647661 0031106 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Check bindings in JavaScript and WebAssembly cycle (JS higher)</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script type=module>
setup({ single_test: true });
import { f } from "./resources/js-wasm-cycle.js";
assert_equals(f(), 24);
done();
</script>
                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/module-parse-error.tentative.html         0000664 0000000 0000000 00000001716 14746647661 0032163 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<title>Handling of importing invalid WebAssembly modules</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    window.log = [];

    window.addEventListener("error", ev => log.push(ev.error));

    const test_load = async_test(
        "Test that imports of invalid WebAssembly modules leads to WebAssembly.CompileError on window.");
    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_equals(log.length, 2);
      assert_equals(log[0].constructor, WebAssembly.CompileError);
      assert_equals(log[1].constructor, WebAssembly.CompileError);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resources/invalid-bytecode.wasm" onerror="unreachable()"></script>
<script type="module" src="./resources/invalid-module.wasm" onerror="unreachable()"></script>
                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resolve-export.js                         0000664 0000000 0000000 00000000065 14746647661 0027077 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export { f } from "./resources/resolve-export.wasm";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resolve-export.tentative.html             0000664 0000000 0000000 00000001471 14746647661 0031433 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<title>Check ResolveExport on invalid re-export from WebAssembly</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    const test_load = async_test(
        "Re-export of missing Wasm export should result in SyntaxError.");

    window.log = [];
    window.addEventListener("error", ev => {
      test_load.step(() => assert_equals(ev.error.constructor, SyntaxError));
      log.push(ev.message);
    });

    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_equals(log[1], 1);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resolve-export.js"
    onerror="unreachable()" onload="log.push(1)"></script>
                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/                                0000775 0000000 0000000 00000000000 14746647661 0025554 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/execute-start.wasm              0000664 0000000 0000000 00000000063 14746647661 0031241 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  ./log.jslogExec   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/exported-names.wasm             0000664 0000000 0000000 00000000111 14746647661 0031371 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `   o 
 
 A glob mem tab func  
                                                                                                                                                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/invalid-bytecode.wasm           0000664 0000000 0000000 00000000016 14746647661 0031664 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   *`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/invalid-module.wasm             0000664 0000000 0000000 00000000033 14746647661 0031352 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  
 B                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-function-error.js 0000664 0000000 0000000 00000000121 14746647661 0033534 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export const func = 42;
import { f } from "./js-wasm-cycle-function-error.wasm";
                                                                                                                                                                                                                                                                                                                                                                                                                                               js-wasm-cycle-function-error.wasm                                                                   0000664 0000000 0000000 00000000113 14746647661 0034011 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources                                                                                                     asm   `  *!./js-wasm-cycle-function-error.jsfunc   f 
                                                                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-global.js         0000664 0000000 0000000 00000000163 14746647661 0032026 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export const glob = new WebAssembly.Global({ value: "i32" }, 42);
import { f } from "./js-wasm-cycle-global.wasm";
                                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-global.wasm       0000664 0000000 0000000 00000000104 14746647661 0032354 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  #./js-wasm-cycle-global.jsglob  f  
                                                                                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-memory.js         0000664 0000000 0000000 00000000155 14746647661 0032077 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export const mem = new WebAssembly.Memory({ initial: 10 });
import { f } from "./js-wasm-cycle-memory.wasm";
                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-memory.wasm       0000664 0000000 0000000 00000000103 14746647661 0032423 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  "./js-wasm-cycle-memory.jsmem 
 f  
                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-table.js          0000664 0000000 0000000 00000000162 14746647661 0031654 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export const tab = new WebAssembly.Table({ element: "anyfunc" });
import { f } from "./js-wasm-cycle-table.wasm";
                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-table.wasm        0000664 0000000 0000000 00000000103 14746647661 0032202 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  "./js-wasm-cycle-table.jstabp 
 f  
                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-value.js          0000664 0000000 0000000 00000000107 14746647661 0031700 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export const val = 42;
import { f } from "./js-wasm-cycle-value.wasm";
                                                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle-value.wasm        0000664 0000000 0000000 00000000102 14746647661 0032226 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  !./js-wasm-cycle-value.jsval  f  
                                                                                                                                                                                                                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle.js                0000664 0000000 0000000 00000000567 14746647661 0030600 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function f() { return 42; }
export { f };

import { mem, tab, glob, func } from "./js-wasm-cycle.wasm";
assert_true(glob instanceof WebAssembly.Global);
assert_equals(glob.valueOf(), 1);
assert_true(mem instanceof WebAssembly.Memory);
assert_true(tab instanceof WebAssembly.Table);
assert_true(func instanceof Function);

f = () => { return 24 };

assert_equals(func(), 42);
                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/js-wasm-cycle.wasm              0000664 0000000 0000000 00000000145 14746647661 0031123 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ` ./js-wasm-cycle.jsf   p 
 
 Amem tab glob func 
                                                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/log.js                          0000664 0000000 0000000 00000000064 14746647661 0026673 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export function logExec() { log.push("executed"); }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/resolve-export.wasm             0000664 0000000 0000000 00000000010 14746647661 0031432 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-export-i64-global.wasm     0000664 0000000 0000000 00000000027 14746647661 0032570 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ~ B*g                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-export-to-wasm.wasm        0000664 0000000 0000000 00000000055 14746647661 0032320 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  ./log.jslogExec  log                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-error-from-wasm.wasm0000664 0000000 0000000 00000000056 14746647661 0033762 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   $./wasm-export-i64-global.wasmg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-from-wasm.wasm      0000664 0000000 0000000 00000000113 14746647661 0032625 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `  "./wasm-export-to-wasm.wasmlog   logExec 
                                                                                                                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-func.js             0000664 0000000 0000000 00000000022 14746647661 0031314 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export let f = 5;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-func.wasm           0000664 0000000 0000000 00000000055 14746647661 0031655 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   `./wasm-import-func.jsf                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-global.js           0000664 0000000 0000000 00000000022 14746647661 0031621 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export let g = 5;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-global.wasm         0000664 0000000 0000000 00000000050 14746647661 0032155 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ./wasm-import-global.jsg~                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-memory.js           0000664 0000000 0000000 00000000022 14746647661 0031671 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export let m = 5;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-memory.wasm         0000664 0000000 0000000 00000000051 14746647661 0032226 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ./wasm-import-memory.jsm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-table.js            0000664 0000000 0000000 00000000022 14746647661 0031450 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export let t = 5;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-import-table.wasm          0000664 0000000 0000000 00000000050 14746647661 0032004 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ./wasm-import-table.jsto                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-js-cycle.js                0000664 0000000 0000000 00000000636 14746647661 0030575 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        import * as mod from "./wasm-js-cycle.wasm";

let jsGlob = new WebAssembly.Global({ value: "i32", mutable: true }, 42);
let jsMem = new WebAssembly.Memory({ initial: 10 });
let jsTab = new WebAssembly.Table({ initial: 10, element: "anyfunc" });
let jsFunc = () => { return 42; };

export { jsGlob, jsMem, jsTab, jsFunc };

export function mutateBindings() {
  jsGlob = 0;
  jsMem = 0;
  jsTab = 0;
  jsFunc = 0;
}
                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/wasm-js-cycle.wasm              0000664 0000000 0000000 00000000446 14746647661 0031127 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   	` ` ps./wasm-js-cycle.jsjsGlob./wasm-js-cycle.jsjsMem 
./wasm-js-cycle.jsjsTabp 
./wasm-js-cycle.jsjsFunc      ASwasmGlobwasmMem wasmTab incrementGlob 	mutateMem 	mutateTab wasmFunc 	 
1 A# j$ #  A A*6 A (  A & A %   Aj                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/worker-helper.js                0000664 0000000 0000000 00000000052 14746647661 0030675 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        export function pm(x) { postMessage(x); }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/worker.js                       0000664 0000000 0000000 00000000045 14746647661 0027422 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        import * as mod from "./worker.wasm"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/resources/worker.wasm                     0000664 0000000 0000000 00000000076 14746647661 0027761 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ` `  ./worker-helper.jspm  
 A*                                                                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/wasm-import-wasm-export.tentative.html    0000664 0000000 0000000 00000000642 14746647661 0033177 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Check import and export between WebAssembly modules</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script type=module>
setup({ single_test: true });
window.log = [];
import { logExec } from "./resources/wasm-import-from-wasm.wasm";
logExec();
assert_equals(log.length, 1);
assert_equals(log[0], "executed");
done();
</script>
                                                                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/wasm-import.tentative.html                0000664 0000000 0000000 00000002410 14746647661 0030706 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Errors for imports of WebAssembly modules</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    const test_load = async_test(
        "Invalid imports for WebAssembly modules should error.");

    window.log = [];
    window.addEventListener("error", ev => {
      test_load.step(() => assert_equals(ev.error.constructor, WebAssembly.LinkError));
      log.push(ev.message);
    });

    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_equals(log[1], 1);
      assert_equals(log[3], 2);
      assert_equals(log[5], 3);
      assert_equals(log[7], 4);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resources/wasm-import-func.wasm"
    onerror="unreachable()" onload="log.push(1)"></script>
<script type="module" src="./resources/wasm-import-memory.wasm"
    onerror="unreachable()" onload="log.push(2)"></script>
<script type="module" src="./resources/wasm-import-table.wasm"
    onerror="unreachable()" onload="log.push(3)"></script>
<script type="module" src="./resources/wasm-import-global.wasm"
    onerror="unreachable()" onload="log.push(4)"></script>
                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/wasm-js-cycle.tentative.html              0000664 0000000 0000000 00000001635 14746647661 0031115 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Check bindings in JavaScript and WebAssembly cycle (Wasm higher)</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script type=module>
setup({ single_test: true });
import * as wasm from "./resources/wasm-js-cycle.wasm";
import * as js from "./resources/wasm-js-cycle.js";

js.mutateBindings();

assert_true(wasm.wasmGlob instanceof WebAssembly.Global);
assert_equals(wasm.wasmGlob.valueOf(), 24);

assert_true(wasm.wasmFunc instanceof Function);
assert_equals(wasm.wasmFunc(), 43);

assert_equals(wasm.incrementGlob(), 43);

const buf = new Int32Array(wasm.wasmMem.buffer);
assert_equals(buf[0], 0);
assert_equals(wasm.mutateMem(), 42);
assert_equals(buf[0], 42);

assert_equals(wasm.wasmTab.get(0), null);
const ref = wasm.mutateTab();
assert_true(ref instanceof Function);
assert_equals(wasm.wasmTab.get(0), ref);

done();
</script>
                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/wasm-to-wasm-link-error.tentative.html    0000664 0000000 0000000 00000001575 14746647661 0033060 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>Errors for linking WebAssembly module scripts</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>
    setup({allow_uncaught_exception: true});

    const test_load = async_test(
        "Link errors for imports between WebAssembly modules should be reported.");

    window.log = [];
    window.addEventListener("error", ev => {
      test_load.step(() => assert_equals(ev.error.constructor, WebAssembly.LinkError));
      log.push(ev.message);
    });

    window.addEventListener("load", test_load.step_func_done(ev => {
      assert_equals(log.length, 2);
      assert_equals(log[1], 1);
    }));

    function unreachable() { log.push("unexpected"); }
</script>
<script type="module" src="./resources/wasm-import-error-from-wasm.wasm"
    onerror="unreachable()" onload="log.push(1)"></script>
                                                                                                                                   node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/worker-import.tentative.html              0000664 0000000 0000000 00000000613 14746647661 0031253 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<title>Testing import of WebAssembly from JavaScript worker</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script type=module>
setup({ single_test: true });
const worker = new Worker("resources/worker.js", { type: "module" });
worker.onmessage = (msg) => {
  assert_equals(msg.data, 42);
  done();
}
</script>
                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/webapi/esm-integration/worker.tentative.html                     0000664 0000000 0000000 00000000556 14746647661 0027751 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<title>Testing WebAssembly worker</title>

<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script type=module>
setup({ single_test: true });
const worker = new Worker("resources/worker.wasm", { type: "module" });
worker.onmessage = (msg) => {
  assert_equals(msg, 42);
  done();
}
</script>
                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/historical.any.js                                         0000664 0000000 0000000 00000001647 14746647661 0023732 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker

promise_test(async t => {
  const db_name = "WebAssembly";
  const obj_store = "store";
  const module_key = "module";

  await new Promise((resolve, reject) => {
    const delete_request = indexedDB.deleteDatabase(db_name);
    delete_request.onsuccess = resolve;
    delete_request.onerror = reject;
  });

  const db = await new Promise((resolve, reject) => {
    const open_request = indexedDB.open(db_name);
    open_request.onupgradeneeded = function() {
      open_request.result.createObjectStore(obj_store);
    };
    open_request.onsuccess = function() {
      resolve(open_request.result);
    };
    open_request.onerror = reject;
  });

  const mod = await WebAssembly.compileStreaming(fetch('../incrementer.wasm'));
  const tx = db.transaction(obj_store, 'readwrite');
  const store = tx.objectStore(obj_store);
  assert_throws_dom("DataCloneError", () => store.put(mod, module_key));
});
                                                                                         node-23.7.0/test/fixtures/wpt/wasm/webapi/idlharness.any.js                                         0000664 0000000 0000000 00000000252 14746647661 0023714 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/resources/WebIDLParser.js
// META: script=/resources/idlharness.js

"use strict";

idl_test(
  ["wasm-web-api"],
  ["wasm-js-api"],
  idl_array => {}
);
                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/wasm/webapi/instantiateStreaming-bad-imports.any.js                   0000664 0000000 0000000 00000000777 14746647661 0030210 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/bad-imports.js

test_bad_imports((name, error, build, ...args) => {
  promise_test(t => {
    const builder = new WasmModuleBuilder();
    build(builder);
    const buffer = builder.toBuffer();
    const response = new Response(buffer, { "headers": { "Content-Type": "application/wasm" } });
    return promise_rejects_js(t, error, WebAssembly.instantiateStreaming(response, ...args));
  }, name);
});
 node-23.7.0/test/fixtures/wpt/wasm/webapi/instantiateStreaming.any.js                               0000664 0000000 0000000 00000002722 14746647661 0025761 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/wasm/jsapi/wasm-module-builder.js
// META: script=/wasm/jsapi/assertions.js
// META: script=/wasm/jsapi/instanceTestFactory.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

for (const [name, fn] of instanceTestFactory) {
  promise_test(async () => {
    const { buffer, args, exports, verify } = fn();
    const response = new Response(buffer, { "headers": { "Content-Type": "application/wasm" } });
    const result = await WebAssembly.instantiateStreaming(response, ...args);
    assert_WebAssemblyInstantiatedSource(result, exports);
    verify(result.instance);
  }, name);
}

promise_test(async () => {
  const builder = new WasmModuleBuilder();
  builder.addImportedGlobal("module", "global", kWasmI32);
  const buffer = builder.toBuffer();
  const response = new Response(buffer, { "headers": { "Content-Type": "application/wasm" } });
  const order = [];

  const imports = {
    get module() {
      order.push("module getter");
      return {
        get global() {
          order.push("global getter");
          return 0;
        },
      }
    },
  };

  const expected = [
    "module getter",
    "global getter",
  ];
  const p = WebAssembly.instantiateStreaming(response, imports);
  assert_array_equals(order, []);
  const result = await p;
  assert_WebAssemblyInstantiatedSource(result, {});
  assert_array_equals(order, expected);
}, "Synchronous options handling");
                                              node-23.7.0/test/fixtures/wpt/wasm/webapi/invalid-args.any.js                                       0000664 0000000 0000000 00000001366 14746647661 0024147 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker

const invalidArguments = [
  [undefined],
  [null],
  [true],
  ["test"],
  [Symbol()],
  [0],
  [0.1],
  [NaN],
  [{}, "Empty object"],
  [Response, "Response interface object"],
  [Response.prototype, "Response interface prototype object"],
];

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  for (const [argument, name = format_value(argument)] of invalidArguments) {
    promise_test(t => {
      return promise_rejects_js(t, TypeError, WebAssembly[method](argument));
    }, `${method}: ${name}`);

    promise_test(t => {
      const promise = Promise.resolve(argument);
      return promise_rejects_js(t, TypeError, WebAssembly[method](argument));
    }, `${method}: ${name} in a promise`);
  }
}
                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/wasm/webapi/invalid-code.any.js                                       0000664 0000000 0000000 00000001634 14746647661 0024123 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/wasm/jsapi/wasm-module-builder.js

let emptyModuleBinary;
setup(() => {
  emptyModuleBinary = new WasmModuleBuilder().toBuffer();
});

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  promise_test(t => {
    const buffer = new Uint8Array(Array.from(emptyModuleBinary).concat([0, 0]));
    const response = new Response(buffer, { headers: { "Content-Type": "application/wasm" } });
    return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly[method](response));
  }, `Invalid code (0x0000): ${method}`);

  promise_test(t => {
    const buffer = new Uint8Array(Array.from(emptyModuleBinary).concat([0xCA, 0xFE]));
    const response = new Response(buffer, { headers: { "Content-Type": "application/wasm" } });
    return promise_rejects_js(t, WebAssembly.CompileError, WebAssembly[method](response));
  }, `Invalid code (0xCAFE): ${method}`);
}
                                                                                                    node-23.7.0/test/fixtures/wpt/wasm/webapi/modified-contenttype.any.js                               0000664 0000000 0000000 00000002064 14746647661 0025715 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker
// META: script=/wasm/jsapi/wasm-module-builder.js

["compileStreaming", "instantiateStreaming"].forEach(method => {
  promise_test(async t => {
    const buffer = new WasmModuleBuilder().toBuffer();
    const argument = new Response(buffer, { headers: { "Content-Type": "test/test" } });
    argument.headers.set("Content-Type", "application/wasm");
    // This should resolve successfully
    await WebAssembly[method](argument);
    // Ensure body can only be read once
    return promise_rejects_js(t, TypeError, argument.blob());
  }, `${method} with Content-Type set late`);

  promise_test(async t => {
    const buffer = new WasmModuleBuilder().toBuffer();
    const argument = new Response(buffer, { headers: { "Content-Type": "application/wasm" } });
    argument.headers.delete("Content-Type");
    // Ensure Wasm cannot be created
    await promise_rejects_js(t, TypeError, WebAssembly[method](argument));
    // This should resolve successfully
    await argument.arrayBuffer();
  }, `${method} with Content-Type removed late`);
});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/webapi/origin.sub.any.js                                         0000664 0000000 0000000 00000001276 14746647661 0023646 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  promise_test(t => {
    const url = "http://{{domains[www]}}:{{ports[http][0]}}/wasm/incrementer.wasm";
    const response = fetch(url, { "mode": "no-cors" });
    return promise_rejects_js(t, TypeError, WebAssembly[method](response));
  }, `Opaque response: ${method}`);

  promise_test(t => {
    const url = "/fetch/api/resources/redirect.py?redirect_status=301&location=/wasm/incrementer.wasm";
    const response = fetch(url, { "mode": "no-cors", "redirect": "manual" });
    return promise_rejects_js(t, TypeError, WebAssembly[method](response));
  }, `Opaque redirect response: ${method}`);
}
                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/rejected-arg.any.js                                       0000664 0000000 0000000 00000000464 14746647661 0024121 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  promise_test(t => {
    const error = { "name": "custom error" };
    const promise = Promise.reject(error);
    return promise_rejects_exactly(t, error, WebAssembly[method](promise));
  }, `${method}`);
}
                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/wasm/webapi/resources/                                                0000775 0000000 0000000 00000000000 14746647661 0022447 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/wasm/webapi/resources/incrementer.no_mime_type.wasm                   0000664 0000000 0000000 00000000056 14746647661 0030337 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ` 	increment  
	   Aj                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/resources/incrementer.wasm                                0000664 0000000 0000000 00000000056 14746647661 0025654 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ` 	increment  
	   Aj                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/resources/incrementer.wasm.headers                        0000664 0000000 0000000 00000000073 14746647661 0027265 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        Content-Type: application/wasm
Cache-Control: max-age=3600
                                                                                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/wasm/webapi/resources/incrementer.wrong_mime_type.wasm                0000664 0000000 0000000 00000000056 14746647661 0031057 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                         asm   ` 	increment  
	   Aj                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/wasm/webapi/resources/incrementer.wrong_mime_type.wasm.headers        0000664 0000000 0000000 00000000063 14746647661 0032467 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        Content-Type: text/css
Cache-Control: max-age=3600
                                                                                                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/wasm/webapi/status.any.js                                             0000664 0000000 0000000 00000000661 14746647661 0023107 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: global=window,worker

const statuses = [
  0,
  300,
  400,
  404,
  500,
  600,
  700,
  999,
];

for (const method of ["compileStreaming", "instantiateStreaming"]) {
  for (const status of statuses) {
    promise_test(t => {
      const response = fetch(`status.py?status=${status}`);
      return promise_rejects_js(t, TypeError, WebAssembly[method](response));
    }, `Response with status ${status}: ${method}`);
  }
}
                                                                               node-23.7.0/test/fixtures/wpt/wasm/webapi/wasm_stream_compile_test.html                             0000664 0000000 0000000 00000012723 14746647661 0026421 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>WebAssembly.compileStreaming</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/get-host-info.sub.js"></script>
<script>
  promise_test(async function() {
      const response = await fetch('resources/incrementer.wasm');
      const module = await WebAssembly.compileStreaming(response);
      assert_true(module instanceof WebAssembly.Module);
  }, "compileStreaming using resolved response");

  promise_test(async function() {
      const response = await fetch('resources/incrementer.wasm');
      const module = await WebAssembly.compileStreaming(response);
      const instance = new WebAssembly.Instance(module);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "compileStreaming using resolved response and check instantiate");

  promise_test(async function() {
      const result = fetch('resources/incrementer.wasm');
      const module = await WebAssembly.compileStreaming(result);
      const instance = new WebAssembly.Instance(module);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "compileStreaming using promise response from fetch and check instantiate");

  promise_test(async function(t) {
      const result = fetch('resources/incrementer.wrong_mime_type.wasm');
      await promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(result));
  }, "compileStreaming raise error if wrong mime type");

  promise_test(async function(t) {
      const result = fetch('resources/incrementer.no_mime_type.wasm?pipe=header(Content-Type,)');
      await promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(result));
  }, "compileStreaming raise error if no mime type");

  promise_test(async function(t) {
      const result = fetch('webapi/status.py?status=404');
      await promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(result));
  }, "compileStreaming raise error if 404 status");

  const getWasmUrl = fileName => {
      const host_info = get_host_info();
      const url = host_info.HTTP_ORIGIN_WITH_DIFFERENT_PORT + '/wasm/webapi/';
      return url + fileName + "?pipe=header(Access-Control-Allow-Origin,*)";
  };

  promise_test(async function() {
      const result = fetch(getWasmUrl('resources/incrementer.wasm'), {"mode": "cors"} );
      const module = await WebAssembly.compileStreaming(result);
      assert_true(module instanceof WebAssembly.Module);
  }, "compileStreaming check CORS");

  promise_test(async function(t) {
      const result = fetch(getWasmUrl('resources/incrementer.wasm'), {"mode": "no-cors"} );
      await promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(result));
  }, "compileStreaming raise error if no-cors");

  promise_test(async function() {
      const v = await fetch('resources/incrementer.wasm');
      const buffer = await v.arrayBuffer();
      const response = new Response(buffer, { headers: { "Content-Type" : "application/wasm" }});
      const module = await WebAssembly.compileStreaming(response);
      assert_true(module instanceof WebAssembly.Module);
  }, "compileStreaming receive promise with response created from ArrayBuffer");

  promise_test(async function() {
      const v = await fetch('resources/incrementer.wasm');
      const buffer = await v.arrayBuffer();
      const stream = new ReadableStream({
        start(controller) {
          (async () => {
            await Promise.resolve().then(() => controller.enqueue(new Uint8Array(buffer.slice(0, 20))));
            await Promise.resolve().then(() => controller.enqueue(new Uint8Array(buffer.slice(20, buffer.byteLength))));
            await Promise.resolve().then(() => controller.close());
          })();
        }
      });
      const response = new Response(stream, { headers: { "Content-Type" : "application/wasm" }});
      const module = await WebAssembly.compileStreaming(response);
      assert_true(module instanceof WebAssembly.Module);
  }, "compileStreaming using ReadableStream with Uint8Array chunks");

  promise_test(async function(t) {
      const v = await fetch('resources/incrementer.wasm');
      const buffer = await v.arrayBuffer();
      const stream = new ReadableStream({
        start(controller) {
          // Enqueuing an ArrayBuffer rather a Uint8Array per
          // https://streams.spec.whatwg.org/#read-loop
          controller.enqueue(buffer);
          controller.close();
        }
      });
      const response = new Response(stream, { headers: { "Content-Type" : "application/wasm" }});
      await promise_rejects_js(t, TypeError, WebAssembly.compileStreaming(response));
  }, "compileStreaming using ReadableStream with ArrayBuffer chunk");

  promise_test(async function() {
      const response = await fetch('resources/incrementer.wasm');
      const blob = await response.blob();
      const module = await WebAssembly.compileStreaming(new Response(blob, { headers: { "Content-Type" : "application/wasm" }}));
      assert_true(module instanceof WebAssembly.Module);
  }, "compileStreaming using blob");

  promise_test(async function(t) {
      const response = await fetch('resources/incrementer.wasm');
      const blob = await response.blob();
      const formData = new FormData;
      formData.append('blob', blob);
      formData.append('blob2', "Hello");
      await promise_rejects_js(t, WebAssembly.CompileError, WebAssembly.compileStreaming(new Response(formData, { headers: { "Content-Type" : "application/wasm" }})));
  }, "compileStreaming using FormData");
</script>
                                             node-23.7.0/test/fixtures/wpt/wasm/webapi/wasm_stream_instantiate_test.html                         0000664 0000000 0000000 00000013215 14746647661 0027311 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>WebAssembly.instantiateStreaming</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/get-host-info.sub.js"></script>
<script>
  promise_test(async function() {
      const response = await fetch('resources/incrementer.wasm');
      const { instance, module } = await WebAssembly.instantiateStreaming(response);
      assert_true(instance instanceof WebAssembly.Instance);
      assert_true(module instanceof WebAssembly.Module);
  }, "instantiateStreaming using resolved response");

  promise_test(async function() {
      const response = await fetch('resources/incrementer.wasm');
      const { instance } = await WebAssembly.instantiateStreaming(response);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "instantiateStreaming using resolved response and check instantiate");

  promise_test(async function() {
      const result = fetch('resources/incrementer.wasm');
      const { instance } = await WebAssembly.instantiateStreaming(result);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "instantiateStreaming using promise response from fetch and check instantiate");

  promise_test(async function(t) {
      const result = fetch('resources/incrementer.wrong_mime_type.wasm');
      await promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(result));
  }, "instantiateStreaming raise error if wrong mime type");

  promise_test(async function(t) {
      const result = fetch('resources/incrementer.no_mime_type.wasm?pipe=header(Content-Type,)');
      await promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(result));
  }, "instantiateStreaming raise error if no mime type");

  promise_test(async function(t) {
      const result = fetch('webapi/status.py?status=404');
      await promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(result));
  }, "instantiateStreaming raise error if 404 status");

  const getWasmUrl = fileName => {
      const host_info = get_host_info();
      const url = host_info.HTTP_ORIGIN_WITH_DIFFERENT_PORT + '/wasm/webapi/';
      return url + fileName + "?pipe=header(Access-Control-Allow-Origin,*)";
  };

  promise_test(async function() {
      const result = fetch(getWasmUrl('resources/incrementer.wasm'), {"mode": "cors"} );
      const { instance } = await WebAssembly.instantiateStreaming(result);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "instantiateStreaming check CORS");

  promise_test(async function(t) {
      const result = fetch(getWasmUrl('resources/incrementer.wasm'), {"mode": "no-cors"} );
      await promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(result));
  }, "instantiateStreaming raise error if no-cors");

  promise_test(async function() {
      const v = await fetch('resources/incrementer.wasm');
      const buffer = await v.arrayBuffer();
      const response = new Response(buffer, { headers: { "Content-Type" : "application/wasm" }});
      const { instance } = await WebAssembly.instantiateStreaming(response);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "instantiateStreaming receive promise with response created from ArrayBuffer");

  promise_test(async function() {
      const v = await fetch('resources/incrementer.wasm');
      const buffer = await v.arrayBuffer();
      const stream = new ReadableStream({
        start(controller) {
          (async () => {
            await Promise.resolve().then(() => controller.enqueue(new Uint8Array(buffer.slice(0, 20))));
            await Promise.resolve().then(() => controller.enqueue(new Uint8Array(buffer.slice(20, buffer.byteLength))));
            await Promise.resolve().then(() => controller.close());
          })();
        }
      });
      const response = new Response(stream, { headers: { "Content-Type" : "application/wasm" }});
      const { instance } = await WebAssembly.instantiateStreaming(response);
      assert_true(instance instanceof WebAssembly.Instance);
  }, "instantiateStreaming using ReadableStream with Uint8Array chunks");

  promise_test(async function(t) {
      const v = await fetch('resources/incrementer.wasm');
      const buffer = await v.arrayBuffer();
      const stream = new ReadableStream({
        start(controller) {
          // Enqueuing an ArrayBuffer rather a Uint8Array per
          // https://streams.spec.whatwg.org/#read-loop
          controller.enqueue(buffer);
          controller.close();
        }
      });
      const response = new Response(stream, { headers: { "Content-Type" : "application/wasm" }});
      await promise_rejects_js(t, TypeError, WebAssembly.instantiateStreaming(response));
  }, "instantiateStreaming using ReadableStream with ArrayBuffer chunk");

  promise_test(async function() {
      const response = await fetch('resources/incrementer.wasm');
      const blob = await response.blob();
      const { instance, module } = await WebAssembly.instantiateStreaming(new Response(blob, { headers: { "Content-Type" : "application/wasm" }}));
      assert_true(instance instanceof WebAssembly.Instance);
      assert_true(module instanceof WebAssembly.Module);
  }, "instantiateStreaming using blob");

  promise_test(async function(t) {
      const response = await fetch('resources/incrementer.wasm');
      const blob = await response.blob();
      const formData = new FormData;
      formData.append('blob', blob);
      formData.append('blob2', "Hello");
      await promise_rejects_js(t, WebAssembly.CompileError, WebAssembly.instantiateStreaming(new Response(formData, { headers: { "Content-Type" : "application/wasm" }})));
  }, "instantiateStreaming using FormData");
</script>
                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webidl/                                                               0000775 0000000 0000000 00000000000 14746647661 0017465 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/                                            0000775 0000000 0000000 00000000000 14746647661 0023227 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/es-exceptions/                              0000775 0000000 0000000 00000000000 14746647661 0026015 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/es-exceptions/DOMException-constants.any.js 0000664 0000000 0000000 00000002664 14746647661 0033461 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        'use strict';

test(function() {
  // https://www.w3.org/Bugs/Public/show_bug.cgi?id=27732
  var constants = [
    "INDEX_SIZE_ERR",
    "DOMSTRING_SIZE_ERR",
    "HIERARCHY_REQUEST_ERR",
    "WRONG_DOCUMENT_ERR",
    "INVALID_CHARACTER_ERR",
    "NO_DATA_ALLOWED_ERR",
    "NO_MODIFICATION_ALLOWED_ERR",
    "NOT_FOUND_ERR",
    "NOT_SUPPORTED_ERR",
    "INUSE_ATTRIBUTE_ERR",
    "INVALID_STATE_ERR",
    "SYNTAX_ERR",
    "INVALID_MODIFICATION_ERR",
    "NAMESPACE_ERR",
    "INVALID_ACCESS_ERR",
    "VALIDATION_ERR",
    "TYPE_MISMATCH_ERR",
    "SECURITY_ERR",
    "NETWORK_ERR",
    "ABORT_ERR",
    "URL_MISMATCH_ERR",
    "QUOTA_EXCEEDED_ERR",
    "TIMEOUT_ERR",
    "INVALID_NODE_TYPE_ERR",
    "DATA_CLONE_ERR"
  ]
  var objects = [
    [DOMException, "DOMException constructor object"],
    [DOMException.prototype, "DOMException prototype object"]
  ]
  constants.forEach(function(name, i) {
    objects.forEach(function(o) {
      var object = o[0], description = o[1];
      test(function() {
        assert_equals(object[name], i + 1, name)
        assert_own_property(object, name)
        var pd = Object.getOwnPropertyDescriptor(object, name)
        assert_false("get" in pd, "get")
        assert_false("set" in pd, "set")
        assert_false(pd.writable, "writable")
        assert_true(pd.enumerable, "enumerable")
        assert_false(pd.configurable, "configurable")
      }, "Constant " + name + " on " + description)
    })
  })
})
                                                                            DOMException-constructor-and-prototype.any.js                                                       0000664 0000000 0000000 00000003001 14746647661 0036540 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/es-exceptions                                                                                                  test(function() {
    assert_own_property(self, "DOMException", "property of global");

    var desc = Object.getOwnPropertyDescriptor(self, "DOMException");
    assert_false("get" in desc, "get");
    assert_false("set" in desc, "set");
    assert_true(desc.writable, "writable");
    assert_false(desc.enumerable, "enumerable");
    assert_true(desc.configurable, "configurable");
}, "existence and property descriptor of DOMException");

test(function() {
    assert_own_property(self.DOMException, "prototype", "prototype property");

    var desc = Object.getOwnPropertyDescriptor(self.DOMException, "prototype");
    assert_false("get" in desc, "get");
    assert_false("set" in desc, "set");
    assert_false(desc.writable, "writable");
    assert_false(desc.enumerable, "enumerable");
    assert_false(desc.configurable, "configurable");
}, "existence and property descriptor of DOMException.prototype");

test(function() {
    assert_own_property(self.DOMException.prototype, "constructor", "property of prototype");
    var desc = Object.getOwnPropertyDescriptor(self.DOMException.prototype, "constructor");
    assert_false("get" in desc, "get");
    assert_false("set" in desc, "set");
    assert_true(desc.writable, "writable");
    assert_false(desc.enumerable, "enumerable");
    assert_true(desc.configurable, "configurable");
    assert_equals(self.DOMException.prototype.constructor, self.DOMException, "equality with actual constructor");
}, "existence and property descriptor of DOMException.prototype.constructor");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               DOMException-constructor-behavior.any.js                                                            0000664 0000000 0000000 00000012772 14746647661 0035551 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/es-exceptions                                                                                                  'use strict';

test(function() {
  var ex = new DOMException();
  assert_equals(ex.name, "Error",
                "Not passing a name should end up with 'Error' as the name");
  assert_equals(ex.message, "",
                "Not passing a message should end up with empty string as the message");
}, 'new DOMException()');

test(function() {
  var ex = new DOMException();
  assert_false(ex.hasOwnProperty("name"),
               "The name property should be inherited");
  assert_false(ex.hasOwnProperty("message"),
               "The message property should be inherited");
}, 'new DOMException(): inherited-ness');

test(function() {
  var ex = new DOMException(null);
  assert_equals(ex.name, "Error",
                "Not passing a name should end up with 'Error' as the name");
  assert_equals(ex.message, "null",
                "Passing null as message should end up with stringified 'null' as the message");
}, 'new DOMException(null)');

test(function() {
  var ex = new DOMException(undefined);
  assert_equals(ex.name, "Error",
                "Not passing a name should end up with 'Error' as the name");
  assert_equals(ex.message, "",
                "Not passing a message should end up with empty string as the message");
}, 'new DOMException(undefined)');

test(function() {
  var ex = new DOMException(undefined);
  assert_false(ex.hasOwnProperty("name"),
               "The name property should be inherited");
  assert_false(ex.hasOwnProperty("message"),
               "The message property should be inherited");
}, 'new DOMException(undefined): inherited-ness');

test(function() {
  var ex = new DOMException("foo");
  assert_equals(ex.name, "Error",
                "Not passing a name should still end up with 'Error' as the name");
  assert_equals(ex.message, "foo", "Should be using passed-in message");
}, 'new DOMException("foo")');

test(function() {
  var ex = new DOMException("foo");
  assert_false(ex.hasOwnProperty("name"),
               "The name property should be inherited");
  assert_false(ex.hasOwnProperty("message"),
              "The message property should be inherited");
}, 'new DOMException("foo"): inherited-ness');

test(function() {
  var ex = new DOMException("bar", undefined);
  assert_equals(ex.name, "Error",
                "Passing undefined for name should end up with 'Error' as the name");
  assert_equals(ex.message, "bar", "Should still be using passed-in message");
}, 'new DOMException("bar", undefined)');

test(function() {
  var ex = new DOMException("bar", "NotSupportedError");
  assert_equals(ex.name, "NotSupportedError", "Should be using the passed-in name");
  assert_equals(ex.message, "bar", "Should still be using passed-in message");
  assert_equals(ex.code, DOMException.NOT_SUPPORTED_ERR,
                "Should have the right exception code");
}, 'new DOMException("bar", "NotSupportedError")');

test(function() {
  var ex = new DOMException("bar", "NotSupportedError");
  assert_false(ex.hasOwnProperty("name"),
              "The name property should be inherited");
  assert_false(ex.hasOwnProperty("message"),
              "The message property should be inherited");
}, 'new DOMException("bar", "NotSupportedError"): inherited-ness');

test(function() {
  var ex = new DOMException("bar", "foo");
  assert_equals(ex.name, "foo", "Should be using the passed-in name");
  assert_equals(ex.message, "bar", "Should still be using passed-in message");
  assert_equals(ex.code, 0,
                "Should have 0 for code for a name not in the exception names table");
}, 'new DOMException("bar", "foo")');

[
  {name: "IndexSizeError", code: 1},
  {name: "HierarchyRequestError", code: 3},
  {name: "WrongDocumentError", code: 4},
  {name: "InvalidCharacterError", code: 5},
  {name: "NoModificationAllowedError", code: 7},
  {name: "NotFoundError", code: 8},
  {name: "NotSupportedError", code: 9},
  {name: "InUseAttributeError", code: 10},
  {name: "InvalidStateError", code: 11},
  {name: "SyntaxError", code: 12},
  {name: "InvalidModificationError", code: 13},
  {name: "NamespaceError", code: 14},
  {name: "InvalidAccessError", code: 15},
  {name: "TypeMismatchError", code: 17},
  {name: "SecurityError", code: 18},
  {name: "NetworkError", code: 19},
  {name: "AbortError", code: 20},
  {name: "URLMismatchError", code: 21},
  {name: "QuotaExceededError", code: 22},
  {name: "TimeoutError", code: 23},
  {name: "InvalidNodeTypeError", code: 24},
  {name: "DataCloneError", code: 25},

  // These were removed from the error names table.
  // See https://github.com/heycam/webidl/pull/946.
  {name: "DOMStringSizeError", code: 0},
  {name: "NoDataAllowedError", code: 0},
  {name: "ValidationError", code: 0},

  // The error names which don't have legacy code values.
  {name: "EncodingError", code: 0},
  {name: "NotReadableError", code: 0},
  {name: "UnknownError", code: 0},
  {name: "ConstraintError", code: 0},
  {name: "DataError", code: 0},
  {name: "TransactionInactiveError", code: 0},
  {name: "ReadOnlyError", code: 0},
  {name: "VersionError", code: 0},
  {name: "OperationError", code: 0},
  {name: "NotAllowedError", code: 0}
].forEach(function(test_case) {
  test(function() {
    var ex = new DOMException("msg", test_case.name);
    assert_equals(ex.name, test_case.name,
                  "Should be using the passed-in name");
    assert_equals(ex.message, "msg",
                  "Should be using the passed-in message");
    assert_equals(ex.code, test_case.code,
                  "Should have matching legacy code from error names table");
  },'new DOMexception("msg", "' + test_case.name + '")');
});
      DOMException-custom-bindings.any.js                                                                 0000664 0000000 0000000 00000011560 14746647661 0034466 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/es-exceptions                                                                                                  "use strict";

test(() => {
  assert_throws_js(TypeError, () => DOMException());
}, "Cannot construct without new");

test(() => {
  assert_equals(Object.getPrototypeOf(DOMException.prototype), Error.prototype);
}, "inherits from Error: prototype-side");

test(() => {
  assert_equals(Object.getPrototypeOf(DOMException), Function.prototype);
}, "does not inherit from Error: class-side");

test(() => {
  const e = new DOMException("message", "name");
  assert_false(e.hasOwnProperty("message"), "property is not own");

  const propDesc = Object.getOwnPropertyDescriptor(DOMException.prototype, "message");
  assert_equals(typeof propDesc.get, "function", "property descriptor is a getter");
  assert_equals(propDesc.set, undefined, "property descriptor is not a setter");
  assert_true(propDesc.enumerable, "property descriptor enumerable");
  assert_true(propDesc.configurable, "property descriptor configurable");
}, "message property descriptor");

test(() => {
  const getter = Object.getOwnPropertyDescriptor(DOMException.prototype, "message").get;

  assert_throws_js(TypeError, () => getter.apply({}));
}, "message getter performs brand checks (i.e. is not [LegacyLenientThis])");

test(() => {
  const e = new DOMException("message", "name");
  assert_false(e.hasOwnProperty("name"), "property is not own");

  const propDesc = Object.getOwnPropertyDescriptor(DOMException.prototype, "name");
  assert_equals(typeof propDesc.get, "function", "property descriptor is a getter");
  assert_equals(propDesc.set, undefined, "property descriptor is not a setter");
  assert_true(propDesc.enumerable, "property descriptor enumerable");
  assert_true(propDesc.configurable, "property descriptor configurable");
}, "name property descriptor");

test(() => {
  const getter = Object.getOwnPropertyDescriptor(DOMException.prototype, "name").get;

  assert_throws_js(TypeError, () => getter.apply({}));
}, "name getter performs brand checks (i.e. is not [LegacyLenientThis])");

test(() => {
  const e = new DOMException("message", "name");
  assert_false(e.hasOwnProperty("code"), "property is not own");

  const propDesc = Object.getOwnPropertyDescriptor(DOMException.prototype, "code");
  assert_equals(typeof propDesc.get, "function", "property descriptor is a getter");
  assert_equals(propDesc.set, undefined, "property descriptor is not a setter");
  assert_true(propDesc.enumerable, "property descriptor enumerable");
  assert_true(propDesc.configurable, "property descriptor configurable");
}, "code property descriptor");

test(() => {
  const getter = Object.getOwnPropertyDescriptor(DOMException.prototype, "code").get;

  assert_throws_js(TypeError, () => getter.apply({}));
}, "code getter performs brand checks (i.e. is not [LegacyLenientThis])");

test(() => {
  const e = new DOMException("message", "InvalidCharacterError");
  assert_equals(e.code, 5, "Initially the code is set to 5");

  Object.defineProperty(e, "name", {
    value: "WrongDocumentError"
  });

  assert_equals(e.code, 5, "The code is still set to 5");
}, "code property is not affected by shadowing the name property");

test(() => {
  const e = new DOMException("message", "name");
  assert_equals(Object.prototype.toString.call(e), "[object DOMException]");
}, "Object.prototype.toString behavior is like other interfaces");

test(() => {
  const e = new DOMException("message", "name");
  assert_false(e.hasOwnProperty("toString"), "toString must not exist on the instance");
  assert_false(DOMException.prototype.hasOwnProperty("toString"), "toString must not exist on DOMException.prototype");
  assert_equals(typeof e.toString, "function", "toString must still exist (via Error.prototype)");
}, "Inherits its toString() from Error.prototype");

test(() => {
  const e = new DOMException("message", "name");
  assert_equals(e.toString(), "name: message",
    "The default Error.prototype.toString() behavior must work on supplied name and message");

  Object.defineProperty(e, "name", { value: "new name" });
  Object.defineProperty(e, "message", { value: "new message" });
  assert_equals(e.toString(), "new name: new message",
    "The default Error.prototype.toString() behavior must work on shadowed names and messages");
}, "toString() behavior from Error.prototype applies as expected");

test(() => {
  assert_throws_js(TypeError, () => DOMException.prototype.toString());
}, "DOMException.prototype.toString() applied to DOMException.prototype throws because of name/message brand checks");

test(() => {
  let stackOnNormalErrors;
  try {
    throw new Error("normal error");
  } catch (e) {
    stackOnNormalErrors = e.stack;
  }

  let stackOnDOMException;
  try {
    throw new DOMException("message", "name");
  } catch (e) {
    stackOnDOMException = e.stack;
  }

  assert_equals(typeof stackOnDOMException, typeof stackOnNormalErrors, "The typeof values must match");
}, "If the implementation has a stack property on normal errors, it also does on DOMExceptions");
                                                                                                                                                node-23.7.0/test/fixtures/wpt/webidl/ecmascript-binding/es-exceptions/exceptions.html               0000664 0000000 0000000 00000005123 14746647661 0031065 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<meta charset=utf-8>
<title>DOMException-throwing tests</title>
<link rel=author title="Aryeh Gregor" href=ayg@aryeh.name>
<div id=log></div>
<script src=/resources/testharness.js></script>
<script src=/resources/testharnessreport.js></script>
<script>
/**
 * This file just picks one case where browsers are supposed to throw an
 * exception, and tests the heck out of whether it meets the spec.  In the
 * future, all these checks should be in assert_throws_dom(), but we don't want
 * every browser failing every assert_throws_dom() check until they fix every
 * single bug in their exception-throwing.
 *
 * We don't go out of our way to test everything that's already tested by
 * interfaces.html, like whether all constants are present on the object, but
 * some things are duplicated.
 */
setup({explicit_done: true});

function testException(exception, global, desc) {
  test(function() {
    assert_equals(global.Object.getPrototypeOf(exception),
                  global.DOMException.prototype);
  }, desc + "Object.getPrototypeOf(exception) === DOMException.prototype");


  test(function() {
    assert_false(exception.hasOwnProperty("name"));
  }, desc + "exception.hasOwnProperty(\"name\")");
  test(function() {
    assert_false(exception.hasOwnProperty("message"));
  }, desc + "exception.hasOwnProperty(\"message\")");

  test(function() {
    assert_equals(exception.name, "HierarchyRequestError");
  }, desc + "exception.name === \"HierarchyRequestError\"");

  test(function() {
    assert_equals(exception.code, global.DOMException.HIERARCHY_REQUEST_ERR);
  }, desc + "exception.code === DOMException.HIERARCHY_REQUEST_ERR");

  test(function() {
    assert_equals(global.Object.prototype.toString.call(exception),
                  "[object DOMException]");
  }, desc + "Object.prototype.toString.call(exception) === \"[object DOMException]\"");
}


// Test in current window
var exception = null;
try {
  // This should throw a HierarchyRequestError in every browser since the
  // Stone Age, so we're really only testing exception-throwing details.
  document.documentElement.appendChild(document);
} catch(e) {
  exception = e;
}
testException(exception, window, "");

// Test in iframe
var iframe = document.createElement("iframe");
iframe.src = "about:blank";
iframe.onload = function() {
  var exception = null;
  try {
    iframe.contentDocument.documentElement.appendChild(iframe.contentDocument);
  } catch(e) {
    exception = e;
  }
  testException(exception, iframe.contentWindow, "In iframe: ");

  document.body.removeChild(iframe);
  done();
};
document.body.appendChild(iframe);
</script>
                                                                                                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/webmessaging/                                                         0000775 0000000 0000000 00000000000 14746647661 0020672 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/                                        0000775 0000000 0000000 00000000000 14746647661 0024165 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/WEB_FEATURES.yml                        0000664 0000000 0000000 00000000062 14746647661 0026621 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        features:
- name: broadcast-channel
  files: "**"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/basics.any.js                           0000664 0000000 0000000 00000010420 14746647661 0026552 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
  assert_throws_js(
      TypeError,
      () => BroadcastChannel(""),
      "Calling BroadcastChannel constructor without 'new' must throw"
    );
}, "BroadcastChannel constructor called as normal function");

async_test(t => {
    let c1 = new BroadcastChannel('eventType');
    let c2 = new BroadcastChannel('eventType');

    c2.onmessage = t.step_func(e => {
        assert_true(e instanceof MessageEvent);
        assert_equals(e.target, c2);
        assert_equals(e.type, 'message');
        assert_equals(e.origin, location.origin, 'origin');
        assert_equals(e.data, 'hello world');
        assert_equals(e.source, null, 'source');
        t.done();
      });
    c1.postMessage('hello world');
  }, 'postMessage results in correct event');

async_test(t => {
    let c1 = new BroadcastChannel('order');
    let c2 = new BroadcastChannel('order');
    let c3 = new BroadcastChannel('order');

    let events = [];
    let doneCount = 0;
    let handler = t.step_func(e => {
      events.push(e);
      if (e.data == 'done') {
        doneCount++;
        if (doneCount == 2) {
          assert_equals(events.length, 6);
          assert_equals(events[0].target, c2, 'target for event 0');
          assert_equals(events[0].data, 'from c1');
          assert_equals(events[1].target, c3, 'target for event 1');
          assert_equals(events[1].data, 'from c1');
          assert_equals(events[2].target, c1, 'target for event 2');
          assert_equals(events[2].data, 'from c3');
          assert_equals(events[3].target, c2, 'target for event 3');
          assert_equals(events[3].data, 'from c3');
          assert_equals(events[4].target, c1, 'target for event 4');
          assert_equals(events[4].data, 'done');
          assert_equals(events[5].target, c3, 'target for event 5');
          assert_equals(events[5].data, 'done');
          t.done();
        }
      }
    });
    c1.onmessage = handler;
    c2.onmessage = handler;
    c3.onmessage = handler;

    c1.postMessage('from c1');
    c3.postMessage('from c3');
    c2.postMessage('done');
  }, 'messages are delivered in port creation order');

async_test(t => {
    let c1 = new BroadcastChannel('closed');
    let c2 = new BroadcastChannel('closed');
    let c3 = new BroadcastChannel('closed');

    c2.onmessage = t.unreached_func();
    c2.close();
    c3.onmessage = t.step_func(() => t.done());
    c1.postMessage('test');
  }, 'messages aren\'t delivered to a closed port');

 async_test(t => {
    let c1 = new BroadcastChannel('closed');
    let c2 = new BroadcastChannel('closed');
    let c3 = new BroadcastChannel('closed');

    c2.onmessage = t.unreached_func();
    c3.onmessage = t.step_func(() => t.done());
    c1.postMessage('test');
    c2.close();
}, 'messages aren\'t delivered to a port closed after calling postMessage.');

async_test(t => {
    let c1 = new BroadcastChannel('create-in-onmessage');
    let c2 = new BroadcastChannel('create-in-onmessage');

    c2.onmessage = t.step_func(e => {
        assert_equals(e.data, 'first');
        c2.close();
        let c3 = new BroadcastChannel('create-in-onmessage');
        c3.onmessage = t.step_func(event => {
            assert_equals(event.data, 'done');
            t.done();
          });
        c1.postMessage('done');
      });
    c1.postMessage('first');
    c2.postMessage('second');
  }, 'closing and creating channels during message delivery works correctly');

async_test(t => {
    let c1 = new BroadcastChannel('close-in-onmessage');
    let c2 = new BroadcastChannel('close-in-onmessage');
    let c3 = new BroadcastChannel('close-in-onmessage');
    let events = [];
    c1.onmessage = e => events.push('c1: ' + e.data);
    c2.onmessage = e => events.push('c2: ' + e.data);
    c3.onmessage = e => events.push('c3: ' + e.data);

    // c2 closes itself when it receives the first message
    c2.addEventListener('message', e => {
        c2.close();
      });

    c3.addEventListener('message', t.step_func(e => {
        if (e.data == 'done') {
          assert_array_equals(events, [
              'c2: first',
              'c3: first',
              'c3: done']);
          t.done();
        }
      }));
    c1.postMessage('first');
    c1.postMessage('done');
  }, 'Closing a channel in onmessage prevents already queued tasks from firing onmessage events');
                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/blobs.html                              0000664 0000000 0000000 00000005162 14746647661 0026160 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/gc.js"></script>
<script>
async_test(t => {
    const c1 = new BroadcastChannel('blob');
    const c2 = new BroadcastChannel('blob');
    const c3 = new BroadcastChannel('blob');

    let readCount = 0;
    c2.onmessage = t.step_func(e => {
        // check blob
        assert_true('blob' in e.data);
        assert_true(e.data.blob instanceof Blob);
        assert_equals(e.data.blob.size, 6);
        const reader = new FileReader();
        reader.onerror = t.unreached_func();
        reader.onload = t.step_func(() => {
            assert_equals(reader.result, 'foobar');
            if (++readCount == 2)
              t.done();
          });
        reader.readAsText(e.data.blob);
      });
    c3.onmessage = c2.onmessage;
    (() => {
      c1.postMessage({blob: new Blob(['foo', 'bar'])});
    })();
    garbageCollect();
  }, 'Blobs work on BroadcastChannel');

async_test(t => {
    const c1 = new BroadcastChannel('blobworker');
    const c2 = new BroadcastChannel('blobworker');
    const events = [];

    const verifyEvents = function() {
        assert_equals(events.length, 5);
        assert_equals(events[0], 'from worker');
        assert_equals(events[1], 'from worker');
        assert_true(events[2].blob instanceof Blob);
        assert_equals(events[2].blob.size, 11);
        assert_true(events[3].blob instanceof Blob);
        assert_equals(events[3].blob.size, 11);
        assert_equals(events[4], 'done');
        const reader = new FileReader();
        reader.onerror = t.unreached_func();
        reader.onload = t.step_func(() => {
            assert_equals(reader.result, 'hello-world');
            t.done();
          });
        reader.readAsText(events[3].blob);
    };

    let receivedDone = false;
    let receivedWorkerDone = false;

    c1.onmessage = e => events.push(e.data);
    c2.onmessage = e => events.push(e.data);
    c2.addEventListener('message', t.step_func(e => {
        if (e.data.blob)
          c1.postMessage('done');
        if (e.data === 'done')
          receivedDone = true;
        if (receivedDone && receivedWorkerDone)
          verifyEvents();
      }));

    const worker = new Worker('resources/worker.js');
    worker.onmessage = t.step_func(e => {
        receivedWorkerDone = true;
        if (receivedDone && receivedWorkerDone)
          verifyEvents();
      });
    worker.postMessage({channel: 'blobworker'});
    worker.postMessage({blob: ['hello-world']});

  }, 'Blobs work with workers on BroadcastChannel');

</script>
                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/cross-origin.html                       0000664 0000000 0000000 00000002042 14746647661 0027467 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/get-host-info.sub.js"></script>
<!-- Pull in the with_iframe helper function from the service worker tests -->
<script src="/service-workers/service-worker/resources/test-helpers.sub.js"></script>
<body>
<script>

const events = [];

function testCompletion(t) {
  return new Promise((resolve) => {
    window.addEventListener("message", t.step_func(e => {
      if (e.data == 'done') {
        assert_equals(events.length, 0);
        resolve();
      }
    }));
  });
}

promise_test(async t => {

  const bc0 = new BroadcastChannel('no-cross-origin-messages');
  bc0.onmessage = e => {window.events.push(e);};

  const testResults = testCompletion(t);
  const url = get_host_info().HTTPS_NOTSAMESITE_ORIGIN +
    '/webmessaging/broadcastchannel/resources/cross-origin.html';
  await with_iframe(url);

  return testResults;
}, "Messages aren't delivered across origins");

</script>
</body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/cross-partition.https.tentative.html    0000664 0000000 0000000 00000035133 14746647661 0033363 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<meta name="timeout" content="long">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/get-host-info.sub.js"></script>
<script src="/common/utils.js"></script>
<script src="/common/dispatcher/dispatcher.js"></script>
<!-- Pull in executor_path needed by newPopup / newIframe -->
<script src="/html/cross-origin-embedder-policy/credentialless/resources/common.js"></script>
<!-- Pull in importScript / newPopup / newIframe -->
<script src="/html/anonymous-iframe/resources/common.js"></script>
<body>
<script>

const bc_postmessage_js = (channel_name, message, done_queue_name) => `
  const bc = new BroadcastChannel("${channel_name}");
  bc.postMessage("${message}");
  send("${done_queue_name}", "done");
`;

const add_iframe_js = (iframe_origin, response_queue_uuid) => `
  const importScript = ${importScript};
  await importScript("/html/cross-origin-embedder-policy/credentialless" +
                   "/resources/common.js");
  await importScript("/html/anonymous-iframe/resources/common.js");
  await importScript("/common/utils.js");
  send("${response_queue_uuid}", newIframe("${iframe_origin}"));
`;

const same_site_origin = get_host_info().HTTPS_ORIGIN;
const cross_site_origin = get_host_info().HTTPS_NOTSAMESITE_ORIGIN;

async function create_test_iframes(t, response_queue_uuid) {

  // Create a same-origin iframe in a cross-site popup.
  const not_same_site_popup_uuid = newPopup(t, cross_site_origin);
  send(not_same_site_popup_uuid,
       add_iframe_js(same_site_origin, response_queue_uuid));
  const iframe_1_uuid = await receive(response_queue_uuid);

  // Create a same-origin iframe in a same-site popup.
  const same_origin_popup_uuid = newPopup(t, same_site_origin);
  send(same_origin_popup_uuid,
       add_iframe_js(same_site_origin, response_queue_uuid));
  const iframe_2_uuid = await receive(response_queue_uuid);

  return [iframe_1_uuid, iframe_2_uuid];
}

promise_test(t => {
  return new Promise(async (resolve, reject) => {
    const response_queue_uuid = token();

    const [iframe_1_uuid, iframe_2_uuid] =
      await create_test_iframes(t, response_queue_uuid);

    const channel_name = token();
    const bc = new BroadcastChannel(channel_name);
    bc.onmessage = resolve;

    // Instruct the not-same-top-level-site iframe to send a message on the BC
    // channel we are listening on. This message should not be received since
    // the iframe should be in a different partition.
    send(iframe_1_uuid,
         bc_postmessage_js(channel_name, "iframe1 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger iframe1 BroadcastChannel message creation");
    }

    // Now instruct the same-top-level-site iframe to send a BC message. By
    // the time we send the script to execute, have it send the BC message,
    // and then receive the BC message in our BC instance, it should be
    // reasonable to assume that the message from the first iframe would have
    // been delivered if it was going to be.
    send(iframe_2_uuid,
         bc_postmessage_js(channel_name, "iframe2 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger iframe2 BroadcastChannel message creation");
    }

  }).then(event => {
    assert_equals(event.data, "iframe2 msg");
  });

}, "BroadcastChannel messages aren't received from a cross-partition iframe");

// Optional Test: Checking for partitioned BroadcastChannels in an A->B->A
// (nested-iframe with cross-site ancestor chain) scenario.
promise_test(t => {
  return new Promise(async (resolve, reject) => {
    const response_queue_uuid = token();

    const [cross_site_iframe_uuid, all_same_parent_iframe_uuid] =
      await create_test_iframes(t, response_queue_uuid);

    // Create a same-origin iframe in a cross-site iframe in a same-site popup.
    // Create the same-site child iframe of the cross-site iframe (A->B->A).
    send(cross_site_iframe_uuid,
         add_iframe_js(same_site_origin, response_queue_uuid));
    const same_site_iframe_uuid = await receive(response_queue_uuid);

    // Create a same-origin iframe in a same-site iframe in a same-site popup.
    // Create the same-site child iframe of the same-site parent iframe (A->A->A).
    send(all_same_parent_iframe_uuid,
         add_iframe_js(same_site_origin, response_queue_uuid));
    const all_same_child_iframe_uuid = await receive(response_queue_uuid);

    const channel_name = token();
    const bc = new BroadcastChannel(channel_name);
    bc.onmessage = resolve;

    // Instruct the A->B->A child iframe to send a message on the BC
    // channel we are listening on. This message should not be received since
    // the iframe should be in a different partition.
    send(same_site_iframe_uuid,
      bc_postmessage_js(channel_name, "iframe1 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger A->B->A BroadcastChannel message creation");
    }

    // Now instruct the A->A->A child iframe to send a BC message. By
    // the time we send the script to execute, send the BC message,
    // and receive the BC message in our BC instance, it should be
    // reasonable to assume that the message from the first iframe would have
    // been delivered if it was going to be.
    send(all_same_child_iframe_uuid,
      bc_postmessage_js(channel_name, "iframe2 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger A->A->A BroadcastChannel message creation");
    }

  }).then(event => {
    assert_equals(event.data, "iframe2 msg");
  });

}, "BroadcastChannel messages aren't received from a nested iframe with a cross-site ancestor");

const newWorker = (origin) => {
  const worker_token = token();
  const worker_url = origin + executor_worker_path + `&uuid=${worker_token}`;
  const worker = new Worker(worker_url);
  return worker_token;
}

promise_test(t => {
  return new Promise(async (resolve, reject) => {
    const response_queue_uuid = token();

    const create_worker_js = (origin) => `
      const importScript = ${importScript};
      await importScript("/html/cross-origin-embedder-policy/credentialless" +
                       "/resources/common.js");
      await importScript("/html/anonymous-iframe/resources/common.js");
      await importScript("/common/utils.js");
      const newWorker = ${newWorker};
      send("${response_queue_uuid}", newWorker("${origin}"));
    `;

    const [iframe_1_uuid, iframe_2_uuid] =
      await create_test_iframes(t, response_queue_uuid);

    // Create a dedicated worker in the cross-top-level-site iframe.
    send(iframe_1_uuid, create_worker_js(same_site_origin));
    const worker_1_uuid = await receive(response_queue_uuid);

    // Create a dedicated worker in the same-top-level-site iframe.
    send(iframe_2_uuid, create_worker_js(same_site_origin));
    const worker_2_uuid = await receive(response_queue_uuid);

    const channel_name = token();
    const bc = new BroadcastChannel(channel_name);
    bc.onmessage = async (e) => {
      await send(worker_1_uuid, "self.close();");
      await send(worker_2_uuid, "self.close();");
      resolve(e);
    };

    // Instruct the not-same-top-level-site worker to send a message on the BC
    // channel we are listening on. This message should not be received since
    // the worker should be in a different partition.
    send(worker_1_uuid,
         bc_postmessage_js(channel_name, "worker1 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger worker1 BroadcastChannel message creation");
    }

    // Now instruct the same-top-level-site worker to send a BC message. By
    // the time we send the script to execute, have it send the BC message,
    // and then receive the BC message in our BC instance, it should be
    // reasonable to assume that the message from the first worker would have
    // been delivered if it was going to be.
    send(worker_2_uuid,
         bc_postmessage_js(channel_name, "worker2 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger worker2 BroadcastChannel message creation");
    }

  }).then(event => {
    assert_equals(event.data, "worker2 msg");
  });

}, "BroadcastChannel messages aren't received from a cross-partition dedicated worker");

const newSharedWorker = (origin) => {
  const worker_token = token();
  const worker_url = origin + executor_worker_path + `&uuid=${worker_token}`;
  const worker = new SharedWorker(worker_url, worker_token);
  return worker_token;
}

promise_test(t => {
  return new Promise(async (resolve, reject) => {
    const response_queue_uuid = token();

    const create_worker_js = (origin) => `
      const importScript = ${importScript};
      await importScript("/html/cross-origin-embedder-policy/credentialless" +
                       "/resources/common.js");
      await importScript("/html/anonymous-iframe/resources/common.js");
      await importScript("/common/utils.js");
      const newSharedWorker = ${newSharedWorker};
      send("${response_queue_uuid}", newSharedWorker("${origin}"));
    `;

    const [iframe_1_uuid, iframe_2_uuid] =
      await create_test_iframes(t, response_queue_uuid);

    // Create a shared worker in the cross-top-level-site iframe.
    send(iframe_1_uuid, create_worker_js(same_site_origin));
    const worker_1_uuid = await receive(response_queue_uuid);

    // Create a shared worker in the same-top-level-site iframe.
    send(iframe_2_uuid, create_worker_js(same_site_origin));
    const worker_2_uuid = await receive(response_queue_uuid);

    const channel_name = token();
    const bc = new BroadcastChannel(channel_name);
    bc.onmessage = async (e) => {
      await send(worker_1_uuid, "self.close();");
      await send(worker_2_uuid, "self.close();");
      resolve(e);
    };

    // Instruct the not-same-top-level-site worker to send a message on the BC
    // channel we are listening on. This message should not be received since
    // the worker should be in a different partition.
    send(worker_1_uuid,
         bc_postmessage_js(channel_name, "worker1 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger worker1 BroadcastChannel message creation");
    }

    // Now instruct the same-top-level-site worker to send a BC message. By
    // the time we send the script to execute, have it send the BC message,
    // and then receive the BC message in our BC instance, it should be
    // reasonable to assume that the message from the first worker would have
    // been delivered if it was going to be.
    send(worker_2_uuid,
         bc_postmessage_js(channel_name, "worker2 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger worker2 BroadcastChannel message creation");
    }

  }).then(event => {
    assert_equals(event.data, "worker2 msg");
  });

}, "BroadcastChannel messages aren't received from a cross-partition shared worker");

const newServiceWorker = async (origin) => {
  const worker_token = token();
  const worker_url = origin + executor_service_worker_path +
                     `&uuid=${worker_token}`;
  const worker_url_path = executor_service_worker_path.substring(0,
                              executor_service_worker_path.lastIndexOf('/'));
  const scope = worker_url_path + "/not-used/";
  const reg = await navigator.serviceWorker.register(worker_url,
                                                     {'scope': scope});
  return worker_token;
}

promise_test(t => {
  return new Promise(async (resolve, reject) => {
    const response_queue_uuid = token();

    const create_worker_js = (origin) => `
      const importScript = ${importScript};
      await importScript("/html/cross-origin-embedder-policy/credentialless" +
                       "/resources/common.js");
      await importScript("/html/anonymous-iframe/resources/common.js");
      await importScript("/common/utils.js");
      const newServiceWorker = ${newServiceWorker};
      send("${response_queue_uuid}", await newServiceWorker("${origin}"));
    `;

    const [iframe_1_uuid, iframe_2_uuid] =
      await create_test_iframes(t, response_queue_uuid);

    // Create a service worker in the cross-top-level-site iframe.
    send(iframe_1_uuid, create_worker_js(same_site_origin));
    var worker_1_uuid = await receive(response_queue_uuid);

    const channel_name = token();
    const bc = new BroadcastChannel(channel_name);
    bc.onmessage = async (e) => {
      if (worker_1_uuid) {
        await send(worker_1_uuid, "self.registration.unregister();");
      }
      if (worker_2_uuid) {
        await send(worker_2_uuid, "self.registration.unregister();");
      }
      resolve(e);
    };

    // Instruct the not-same-top-level-site worker to send a message on the BC
    // channel we are listening on. This message should not be received since
    // the worker should be in a different partition.
    send(worker_1_uuid,
         bc_postmessage_js(channel_name, "worker1 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger worker1 BroadcastChannel message creation");
    }

    await send(worker_1_uuid, "await self.registration.unregister();");
    worker_1_uuid = undefined;

    // Create a service worker in the same-top-level-site iframe. Note that
    // if service workers are unpartitioned then this new service worker would
    // replace the one created above. This is why we wait to create the second
    // service worker until after we are done with the first one.
    send(iframe_2_uuid, create_worker_js(same_site_origin));
    var worker_2_uuid = await receive(response_queue_uuid);

    // Now instruct the same-top-level-site worker to send a BC message. By
    // the time we send the script to execute, have it send the BC message,
    // and then receive the BC message in our BC instance, it should be
    // reasonable to assume that the message from the first worker would have
    // been delivered if it was going to be.
    send(worker_2_uuid,
         bc_postmessage_js(channel_name, "worker2 msg", response_queue_uuid));
    if (await receive(response_queue_uuid) != "done") {
      reject("Unable to trigger worker2 BroadcastChannel message creation");
    }

    await send(worker_2_uuid, "await self.registration.unregister();");
    worker_2_uuid = undefined;

  }).then(event => {
    assert_equals(event.data, "worker2 msg");
  });

}, "BroadcastChannel messages aren't received from a cross-partition service worker");

</script>
</body>
                                                                                                                                                                                                                                                                                                                                                                                                                                     node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/detached-iframe.html                    0000664 0000000 0000000 00000013174 14746647661 0030063 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/get-host-info.sub.js"></script>
<!-- Pull in the with_iframe helper function from the service worker tests -->
<script src="/service-workers/service-worker/resources/test-helpers.sub.js"></script>
<body>
<script>
const TEST_IFRAME_CLASS_NAME = 'test-iframe';
const events = [];
var bc1;
const DONE_MSG = 'done';

function DetachedIframeTestCheckForOneMessage(t) {
  return new Promise((resolve) => {
    bc1.onmessage = t.step_func(e => {
      events.push(e);
      if (e.data == DONE_MSG) {
        assert_equals(events.length, 1);
        resolve();
      }
    });
  });
}

const IframeAction = {
  REMOVE_BEFORE_CREATION: 'remove-before-creation',
  REMOVE_AFTER_CREATION: 'remove-after-creation',
};

async function doMessageSentTest(t, channelName, action) {
  await with_iframe('about:blank');
  const iframe = document.getElementsByClassName(TEST_IFRAME_CLASS_NAME)[0];
  const iframe_BroadcastChannel = iframe.contentWindow.BroadcastChannel;

  if (action === IframeAction.REMOVE_BEFORE_CREATION) {
    iframe.remove();
  }

  events.length = 0;

  bc1 = new BroadcastChannel(channelName);
  const bc2 = new BroadcastChannel(channelName);
  const iframe_bc = new iframe_BroadcastChannel(channelName);

  if (action === IframeAction.REMOVE_AFTER_CREATION) {
    iframe.remove();
  }

  const testResultsPromise = DetachedIframeTestCheckForOneMessage(t);

  iframe_bc.postMessage('test');
  bc2.postMessage(DONE_MSG);

  bc2.close();
  iframe_bc.close();
  t.add_cleanup(() => bc1.close());

  return testResultsPromise;
}

promise_test(async t => {
  return doMessageSentTest(
      t, 'postMessage-from-detached-iframe-pre',
      IframeAction.REMOVE_AFTER_CREATION);
}, 'BroadcastChannel messages from detached iframe to parent should be ignored (BC created before detaching)');

promise_test(async t => {
  return doMessageSentTest(
      t, 'postMessage-from-detached-iframe-post',
      IframeAction.REMOVE_BEFORE_CREATION);
}, 'BroadcastChannel messages from detached iframe to parent should be ignored (BC created after detaching)');


async function doMessageReceivedTest(t, channelName, action) {
  await with_iframe('about:blank');
  const iframe = document.getElementsByClassName(TEST_IFRAME_CLASS_NAME)[0];
  const iframe_BroadcastChannel = iframe.contentWindow.BroadcastChannel;

  if (action === IframeAction.REMOVE_BEFORE_CREATION) {
    iframe.remove();
  }

  events.length = 0;

  // `iframe_bc` must be created first so that it receives messages before
  // `bc1`. That way we can tell whether `iframe_bc` received a message by
  // inspecting `events` in the `bc1` message handler.
  const iframe_bc = new iframe_BroadcastChannel(channelName);
  iframe_bc.onmessage = e => {
    events.push(e)
  };
  bc1 = new BroadcastChannel(channelName);
  const bc2 = new BroadcastChannel(channelName);

  if (action === IframeAction.REMOVE_AFTER_CREATION) {
    iframe.remove();
  }

  const testResultsPromise = DetachedIframeTestCheckForOneMessage(t);
  bc2.postMessage(DONE_MSG);

  bc2.close();
  iframe_bc.close();
  t.add_cleanup(() => bc1.close());
}

promise_test(async t => {
  return doMessageReceivedTest(
      t, 'postMessage-to-detached-iframe-pre',
      IframeAction.REMOVE_AFTER_CREATION);
}, 'BroadcastChannel messages from parent to detached iframe should be ignored (BC created before detaching)');

promise_test(async t => {
  return doMessageReceivedTest(
      t, 'postMessage-to-detached-iframe-post',
      IframeAction.REMOVE_BEFORE_CREATION);
}, 'BroadcastChannel messages from parent to detached iframe should be ignored (BC created after detaching)');


async function doMessageSendReceiveTest(t, channelName, action) {
  await with_iframe('about:blank');
  const iframe = document.getElementsByClassName(TEST_IFRAME_CLASS_NAME)[0];
  const iframe_BroadcastChannel = iframe.contentWindow.BroadcastChannel;

  if (action === IframeAction.REMOVE_BEFORE_CREATION) {
    iframe.remove();
  }

  const iframe_bc1 = new iframe_BroadcastChannel(channelName);
  const iframe_bc2 = new iframe_BroadcastChannel(channelName);
  iframe_bc1.onmessage = t.unreached_func(
      'Detached iframe BroadcastChannel instance received message unexpectedly');

  if (action === IframeAction.REMOVE_AFTER_CREATION) {
    iframe.remove();
  }

  iframe_bc2.postMessage(DONE_MSG);

  iframe_bc2.close();
  t.add_cleanup(() => iframe_bc1.close());

  // To avoid calling t.step_timeout here, instead just create two new
  // BroadcastChannel instances and complete the test when a message is passed
  // between them.  Per the spec, all "BroadcastChannel objects whose relevant
  // agents are the same" must have messages delivered to them in creation
  // order, so if we get this message then it's safe to assume the earlier
  // message would have been delivered if it was going to be.
  const bc1 = new BroadcastChannel(channelName);
  const bc2 = new BroadcastChannel(channelName);
  return new Promise((resolve) => {
    bc1.onmessage = t.step_func(e => {
      resolve();
    });
    bc2.postMessage(DONE_MSG);
  });
}

promise_test(async t => {
  return doMessageSendReceiveTest(
      t, 'postMessage-within-detached-iframe-pre',
      IframeAction.REMOVE_AFTER_CREATION);
}, 'BroadcastChannel messages within detached iframe should be ignored (BCs created before detaching)');

promise_test(async t => {
  return doMessageSendReceiveTest(
      t, 'postMessage-within-detached-iframe-post',
      IframeAction.REMOVE_BEFORE_CREATION);
}, 'BroadcastChannel messages within detached iframe should be ignored (BCs created after detaching)');

</script>
</body>
                                                                                                                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/interface.any.js                        0000664 0000000 0000000 00000003600 14746647661 0027250 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(() => assert_throws_js(TypeError, () => new BroadcastChannel()),
  'Should throw if no name is provided');

test(() => {
    let c = new BroadcastChannel(null);
    assert_equals(c.name, 'null');
  }, 'Null name should not throw');

test(() => {
    let c = new BroadcastChannel(undefined);
    assert_equals(c.name, 'undefined');
  }, 'Undefined name should not throw');

test(() => {
    let c = new BroadcastChannel('fooBar');
    assert_equals(c.name, 'fooBar');
  }, 'Non-empty name should not throw');

test(() => {
    let c = new BroadcastChannel(123);
    assert_equals(c.name, '123');
  }, 'Non-string name should not throw');

test(() => {
    let c = new BroadcastChannel('');
    assert_throws_js(TypeError, () => c.postMessage());
  }, 'postMessage without parameters should throw');

test(() => {
    let c = new BroadcastChannel('');
    c.postMessage(null);
  }, 'postMessage with null should not throw');

test(() => {
    let c = new BroadcastChannel('');
    c.close();
  }, 'close should not throw');

test(() => {
    let c = new BroadcastChannel('');
    c.close();
    c.close();
  }, 'close should not throw when called multiple times');

test(() => {
    let c = new BroadcastChannel('');
    c.close();
    assert_throws_dom('InvalidStateError', () => c.postMessage(''));
  }, 'postMessage after close should throw');

test(() => {
    let c = new BroadcastChannel('');
    assert_not_equals(c.onmessage, undefined);
  }, 'BroadcastChannel should have an onmessage event');

test(() => {
    let c = new BroadcastChannel('');
    assert_throws_dom('DataCloneError', () => c.postMessage(Symbol()));
  }, 'postMessage should throw with uncloneable data');

test(() => {
    let c = new BroadcastChannel('');
    c.close();
    assert_throws_dom('InvalidStateError', () => c.postMessage(Symbol()));
  }, 'postMessage should throw InvalidStateError after close, even with uncloneable data');
                                                                                                                                node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/opaque-origin.html                      0000664 0000000 0000000 00000015742 14746647661 0027643 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta name="timeout" content="long">
<title></title>
<script src=/resources/testharness.js></script>
<script src=/resources/testharnessreport.js></script>
</head>
<body>
<script>
<!--
promise_test(t => {
  return new Promise((resolve) => {
    let ifr = document.createElement("iframe");
    ifr.src =
      "data:text/html,<script> let bc = new BroadcastChannel(\"test\");" +
      "bc.onmessage = (e) => {" +
      "  if (e.data == \"ping\") bc.postMessage('pong');"+
      "  else parent.postMessage({workerMessageOrigin: e.data, messageOrigin: e.origin}, \"*\"); };" +
      "new Worker(URL.createObjectURL(new Blob([\"" +
      "let bc2 = new BroadcastChannel('test'); bc2.postMessage('ping'); " +
      "bc2.onmessage = e => bc2.postMessage(e.origin);" +
      "\"], {type: 'text/javascript'}))); </script>";
    window.addEventListener("message", t.step_func(e => {
        assert_equals(e.data.workerMessageOrigin, "null");
        assert_equals(e.data.messageOrigin, "null");
        resolve();
      }), {once: true});
    t.add_cleanup(() => { document.body.removeChild(ifr) });
    document.body.appendChild(ifr);
    });
}, "Opaque origin should be serialized to \"null\"");


const iframe_src = (channel_name, iframe_name) => `data:text/html,<script>
let bc2 = new BroadcastChannel("${channel_name}");
bc2.onmessage = (e) => {
  if (e.data == "from-${iframe_name}") {
    parent.postMessage("${iframe_name}-done", "*");
  } else {
    parent.postMessage("fail", "*");
  }
};
let bc3 = new BroadcastChannel("${channel_name}");
bc3.postMessage("from-${iframe_name}");
</script>`;

promise_test(t => {
  return new Promise((resolve, reject) => {
    const channel_name = "opaque-origin-test-2";
    const bc1 = new BroadcastChannel(channel_name);
    bc1.onmessage = t.unreached_func("Received message from an opaque origin");

    // We'll create an iframe and have it send a BroadcastChannel message
    // between two instances. Once the message is received, it will postMessage
    // back and we'll repeat this with another iframe. If the first
    // BroadcastChannel message is received by `bc1`, or if the second
    // BroadcastChannel message is received by `bc1` or `bc2` in the first
    // iframe, then the test should fail.

    window.addEventListener("message", e => {
      if(e.data == "iframe1-done") {
        let iframe2 = document.createElement("iframe");
        iframe2.src = iframe_src(channel_name, "iframe2");
        t.add_cleanup(() => { document.body.removeChild(iframe2) });
        document.body.appendChild(iframe2);
      } else if(e.data == "iframe2-done") {
        resolve();
      } else if(e.data == "fail") {
        reject("One opaque origin received a message from the other");
      } else {
        reject("An unexpected error occurred");
      }
    });

    let iframe1 = document.createElement("iframe");
    iframe1.src = iframe_src(channel_name, "iframe1");
    t.add_cleanup(() => { document.body.removeChild(iframe1) });
    document.body.appendChild(iframe1);
    });
}, "BroadcastChannel messages from opaque origins should be self-contained");

const data_url_worker_src = (channel_name, worker_name) => {
  const source = `
const handler = (reply) => {
  let bc2 = new BroadcastChannel("${channel_name}");
  bc2.onmessage = (e) => {
    if (e.data == "from-${worker_name}") {
      reply("${worker_name}-done");
    } else {
      reply("fail");
    }
  };
  let bc3 = new BroadcastChannel("${channel_name}");
  bc3.postMessage("from-${worker_name}");
};
// For dedicated workers:
self.addEventListener("message", () => handler(self.postMessage));
// For shared workers:
self.addEventListener("connect", (e) => {
  var port = e.ports[0];
  port.onmessage = () => handler(msg => port.postMessage(msg));
  port.start();

});
`;
  return "data:,".concat(encodeURIComponent(source));
}

promise_test(t => {
  return new Promise((resolve, reject) => {
    const channel_name = "opaque-origin-test-3";
    const bc1 = new BroadcastChannel(channel_name);
    bc1.onmessage = e => { reject("Received message from an opaque origin"); };

    // Same as the previous test but with data URL dedicated workers (which
    // should have opaque origins per the HTML spec).
    const worker_name_prefix = "data-url-dedicated-worker";
    const worker_1_name = `${worker_name_prefix}-1`;
    const worker_2_name = `${worker_name_prefix}-2`;

    const handler = e => {
      if(e.data == `${worker_1_name}-done`) {
        const worker2 = new Worker(data_url_worker_src(channel_name, worker_2_name));
        t.add_cleanup(() => worker2.terminate());
        worker2.addEventListener("message", handler);
        worker2.postMessage("go!");
      } else if(e.data == `${worker_2_name}-done`) {
        resolve();
      } else if(e.data == "fail") {
        reject("One opaque origin received a message from the other");
      } else {
        reject("An unexpected error occurred");
      }
    };

    let worker1 = new Worker(data_url_worker_src(channel_name, worker_1_name));
    t.add_cleanup(() => worker1.terminate());
    worker1.addEventListener("message", handler);
    worker1.postMessage("go!");
    });
}, "BroadcastChannel messages from data URL dedicated workers should be self-contained");

promise_test(() => {
  return new Promise((resolve, reject) => {
    const channel_name = "opaque-origin-test-4";
    const bc1 = new BroadcastChannel(channel_name);

    // Same as the previous test but with data URL shared workers (which
    // should have opaque origins per the HTML spec).
    const worker_name_prefix = "data-url-shared-worker";
    const worker_1_name = `${worker_name_prefix}-1`;
    const worker_2_name = `${worker_name_prefix}-2`;

    const handler = e => {
      if (e.data == `${worker_1_name}-done`) {
        const worker_script = data_url_worker_src(channel_name, worker_2_name);
        const worker2 = new SharedWorker(worker_script, worker_2_name);
        worker2.port.addEventListener("message", handler);
        worker2.port.start();
        worker2.port.postMessage("go!");
      } else if(e.data == `${worker_2_name}-done`) {
        resolve();
      } else if(e.data == "fail") {
        reject("One opaque origin received a message from the other");
      } else {
        reject("An unexpected error occurred");
      }
    };

    bc1.onmessage = e => {
      if (e.data == "go!") {
        const worker_script = data_url_worker_src(channel_name, worker_1_name);
        const worker1 = new SharedWorker(worker_script, worker_1_name);
        worker1.port.addEventListener("message", handler);
        worker1.port.start();
        worker1.port.postMessage("go!");
      } else {
        reject("Received message from an opaque origin");
      }
    };

    // Ensure that the BroadcastChannel instance above can receive messages
    // before we create the first shared worker.
    const bc2 = new BroadcastChannel(channel_name);
    bc2.postMessage("go!");
    });
}, "BroadcastChannel messages from data URL shared workers should be self-contained");
//-->
</script>
</body>
</html>
                              node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/ordering.html                           0000664 0000000 0000000 00000007550 14746647661 0026673 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<!-- Pull in the with_iframe helper function from the service worker tests -->
<script src="/service-workers/service-worker/resources/test-helpers.sub.js"></script>
<body>
<script>

const BC0_FIRST_MSG = 'from BC0 - first';
const BC1_FIRST_MSG = 'from BC1 - first';
const BC2_FIRST_MSG = 'from BC2 - first';
const BC3_FIRST_MSG = 'from BC3 - first';
const BC0_SECOND_MSG = 'from BC0 - second';
const BC1_SECOND_MSG = 'from BC1 - second';
const BC2_SECOND_MSG = 'from BC2 - second';
const BC3_SECOND_MSG = 'done';
const BC0_TARGET_NAME = 'BC1';
const BC1_TARGET_NAME = 'BC1';
const BC2_TARGET_NAME = 'BC2';
const BC3_TARGET_NAME = 'BC3';
const MULTI_FRAME_ORDERING_TEST_CHANNEL_NAME = 'multi-frame-order';

const bc0 = new BroadcastChannel(MULTI_FRAME_ORDERING_TEST_CHANNEL_NAME);
const messages = [];

function logReceivedMessage(targetname, e) {
  messages.push({'target': targetname, 'data': e.data});
}

function postMessagesToChannel() {
  return new Promise((resolve) => {
    bc0.postMessage(BC0_FIRST_MSG);
    bc0.postMessage(BC0_SECOND_MSG);
    resolve();
  });
}

// Expected flow of messages between the BroadcastChannel objects (based on
// the requirement that messages get delivered to BroadcastChannel objects
// "in creation order, oldest first") and comments describing the actions
// taken in response to each event
const EXPECTED_RESULTS = [
  // -> BC0 sends two messages, BC1 and BC2 are connected to the channel

  {'data': BC0_FIRST_MSG, 'target': BC1_TARGET_NAME},
  // -> BC1 Creates BC3 and sends first message

  {'data': BC0_FIRST_MSG, 'target': BC2_TARGET_NAME},
  // -> BC2 sends two messages

  // BC3 isn't expected to receive the messages sent before it was created, so
  // no corresponding entries here for messages from BC0.

  {'data': BC0_SECOND_MSG, 'target': BC1_TARGET_NAME},
  // -> BC1 sends second message

  {'data': BC0_SECOND_MSG, 'target': BC2_TARGET_NAME},
  // -> BC2 closes

  {'data': BC1_FIRST_MSG, 'target': BC0_TARGET_NAME},

  {'data': BC1_FIRST_MSG, 'target': BC3_TARGET_NAME},
  // -> BC3 sends first message

  {'data': BC2_FIRST_MSG, 'target': BC0_TARGET_NAME},

  {'data': BC2_FIRST_MSG, 'target': BC1_TARGET_NAME},
  // -> BC1 closes

  {'data': BC2_FIRST_MSG, 'target': BC3_TARGET_NAME},
  // -> BC3 sends second message

  {'data': BC2_SECOND_MSG, 'target': BC0_TARGET_NAME},

  {'data': BC2_SECOND_MSG, 'target': BC3_TARGET_NAME},
  // -> BC3 closes

  {'data': BC1_SECOND_MSG, 'target': BC0_TARGET_NAME},

  {'data': BC3_FIRST_MSG, 'target': BC0_TARGET_NAME},

  {'data': BC3_SECOND_MSG, 'target': BC0_TARGET_NAME},
];

function testCompletion(t) {
  return new Promise((resolve) => {
    bc0.onmessage = t.step_func(e => {
      logReceivedMessage(BC0_TARGET_NAME, e);
      if (e.data == BC3_SECOND_MSG) {
        assert_equals(messages.length, EXPECTED_RESULTS.length);
        for(var i = 0; i < messages.length; i++) {
          assert_equals(messages[i].target, EXPECTED_RESULTS[i].target, `Message ${i+1} has unexpected target`);
          assert_equals(messages[i].data, EXPECTED_RESULTS[i].data, `Message ${i+1} has unexpected message contents`);
        }
        resolve();
      }
    });
  });
}

promise_test(async t => {

  const testResults = testCompletion(t);
  // Await them sequentially because we need the BroadcastChannel object in
  // iframe1 to be created first, we need the BroadcastChannel object in
  // iframe2 to be created second, and then we only want to call
  // postMessagesToChannel once both BroadcastChannels have been created.
  await with_iframe('resources/ordering.html?id=iframe1');
  await with_iframe('resources/ordering.html?id=iframe2');
  await postMessagesToChannel();
  return testResults;
}, "Messages are delivered in port creation order across multiple frames");

</script>
</body>
                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/origin.window.js                        0000664 0000000 0000000 00000000741 14746647661 0027322 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        async_test(t => {
  const crossOriginURL = new URL("resources/origin.html", self.location.href).href.replace("://", "://天気の良い日."),
        frame = document.createElement("iframe");
  frame.src = crossOriginURL;
  document.body.appendChild(frame);
  t.add_cleanup(() => frame.remove());
  self.onmessage = t.step_func_done(e => {
    assert_equals(e.data, self.origin.replace("://", "://xn--n8j6ds53lwwkrqhv28a."));
  });
}, "Serialization of BroadcastChannel origin");
                               node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/                              0000775 0000000 0000000 00000000000 14746647661 0026177 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/cross-origin.html             0000664 0000000 0000000 00000001060 14746647661 0031500 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <body></body>
<script>
  window.onload = function() {
    bc1 = new BroadcastChannel('no-cross-origin-messages');
    bc2 = new BroadcastChannel('no-cross-origin-messages');
    bc2.onmessage = e => {
      parent.postMessage('done', "*");
    };
    // Post a message on bc1 and once we receive it in bc2, we know that the
    // message should have been sent to bc0 if messages were being passed
    // across origin (assuming compliance with the spec regarding message
    // delivery in port creation order).
    bc1.postMessage('ignition');
  }
</script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/ordering.html                 0000664 0000000 0000000 00000004335 14746647661 0030703 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <body></body>
<script>
  const BC0_FIRST_MSG = 'from BC0 - first';
  const BC1_FIRST_MSG = 'from BC1 - first';
  const BC2_FIRST_MSG = 'from BC2 - first';
  const BC3_FIRST_MSG = 'from BC3 - first';
  const BC0_SECOND_MSG = 'from BC0 - second';
  const BC1_SECOND_MSG = 'from BC1 - second';
  const BC2_SECOND_MSG = 'from BC2 - second';
  const BC3_SECOND_MSG = 'done';
  const BC0_TARGET_NAME = 'BC1';
  const BC1_TARGET_NAME = 'BC1';
  const BC2_TARGET_NAME = 'BC2';
  const BC3_TARGET_NAME = 'BC3';
  const MULTI_FRAME_ORDERING_TEST_CHANNEL_NAME = 'multi-frame-order';

  var bc1, bc2, bc3;
  var sentMessageCountForBc1 = 0;
  var sentMessageCountForBc2 = 0;
  var sentMessageCountForBc3 = 0;

  var bc1_handler = e => {
    window.top.logReceivedMessage(BC1_TARGET_NAME, e);
    switch(sentMessageCountForBc1) {
      case 0:
        bc3 = new BroadcastChannel(MULTI_FRAME_ORDERING_TEST_CHANNEL_NAME);
        bc3.onmessage = bc3_handler;
        bc1.postMessage(BC1_FIRST_MSG);
        break;
      case 1:
        bc1.postMessage(BC1_SECOND_MSG);
        break;
      case 2:
        bc1.close();
        return;
    }
    sentMessageCountForBc1 += 1;
  }
  var bc2_handler = e => {
    window.top.logReceivedMessage(BC2_TARGET_NAME, e);
    switch(sentMessageCountForBc2) {
      case 0:
        bc2.postMessage(BC2_FIRST_MSG);
        bc2.postMessage(BC2_SECOND_MSG);
        sentMessageCountForBc2 += 2;
        break;
      case 2:
        bc2.close();
        return;
    }
  };
  var bc3_handler = e => {
    window.top.logReceivedMessage(BC3_TARGET_NAME, e);
    switch(sentMessageCountForBc3) {
      case 0:
        bc3.postMessage(BC3_FIRST_MSG);
        break;
      case 1:
        bc3.postMessage(BC3_SECOND_MSG);
        break;
      case 2:
        bc3.close();
        return;
    }
    sentMessageCountForBc3 += 1;
  };

  window.onload = function() {
    const params = new URLSearchParams(window.location.search);
    if (params.get('id') === 'iframe1') {
      bc1 = new BroadcastChannel(MULTI_FRAME_ORDERING_TEST_CHANNEL_NAME);
      bc1.onmessage = bc1_handler;
    } else if (params.get('id')  === 'iframe2') {
      bc2 = new BroadcastChannel(MULTI_FRAME_ORDERING_TEST_CHANNEL_NAME);
      bc2.onmessage = bc2_handler;
    }
  }
</script>
                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/origin.html                   0000664 0000000 0000000 00000000315 14746647661 0030353 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <script>
const bc1 = new BroadcastChannel("ladila"),
      bc2 = new BroadcastChannel("ladila");
bc2.onmessage = e => {
  parent.postMessage(e.origin, "*");
}
bc1.postMessage("does not matter");
</script>
                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/sandboxed.html                0000664 0000000 0000000 00000000316 14746647661 0031034 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script>
try {
  let c = new BroadcastChannel('foo');
  parent.postMessage('Created', '*');
} catch (e) {
  parent.postMessage('Exception: ' + e.name, '*');
}
</script>
                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/service-worker.js             0000664 0000000 0000000 00000000712 14746647661 0031504 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        let promise_func = null;
let promise = new Promise(resolve => promise_func = resolve);

const SERVICE_WORKER_TEST_CHANNEL_NAME = 'service worker';
const bc3 = new BroadcastChannel(SERVICE_WORKER_TEST_CHANNEL_NAME);
bc3.onmessage = e => {
  bc3.postMessage('done');
  promise_func();
};
bc3.postMessage('from worker');

// Ensure that the worker stays alive for the duration of the test
self.addEventListener('install', evt => {
  evt.waitUntil(promise);
});
                                                      node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/resources/worker.js                     0000664 0000000 0000000 00000001643 14746647661 0030052 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        importScripts("/common/gc.js");

var c;

async function handler(e, reply) {
  if (e.data.ping) {
    c.postMessage(e.data.ping);
    return;
  }
  if (e.data.blob) {
    (() => {
      c.postMessage({blob: new Blob(e.data.blob)});
    })();
    await garbageCollect();
  }
  c = new BroadcastChannel(e.data.channel);
  let messages = [];
  c.onmessage = e => {
      if (e.data === 'ready') {
        // Ignore any 'ready' messages from the other thread since there could
        // be some race conditions between this BroadcastChannel instance
        // being created / ready to receive messages and the message being sent.
        return;
      }
      messages.push(e.data);
      if (e.data == 'done')
        reply(messages);
    };
  c.postMessage('from worker');
}

onmessage = e => handler(e, postMessage);

onconnect = e => {
  let port = e.ports[0];
  port.onmessage = e => handler(e, msg => port.postMessage(msg));
};
                                                                                             node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/sandbox.html                            0000664 0000000 0000000 00000000675 14746647661 0026521 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<title>Creating BroadcastChannel in an opaque origin</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<body>
<script>
async_test(t => {
    self.onmessage = t.step_func(e => {
        assert_equals(e.data, 'Created');
        t.done();
      });
  });
</script>
<iframe sandbox="allow-scripts" src="resources/sandboxed.html"></iframe>
</body>
                                                                   node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/service-worker.https.html               0000664 0000000 0000000 00000003064 14746647661 0031166 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>

const SERVICE_WORKER_TEST_CHANNEL_NAME = 'service worker';
const events = [];
const c1 = new BroadcastChannel(SERVICE_WORKER_TEST_CHANNEL_NAME);
const c2 = new BroadcastChannel(SERVICE_WORKER_TEST_CHANNEL_NAME);
c1.onmessage = e => events.push(e);
c2.onmessage = e => events.push(e);

function testCompletion(t) {
  return new Promise((resolve) => {
    c2.addEventListener("message", t.step_func(e => {
      if (e.data == 'from worker') {
        c2.postMessage('from c2');
      } else if (e.data == 'done') {
        assert_equals(events.length, 5);
        assert_equals(events[0].data, 'from worker');
        assert_equals(events[0].target, c1);
        assert_equals(events[1].data, 'from worker');
        assert_equals(events[1].target, c2);
        assert_equals(events[2].data, 'from c2');
        assert_equals(events[3].data, 'done');
        assert_equals(events[3].target, c1);
        assert_equals(events[4].data, 'done');
        assert_equals(events[4].target, c2);
        resolve();
      }
    }));
  });
}

promise_test(async t => {

    const testResults = testCompletion(t);
    const SCRIPT = "resources/service-worker.js";
    const SCOPE = "/webmessaging/broadcastchannel/resources/not-used/";

    const reg = await navigator.serviceWorker.register(SCRIPT, {'scope': SCOPE});
    t.add_cleanup(() => reg.unregister());

    return testResults;
  }, 'BroadcastChannel works in service workers');
</script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/webmessaging/broadcastchannel/workers.html                            0000664 0000000 0000000 00000031500 14746647661 0026546 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset=utf-8>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script>

async_test(t => {
    let c1 = new BroadcastChannel('worker');
    let c2 = new BroadcastChannel('worker');
    let events = [];

    c1.onmessage = e => events.push(e);
    c2.onmessage = e => events.push(e);

    let doneCount = 0;
    c2.addEventListener('message', t.step_func(e => {
        if (e.data == 'from worker') {
          c2.postMessage('from c2');
          c1.postMessage('done');
        } else if (e.data == 'done') {
          assert_equals(events.length, 4);
          assert_equals(events[0].data, 'from worker');
          assert_equals(events[0].target, c1);
          assert_equals(events[1].data, 'from worker');
          assert_equals(events[1].target, c2);
          assert_equals(events[2].data, 'from c2');
          assert_equals(events[3].data, 'done');
          if (++doneCount == 2) t.done();
        }
      }));

    let worker = new Worker('resources/worker.js');
    worker.onmessage = t.step_func(e => {
        assert_array_equals(e.data, ['from c2', 'done']);
        if (++doneCount == 2) t.done();
      });
    worker.postMessage({channel: 'worker'});

  }, 'BroadcastChannel works in workers');

async_test(t => {
    let c1 = new BroadcastChannel('shared worker');
    let c2 = new BroadcastChannel('shared worker');
    let events = [];

    c1.onmessage = e => events.push(e);
    c2.onmessage = e => events.push(e);

    let doneCount = 0;
    c2.addEventListener('message', t.step_func(e => {
        if (e.data == 'from worker') {
          c2.postMessage('from c2');
          c1.postMessage('done');
        } else if (e.data == 'done') {
          assert_equals(events.length, 4);
          assert_equals(events[0].data, 'from worker');
          assert_equals(events[0].target, c1);
          assert_equals(events[1].data, 'from worker');
          assert_equals(events[1].target, c2);
          assert_equals(events[2].data, 'from c2');
          assert_equals(events[3].data, 'done');
          if (++doneCount == 2) t.done();
        }
      }));

    let worker = new SharedWorker('resources/worker.js');
    worker.port.onmessage = t.step_func(e => {
        assert_array_equals(e.data, ['from c2', 'done']);
        if (++doneCount == 2) t.done();
      });
    worker.port.postMessage({channel: 'shared worker'});

  }, 'BroadcastChannel works in shared workers');

async_test(t => {
    let c = new BroadcastChannel('worker-close');
    let events = [];

    c.onmessage = e => events.push('c1: ' + e.data);

    let worker = new Worker('resources/worker.js');
    worker.onmessage = t.step_func(e => {
        assert_array_equals(events,
                            ['c1: from worker', 'c2: ready', 'c2: echo'],
                            'messages in document');
        assert_array_equals(e.data, ['done'], 'messages in worker');
        t.done();
      });
    worker.onmessagerror =
        t.unreached_func('Worker\'s onmessageerror handler called');

    c.addEventListener('message', e => {
        if (e.data == 'from worker') {
          c.close();
          if (self.gc) self.gc();
          window.setTimeout(() => {
              let c2 = new BroadcastChannel('worker-close');
              c2.onmessage = e => {
                  events.push('c2: ' + e.data);
                  if (e.data === 'ready') {
                    worker.postMessage({ping: 'echo'});
                  } else {
                    c2.postMessage('done');
                    c2.close();
                  }
                };
              // For some implementations there may be a race condition between
              // when the BroadcastChannel instance above is created / ready to
              // receive messages and when the worker calls postMessage on it's
              // BroadcastChannel instance. To avoid this, confirm that our
              // instance can receive a message before indicating to the other
              // thread that we are ready. For more details, see:
              // https://github.com/whatwg/html/issues/7267
              let c3 = new BroadcastChannel('worker-close');
              c3.postMessage('ready');
              c3.close();
            }, 1);
        }
      });

    worker.postMessage({channel: 'worker-close'});
    t.add_cleanup(() => worker.terminate());

  }, 'Closing and re-opening a channel works.');

async_test(t => {
  function workerCode() {
    close();
    try {
      var bc = new BroadcastChannel('worker-create-after-close');
    } catch (e) {
      postMessage(e);
      return;
    }
    postMessage(true);
  }

  var workerBlob = new Blob(
      [workerCode.toString() + ';workerCode();'],
      {type: 'application/javascript'});

  var w = new Worker(URL.createObjectURL(workerBlob));
  w.onmessage = t.step_func_done(function(e) {
    assert_equals(
        e.data, true,
        'BroadcastChannel creation in closed worker triggered exception: ' +
            e.data.message);
  });
  t.add_cleanup(() => w.terminate());
}, 'BroadcastChannel created after a worker self.close()');


function postMessageFromWorkerWorkerCode(workerName, channelName) {
  if (workerName === 'close-before-create-worker') {
    close();
  }
  let bc = new BroadcastChannel(channelName);
  if (workerName === 'close-after-create-worker') {
    close();
  }
  bc.postMessage(workerName + ' done');
  postMessage(true);
}

function doPostMessageFromWorkerTest(t, workerName, channelName) {
  var bc = new BroadcastChannel(channelName);
  bc.onmessage = t.step_func_done(function(e) {
    assert_equals(
        e.data, 'done-worker done',
        'BroadcastChannel message should only be received from the second worker');
  });
  t.add_cleanup(() => bc.close());

  var testMessageHandler = t.step_func(function(e) {
    assert_equals(
        e.data, true,
        'Worker sent postMessage indicating it sent a BroadcastChannel message');

    var w = createWorker(
        postMessageFromWorkerWorkerCode, 'done-worker', channelName);
    t.add_cleanup(() => w.terminate());
  });
  createWorker(
      postMessageFromWorkerWorkerCode, workerName, channelName,
      testMessageHandler);

  // To avoid calling t.step_timeout here, have the worker postMessage(true)
  // once it is finished and then we'll instantiate another worker that
  // performs the same test steps but doesn't close. By the time the
  // BroadcastChannel message in that worker gets sent successfully it should
  // be safe to assume that any BroadcastChannel messages from the previous
  // worker would have been sent if they were going to be.
}

function createWorker(workerCode, workerName, channelName, handler = null) {
  var workerCodeStr = workerCode.toString() +
      `;${workerCode.name}("${workerName}", "${channelName}");`;
  var workerBlob = new Blob([workerCodeStr], {type: 'application/javascript'});
  var w = new Worker(URL.createObjectURL(workerBlob));
  if (handler !== null) {
    w.onmessage = handler;
  }
  return w;
}

async_test(t => {
  const workerName = 'close-after-create-worker';
  const channelName = workerName + '-postmessage-from-worker';
  doPostMessageFromWorkerTest(t, workerName, channelName);
}, 'BroadcastChannel messages from closed worker to parent should be ignored (BC created before closing)');

async_test(t => {
  const workerName = 'close-before-create-worker';
  const channelName = workerName + '-postmessage-from-worker';
  doPostMessageFromWorkerTest(t, workerName, channelName);
}, 'BroadcastChannel messages from closed worker to parent should be ignored (BC created after closing)');


function postMessageToWorkerWorkerCode(workerName, channelName) {
  self.addEventListener('message', () => {
    if (workerName === 'close-before-create-worker') {
      close();
    }
    try {
      let bc1 = new BroadcastChannel(channelName);
      bc1.onmessage = e => {
        if (e.data === 'ready') {
          postMessage(e.data);
        } else if (e.data === 'test') {
          postMessage(workerName + ' done');
        }
      };
      bc1.onmessageerror = () => {
        postMessage('onmessageerror called from worker BroadcastChannel');
      };
      if (workerName === 'close-after-create-worker') {
        close();
      }
    } catch (e) {
      postMessage(e);
      return;
    }

    if (workerName === 'done-worker') {
      // For some implementations there may be a race condition between when
      // the BroadcastChannel instance above is created / ready to receive
      // messages and when the parent calls postMessage on it's
      // BroadcastChannel instance. To avoid this, confirm that our instance
      // can receive a message before indicating to the other thread that we
      // are ready. For more details, see:
      // https://github.com/whatwg/html/issues/7267
      let bc2 = new BroadcastChannel(channelName);
      bc2.postMessage('ready');
      bc2.close();
    } else {
      // Since the worker has closed, it's not expected that the
      // BroadcastChannel will receive messages (there's a separate test for
      // that), so just indicate directly that it's ready to test receiving
      // a message from the parent dispite the possibility of a race condition.
      postMessage('ready');
    }
  });
  self.addEventListener('messageerror', () => {
    postMessage('onmessageerror called from worker');
  });
}

function doPostMessageToWorkerTest(t, workerName, channelName) {
  var bc = new BroadcastChannel(channelName);
  t.add_cleanup(() => bc.close());

  var doneMessageHandler = t.step_func(function(e) {
    if (e.data === 'ready') {
      bc.postMessage('test');
    } else if (e.data === 'done-worker done') {
      t.done();
    } else {
      assert_unreached(
          'BroadcastChannel.postMessage triggered exception within second worker: ' +
          e.data.message);
    }
  });
  var testMessageHandler = t.step_func(function(e) {
    assert_equals(
        e.data, 'ready',
        'Worker sent postMessage indicating its BroadcastChannel instance is ready');
    bc.postMessage('test');

    var doneWorker = createWorker(
        postMessageToWorkerWorkerCode, 'done-worker', channelName,
        doneMessageHandler);
    t.add_cleanup(() => {
      doneWorker.terminate();
    });
    doneWorker.postMessage('start');
  });
  var testWorker = createWorker(
      postMessageToWorkerWorkerCode, workerName, channelName,
      testMessageHandler);
  testWorker.postMessage('start');
}

async_test(t => {
  const workerName = 'close-after-create-worker';
  const channelName = workerName + '-postmessage-to-worker';
  doPostMessageToWorkerTest(t, workerName, channelName);
}, 'BroadcastChannel messages from parent to closed worker should be ignored (BC created before closing)');

async_test(t => {
  const workerName = 'close-before-create-worker';
  const channelName = workerName + '-postmessage-to-worker';
  doPostMessageToWorkerTest(t, workerName, channelName);
}, 'BroadcastChannel messages from parent to closed worker should be ignored (BC created after closing)');


function postMessageWithinWorkerWorkerCode(workerName, channelName) {
  if (workerName === 'close-before-create-worker') {
    close();
  }
  try {
    let bc1 = new BroadcastChannel(channelName);
    let bc2 = new BroadcastChannel(channelName);
    bc1.onmessage = e => {
      postMessage(workerName + ' done')
    };
    if (workerName === 'close-after-create-worker') {
      close();
    }
    bc2.postMessage(true);
    postMessage(true);
  } catch (e) {
    postMessage(e);
  }
}

function doPostMessageWithinWorkerTest(t, workerName, channelName) {
  var doneMessageHandler = t.step_func(function(e) {
    if (e.data === true) {
      // Done worker has finished - no action needed
    } else if (e.data === 'done-worker done') {
      t.done();
    } else {
      assert_unreached(
          'BroadcastChannel.postMessage triggered exception within second worker: ' +
          e.data.message);
    }
  });
  var testMessageHandler = t.step_func(function(e) {
    assert_equals(
        e.data, true,
        'Worker indicated that the test procedures were executed successfully');

    var w = createWorker(
        postMessageWithinWorkerWorkerCode, 'done-worker', channelName,
        doneMessageHandler);
    t.add_cleanup(() => w.terminate());
  });
  createWorker(
      postMessageWithinWorkerWorkerCode, workerName, channelName,
      testMessageHandler);
}

async_test(t => {
  const workerName = 'close-after-create-worker';
  const channelName = workerName + '-postmessage-within-worker';
  doPostMessageWithinWorkerTest(t, workerName, channelName);
}, 'BroadcastChannel messages within closed worker should be ignored (BCs created before closing)');

async_test(t => {
  const workerName = 'close-before-create-worker';
  const channelName = workerName + '-postmessage-within-worker';
  doPostMessageWithinWorkerTest(t, workerName, channelName);
}, 'BroadcastChannel messages within closed worker should be ignored (BCs created after closing)');

</script>
                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/webstorage/                                                           0000775 0000000 0000000 00000000000 14746647661 0020361 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/META.yml                                                   0000664 0000000 0000000 00000000170 14746647661 0021630 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        spec: https://html.spec.whatwg.org/multipage/webstorage.html
suggested_reviewers:
  - siusin
  - inexorabletash
  - jdm
                                                                                                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/README.md                                                  0000664 0000000 0000000 00000000341 14746647661 0021636 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        These are the storage (`localStorage`, `sessionStorage`) tests for the
[Web storage chapter of the HTML Standard](https://html.spec.whatwg.org/multipage/webstorage.html).

IDL is covered by `/html/dom/idlharness.https.html`.
                                                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/webstorage/defineProperty.window.js                                   0000664 0000000 0000000 00000004041 14746647661 0025223 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    [9, "x"].forEach(function(key) {
        test(function() {
            var desc = {
                value: "value",
            };

            var storage = window[name];
            storage.clear();

            assert_equals(storage[key], undefined);
            assert_equals(storage.getItem(key), null);
            assert_equals(Object.defineProperty(storage, key, desc), storage);
            assert_equals(storage[key], "value");
            assert_equals(storage.getItem(key), "value");
        }, "Defining data property for key " + key + " on " + name);

        test(function() {
            var desc1 = {
                value: "value",
            };
            var desc2 = {
                value: "new value",
            };

            var storage = window[name];
            storage.clear();

            assert_equals(storage[key], undefined);
            assert_equals(storage.getItem(key), null);
            assert_equals(Object.defineProperty(storage, key, desc1), storage);
            assert_equals(storage[key], "value");
            assert_equals(storage.getItem(key), "value");

            assert_equals(Object.defineProperty(storage, key, desc2), storage);
            assert_equals(storage[key], "new value");
            assert_equals(storage.getItem(key), "new value");
        }, "Defining data property for key " + key + " on " + name + " twice");

        test(function() {
            var desc = {
                value: {
                    toString: function() { return "value"; }
                },
            };

            var storage = window[name];
            storage.clear();

            assert_equals(storage[key], undefined);
            assert_equals(storage.getItem(key), null);
            assert_equals(Object.defineProperty(storage, key, desc), storage);
            assert_equals(storage[key], "value");
            assert_equals(storage.getItem(key), "value");
        }, "Defining data property with toString for key " + key + " on " + name);
    });
});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               node-23.7.0/test/fixtures/wpt/webstorage/document-domain.html                                       0000664 0000000 0000000 00000000774 14746647661 0024342 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<title>localStorage and document.domain</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<div id="log"></div>
<iframe></iframe>
<script>
  async_test(function(t) {
    frames[0].addEventListener("storage", function(e) {
      t.step(function() {
        localStorage.clear()
        t.done()
      })
    })
    frames[0].document.domain = document.domain
    localStorage.setItem("test", "test")
  })
</script>
    node-23.7.0/test/fixtures/wpt/webstorage/eventTestHarness.js                                        0000664 0000000 0000000 00000002734 14746647661 0024232 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        storageEventList = [];
iframe = document.createElement("IFRAME");
document.body.appendChild(iframe);

function runAfterNStorageEvents(callback, expectedNumEvents)
{
    countStorageEvents(callback, expectedNumEvents, 0)
}

function countStorageEvents(callback, expectedNumEvents, times)
{
    function onTimeout()
    {
        var currentCount = storageEventList.length;
        if (currentCount == expectedNumEvents) {
            callback();
        } else if (currentCount > expectedNumEvents) {
            msg = "got at least " + currentCount + ", expected only " + expectedNumEvents + " events";
            callback(msg);
        } else if (times > 50) {
            msg = "Timeout: only got " + currentCount + ", expected " + expectedNumEvents + " events";
            callback(msg);
        } else {
            countStorageEvents(callback, expectedNumEvents, times+1);
        }
    }
    setTimeout(onTimeout, 20);
}

function clearStorage(storageName, callback)
{
    if (window[storageName].length === 0) {
        storageEventList = [];
        setTimeout(callback, 0);
    } else {
        window[storageName].clear();
        runAfterNStorageEvents(function() {
            storageEventList = [];
            callback();
        }, 1);
    }
}

function testStorages(testCallback)
{
    testCallback("sessionStorage");
    var hit = false;
    add_result_callback(function() {
        if (!hit) {
            hit = true;
            testCallback("localStorage");
        }
    });
}
                                    node-23.7.0/test/fixtures/wpt/webstorage/event_basic.html                                           0000664 0000000 0000000 00000000565 14746647661 0023537 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<meta name="timeout" content="long">
<title>WebStorage Test: StorageEvent - window.onstorage</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<div id="log"></div>
<script src="eventTestHarness.js"></script>
<script src="event_basic.js"></script>
</body>
</html>

                                                                                                                                           node-23.7.0/test/fixtures/wpt/webstorage/event_basic.js                                             0000664 0000000 0000000 00000011464 14746647661 0023207 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        testStorages(function(storageString) {
    async_test(function(t) {
        assert_true(storageString in window, storageString + " exist");
        var storage = window[storageString];
        t.add_cleanup(function() { storage.clear() });

        clearStorage(storageString, t.step_func(loadiframe));
        assert_equals(storage.length, 0, "storage.length");

        function loadiframe(msg)
        {
            iframe.onload = t.step_func(step1);
            iframe.src = "resources/event_basic.html";
        }

        function step1(msg)
        {
            storage.setItem('FOO', 'BAR');

            runAfterNStorageEvents(t.step_func(step2), 1);
        }

        function step2(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 1);
            assert_equals(storageEventList[0].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[0].key, "FOO");
            assert_equals(storageEventList[0].oldValue, null);
            assert_equals(storageEventList[0].newValue, "BAR");

            storage.setItem('FU', 'BAR');
            storage.setItem('a', '1');
            storage.setItem('b', '2');
            storage.setItem('b', '3');

            runAfterNStorageEvents(t.step_func(step3), 5);
        }

        function step3(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 5);
            assert_equals(storageEventList[1].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[1].key, "FU");
            assert_equals(storageEventList[1].oldValue, null);
            assert_equals(storageEventList[1].newValue, "BAR");

            assert_equals(storageEventList[2].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[2].key, "a");
            assert_equals(storageEventList[2].oldValue, null);
            assert_equals(storageEventList[2].newValue, "1");

            assert_equals(storageEventList[3].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[3].key, "b");
            assert_equals(storageEventList[3].oldValue, null);
            assert_equals(storageEventList[3].newValue, "2");

            assert_equals(storageEventList[4].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[4].key, "b");
            assert_equals(storageEventList[4].oldValue, "2");
            assert_equals(storageEventList[4].newValue, "3");

            storage.removeItem('FOO');

            runAfterNStorageEvents(t.step_func(step4), 6);
        }

        function step4(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 6);
            assert_equals(storageEventList[5].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[5].key, "FOO");
            assert_equals(storageEventList[5].oldValue, "BAR");
            assert_equals(storageEventList[5].newValue, null);

            storage.removeItem('FU');

            runAfterNStorageEvents(t.step_func(step5), 7);
        }

        function step5(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 7);
            assert_equals(storageEventList[6].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[6].key, "FU");
            assert_equals(storageEventList[6].oldValue, "BAR");
            assert_equals(storageEventList[6].newValue, null);

            storage.clear();

            runAfterNStorageEvents(t.step_func(step6), 8);
        }

        function step6(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 8);
            assert_equals(storageEventList[7].storageAreaString, storageString,
                "Storage event came from wrong storage type.");
            assert_equals(storageEventList[7].key, null);
            assert_equals(storageEventList[7].oldValue, null);
            assert_equals(storageEventList[7].newValue, null);

            t.done();
        }

    }, storageString + " mutations fire StorageEvents that are caught by the event listener set via window.onstorage.");
});
                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/webstorage/event_body_attribute.html                                  0000664 0000000 0000000 00000000615 14746647661 0025472 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<meta name="timeout" content="long">
<title>WebStorage Test: StorageEvent - set onstorage as body attribute</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<div id="log"></div>
<script src="eventTestHarness.js"></script>
<script src="event_body_attribute.js"></script>
</body>
</html>

                                                                                                                   node-23.7.0/test/fixtures/wpt/webstorage/event_body_attribute.js                                    0000664 0000000 0000000 00000007665 14746647661 0025156 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        testStorages(function(storageString) {
    async_test(function(t) {
        assert_true(storageString in window, storageString + " exist");
        var storage = window[storageString];
        t.add_cleanup(function() { storage.clear() });

        clearStorage(storageString, t.step_func(step0));
        assert_equals(storage.length, 0, "storage.length");

        function step0(msg)
        {
            iframe.onload = t.step_func(step1);
            // Null out the existing handler eventTestHarness.js set up;
            // otherwise this test won't be testing much of anything useful.
            iframe.contentWindow.onstorage = null;
            iframe.src = "resources/event_body_handler.html";
        }

        function step1(msg)
        {
            storageEventList = new Array();
            storage.setItem('FOO', 'BAR');

            runAfterNStorageEvents(t.step_func(step2), 1);
        }

        function step2(msg)
        {
            if (msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 1);
            assert_equals(storageEventList[0].key, "FOO");
            assert_equals(storageEventList[0].oldValue, null);
            assert_equals(storageEventList[0].newValue, "BAR");

            storage.setItem('FU', 'BAR');
            storage.setItem('a', '1');
            storage.setItem('b', '2');
            storage.setItem('b', '3');

            runAfterNStorageEvents(t.step_func(step3), 5);
        }

        function step3(msg)
        {
            if (msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 5);
            assert_equals(storageEventList[1].key, "FU");
            assert_equals(storageEventList[1].oldValue, null);
            assert_equals(storageEventList[1].newValue, "BAR");

            assert_equals(storageEventList[2].key, "a");
            assert_equals(storageEventList[2].oldValue, null);
            assert_equals(storageEventList[2].newValue, "1");

            assert_equals(storageEventList[3].key, "b");
            assert_equals(storageEventList[3].oldValue, null);
            assert_equals(storageEventList[3].newValue, "2");

            assert_equals(storageEventList[4].key, "b");
            assert_equals(storageEventList[4].oldValue, "2");
            assert_equals(storageEventList[4].newValue, "3");

            storage.removeItem('FOO');

            runAfterNStorageEvents(t.step_func(step4), 6);
        }

        function step4(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 6);
            assert_equals(storageEventList[5].key, "FOO");
            assert_equals(storageEventList[5].oldValue, "BAR");
            assert_equals(storageEventList[5].newValue, null);

            storage.removeItem('FU');

            runAfterNStorageEvents(t.step_func(step5), 7);
        }

        function step5(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 7);
            assert_equals(storageEventList[6].key, "FU");
            assert_equals(storageEventList[6].oldValue, "BAR");
            assert_equals(storageEventList[6].newValue, null);

            storage.clear();

            runAfterNStorageEvents(t.step_func(step6), 8);
        }

        function step6(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 8);
            assert_equals(storageEventList[7].key, null);
            assert_equals(storageEventList[7].oldValue, null);
            assert_equals(storageEventList[7].newValue, null);

            t.done();
        }

    }, storageString + " mutations fire StorageEvents that are caught by the event listener specified as an attribute on the body.");
});
                                                                           node-23.7.0/test/fixtures/wpt/webstorage/event_case_sensitive.html                                  0000664 0000000 0000000 00000000607 14746647661 0025457 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<meta name="timeout" content="long">
<title>WebStorage Test: StorageEvent - the case of value changed</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<div id="log"></div>
<script src="eventTestHarness.js"></script>
<script src="event_case_sensitive.js"></script>
</body>
</html>

                                                                                                                         node-23.7.0/test/fixtures/wpt/webstorage/event_case_sensitive.js                                    0000664 0000000 0000000 00000002651 14746647661 0025130 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        testStorages(function(storageString) {
    async_test(function(t) {
        assert_true(storageString in window, storageString + " exist");
        var storage = window[storageString];
        t.add_cleanup(function() { storage.clear() });

        clearStorage(storageString, t.step_func(loadiframe));
        assert_equals(storage.length, 0, "storage.length");

        function loadiframe(msg)
        {
            iframe.onload = t.step_func(step0);
            iframe.src = "resources/event_basic.html";
        }

        function step0(msg)
        {
            storage.foo = "test";
            runAfterNStorageEvents(t.step_func(step1), 1);
        }

        function step1(msg)
        {
            storageEventList = new Array();
            storage.foo = "test";

            runAfterNStorageEvents(t.step_func(step2), 0);
        }

        function step2(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 0);

            storage.foo = "TEST";

            runAfterNStorageEvents(t.step_func(step3), 1);
        }

        function step3(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 1);

            t.done();
        }
    }, storageString + " storage events fire even when only the case of the value changes.");
});
                                                                                       node-23.7.0/test/fixtures/wpt/webstorage/event_constructor.window.js                                0000664 0000000 0000000 00000005476 14746647661 0026027 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    assert_throws_js(
        TypeError,
        () => StorageEvent(""),
        "Calling StorageEvent constructor without 'new' must throw"
    );
}, "StorageEvent constructor called as normal function");

test(function() {
    assert_throws_js(TypeError, () => new StorageEvent());
    // should be redundant, but .length can be wrong with custom bindings
    assert_equals(StorageEvent.length, 1, 'StorageEvent.length');
}, 'constructor with no arguments');

test(function() {
    var event = new StorageEvent('type');
    assert_equals(event.type, 'type', 'type');
    assert_equals(event.key, null, 'key');
    assert_equals(event.oldValue, null, 'oldValue');
    assert_equals(event.newValue, null, 'newValue');
    assert_equals(event.url, '', 'url');
    assert_equals(event.storageArea, null, 'storageArea');
}, 'constructor with just type argument');

test(function() {
    assert_not_equals(localStorage, null, 'localStorage'); // precondition

    var event = new StorageEvent('storage', {
        bubbles: true,
        cancelable: true,
        key: 'key',
        oldValue: 'oldValue',
        newValue: 'newValue',
        url: 'url', // not an absolute URL to ensure it isn't resolved
        storageArea: localStorage
    });
    assert_equals(event.type, 'storage', 'type');
    assert_equals(event.bubbles, true, 'bubbles');
    assert_equals(event.cancelable, true, 'cancelable');
    assert_equals(event.key, 'key', 'key');
    assert_equals(event.oldValue, 'oldValue', 'oldValue');
    assert_equals(event.newValue, 'newValue', 'newValue');
    assert_equals(event.url, 'url', 'url');
    assert_equals(event.storageArea, localStorage, 'storageArea');
}, 'constructor with sensible type argument and members');

test(function() {
    var event = new StorageEvent(null, {
        key: null,
        oldValue: null,
        newValue: null,
        url: null,
        storageArea: null
    });
    assert_equals(event.type, 'null', 'type');
    assert_equals(event.key, null, 'key');
    assert_equals(event.oldValue, null, 'oldValue');
    assert_equals(event.newValue, null, 'newValue');
    assert_equals(event.url, 'null', 'url');
    assert_equals(event.storageArea, null, 'storageArea');
}, 'constructor with null type argument and members');

test(function() {
    var event = new StorageEvent(undefined, {
        key: undefined,
        oldValue: undefined,
        newValue: undefined,
        url: undefined,
        storageArea: undefined
    });
    assert_equals(event.type, 'undefined', 'type');
    assert_equals(event.key, null, 'key');
    assert_equals(event.oldValue, null, 'oldValue');
    assert_equals(event.newValue, null, 'newValue');
    assert_equals(event.url, '', 'url'); // not 'undefined'!
    assert_equals(event.storageArea, null, 'storageArea');
}, 'constructor with undefined type argument and members');
                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/event_initstorageevent.window.js                           0000664 0000000 0000000 00000005700 14746647661 0027022 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(() => {
    const event = new StorageEvent('storage');
    assert_throws_js(TypeError, () => event.initStorageEvent());
    // should be redundant, but .length can be wrong with custom bindings
    assert_equals(event.initStorageEvent.length, 1, 'event.initStorageEvent.length');
}, 'initStorageEvent with 0 arguments');

test(() => {
    const event = new StorageEvent('storage');
    event.initStorageEvent('type');
    assert_equals(event.type, 'type', 'event.type');
    assert_equals(event.bubbles, false, 'event.bubbles');
    assert_equals(event.cancelable, false, 'event.cancelable');
    assert_equals(event.key, null, 'event.key');
    assert_equals(event.oldValue, null, 'event.oldValue');
    assert_equals(event.newValue, null, 'event.newValue');
    assert_equals(event.url, '', 'event.url');
    assert_equals(event.storageArea, null, 'event.storageArea');
}, 'initStorageEvent with 1 argument');

test(() => {
    assert_not_equals(localStorage, null, 'localStorage'); // precondition

    const event = new StorageEvent('storage');
    event.initStorageEvent('type', true, true, 'key', 'oldValue', 'newValue', 'url', localStorage);
    assert_equals(event.type, 'type', 'event.type');
    assert_equals(event.bubbles, true, 'event.bubbles');
    assert_equals(event.cancelable, true, 'event.cancelable');
    assert_equals(event.key, 'key', 'event.key');
    assert_equals(event.oldValue, 'oldValue', 'event.oldValue');
    assert_equals(event.newValue, 'newValue', 'event.newValue');
    assert_equals(event.url, 'url', 'event.url');
    assert_equals(event.storageArea, localStorage, 'event.storageArea');
}, 'initStorageEvent with 8 sensible arguments');

test(() => {
    const event = new StorageEvent('storage');
    event.initStorageEvent(null, null, null, null, null, null, null, null);
    assert_equals(event.type, 'null', 'event.type');
    assert_equals(event.bubbles, false, 'event.bubbles');
    assert_equals(event.cancelable, false, 'event.cancelable');
    assert_equals(event.key, null, 'event.key');
    assert_equals(event.oldValue, null, 'event.oldValue');
    assert_equals(event.newValue, null, 'event.newValue');
    assert_equals(event.url, 'null', 'event.url');
    assert_equals(event.storageArea, null, 'event.storageArea');
}, 'initStorageEvent with 8 null arguments');

test(() => {
    const event = new StorageEvent('storage');
    event.initStorageEvent(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined);
    assert_equals(event.type, 'undefined', 'event.type');
    assert_equals(event.bubbles, false, 'event.bubbles');
    assert_equals(event.cancelable, false, 'event.cancelable');
    assert_equals(event.key, null, 'event.key');
    assert_equals(event.oldValue, null, 'event.oldValue');
    assert_equals(event.newValue, null, 'event.newValue');
    assert_equals(event.url, '', 'event.url');
    assert_equals(event.storageArea, null, 'event.storageArea');
}, 'initStorageEvent with 8 undefined arguments');
                                                                node-23.7.0/test/fixtures/wpt/webstorage/event_local_key.html                                       0000664 0000000 0000000 00000002362 14746647661 0024415 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: localStorage event - key</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_local_key</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            localStorage.clear();
            t.add_cleanup(function() { localStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            var expected = ['name', null]
            function onStorageEvent(event) {
                assert_equals(event.key, expected.shift());
                if (!expected.length) {
                    t.done();
                }
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/local_set_item_clear_iframe.html');
            document.body.appendChild(el);
        }, "key property test of local event - Local event is fired due to an invocation of the setItem(), clear() methods.");
    </script>
 </body>
</html>
                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/webstorage/event_local_newvalue.html                                  0000664 0000000 0000000 00000002415 14746647661 0025452 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: localStorage event - newValue</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_local_newValue</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            localStorage.clear();
            t.add_cleanup(function() { localStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            var expected = ['user1', 'user2', null]
            function onStorageEvent(event) {
                assert_equals(event.newValue, expected.shift());
                if (!expected.length) {
                    t.done();
                }
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/local_change_item_iframe.html');
            document.body.appendChild(el);
        }, "newValue property test of local event - Local event is fired due to an invocation of the setItem(), clear() methods.");
    </script>
 </body>
</html>
                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webstorage/event_local_oldvalue.html                                  0000664 0000000 0000000 00000002412 14746647661 0025434 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: localStorage event - oldValue</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_local_oldValue</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            localStorage.clear();
            t.add_cleanup(function() { localStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            var expected = [null, 'user1', null]
            function onStorageEvent(event) {
                assert_equals(event.oldValue, expected.shift());
                if (!expected.length) {
                    t.done();
                }
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/local_change_item_iframe.html');
            document.body.appendChild(el);
        }, "oldValue property test of local event - Local event is fired due to an invocation of the setItem(), clear() methods.");
    </script>
 </body>
</html>
                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/webstorage/event_local_removeitem.html                                0000664 0000000 0000000 00000003271 14746647661 0026001 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<meta charset="utf-8">
<title>Web Storage Test: event - localStorage removeItem</title>
<link rel="author" title="Intel" href="http://www.intel.com">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>

<div id="log"></div>

<script>

async_test(function(t) {
    localStorage.clear();
    t.add_cleanup(function() { localStorage.clear() });

    self.step = function(f) { t.step(f); };

    var event_index = 0;
    window.addEventListener('storage', t.step_func(function(event) {
        switch(++event_index) {
            case 1:
                assert_equals(event.key, "name", "set key");
                assert_equals(event.oldValue, null, "set oldValue");
                assert_equals(event.newValue, "user1", "set newValue");
                assert_equals(event.url, el.contentDocument.documentURI, "set url");
                assert_equals(event.storageArea, localStorage, "set storageArea");
                break;
            case 2:
                assert_equals(event.key, "name", "remove key");
                assert_equals(event.oldValue, "user1", "remove oldValue");
                assert_equals(event.newValue, null, "remove newValue");
                assert_equals(event.url, el.contentDocument.documentURI, "remove url");
                assert_equals(event.storageArea, localStorage, "remove storageArea");
                t.done();
                break;
        }
    }), false);

    var el = document.createElement("iframe");
    el.setAttribute('id', 'ifrm');
    el.setAttribute('src', 'resources/local_set_item_remove_iframe.html');
    document.body.appendChild(el);
}, "key property test of local event");

</script>
                                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/webstorage/event_local_storagearea.html                               0000664 0000000 0000000 00000002535 14746647661 0026124 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: localStorage event - storageArea</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_local_storageArea</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            localStorage.clear();
            t.add_cleanup(function() { localStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            function onStorageEvent(event) {
                assert_equals(event.storageArea.length, 1);
                var key = event.storageArea.key(0);
                var value = event.storageArea.getItem(key);
                assert_equals(key, "name");
                assert_equals(value, "user1");
                t.done();
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/local_set_item_iframe.html');
            document.body.appendChild(el);
        }, "storageArea property test of local event - Local event is fired due to an invocation of the setItem() method.");
    </script>
 </body>
</html>
                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webstorage/event_local_url.html                                       0000664 0000000 0000000 00000002574 14746647661 0024434 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: localStorage event - url</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_local_url</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            localStorage.clear();
            t.add_cleanup(function() { localStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            function onStorageEvent(event) {
                var url = window.location.href;

                var pos = url.lastIndexOf("/");
                if (pos != -1) {
                    url = url.substr(0, pos + 1);
                    url = url + "resources/local_set_item_iframe.html";
                }

                assert_equals(event.url, url);
                t.done();
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/local_set_item_iframe.html');
            document.body.appendChild(el);
        }, "url property test of local event - Local event is fired due to an invocation of the setItem() method.");
    </script>
 </body>
</html>
                                                                                                                                    node-23.7.0/test/fixtures/wpt/webstorage/event_no_duplicates.html                                   0000664 0000000 0000000 00000007136 14746647661 0025310 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<title>WebStorage Test: StorageEvent - only if something changes</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<body>
<script>
const iframe = document.createElement('iframe');

function tests(storageName) {
  test(t => assert_true(storageName in window), storageName + ' exists');

  const storage = window[storageName];
  const iframeStorage = iframe.contentWindow[storageName];

  add_completion_callback(() => {
    storage.clear();
  });

  promise_test(t => {
    const w = new EventWatcher(t, iframe.contentWindow, 'storage');

    // Random key to make sure we don't conflict with any cruft leftover from
    // earlier runs. Any synchronization would be really hard with localStorage
    // limited guarantees.
    const testKey = Math.random().toString(36).slice(2);

    storage.setItem(testKey, 'foo');
    storage.setItem(testKey, 'foo');
    storage.setItem(testKey, 'bar');
    return w.wait_for('storage')
      .then(e => {
          assert_equals(e.storageArea, iframeStorage);
          assert_equals(e.key, testKey);
          assert_equals(e.newValue, 'foo');
          return w.wait_for('storage');
        })
      .then(e => {
          assert_equals(e.storageArea, iframeStorage);
          assert_equals(e.key, testKey);
          assert_equals(e.oldValue, 'foo');
          assert_equals(e.newValue, 'bar');
        });
  }, 'Setting to same value does not trigger event for ' + storageName);

  promise_test(t => {
    const w = new EventWatcher(t, iframe.contentWindow, 'storage');

    // Random key to make sure we don't conflict with any cruft leftover from
    // earlier runs. Any synchronization would be really hard with localStorage
    // limited guarantees.
    const testKey1 = Math.random().toString(36).slice(2);
    const testKey2 = Math.random().toString(36).slice(2);

    storage.removeItem(testKey1);
    storage.setItem(testKey2, 'foo');
    return w.wait_for('storage')
      .then(e => {
          assert_equals(e.storageArea, iframeStorage);
          assert_equals(e.key, testKey2);
          assert_equals(e.newValue, 'foo');
        });
  }, 'Deleting non-existent key does not trigger event for ' + storageName);


  promise_test(t => {
    const w = new EventWatcher(t, iframe.contentWindow, 'storage');

    // Random key to make sure we don't conflict with any cruft leftover from
    // earlier runs. Any synchronization would be really hard with localStorage
    // limited guarantees.
    const testKey = Math.random().toString(36).slice(2);

    storage.setItem(testKey, 'foo');
    storage.clear();
    storage.clear();
    storage.setItem(testKey, 'bar');
    return w.wait_for('storage')
      .then(e => {
          assert_equals(e.storageArea, iframeStorage);
          assert_equals(e.key, testKey);
          assert_equals(e.newValue, 'foo');
          return w.wait_for('storage');
        })
      .then(e => {
          assert_equals(e.storageArea, iframeStorage);
          assert_equals(e.key, null);
          assert_equals(e.oldValue, null);
          assert_equals(e.newValue, null);
          return w.wait_for('storage');
        })
      .then(e => {
          assert_equals(e.storageArea, iframeStorage);
          assert_equals(e.key, testKey);
          assert_equals(e.oldValue, null);
          assert_equals(e.newValue, 'bar');
        });
  }, 'Clearing empty storage does not trigger event for ' + storageName);

}

iframe.src = "resources/event_basic.html";
iframe.onload = () => {
  tests('sessionStorage');
  tests('localStorage');
};
document.body.appendChild(iframe);
</script>
</body>
</html>

                                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/event_session_key.html                                     0000664 0000000 0000000 00000002400 14746647661 0024777 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: sessionStorage event - key</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_session_key</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            sessionStorage.clear();
            t.add_cleanup(function() { sessionStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            var expected = ['name', null]
            function onStorageEvent(event) {
                assert_equals(event.key, expected.shift());
                if (!expected.length) {
                    t.done();
                }
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/session_set_item_clear_iframe.html');
            document.body.appendChild(el);
        }, "key property test of session event - Session event is fired due to an invocation of the setItem(), clear() methods.");
    </script>
 </body>
</html>
                                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/webstorage/event_session_newvalue.html                                0000664 0000000 0000000 00000002527 14746647661 0026047 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: sessionStorage event - newValue</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_session_newValue</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            sessionStorage.clear();
            t.add_cleanup(function() { sessionStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            var expected = ['user1', 'user2', null]
            function onStorageEvent(event) {
                t.step(function() {
                    assert_equals(event.newValue, expected.shift());
                });
                if (!expected.length) {
                    t.done();
                }
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/session_change_item_iframe.html');
            document.body.appendChild(el);
        }, "newvalue property test of session event - Session event is fired due to an invocation of the setItem(), clear() methods.");
    </script>
 </body>
</html>
                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/webstorage/event_session_oldvalue.html                                0000664 0000000 0000000 00000002430 14746647661 0026025 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: sessionStorage event - oldValue</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_session_oldValue</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            sessionStorage.clear();
            t.add_cleanup(function() { sessionStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            var expected = [null, 'user1', null]
            function onStorageEvent(event) {
                assert_equals(event.oldValue, expected.shift());
                if (!expected.length) {
                    t.done();
                }
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/session_change_item_iframe.html');
            document.body.appendChild(el);
        }, "oldvalue property test of session event - Session event is fired due to an invocation of the setItem(), clear() methods.");
    </script>
 </body>
</html>
                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/event_session_removeitem.html                              0000664 0000000 0000000 00000003306 14746647661 0026371 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<meta charset="utf-8">
<title>Web Storage Test: event - sessionStorage removeItem</title>
<link rel="author" title="Intel" href="http://www.intel.com">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>

<div id="log"></div>

<script>

async_test(function(t) {
    sessionStorage.clear();
    t.add_cleanup(function() { sessionStorage.clear() });

    self.step = function(f) { t.step(f); };

    var event_index = 0;
    window.addEventListener('storage', t.step_func(function(event) {
        switch(++event_index) {
            case 1:
                assert_equals(event.key, "name", "set key");
                assert_equals(event.oldValue, null, "set oldValue");
                assert_equals(event.newValue, "user1", "set newValue");
                assert_equals(event.url, el.contentDocument.documentURI, "set url");
                assert_equals(event.storageArea, sessionStorage, "set storageArea");
                break;
            case 2:
                assert_equals(event.key, "name", "remove key");
                assert_equals(event.oldValue, "user1", "remove oldValue");
                assert_equals(event.newValue, null, "remove newValue");
                assert_equals(event.url, el.contentDocument.documentURI, "remove url");
                assert_equals(event.storageArea, sessionStorage, "remove storageArea");
                t.done();
                break;
        }
    }), false);

    var el = document.createElement("iframe");
    el.setAttribute('id', 'ifrm');
    el.setAttribute('src', 'resources/session_set_item_remove_iframe.html');
    document.body.appendChild(el);
}, "key property test of session event");
</script>
                                                                                                                                                                                                                                                                                                                          node-23.7.0/test/fixtures/wpt/webstorage/event_session_storagearea.html                             0000664 0000000 0000000 00000002554 14746647661 0026516 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: sessionStorage event - storageArea</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_session_storageArea</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            sessionStorage.clear();
            t.add_cleanup(function() { sessionStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            function onStorageEvent(event) {
                assert_equals(event.storageArea.length, 1);
                var key = event.storageArea.key(0);
                var value = event.storageArea.getItem(key);
                assert_equals(key, "name");
                assert_equals(value, "user1");
                t.done();
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/session_set_item_iframe.html');
            document.body.appendChild(el);
        }, "storageArea property test of session event - session event is fired due to an invocation of the setItem() method.");
    </script>

 </body>
</html>
                                                                                                                                                    node-23.7.0/test/fixtures/wpt/webstorage/event_session_url.html                                     0000664 0000000 0000000 00000002614 14746647661 0025020 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <head>
  <title>WebStorage Test: sessionStorage event - url</title>
  <script src="/resources/testharness.js"></script>
  <script src="/resources/testharnessreport.js"></script>
 </head>
 <body>
    <h1>event_session_url</h1>
    <div id="log"></div>
    <script>
        async_test(function(t) {
            sessionStorage.clear();
            t.add_cleanup(function() { sessionStorage.clear() });

            self.fail = t.step_func(function(msg) {
                assert_unreached(msg);
                t.done();
            });

            function onStorageEvent(event) {
                var url = window.location.href;

                var pos = url.lastIndexOf("/");
                if (pos != -1) {
                    url = url.substr(0, pos + 1);
                    url = url + "resources/session_set_item_iframe.html";
                }

                assert_equals(event.url, url);
                t.done();
            }

            window.addEventListener('storage', t.step_func(onStorageEvent), false);

            var el = document.createElement("iframe");
            el.setAttribute('id', 'ifrm');
            el.setAttribute('src', 'resources/session_set_item_iframe.html');
            document.body.appendChild(el);
        }, "url property test of session event - Session event is fired due to an invocation of the setItem() method.");
    </script>
 </body>
</html>
                                                                                                                    node-23.7.0/test/fixtures/wpt/webstorage/event_setattribute.html                                    0000664 0000000 0000000 00000000601 14746647661 0025164 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<meta name="timeout" content="long">
<title>WebStorage Test: StorageEvent - attached setAttribute</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
</head>
<body>
<div id="log"></div>
<script src="eventTestHarness.js"></script>
<script src="event_setattribute.js"></script>
</body>
</html>

                                                                                                                               node-23.7.0/test/fixtures/wpt/webstorage/event_setattribute.js                                      0000664 0000000 0000000 00000007603 14746647661 0024645 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        testStorages(function(storageString) {
    async_test(function(t) {
        assert_true(storageString in window, storageString + " exist");
        var storage = window[storageString];
        t.add_cleanup(function() { storage.clear() });

        clearStorage(storageString, t.step_func(step0));
        assert_equals(storage.length, 0, "storage.length");

        function step0(msg)
        {
            iframe.onload = t.step_func(step1);
            // Null out the existing handler eventTestHarness.js set up;
            // otherwise this test won't be testing much of anything useful.
            iframe.contentWindow.onstorage = null;
            iframe.src = "resources/event_setattribute_handler.html";
        }

        function step1(msg)
        {
            storage.setItem('FOO', 'BAR');

            runAfterNStorageEvents(t.step_func(step2), 1);
        }

        function step2(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 1);
            assert_equals(storageEventList[0].key, "FOO");
            assert_equals(storageEventList[0].oldValue, null);
            assert_equals(storageEventList[0].newValue, "BAR");

            storage.setItem('FU', 'BAR');
            storage.setItem('a', '1');
            storage.setItem('b', '2');
            storage.setItem('b', '3');

            runAfterNStorageEvents(t.step_func(step3), 5);
        }

        function step3(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 5);
            assert_equals(storageEventList[1].key, "FU");
            assert_equals(storageEventList[1].oldValue, null);
            assert_equals(storageEventList[1].newValue, "BAR");

            assert_equals(storageEventList[2].key, "a");
            assert_equals(storageEventList[2].oldValue, null);
            assert_equals(storageEventList[2].newValue, "1");

            assert_equals(storageEventList[3].key, "b");
            assert_equals(storageEventList[3].oldValue, null);
            assert_equals(storageEventList[3].newValue, "2");

            assert_equals(storageEventList[4].key, "b");
            assert_equals(storageEventList[4].oldValue, "2");
            assert_equals(storageEventList[4].newValue, "3");

            storage.removeItem('FOO');

            runAfterNStorageEvents(t.step_func(step4), 6);
        }

        function step4(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 6);
            assert_equals(storageEventList[5].key, "FOO");
            assert_equals(storageEventList[5].oldValue, "BAR");
            assert_equals(storageEventList[5].newValue, null);

            storage.removeItem('FU');

            runAfterNStorageEvents(t.step_func(step5), 7);
        }

        function step5(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 7);
            assert_equals(storageEventList[6].key, "FU");
            assert_equals(storageEventList[6].oldValue, "BAR");
            assert_equals(storageEventList[6].newValue, null);

            storage.clear();

            runAfterNStorageEvents(t.step_func(step6), 8);
        }

        function step6(msg)
        {
            if(msg != undefined) {
                assert_unreached(msg);
            }
            assert_equals(storageEventList.length, 8);
            assert_equals(storageEventList[7].key, null);
            assert_equals(storageEventList[7].oldValue, null);
            assert_equals(storageEventList[7].newValue, null);

            t.done();
        }

    }, storageString + " mutations fire StorageEvents that are caught by the event listener attached via setattribute.");
});
                                                                                                                             localstorage-about-blank-3P-iframe-opens-3P-window.partitioned.tentative.html                       0000664 0000000 0000000 00000005364 14746647661 0037027 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/webstorage                                                                                                                               <!doctype html>
<meta charset=utf-8>
<title>localStorage: about:blank partitioning</title>
<meta name=help href="https://privacycg.github.io/storage-partitioning/">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/common/get-host-info.sub.js"></script>
<script src="/webstorage/resources/partitioning-utils.js"></script>
<body>
<script>
const path =
  "webstorage/resources/localstorage-about-blank-partitioned-win-open.html";
const crossSiteURL = `${get_host_info().HTTP_NOTSAMESITE_ORIGIN}/${path}`;
const sameSiteURL = `${get_host_info().HTTP_ORIGIN}/${path}`;
let firstPartyID = getOrCreateID("userID3");
let crossSiteIframeID;
let sameSiteIframeID;
let crossSiteIframe;
let crossSiteIframeAboutBlankID;
let frameMessageCount = 0;

promise_test(async t => {
  localStorage.clear();

  // Step 1. Add a cross-site iframe
  return addIframePromise(crossSiteURL).then(async crossSiteIframe => {
    return new Promise(resolve => {
      window.addEventListener("message", async e => {
        const payload = {
          command: "open about:blank window"
        }

        if (e.data.message === "window loaded") {
          // Step 2. cross-site iframe is loaded, capture reference to its ID
          crossSiteIframeID = e.data.userID;
          // Step 3. Ask the cross-site iframe to create an about:blank window
          crossSiteIframe.contentWindow.postMessage(payload, e.origin);
        }

        if (e.data.message === "about:blank frame ID") {
          // Step 4. capture reference to 3P iframe's about:blank window ID
          crossSiteIframeAboutBlankID = e.data.userID;
          crossSiteIframe.contentWindow.postMessage(
            {command: "close about:blank window"}, "*");
        }

        if (e.data.message === "about:blank window closed") {
          resolve({crossSiteIframeID, crossSiteIframeAboutBlankID});
        }
      });
    }).then(ids => {
      const {
        crossSiteIframeID,
        crossSiteIframeAboutBlankID
      } = ids;
      // Step 5. Assert some things
      for (let id in ids) {
        assert_true(id !== undefined, "id is not undefined");
      }
      // Note: we use assert_true, rather than assert_equals because we're
      // setting random numbers as IDs - this would mean expectations
      // files wouldn't work as intended.
      assert_true(crossSiteIframeAboutBlankID !== crossSiteIframeID,
        "about:blank window opened by 3P iframe does not inherit 3P iframe's StorageKey");
      assert_true(firstPartyID !== crossSiteIframeAboutBlankID,
        "about:blank window open by 3P iframe does not inherit 1P StorageKey");

      localStorage.clear();
    })
  });


}, "StorageKey: test 3P about:blank window opened from a 3P iframe");
</script>
</body>
                                                                                                                                                                                                                                                                            node-23.7.0/test/fixtures/wpt/webstorage/localstorage-basic-partitioned.tentative.sub.html          0000664 0000000 0000000 00000004700 14746647661 0032120 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<meta charset=utf-8>
<title>localStorage: partitioned storage test</title>
<meta name=help href="https://privacycg.github.io/storage-partitioning/">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<iframe id="shared-iframe" src="http://{{host}}:{{ports[http][0]}}/webstorage/resources/localstorage-about-blank-partitioned-iframe.html"></iframe>
<body>
<script>
// Here's the set-up for this test:
// Step 1. (window) set up listeners for main window.
// Step 2. (window) set up load listener for same-site iframe.
// Step 3. (same-site iframe) loads, send it a message to createOrGet a "userID".
// Step 4. (same-site iframe) receives the message, creates the "userID".
// Step 5. (window) receives "storage got set" message from same-site iframe.
// Step 6. (window) opens cross-site window w/ shared (same-site to us currently) iframe.
// Step 7. (cross-site iframe) loads, sends back the userID key from the iframe.
// Step 8. (window) asserts that the IDs should be different, as they should have a different StorageKey.
const altOrigin = "http://{{hosts[alt][]}}:{{ports[http][0]}}";

async_test(t => {
  let crossSiteWindow;
  let crossSiteID;
  let sameSiteID;
  const iframe = document.getElementById("shared-iframe");

  iframe.addEventListener("load", t.step_func(e => {
    const payload = {
      command: "create ID",
      key: "userID",
    };
    iframe.contentWindow.postMessage(payload, iframe.origin);
  }), {once: true});

  window.addEventListener("message", t.step_func(e => {
    if (e.data.message === "ID created") {
      sameSiteID = e.data.userID;
      assert_true(typeof sameSiteID === "string");

      if (location.origin !== altOrigin) {
        crossSiteWindow = window.open(`${altOrigin}/webstorage/localstorage-basic-partitioned.tentative.sub.html`, "", "noopener=false");
        t.add_cleanup(() => crossSiteWindow.close());
      }
    }

    if (e.data.message === "cross-site window iframe loaded") {
      crossSiteID = e.data.userID;
      t.step(() => {
        assert_true(typeof crossSiteID === "string");
        assert_true(sameSiteID !== crossSiteID, "IDs pulled from two partitioned iframes are different.")
      });

      // clean up after ourselves.
      iframe.contentWindow.localStorage.clear();
      crossSiteWindow.postMessage({command: "clearStorage"}, altOrigin);
      t.done();
    };
  }));
}, "Simple test for partitioned localStorage");
</script>
</body>
                                                                node-23.7.0/test/fixtures/wpt/webstorage/localstorage-cross-origin-iframe.tentative.https.window.js 0000664 0000000 0000000 00000001661 14746647661 0033730 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        // META: script=/common/get-host-info.sub.js
// META: script=/common/utils.js
// META: script=/common/dispatcher/dispatcher.js
// META: script=/html/cross-origin-embedder-policy/credentialless/resources/common.js
// META: script=/html/anonymous-iframe/resources/common.js

promise_test(async test => {
    const same_origin= get_host_info().HTTPS_ORIGIN;
    const cross_origin = get_host_info().HTTPS_REMOTE_ORIGIN;
    const reply_token = token();

    for(iframe of [
      newIframe(same_origin),
      newIframe(cross_origin),
    ]) {
      send(iframe, `
        try {
          let c = window.localStorage;
          send("${reply_token}","OK");
        } catch (exception) {
          send("${reply_token}","ERROR");
        }
      `);
    }
    assert_equals(await receive(reply_token), "OK");
    assert_equals(await receive(reply_token), "OK");
  }, "LocalStorage should be accessible on both same_origin and cross_origin iframes");                                                                               node-23.7.0/test/fixtures/wpt/webstorage/missing_arguments.window.js                                0000664 0000000 0000000 00000001172 14746647661 0025764 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        var tests = [
    function() { localStorage.key(); },
    function() { localStorage.getItem(); },
    function() { localStorage.setItem(); },
    function() { localStorage.setItem("a"); },
    function() { localStorage.removeItem(); },
    function() { sessionStorage.key(); },
    function() { sessionStorage.getItem(); },
    function() { sessionStorage.setItem(); },
    function() { sessionStorage.setItem("a"); },
    function() { sessionStorage.removeItem(); },
];
tests.forEach(function(fun) {
    test(function() {
        assert_throws_js(TypeError, fun);
    }, "Should throw TypeError for " + format_value(fun) + ".");
});
                                                                                                                                                                                                                                                                                                                                                                                                      node-23.7.0/test/fixtures/wpt/webstorage/resources/                                                 0000775 0000000 0000000 00000000000 14746647661 0022373 5                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/resources/event_basic.html                                 0000664 0000000 0000000 00000000605 14746647661 0025544 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<script>
function handleStorageEvent(e) {
    if (window.sessionStorage === e.storageArea)
      e.storageAreaString = "sessionStorage";
    else if (window.localStorage === e.storageArea)
      e.storageAreaString = "localStorage";
    window.parent.storageEventList.push(e);
}
</script>
</head>
<body onstorage="handleStorageEvent(event);">
</body>
</html>
                                                                                                                           node-23.7.0/test/fixtures/wpt/webstorage/resources/event_body_handler.html                          0000664 0000000 0000000 00000000310 14746647661 0027106 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<script>

function handleStorageEvent(e) {
    window.parent.storageEventList.push(e);
}

</script>
</head>
<body onstorage="handleStorageEvent(event);">
</body>
</html>
                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/resources/event_setattribute_handler.html                  0000664 0000000 0000000 00000000350 14746647661 0030674 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head></head>
<body>
<script>

function handleStorageEvent(e) {
    window.parent.storageEventList.push(e);
}

document.body.setAttribute("onstorage", "handleStorageEvent(event);");

</script>
</body>
</html>
                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/resources/local_change_item_iframe.html                    0000664 0000000 0000000 00000000760 14746647661 0030224 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
  <body>
    <script>
        if (('localStorage' in window) && window.localStorage !== null){
            try {
                localStorage.setItem("name", "user1");
                localStorage.setItem("name", "user2");
            } catch (e) {
                parent.fail("setItem method is failed.");
            }
            localStorage.clear();
        } else {
            parent.fail("localStorage is not supported.");
        }
    </script>
  </body>
</html>
                node-23.7.0/test/fixtures/wpt/webstorage/resources/local_set_item_clear_iframe.html                 0000664 0000000 0000000 00000000667 14746647661 0030746 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
    <script>
        if (('localStorage' in window) && window.localStorage !== null){
            try {
                localStorage.setItem("name", "user1");
            } catch (e) {
                parent.fail("setItem method is failed.");
            }
            localStorage.clear();
        } else {
            parent.fail("localStorage is not supported.");
        }
    </script>
 </body>
</html>
                                                                         node-23.7.0/test/fixtures/wpt/webstorage/resources/local_set_item_iframe.html                       0000664 0000000 0000000 00000000625 14746647661 0027572 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
    <script>
        if (('localStorage' in window) && window.localStorage !== null){
            try {
                localStorage.setItem("name", "user1");
            } catch (e) {
                parent.fail("setItem method is failed.");
            }
        } else {
            parent.fail("localStorage is not supported.");
        }
    </script>
 </body>
</html>
                                                                                                           node-23.7.0/test/fixtures/wpt/webstorage/resources/local_set_item_remove_iframe.html                0000664 0000000 0000000 00000000330 14746647661 0031140 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
    <script>
        parent.step(function() {
            localStorage.setItem("name", "user1");
            localStorage.removeItem('name');
        });
    </script>
 </body>
</html>
                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/resources/localstorage-about-blank-partitioned-iframe.html 0000664 0000000 0000000 00000002001 14746647661 0033707 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<meta charset="utf-8">
<script>
function getOrCreateID(key) {
  if (!localStorage.getItem(key)) {
    const newID = +new Date() + "-" + Math.random();
    localStorage.setItem(key, newID);
  }
  return localStorage.getItem(key);
}

window.addEventListener("load", () => {
  // if we have an opener, we know that we are loaded inside a cross-site
  // iframe (because we opened it ourselves).
  if (parent.opener) {
    const payload = {
      message: "cross-site window iframe loaded",
      userID: getOrCreateID("userID"),
    }
    parent.opener.postMessage(payload, parent.opener.origin);
  }
});

window.addEventListener("message", (e) => {
  if (e.data.command == "create ID") {
    getOrCreateID(e.data.key);

    // storage is set, call back to window.
    const payload = {
      message: "ID created",
      userID: localStorage.getItem("userID"),
    }

    e.source.postMessage(payload, e.source.origin);
  }

  if (e.data.command == "clearStorage") {
    localStorage.clear();
  }
});
</script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               localstorage-about-blank-partitioned-win-open.html                                                  0000664 0000000 0000000 00000001734 14746647661 0034135 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/webstorage/resources                                                                                                                     <!doctype html>
<meta charset="utf-8">
<script src="./partitioning-utils.js"></script>
<script>
window.addEventListener("load", () => {
  localStorage.clear();

  const userID = getOrCreateID("userID4");
  const payload = {
    message: "window loaded",
    userID,
  }

  let win = window.opener ? window.opener : window.parent;
  win.postMessage(payload, "*");
});

window.addEventListener("message", e => {
  let win = window.opener ? parent.window.opener : window.parent;

  if (e.data.command == "open about:blank window") {
    window.blankWindow = window.open("about:blank");
    const payload = {
      message: "about:blank frame ID",
      userID: window.blankWindow?.localStorage["userID4"],
    }

    let win = window.opener ? parent.window.opener : window.parent;
    win.postMessage(payload, "*");
  }

  if (e.data.command == "close about:blank window") {
    window.blankWindow.close();
    win.postMessage({message: "about:blank window closed"}, "*");
  }
});
</script>
                                    node-23.7.0/test/fixtures/wpt/webstorage/resources/partitioning-utils.js                            0000664 0000000 0000000 00000001003 14746647661 0026570 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        function getOrCreateID(key) {
  if (!localStorage.getItem(key)) {
    const newID = +new Date() + "-" + Math.random();
    localStorage.setItem(key, newID);
  }
  return localStorage.getItem(key);
}

function addIframePromise(url) {
  return new Promise(resolve => {
    const iframe = document.createElement("iframe");
    iframe.style.display = "none";
    iframe.src = url;
    iframe.addEventListener("load", (e) => {
      resolve(iframe);
    }, {once: true});

    document.body.appendChild(iframe);
  });
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             sessionStorage-about-blank-partitioned-iframe.html                                                  0000664 0000000 0000000 00000002334 14746647661 0034172 0                                                                                                    ustar 00root                            root                            0000000 0000000 node-23.7.0/test/fixtures/wpt/webstorage/resources                                                                                                                     <!doctype html>
<meta charset="utf-8">
<script>

function getOrCreateID(key) {
  if (!sessionStorage.getItem(key)) {
    const newID = new Date() + "-" + Math.random();
    sessionStorage.setItem(key, newID);
  }
  return sessionStorage.getItem(key);
}

window.addEventListener("load", () => {
  // In this testing set-up, only cross-site iframes will have an opener.
  if (parent.opener) {
    const payload = {
      message: "cross-site window iframe loaded",
      userID: getOrCreateID("userID"),
    }
    // Once the cross-site iframe has loaded, we send a message back to
    // the main window with the ID from sessionStorage.
    parent.opener.postMessage(payload, parent.opener.origin);
  }
});

window.addEventListener("message", (e) => {
  if (e.data.command == "create ID") {
    // e.data.key is equivalent to "userID"
    getOrCreateID(e.data.key);

    const payload = {
      message: "ID created",
      userID: sessionStorage.getItem("userID"),
    }
    // Return the ID from sessionStorage to the main window.
    e.source.postMessage(payload, e.source.origin);
  }

  // Additional functionality for clean-up at the end of the test.
  if (e.data.command == "clearStorage") {
    sessionStorage.clear();
  }
});
</script>
                                                                                                                                                                                                                                                                                                    node-23.7.0/test/fixtures/wpt/webstorage/resources/session_change_item_iframe.html                  0000664 0000000 0000000 00000000772 14746647661 0030620 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
    <script>
        if (('sessionStorage' in window) && window.sessionStorage !== null){
            try {
                sessionStorage.setItem("name", "user1");
                sessionStorage.setItem("name", "user2");
            } catch (e) {
                parent.fail("setItem method is failed.");
            }
            sessionStorage.clear();
        } else {
            parent.fail("sessionStorage is not supported.");
        }
    </script>
 </body>
</html>
      node-23.7.0/test/fixtures/wpt/webstorage/resources/session_set_item_clear_iframe.html               0000664 0000000 0000000 00000000704 14746647661 0031327 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
     <script>
         if (('sessionStorage' in window) && window.sessionStorage !== null){
            try {
                sessionStorage.setItem('name', 'user1');
            } catch (e) {
                parent.fail('setItem method is failed.');
            }
            sessionStorage.clear();
        } else {
            parent.fail('sessionStorage is not supported.');
        }
     </script>
 </body>
</html>
                                                            node-23.7.0/test/fixtures/wpt/webstorage/resources/session_set_item_iframe.html                     0000664 0000000 0000000 00000000640 14746647661 0030160 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
     <script>
         if (('sessionStorage' in window) && window.sessionStorage !== null){
            try {
                sessionStorage.setItem('name', 'user1');
            } catch (e) {
                parent.fail('setItem method is failed.');
            }
        } else {
            parent.fail('sessionStorage is not supported.');
        }
     </script>
 </body>
</html>
                                                                                                node-23.7.0/test/fixtures/wpt/webstorage/resources/session_set_item_remove_iframe.html              0000664 0000000 0000000 00000000336 14746647661 0031537 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
 <body>
     <script>
        parent.step(function() {
            sessionStorage.setItem("name", "user1");
            sessionStorage.removeItem('name');
        });
     </script>
 </body>
</html>
                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/resources/storage_local_window_open_second.html            0000664 0000000 0000000 00000001267 14746647661 0032050 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<title>WebStorage Test: localStorage - second page</title>
</head>
<body>
<script>

var storage = window.localStorage;

var assertions = [];

assertions.push({
    actual: storage.getItem("FOO"),
    expected: "BAR",
    message: "storage.getItem('FOO')"
});

storage.setItem("FOO", "BAR-NEWWINDOW");

assertions.push({
    actual: storage.getItem("FOO"),
    expected: "BAR-NEWWINDOW",
    message: "value for FOO after changing"
});
assertions.push({
    actual: window.opener.localStorage.getItem("FOO"),
    expected: "BAR-NEWWINDOW",
    message: "value for FOO in my opening window"
});

window.opener.postMessage(assertions, '*');

</script>
</body>
</html>
                                                                                                                                                                                                                                                                                                                                         node-23.7.0/test/fixtures/wpt/webstorage/resources/storage_session_window_noopener_second.html      0000664 0000000 0000000 00000001156 14746647661 0033322 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<title>WebStorage Test: sessionStorage - second page</title>
</head>
<body>
<script>

var storage = window.sessionStorage;

var assertions = [];

assertions.push({
    actual: storage.getItem("FOO"),
    expected: null,
    message: "storage.getItem('FOO')"
});

storage.setItem("FOO", "BAR-NEWWINDOW");

assertions.push({
    actual: storage.getItem("FOO"),
    expected: "BAR-NEWWINDOW",
    message: "value for FOO after changing"
});

let channel = new BroadcastChannel('storage_session_window_noopener');
channel.postMessage(assertions, '*');

window.close();

</script>
</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/resources/storage_session_window_open_second.html          0000664 0000000 0000000 00000001520 14746647661 0032431 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE HTML>
<html>
<head>
<title>WebStorage Test: sessionStorage - second page</title>
</head>
<body>
<script>

var storage = window.sessionStorage;

var assertions = [];

assertions.push({
    actual: storage.getItem("FOO"),
    expected: "BAR",
    message: "storage.getItem('FOO')"
});

storage.setItem("FOO", "BAR-NEWWINDOW");

assertions.push({
    actual: storage.getItem("FOO"),
    expected: "BAR-NEWWINDOW",
    message: "value for FOO after changing"
});
assertions.push({
    actual: window.opener.sessionStorage.getItem("FOO"),
    expected: "BAR",
    message: "value for FOO in my opening window"
});
assertions.push({
    actual: storage.getItem("BAZ"),
    expected: null,
    message: "value for BAZ set after window.open(), is not set in new window"
});

window.opener.postMessage(assertions, '*');

</script>
</body>
</html>
                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/webstorage/sessionStorage-basic-partitioned.tentative.sub.html        0000664 0000000 0000000 00000006320 14746647661 0032451 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!doctype html>
<meta charset=utf-8>
<title>sessionStorage: partitioned storage test</title>
<meta name=help href="https://privacycg.github.io/storage-partitioning/">
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<iframe id="shared-iframe" src="http://{{host}}:{{ports[http][0]}}/webstorage/resources/sessionStorage-about-blank-partitioned-iframe.html"></iframe>
<body>
<script>
// Here's the set-up for this test:
// Step 1. (main window) set up messaging and same-site iframe load listeners.
// Step 2. (same-site iframe) loads, requests sessionStorage for "userID".
// Step 3. (same-site iframe) receives the message, gets or allocates sessionStorage,
// and returns the generated ID to the main frame.
// Step 4. (main window) receives "storage got set" message from same-site iframe.
// Step 5. (main window) opens a new cross-site window with the shared-iframe inside.
// Step 6. (cross-site iframe) loads, requests sessionStorage for "userID", gets or
// allocates that sessionStorage, and returns the generated ID to the main frame.
// Step 7. (main window) asserts that the generated IDs should be different, as
// they should have a different StorageKey.
const altOrigin = "http://{{hosts[alt][]}}:{{ports[http][0]}}";

async_test(t => {
  let crossSiteWindow;
  let crossSiteID;
  let sameSiteID;
  // Retrieve the iframe we created in the HTML above.
  const iframe = document.getElementById("shared-iframe");

  // Once the iframe loads, we request sessionStorage.
  iframe.addEventListener("load", t.step_func(e => {
    const payload = {
      command: "create ID",
      key: "userID",
    };
    iframe.contentWindow.postMessage(payload, iframe.origin);
  }), {once: true});

  window.addEventListener("message", t.step_func(e => {
    // Once we get or allocate the sessionStorage, we expect the iframe
    // to message us back with the generated ID.
    if (e.data.message === "ID created") {
      sameSiteID = e.data.userID;
      assert_true(typeof sameSiteID === "string");

      // Now that same-site storage has been secured, we need to open a
      // new cross-site window that contains our shared-iframe to repeat
      // the process in a cross-site environment.
      if (location.origin !== altOrigin) {
        crossSiteWindow = window.open(`${altOrigin}/webstorage/sessionStorage-basic-partitioned.tentative.sub.html`, "", "noopener=false");
        t.add_cleanup(() => crossSiteWindow.close());
      }
    }

    // We expect that once the cross-site iframe requests sessionStorage,
    // it will message us back with the generated ID.
    if (e.data.message === "cross-site window iframe loaded") {
      crossSiteID = e.data.userID;
      t.step(() => {
        // Same and cross-site iframes should have different generated IDs.
        assert_true(typeof crossSiteID === "string");
        assert_true(sameSiteID !== crossSiteID, "IDs pulled from two partitioned iframes are different.")
      });

      // Clear storage state to clean up after the test.
      iframe.contentWindow.sessionStorage.clear();
      crossSiteWindow.postMessage({command: "clearStorage"}, altOrigin);
      t.done();
    };
  }));
}, "Simple test for partitioned sessionStorage");
</script>
</body>
                                                                                                                                                                                                                                                                                                                node-23.7.0/test/fixtures/wpt/webstorage/set.window.js                                              0000664 0000000 0000000 00000010243 14746647661 0023020 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    [9, "x"].forEach(function(key) {
        test(function() {
            var expected = "value for " + this.name;
            var value = expected;

            var storage = window[name];
            storage.clear();

            assert_equals(storage[key], undefined);
            assert_equals(storage.getItem(key), null);
            assert_equals(storage[key] = value, value);
            assert_equals(storage[key], expected);
            assert_equals(storage.getItem(key), expected);
        }, "Setting property for key " + key + " on " + name);

        test(function() {
            var expected = "value for " + this.name;
            var value = {
                toString: function() { return expected; }
            };

            var storage = window[name];
            storage.clear();

            assert_equals(storage[key], undefined);
            assert_equals(storage.getItem(key), null);
            assert_equals(storage[key] = value, value);
            assert_equals(storage[key], expected);
            assert_equals(storage.getItem(key), expected);
        }, "Setting property with toString for key " + key + " on " + name);

        test(function() {
            var proto = "proto for " + this.name;
            Storage.prototype[key] = proto;
            this.add_cleanup(function() { delete Storage.prototype[key]; });

            var value = "value for " + this.name;

            var storage = window[name];
            storage.clear();

            assert_equals(storage[key], proto);
            assert_equals(storage.getItem(key), null);
            assert_equals(storage[key] = value, value);
            // Hidden because no [LegacyOverrideBuiltIns].
            assert_equals(storage[key], proto);
            assert_equals(Object.getOwnPropertyDescriptor(storage, key), undefined);
            assert_equals(storage.getItem(key), value);
        }, "Setting property for key " + key + " on " + name + " with data property on prototype");

        test(function() {
            var proto = "proto for " + this.name;
            Storage.prototype[key] = proto;
            this.add_cleanup(function() { delete Storage.prototype[key]; });

            var value = "value for " + this.name;
            var existing = "existing for " + this.name;

            var storage = window[name];
            storage.clear();

            storage.setItem(key, existing);

            // Hidden because no [LegacyOverrideBuiltIns].
            assert_equals(storage[key], proto);
            assert_equals(Object.getOwnPropertyDescriptor(storage, key), undefined);
            assert_equals(storage.getItem(key), existing);
            assert_equals(storage[key] = value, value);
            assert_equals(storage[key], proto);
            assert_equals(Object.getOwnPropertyDescriptor(storage, key), undefined);
            assert_equals(storage.getItem(key), value);
        }, "Setting property for key " + key + " on " + name + " with data property on prototype and existing item");

        test(function() {
            var storage = window[name];
            storage.clear();

            var proto = "proto getter for " + this.name;
            Object.defineProperty(Storage.prototype, key, {
                "get": function() { return proto; },
                "set": this.unreached_func("Should not call [[Set]] on prototype"),
                "configurable": true,
            });
            this.add_cleanup(function() {
                delete Storage.prototype[key];
                delete storage[key];
                assert_false(key in storage);
            });

            var value = "value for " + this.name;

            assert_equals(storage[key], proto);
            assert_equals(storage.getItem(key), null);
            assert_equals(storage[key] = value, value);
            // Property is hidden because no [LegacyOverrideBuiltIns].
            assert_equals(storage[key], proto);
            assert_equals(Object.getOwnPropertyDescriptor(storage, key), undefined);
            assert_equals(storage.getItem(key), value);
        }, "Setting property for key " + key + " on " + name + " with accessor property on prototype");
    });
});
                                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/webstorage/storage_builtins.window.js                                 0000664 0000000 0000000 00000001503 14746647661 0025601 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();
        assert_equals(storage.length, 0, "storage.length");

        var builtins = ["key", "getItem", "setItem", "removeItem", "clear"];
        var origBuiltins = builtins.map(function(b) { return Storage.prototype[b]; });
        assert_array_equals(builtins.map(function(b) { return storage[b]; }), origBuiltins, "a");
        builtins.forEach(function(b) { storage[b] = b; });
        assert_array_equals(builtins.map(function(b) { return storage[b]; }), origBuiltins, "b");
        assert_array_equals(builtins.map(function(b) { return storage.getItem(b); }), builtins, "c");

        assert_equals(storage.length, builtins.length, "storage.length");
    }, "Builtins in " + name);
});
                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/webstorage/storage_clear.window.js                                    0000664 0000000 0000000 00000001122 14746647661 0025033 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();

        storage.setItem("name", "user1");
        assert_equals(storage.getItem("name"), "user1");
        assert_equals(storage.name, "user1");
        assert_equals(storage.length, 1);

        storage.clear();
        assert_equals(storage.getItem("name"), null, "storage.getItem('name')");
        assert_equals(storage.name, undefined, "storage.name");
        assert_equals(storage.length, 0, "storage.length");
    }, "Clear in " + name);
});
                                                                                                                                                                                                                                                                                                                                                                                                                                              node-23.7.0/test/fixtures/wpt/webstorage/storage_enumerate.window.js                                0000664 0000000 0000000 00000004155 14746647661 0025743 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        assert_true(name in window, name + " exist");

        var storage = window[name];
        storage.clear();

        Storage.prototype.prototypeTestKey = "prototypeTestValue";
        storage.foo = "bar";
        storage.fu = "baz";
        storage.batman = "bin suparman";
        storage.bar = "foo";
        storage.alpha = "beta";
        storage.zeta = "gamma";

        const enumeratedArray = Object.keys(storage);
        enumeratedArray.sort();  // Storage order is implementation-defined.

        const expectArray = ["alpha", "bar", "batman", "foo", "fu", "zeta"];
        assert_array_equals(enumeratedArray, expectArray);

        // 'prototypeTestKey' is not an actual storage key, it is just a
        // property set on Storage's prototype object.
        assert_equals(storage.length, 6);
        assert_equals(storage.getItem("prototypeTestKey"), null);
        assert_equals(storage.prototypeTestKey, "prototypeTestValue");
    }, name + ": enumerate a Storage object and get only the keys as a result and the built-in properties of the Storage object should be ignored");

    test(function() {
        const storage = window[name];
        storage.clear();

        storage.setItem("foo", "bar");
        storage.baz = "quux";
        storage.setItem(0, "alpha");
        storage[42] = "beta";

        for (let prop in storage) {
            if (!storage.hasOwnProperty(prop))
                continue;
            const desc = Object.getOwnPropertyDescriptor(storage, prop);
            assert_true(desc.configurable);
            assert_true(desc.enumerable);
            assert_true(desc.writable);
        }

        const keys = Object.keys(storage);
        keys.sort();  // Storage order is implementation-defined.
        assert_array_equals(keys, ["0", "42", "baz", "foo"]);

        const values = Object.values(storage);
        values.sort();  // Storage order is implementation-defined.
        assert_array_equals(values, ["alpha", "bar", "beta", "quux"]);
    }, name + ": test enumeration of numeric and non-numeric keys");
});
                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webstorage/storage_functions_not_overwritten.window.js                0000664 0000000 0000000 00000002601 14746647661 0031310 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();

        runTest();
        function doWedgeThySelf() {
            storage.setItem("clear", "almost");
            storage.setItem("key", "too");
            storage.setItem("getItem", "funny");
            storage.setItem("removeItem", "to");
            storage.setItem("length", "be");
            storage.setItem("setItem", "true");
        }

        function runTest() {
            doWedgeThySelf();

            assert_equals(storage.getItem('clear'), "almost");
            assert_equals(storage.getItem('key'), "too");
            assert_equals(storage.getItem('getItem'), "funny");
            assert_equals(storage.getItem('removeItem'), "to");
            assert_equals(storage.getItem('length'), "be");
            assert_equals(storage.getItem('setItem'), "true");

            // Test to see if an exception is thrown for any of the built in
            // functions.
            storage.setItem("test", "123");
            storage.key(0);
            storage.getItem("test");
            storage.removeItem("test");
            storage.clear();
            assert_equals(storage.length, 0);
        }

    }, name + " should be not rendered unusable by setting a key with the same name as a storage function such that the function is hidden");
});
                                                                                                                               node-23.7.0/test/fixtures/wpt/webstorage/storage_getitem.window.js                                  0000664 0000000 0000000 00000003351 14746647661 0025411 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();
        storage.setItem("name", "x");
        storage.setItem("undefined", "foo");
        storage.setItem("null", "bar");
        storage.setItem("", "baz");

        test(function() {
            assert_equals(storage.length, 4);
        }, "All items should be added to " + name + ".");

        test(function() {
            assert_equals(storage["unknown"], undefined, "storage['unknown']")
            assert_equals(storage["name"], "x", "storage['name']")
            assert_equals(storage["undefined"], "foo", "storage['undefined']")
            assert_equals(storage["null"], "bar", "storage['null']")
            assert_equals(storage[undefined], "foo", "storage[undefined]")
            assert_equals(storage[null], "bar", "storage[null]")
            assert_equals(storage[""], "baz", "storage['']")
        }, "Named access to " + name + " should be correct");

        test(function() {
            assert_equals(storage.getItem("unknown"), null, "storage.getItem('unknown')")
            assert_equals(storage.getItem("name"), "x", "storage.getItem('name')")
            assert_equals(storage.getItem("undefined"), "foo", "storage.getItem('undefined')")
            assert_equals(storage.getItem("null"), "bar", "storage.getItem('null')")
            assert_equals(storage.getItem(undefined), "foo", "storage.getItem(undefined)")
            assert_equals(storage.getItem(null), "bar", "storage.getItem(null)")
            assert_equals(storage.getItem(""), "baz", "storage.getItem('')")
        }, name + ".getItem should be correct")
    }, "Get value by getIten(key) and named access in " + name + ".");
});
                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/webstorage/storage_in.window.js                                       0000664 0000000 0000000 00000001311 14746647661 0024353 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();

        assert_false("name" in storage);
        storage["name"] = "user1";
        assert_true("name" in storage);
    }, "The in operator in " + name + ": property access");

    test(function() {
        var storage = window[name];
        storage.clear();

        assert_false("name" in storage);
        storage.setItem("name", "user1");
        assert_true("name" in storage);
        assert_equals(storage.name, "user1");
        storage.removeItem("name");
        assert_false("name" in storage);
    }, "The in operator in " + name + ": method access");
});
                                                                                                                                                                                                                                                                                                                       node-23.7.0/test/fixtures/wpt/webstorage/storage_indexing.window.js                                 0000664 0000000 0000000 00000002055 14746647661 0025560 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();
        storage["name"] = "user1";
        storage["age"] = "42";

        test(function() {
            assert_equals(storage[-1], undefined);
            assert_equals(storage[0], undefined);
            assert_equals(storage[1], undefined);
            assert_equals(storage[2], undefined);
        }, "Getting number properties on " + name);

        test(function() {
            assert_equals(storage["-1"], undefined);
            assert_equals(storage["0"], undefined);
            assert_equals(storage["1"], undefined);
            assert_equals(storage["2"], undefined);
        }, "Getting number-valued string properties on " + name);

        test(function() {
            storage.setItem(1, "number");
            assert_equals(storage[1], "number");
            assert_equals(storage["1"], "number");
        }, "Getting existing number-valued properties on " + name);
    }, "Indexed getter on " + name);
});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   node-23.7.0/test/fixtures/wpt/webstorage/storage_key.window.js                                      0000664 0000000 0000000 00000003263 14746647661 0024545 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();

        storage.setItem("name", "user1");
        storage.setItem("age", "20");
        storage.setItem("a", "1");
        storage.setItem("b", "2");

        var keys = ["name", "age", "a", "b"];
        function doTest(index) {
            test(function() {
                var key = storage.key(index);
                assert_not_equals(key, null);
                assert_true(keys.indexOf(key) >= 0,
                            "Unexpected key " + key + " found.");
            }, name + ".key(" + index + ") should return the right thing.");
        }
        for (var i = 0; i < keys.length; ++i) {
            doTest(i);
            doTest(i + 0x100000000);
        }

        test(function() {
            assert_equals(storage.key(-1), null, "storage.key(-1)");
            assert_equals(storage.key(4), null, "storage.key(4)");
        }, name + ".key() should return null for out-of-range arguments.");
    }, name + ".key");

    test(function() {
        var get_keys = function(s) {
            var keys = [];
            for (var i = 0; i < s.length; ++i) {
                keys.push(s.key(i));
            }
            return keys;
        };
        var storage = window[name];
        storage.clear();

        storage.setItem("name", "user1");
        storage.setItem("age", "20");
        storage.setItem("a", "1");
        storage.setItem("b", "2");

        var expected_keys = get_keys(storage);
        storage.setItem("name", "user2");
        assert_array_equals(get_keys(storage), expected_keys);
    }, name + ".key with value changes");
});
                                                                                                                                                                                                                                                                                                                                             node-23.7.0/test/fixtures/wpt/webstorage/storage_key_empty_string.window.js                         0000664 0000000 0000000 00000000436 14746647661 0027350 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function () {
      var storage = window[name];
      storage.clear();

      storage.setItem("", "empty string");
      assert_equals(storage.getItem(""), "empty string");

  }, name + ".key with empty string");
});
                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/storage_length.window.js                                   0000664 0000000 0000000 00000001276 14746647661 0025240 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();
        assert_equals(storage.length, 0, "storage.length")

        storage["name"] = "user1";
        storage["age"] = "20";

        assert_equals(storage.length, 2, "storage.length")
    }, name + ".length (method access)");

    test(function() {
        var storage = window[name];
        storage.clear();
        assert_equals(storage.length, 0, "storage.length")

        storage.setItem("name", "user1");
        storage.setItem("age", "20");

        assert_equals(storage.length, 2, "storage.length")
    }, name + ".length (proprty access)");
});
                                                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/storage_local-manual.html                                  0000664 0000000 0000000 00000002336 14746647661 0025344 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        <!DOCTYPE html>
<meta charset="utf-8">
<title>WebStorage Test: local storage</title>
<link rel="author" title="Intel" href="http://www.intel.com">
<meta name="flags" content="interact">

<h2>Description</h2>
<p>
  This test validates that store data using Local Storage which means that close the page, and re-open it, the data saved before should be loaded again.
</p>

<h2>Preconditions</h2>
<ol class="instructions">
  <li>
    Click the "Clear" button, refresh the page once and then check if the page shows "You have viewed this page 1 time(s)"
  </li>
  <li>
    Close the page, re-open it and then check if the page still shows "You have viewed this page 2 time(s)"
  </li>
  <li>
    If the above two steps are all true the test case pass, otherwise it fail
  </li>
</ol>

<p>
  <h2>You have viewed this page
  <span id="count">an untold number of</span>
  time(s).</h2>
  <button type="button" onclick="javascript:localStorage.pageLoadCount = 0;"><h3>Clear</h3></button>
</p>

<script>

    if (!localStorage.pageLoadCount) {
        localStorage.pageLoadCount = 0;
    }
    localStorage.pageLoadCount = parseInt(localStorage.pageLoadCount) + 1;
    document.getElementById('count').textContent = localStorage.pageLoadCount;

</script>
                                                                                                                                                                                                                                                                                                  node-23.7.0/test/fixtures/wpt/webstorage/storage_local_setitem_quotaexceedederr.window.js           0000664 0000000 0000000 00000000621 14746647661 0032205 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        test(function() {
    localStorage.clear();

    var index = 0;
    var key = "name";
    var val = "x".repeat(1024);

    assert_throws_dom("QUOTA_EXCEEDED_ERR", function() {
        while (true) {
            index++;
            localStorage.setItem("" + key + index, "" + val + index);
        }
    });

    localStorage.clear();
}, "Throws QuotaExceededError when the quota has been exceeded");
                                                                                                               node-23.7.0/test/fixtures/wpt/webstorage/storage_local_window_open.window.js                        0000664 0000000 0000000 00000001130 14746647661 0027446 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        async_test(function(t) {

    var storage = window.localStorage;
    storage.clear();

    storage.setItem("FOO", "BAR");
    var win = window.open("resources/storage_local_window_open_second.html");
    window.addEventListener('message', t.step_func(function(e) {
        e.data.forEach(t.step_func(function(assertion) {
            assert_equals(assertion.actual, assertion.expected, assertion.message);
        }));
        win.close();
        t.done();
    }));

}, "A new window to make sure there is a copy of the previous window's localStorage, and that they do not diverge after a change");
                                                                                                                                                                                                                                                                                                                                                                                                                                        node-23.7.0/test/fixtures/wpt/webstorage/storage_removeitem.window.js                               0000664 0000000 0000000 00000002542 14746647661 0026130 0                                                                                                    ustar 00root                            root                            0000000 0000000                                                                                                                                                                        ["localStorage", "sessionStorage"].forEach(function(name) {
    test(function() {
        var storage = window[name];
        storage.clear();

        storage.setItem("name", "user1");
        assert_equals(storage.getItem("name"), "user1");

        storage.removeItem("name");
        storage.removeItem("unknown");
        assert_equals(storage.getItem("name"), null, "storage.getItem('name')")
    }, name + ".removeItem()");

    test(function() {
        var storage = window[name];
        storage.clear(